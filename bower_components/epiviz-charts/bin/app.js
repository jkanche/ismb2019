!function(t,e){for(var i in e)t[i]=e[i]}(window,function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var n;
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */
!function(e,i){"use strict";"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(e)}("undefined"!=typeof window?window:this,function(i,r){"use strict";var a=[],o=i.document,s=Object.getPrototypeOf,u=a.slice,c=a.concat,l=a.push,p=a.indexOf,h={},d=h.toString,f=h.hasOwnProperty,v=f.toString,g=v.call(Object),m={},y=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},_=function(t){return null!=t&&t===t.window},z={type:!0,src:!0,noModule:!0};function b(t,e,i){var n,r=(e=e||o).createElement("script");if(r.text=t,i)for(n in z)i[n]&&(r[n]=i[n]);e.head.appendChild(r).parentNode.removeChild(r)}function w(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[d.call(t)]||"object":typeof t}var C=function(t,e){return new C.fn.init(t,e)},S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function x(t){var e=!!t&&"length"in t&&t.length,i=w(t);return!y(t)&&!_(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}C.fn=C.prototype={jquery:"3.3.1",constructor:C,length:0,toArray:function(){return u.call(this)},get:function(t){return null==t?u.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=C.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return C.each(this,t)},map:function(t){return this.pushStack(C.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(u.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:a.sort,splice:a.splice},C.extend=C.fn.extend=function(){var t,e,i,n,r,a,o=arguments[0]||{},s=1,u=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[s]||{},s++),"object"==typeof o||y(o)||(o={}),s===u&&(o=this,s--);s<u;s++)if(null!=(t=arguments[s]))for(e in t)i=o[e],o!==(n=t[e])&&(c&&n&&(C.isPlainObject(n)||(r=Array.isArray(n)))?(r?(r=!1,a=i&&Array.isArray(i)?i:[]):a=i&&C.isPlainObject(i)?i:{},o[e]=C.extend(c,a,n)):void 0!==n&&(o[e]=n));return o},C.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==d.call(t))&&(!(e=s(t))||"function"==typeof(i=f.call(e,"constructor")&&e.constructor)&&v.call(i)===g)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t){b(t)},each:function(t,e){var i,n=0;if(x(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(S,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(x(Object(t))?C.merge(i,"string"==typeof t?[t]:t):l.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:p.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,a=t.length,o=!i;r<a;r++)!e(t[r],r)!==o&&n.push(t[r]);return n},map:function(t,e,i){var n,r,a=0,o=[];if(x(t))for(n=t.length;a<n;a++)null!=(r=e(t[a],a,i))&&o.push(r);else for(a in t)null!=(r=e(t[a],a,i))&&o.push(r);return c.apply([],o)},guid:1,support:m}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=a[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){h["[object "+e+"]"]=e.toLowerCase()});var M=
/*!
 * Sizzle CSS Selector Engine v2.3.3
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-08-08
 */
function(t){var e,i,n,r,a,o,s,u,c,l,p,h,d,f,v,g,m,y,_,z="sizzle"+1*new Date,b=t.document,w=0,C=0,S=ot(),x=ot(),M=ot(),T=function(t,e){return t===e&&(p=!0),0},k={}.hasOwnProperty,E=[],A=E.pop,R=E.push,D=E.push,I=E.slice,L=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",O="[\\x20\\t\\r\\n\\f]",P="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",B="\\["+O+"*("+P+")(?:"+O+"*([*^$|!~]?=)"+O+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+O+"*\\]",q=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",G=new RegExp(O+"+","g"),V=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),W=new RegExp("^"+O+"*,"+O+"*"),U=new RegExp("^"+O+"*([>+~]|"+O+")"+O+"*"),F=new RegExp("="+O+"*([^\\]'\"]*?)"+O+"*\\]","g"),j=new RegExp(q),H=new RegExp("^"+P+"$"),Y={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),bool:new RegExp("^(?:"+N+")$","i"),needsContext:new RegExp("^"+O+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)","i")},$=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+O+"?|("+O+")|.)","ig"),tt=function(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},et=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,it=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},nt=function(){h()},rt=yt(function(t){return!0===t.disabled&&("form"in t||"label"in t)},{dir:"parentNode",next:"legend"});try{D.apply(E=I.call(b.childNodes),b.childNodes),E[b.childNodes.length].nodeType}catch(t){D={apply:E.length?function(t,e){R.apply(t,I.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function at(t,e,n,r){var a,s,c,l,p,f,m,y=e&&e.ownerDocument,w=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==w&&9!==w&&11!==w)return n;if(!r&&((e?e.ownerDocument||e:b)!==d&&h(e),e=e||d,v)){if(11!==w&&(p=J.exec(t)))if(a=p[1]){if(9===w){if(!(c=e.getElementById(a)))return n;if(c.id===a)return n.push(c),n}else if(y&&(c=y.getElementById(a))&&_(e,c)&&c.id===a)return n.push(c),n}else{if(p[2])return D.apply(n,e.getElementsByTagName(t)),n;if((a=p[3])&&i.getElementsByClassName&&e.getElementsByClassName)return D.apply(n,e.getElementsByClassName(a)),n}if(i.qsa&&!M[t+" "]&&(!g||!g.test(t))){if(1!==w)y=e,m=t;else if("object"!==e.nodeName.toLowerCase()){for((l=e.getAttribute("id"))?l=l.replace(et,it):e.setAttribute("id",l=z),s=(f=o(t)).length;s--;)f[s]="#"+l+" "+mt(f[s]);m=f.join(","),y=Q.test(t)&&vt(e.parentNode)||e}if(m)try{return D.apply(n,y.querySelectorAll(m)),n}catch(t){}finally{l===z&&e.removeAttribute("id")}}}return u(t.replace(V,"$1"),e,n,r)}function ot(){var t=[];return function e(i,r){return t.push(i+" ")>n.cacheLength&&delete e[t.shift()],e[i+" "]=r}}function st(t){return t[z]=!0,t}function ut(t){var e=d.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ct(t,e){for(var i=t.split("|"),r=i.length;r--;)n.attrHandle[i[r]]=e}function lt(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function pt(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ht(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function dt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&rt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ft(t){return st(function(e){return e=+e,st(function(i,n){for(var r,a=t([],i.length,e),o=a.length;o--;)i[r=a[o]]&&(i[r]=!(n[r]=i[r]))})})}function vt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=at.support={},a=at.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},h=at.setDocument=function(t){var e,r,o=t?t.ownerDocument||t:b;return o!==d&&9===o.nodeType&&o.documentElement?(f=(d=o).documentElement,v=!a(d),b!==d&&(r=d.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",nt,!1):r.attachEvent&&r.attachEvent("onunload",nt)),i.attributes=ut(function(t){return t.className="i",!t.getAttribute("className")}),i.getElementsByTagName=ut(function(t){return t.appendChild(d.createComment("")),!t.getElementsByTagName("*").length}),i.getElementsByClassName=K.test(d.getElementsByClassName),i.getById=ut(function(t){return f.appendChild(t).id=z,!d.getElementsByName||!d.getElementsByName(z).length}),i.getById?(n.filter.ID=function(t){var e=t.replace(Z,tt);return function(t){return t.getAttribute("id")===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&v){var i=e.getElementById(t);return i?[i]:[]}}):(n.filter.ID=function(t){var e=t.replace(Z,tt);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&v){var i,n,r,a=e.getElementById(t);if(a){if((i=a.getAttributeNode("id"))&&i.value===t)return[a];for(r=e.getElementsByName(t),n=0;a=r[n++];)if((i=a.getAttributeNode("id"))&&i.value===t)return[a]}return[]}}),n.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,a=e.getElementsByTagName(t);if("*"===t){for(;i=a[r++];)1===i.nodeType&&n.push(i);return n}return a},n.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&v)return e.getElementsByClassName(t)},m=[],g=[],(i.qsa=K.test(d.querySelectorAll))&&(ut(function(t){f.appendChild(t).innerHTML="<a id='"+z+"'></a><select id='"+z+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+O+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||g.push("\\["+O+"*(?:value|"+N+")"),t.querySelectorAll("[id~="+z+"-]").length||g.push("~="),t.querySelectorAll(":checked").length||g.push(":checked"),t.querySelectorAll("a#"+z+"+*").length||g.push(".#.+[+~]")}),ut(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=d.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&g.push("name"+O+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),f.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),g.push(",.*:")})),(i.matchesSelector=K.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ut(function(t){i.disconnectedMatch=y.call(t,"*"),y.call(t,"[s!='']:x"),m.push("!=",q)}),g=g.length&&new RegExp(g.join("|")),m=m.length&&new RegExp(m.join("|")),e=K.test(f.compareDocumentPosition),_=e||K.test(f.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},T=e?function(t,e){if(t===e)return p=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===n?t===d||t.ownerDocument===b&&_(b,t)?-1:e===d||e.ownerDocument===b&&_(b,e)?1:l?L(l,t)-L(l,e):0:4&n?-1:1)}:function(t,e){if(t===e)return p=!0,0;var i,n=0,r=t.parentNode,a=e.parentNode,o=[t],s=[e];if(!r||!a)return t===d?-1:e===d?1:r?-1:a?1:l?L(l,t)-L(l,e):0;if(r===a)return lt(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)s.unshift(i);for(;o[n]===s[n];)n++;return n?lt(o[n],s[n]):o[n]===b?-1:s[n]===b?1:0},d):d},at.matches=function(t,e){return at(t,null,null,e)},at.matchesSelector=function(t,e){if((t.ownerDocument||t)!==d&&h(t),e=e.replace(F,"='$1']"),i.matchesSelector&&v&&!M[e+" "]&&(!m||!m.test(e))&&(!g||!g.test(e)))try{var n=y.call(t,e);if(n||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return at(e,d,null,[t]).length>0},at.contains=function(t,e){return(t.ownerDocument||t)!==d&&h(t),_(t,e)},at.attr=function(t,e){(t.ownerDocument||t)!==d&&h(t);var r=n.attrHandle[e.toLowerCase()],a=r&&k.call(n.attrHandle,e.toLowerCase())?r(t,e,!v):void 0;return void 0!==a?a:i.attributes||!v?t.getAttribute(e):(a=t.getAttributeNode(e))&&a.specified?a.value:null},at.escape=function(t){return(t+"").replace(et,it)},at.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},at.uniqueSort=function(t){var e,n=[],r=0,a=0;if(p=!i.detectDuplicates,l=!i.sortStable&&t.slice(0),t.sort(T),p){for(;e=t[a++];)e===t[a]&&(r=n.push(a));for(;r--;)t.splice(n[r],1)}return l=null,t},r=at.getText=function(t){var e,i="",n=0,a=t.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=r(t)}else if(3===a||4===a)return t.nodeValue}else for(;e=t[n++];)i+=r(e);return i},(n=at.selectors={cacheLength:50,createPseudo:st,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Z,tt),t[3]=(t[3]||t[4]||t[5]||"").replace(Z,tt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||at.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&at.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return Y.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&j.test(i)&&(e=o(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Z,tt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=S[t+" "];return e||(e=new RegExp("(^|"+O+")"+t+"("+O+"|$)"))&&S(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,e,i){return function(n){var r=at.attr(n,t);return null==r?"!="===e:!e||(r+="","="===e?r===i:"!="===e?r!==i:"^="===e?i&&0===r.indexOf(i):"*="===e?i&&r.indexOf(i)>-1:"$="===e?i&&r.slice(-i.length)===i:"~="===e?(" "+r.replace(G," ")+" ").indexOf(i)>-1:"|="===e&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,n,r){var a="nth"!==t.slice(0,3),o="last"!==t.slice(-4),s="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,u){var c,l,p,h,d,f,v=a!==o?"nextSibling":"previousSibling",g=e.parentNode,m=s&&e.nodeName.toLowerCase(),y=!u&&!s,_=!1;if(g){if(a){for(;v;){for(h=e;h=h[v];)if(s?h.nodeName.toLowerCase()===m:1===h.nodeType)return!1;f=v="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?g.firstChild:g.lastChild],o&&y){for(_=(d=(c=(l=(p=(h=g)[z]||(h[z]={}))[h.uniqueID]||(p[h.uniqueID]={}))[t]||[])[0]===w&&c[1])&&c[2],h=d&&g.childNodes[d];h=++d&&h&&h[v]||(_=d=0)||f.pop();)if(1===h.nodeType&&++_&&h===e){l[t]=[w,d,_];break}}else if(y&&(_=d=(c=(l=(p=(h=e)[z]||(h[z]={}))[h.uniqueID]||(p[h.uniqueID]={}))[t]||[])[0]===w&&c[1]),!1===_)for(;(h=++d&&h&&h[v]||(_=d=0)||f.pop())&&((s?h.nodeName.toLowerCase()!==m:1!==h.nodeType)||!++_||(y&&((l=(p=h[z]||(h[z]={}))[h.uniqueID]||(p[h.uniqueID]={}))[t]=[w,_]),h!==e)););return(_-=r)===n||_%n==0&&_/n>=0}}},PSEUDO:function(t,e){var i,r=n.pseudos[t]||n.setFilters[t.toLowerCase()]||at.error("unsupported pseudo: "+t);return r[z]?r(e):r.length>1?(i=[t,t,"",e],n.setFilters.hasOwnProperty(t.toLowerCase())?st(function(t,i){for(var n,a=r(t,e),o=a.length;o--;)t[n=L(t,a[o])]=!(i[n]=a[o])}):function(t){return r(t,0,i)}):r}},pseudos:{not:st(function(t){var e=[],i=[],n=s(t.replace(V,"$1"));return n[z]?st(function(t,e,i,r){for(var a,o=n(t,null,r,[]),s=t.length;s--;)(a=o[s])&&(t[s]=!(e[s]=a))}):function(t,r,a){return e[0]=t,n(e,null,a,i),e[0]=null,!i.pop()}}),has:st(function(t){return function(e){return at(t,e).length>0}}),contains:st(function(t){return t=t.replace(Z,tt),function(e){return(e.textContent||e.innerText||r(e)).indexOf(t)>-1}}),lang:st(function(t){return H.test(t||"")||at.error("unsupported lang: "+t),t=t.replace(Z,tt).toLowerCase(),function(e){var i;do{if(i=v?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===f},focus:function(t){return t===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:dt(!1),disabled:dt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!n.pseudos.empty(t)},header:function(t){return X.test(t.nodeName)},input:function(t){return $.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ft(function(){return[0]}),last:ft(function(t,e){return[e-1]}),eq:ft(function(t,e,i){return[i<0?i+e:i]}),even:ft(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:ft(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:ft(function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t}),gt:ft(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[e]=pt(e);for(e in{submit:!0,reset:!0})n.pseudos[e]=ht(e);function gt(){}function mt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function yt(t,e,i){var n=e.dir,r=e.next,a=r||n,o=i&&"parentNode"===a,s=C++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||o)return t(e,i,r);return!1}:function(e,i,u){var c,l,p,h=[w,s];if(u){for(;e=e[n];)if((1===e.nodeType||o)&&t(e,i,u))return!0}else for(;e=e[n];)if(1===e.nodeType||o)if(l=(p=e[z]||(e[z]={}))[e.uniqueID]||(p[e.uniqueID]={}),r&&r===e.nodeName.toLowerCase())e=e[n]||e;else{if((c=l[a])&&c[0]===w&&c[1]===s)return h[2]=c[2];if(l[a]=h,h[2]=t(e,i,u))return!0}return!1}}function _t(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function zt(t,e,i,n,r){for(var a,o=[],s=0,u=t.length,c=null!=e;s<u;s++)(a=t[s])&&(i&&!i(a,n,r)||(o.push(a),c&&e.push(s)));return o}function bt(t,e,i,n,r,a){return n&&!n[z]&&(n=bt(n)),r&&!r[z]&&(r=bt(r,a)),st(function(a,o,s,u){var c,l,p,h=[],d=[],f=o.length,v=a||function(t,e,i){for(var n=0,r=e.length;n<r;n++)at(t,e[n],i);return i}(e||"*",s.nodeType?[s]:s,[]),g=!t||!a&&e?v:zt(v,h,t,s,u),m=i?r||(a?t:f||n)?[]:o:g;if(i&&i(g,m,s,u),n)for(c=zt(m,d),n(c,[],s,u),l=c.length;l--;)(p=c[l])&&(m[d[l]]=!(g[d[l]]=p));if(a){if(r||t){if(r){for(c=[],l=m.length;l--;)(p=m[l])&&c.push(g[l]=p);r(null,m=[],c,u)}for(l=m.length;l--;)(p=m[l])&&(c=r?L(a,p):h[l])>-1&&(a[c]=!(o[c]=p))}}else m=zt(m===o?m.splice(f,m.length):m),r?r(null,o,m,u):D.apply(o,m)})}function wt(t){for(var e,i,r,a=t.length,o=n.relative[t[0].type],s=o||n.relative[" "],u=o?1:0,l=yt(function(t){return t===e},s,!0),p=yt(function(t){return L(e,t)>-1},s,!0),h=[function(t,i,n){var r=!o&&(n||i!==c)||((e=i).nodeType?l(t,i,n):p(t,i,n));return e=null,r}];u<a;u++)if(i=n.relative[t[u].type])h=[yt(_t(h),i)];else{if((i=n.filter[t[u].type].apply(null,t[u].matches))[z]){for(r=++u;r<a&&!n.relative[t[r].type];r++);return bt(u>1&&_t(h),u>1&&mt(t.slice(0,u-1).concat({value:" "===t[u-2].type?"*":""})).replace(V,"$1"),i,u<r&&wt(t.slice(u,r)),r<a&&wt(t=t.slice(r)),r<a&&mt(t))}h.push(i)}return _t(h)}return gt.prototype=n.filters=n.pseudos,n.setFilters=new gt,o=at.tokenize=function(t,e){var i,r,a,o,s,u,c,l=x[t+" "];if(l)return e?0:l.slice(0);for(s=t,u=[],c=n.preFilter;s;){for(o in i&&!(r=W.exec(s))||(r&&(s=s.slice(r[0].length)||s),u.push(a=[])),i=!1,(r=U.exec(s))&&(i=r.shift(),a.push({value:i,type:r[0].replace(V," ")}),s=s.slice(i.length)),n.filter)!(r=Y[o].exec(s))||c[o]&&!(r=c[o](r))||(i=r.shift(),a.push({value:i,type:o,matches:r}),s=s.slice(i.length));if(!i)break}return e?s.length:s?at.error(t):x(t,u).slice(0)},s=at.compile=function(t,e){var i,r=[],a=[],s=M[t+" "];if(!s){for(e||(e=o(t)),i=e.length;i--;)(s=wt(e[i]))[z]?r.push(s):a.push(s);(s=M(t,function(t,e){var i=e.length>0,r=t.length>0,a=function(a,o,s,u,l){var p,f,g,m=0,y="0",_=a&&[],z=[],b=c,C=a||r&&n.find.TAG("*",l),S=w+=null==b?1:Math.random()||.1,x=C.length;for(l&&(c=o===d||o||l);y!==x&&null!=(p=C[y]);y++){if(r&&p){for(f=0,o||p.ownerDocument===d||(h(p),s=!v);g=t[f++];)if(g(p,o||d,s)){u.push(p);break}l&&(w=S)}i&&((p=!g&&p)&&m--,a&&_.push(p))}if(m+=y,i&&y!==m){for(f=0;g=e[f++];)g(_,z,o,s);if(a){if(m>0)for(;y--;)_[y]||z[y]||(z[y]=A.call(u));z=zt(z)}D.apply(u,z),l&&!a&&z.length>0&&m+e.length>1&&at.uniqueSort(u)}return l&&(w=S,c=b),_};return i?st(a):a}(a,r))).selector=t}return s},u=at.select=function(t,e,i,r){var a,u,c,l,p,h="function"==typeof t&&t,d=!r&&o(t=h.selector||t);if(i=i||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(c=u[0]).type&&9===e.nodeType&&v&&n.relative[u[1].type]){if(!(e=(n.find.ID(c.matches[0].replace(Z,tt),e)||[])[0]))return i;h&&(e=e.parentNode),t=t.slice(u.shift().value.length)}for(a=Y.needsContext.test(t)?0:u.length;a--&&(c=u[a],!n.relative[l=c.type]);)if((p=n.find[l])&&(r=p(c.matches[0].replace(Z,tt),Q.test(u[0].type)&&vt(e.parentNode)||e))){if(u.splice(a,1),!(t=r.length&&mt(u)))return D.apply(i,r),i;break}}return(h||s(t,d))(r,e,!v,i,!e||Q.test(t)&&vt(e.parentNode)||e),i},i.sortStable=z.split("").sort(T).join("")===z,i.detectDuplicates=!!p,h(),i.sortDetached=ut(function(t){return 1&t.compareDocumentPosition(d.createElement("fieldset"))}),ut(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||ct("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),i.attributes&&ut(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||ct("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),ut(function(t){return null==t.getAttribute("disabled")})||ct(N,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),at}(i);C.find=M,C.expr=M.selectors,C.expr[":"]=C.expr.pseudos,C.uniqueSort=C.unique=M.uniqueSort,C.text=M.getText,C.isXMLDoc=M.isXML,C.contains=M.contains,C.escapeSelector=M.escape;var T=function(t,e,i){for(var n=[],r=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&C(t).is(i))break;n.push(t)}return n},k=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},E=C.expr.match.needsContext;function A(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var R=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function D(t,e,i){return y(e)?C.grep(t,function(t,n){return!!e.call(t,n,t)!==i}):e.nodeType?C.grep(t,function(t){return t===e!==i}):"string"!=typeof e?C.grep(t,function(t){return p.call(e,t)>-1!==i}):C.filter(e,t,i)}C.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?C.find.matchesSelector(n,t)?[n]:[]:C.find.matches(t,C.grep(e,function(t){return 1===t.nodeType}))},C.fn.extend({find:function(t){var e,i,n=this.length,r=this;if("string"!=typeof t)return this.pushStack(C(t).filter(function(){for(e=0;e<n;e++)if(C.contains(r[e],this))return!0}));for(i=this.pushStack([]),e=0;e<n;e++)C.find(t,r[e],i);return n>1?C.uniqueSort(i):i},filter:function(t){return this.pushStack(D(this,t||[],!1))},not:function(t){return this.pushStack(D(this,t||[],!0))},is:function(t){return!!D(this,"string"==typeof t&&E.test(t)?C(t):t||[],!1).length}});var I,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||I,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:L.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof C?e[0]:e,C.merge(this,C.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:o,!0)),R.test(n[1])&&C.isPlainObject(e))for(n in e)y(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(r=o.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):y(t)?void 0!==i.ready?i.ready(t):t(C):C.makeArray(t,this)}).prototype=C.fn,I=C(o);var N=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}C.fn.extend({has:function(t){var e=C(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(C.contains(this,e[t]))return!0})},closest:function(t,e){var i,n=0,r=this.length,a=[],o="string"!=typeof t&&C(t);if(!E.test(t))for(;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&C.find.matchesSelector(i,t))){a.push(i);break}return this.pushStack(a.length>1?C.uniqueSort(a):a)},index:function(t){return t?"string"==typeof t?p.call(C(t),this[0]):p.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),C.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return T(t,"parentNode")},parentsUntil:function(t,e,i){return T(t,"parentNode",i)},next:function(t){return P(t,"nextSibling")},prev:function(t){return P(t,"previousSibling")},nextAll:function(t){return T(t,"nextSibling")},prevAll:function(t){return T(t,"previousSibling")},nextUntil:function(t,e,i){return T(t,"nextSibling",i)},prevUntil:function(t,e,i){return T(t,"previousSibling",i)},siblings:function(t){return k((t.parentNode||{}).firstChild,t)},children:function(t){return k(t.firstChild)},contents:function(t){return A(t,"iframe")?t.contentDocument:(A(t,"template")&&(t=t.content||t),C.merge([],t.childNodes))}},function(t,e){C.fn[t]=function(i,n){var r=C.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=C.filter(n,r)),this.length>1&&(O[t]||C.uniqueSort(r),N.test(t)&&r.reverse()),this.pushStack(r)}});var B=/[^\x20\t\r\n\f]+/g;function q(t){return t}function G(t){throw t}function V(t,e,i,n){var r;try{t&&y(r=t.promise)?r.call(t).done(e).fail(i):t&&y(r=t.then)?r.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}C.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return C.each(t.match(B)||[],function(t,i){e[i]=!0}),e}(t):C.extend({},t);var e,i,n,r,a=[],o=[],s=-1,u=function(){for(r=r||t.once,n=e=!0;o.length;s=-1)for(i=o.shift();++s<a.length;)!1===a[s].apply(i[0],i[1])&&t.stopOnFalse&&(s=a.length,i=!1);t.memory||(i=!1),e=!1,r&&(a=i?[]:"")},c={add:function(){return a&&(i&&!e&&(s=a.length-1,o.push(i)),function e(i){C.each(i,function(i,n){y(n)?t.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==w(n)&&e(n)})}(arguments),i&&!e&&u()),this},remove:function(){return C.each(arguments,function(t,e){for(var i;(i=C.inArray(e,a,i))>-1;)a.splice(i,1),i<=s&&s--}),this},has:function(t){return t?C.inArray(t,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return r=o=[],a=i="",this},disabled:function(){return!a},lock:function(){return r=o=[],i||e||(a=i=""),this},locked:function(){return!!r},fireWith:function(t,i){return r||(i=[t,(i=i||[]).slice?i.slice():i],o.push(i),e||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},C.extend({Deferred:function(t){var e=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},catch:function(t){return r.then(null,t)},pipe:function(){var t=arguments;return C.Deferred(function(i){C.each(e,function(e,n){var r=y(t[n[4]])&&t[n[4]];a[n[1]](function(){var t=r&&r.apply(this,arguments);t&&y(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,r?[t]:arguments)})}),t=null}).promise()},then:function(t,n,r){var a=0;function o(t,e,n,r){return function(){var s=this,u=arguments,c=function(){var i,c;if(!(t<a)){if((i=n.apply(s,u))===e.promise())throw new TypeError("Thenable self-resolution");c=i&&("object"==typeof i||"function"==typeof i)&&i.then,y(c)?r?c.call(i,o(a,e,q,r),o(a,e,G,r)):(a++,c.call(i,o(a,e,q,r),o(a,e,G,r),o(a,e,q,e.notifyWith))):(n!==q&&(s=void 0,u=[i]),(r||e.resolveWith)(s,u))}},l=r?c:function(){try{c()}catch(i){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(i,l.stackTrace),t+1>=a&&(n!==G&&(s=void 0,u=[i]),e.rejectWith(s,u))}};t?l():(C.Deferred.getStackHook&&(l.stackTrace=C.Deferred.getStackHook()),i.setTimeout(l))}}return C.Deferred(function(i){e[0][3].add(o(0,i,y(r)?r:q,i.notifyWith)),e[1][3].add(o(0,i,y(t)?t:q)),e[2][3].add(o(0,i,y(n)?n:G))}).promise()},promise:function(t){return null!=t?C.extend(t,r):r}},a={};return C.each(e,function(t,i){var o=i[2],s=i[5];r[i[1]]=o.add,s&&o.add(function(){n=s},e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),o.add(i[3].fire),a[i[0]]=function(){return a[i[0]+"With"](this===a?void 0:this,arguments),this},a[i[0]+"With"]=o.fireWith}),r.promise(a),t&&t.call(a,a),a},when:function(t){var e=arguments.length,i=e,n=Array(i),r=u.call(arguments),a=C.Deferred(),o=function(t){return function(i){n[t]=this,r[t]=arguments.length>1?u.call(arguments):i,--e||a.resolveWith(n,r)}};if(e<=1&&(V(t,a.done(o(i)).resolve,a.reject,!e),"pending"===a.state()||y(r[i]&&r[i].then)))return a.then();for(;i--;)V(r[i],o(i),a.reject);return a.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(t,e){i.console&&i.console.warn&&t&&W.test(t.name)&&i.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},C.readyException=function(t){i.setTimeout(function(){throw t})};var U=C.Deferred();function F(){o.removeEventListener("DOMContentLoaded",F),i.removeEventListener("load",F),C.ready()}C.fn.ready=function(t){return U.then(t).catch(function(t){C.readyException(t)}),this},C.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--C.readyWait:C.isReady)||(C.isReady=!0,!0!==t&&--C.readyWait>0||U.resolveWith(o,[C]))}}),C.ready.then=U.then,"complete"===o.readyState||"loading"!==o.readyState&&!o.documentElement.doScroll?i.setTimeout(C.ready):(o.addEventListener("DOMContentLoaded",F),i.addEventListener("load",F));var j=function(t,e,i,n,r,a,o){var s=0,u=t.length,c=null==i;if("object"===w(i))for(s in r=!0,i)j(t,e,s,i[s],!0,a,o);else if(void 0!==n&&(r=!0,y(n)||(o=!0),c&&(o?(e.call(t,n),e=null):(c=e,e=function(t,e,i){return c.call(C(t),i)})),e))for(;s<u;s++)e(t[s],i,o?n:n.call(t[s],s,e(t[s],i)));return r?t:c?e.call(t):u?e(t[0],i):a},H=/^-ms-/,Y=/-([a-z])/g;function $(t,e){return e.toUpperCase()}function X(t){return t.replace(H,"ms-").replace(Y,$)}var K=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function J(){this.expando=C.expando+J.uid++}J.uid=1,J.prototype={cache:function(t){var e=t[this.expando];return e||(e={},K(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[X(e)]=i;else for(n in e)r[X(n)]=e[n];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][X(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=Array.isArray(e)?e.map(X):(e=X(e))in n?[e]:e.match(B)||[]).length;for(;i--;)delete n[e[i]]}(void 0===e||C.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!C.isEmptyObject(e)}};var Q=new J,Z=new J,tt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,et=/[A-Z]/g;function it(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(et,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:tt.test(t)?JSON.parse(t):t)}(i)}catch(t){}Z.set(t,e,i)}else i=void 0;return i}C.extend({hasData:function(t){return Z.hasData(t)||Q.hasData(t)},data:function(t,e,i){return Z.access(t,e,i)},removeData:function(t,e){Z.remove(t,e)},_data:function(t,e,i){return Q.access(t,e,i)},_removeData:function(t,e){Q.remove(t,e)}}),C.fn.extend({data:function(t,e){var i,n,r,a=this[0],o=a&&a.attributes;if(void 0===t){if(this.length&&(r=Z.get(a),1===a.nodeType&&!Q.get(a,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&(n=X(n.slice(5)),it(a,n,r[n]));Q.set(a,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each(function(){Z.set(this,t)}):j(this,function(e){var i;if(a&&void 0===e)return void 0!==(i=Z.get(a,t))?i:void 0!==(i=it(a,t))?i:void 0;this.each(function(){Z.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Z.remove(this,t)})}}),C.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Q.get(t,e),i&&(!n||Array.isArray(i)?n=Q.access(t,e,C.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=C.queue(t,e),n=i.length,r=i.shift(),a=C._queueHooks(t,e);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete a.stop,r.call(t,function(){C.dequeue(t,e)},a)),!n&&a&&a.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Q.get(t,i)||Q.access(t,i,{empty:C.Callbacks("once memory").add(function(){Q.remove(t,[e+"queue",i])})})}}),C.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?C.queue(this[0],t):void 0===e?this:this.each(function(){var i=C.queue(this,t,e);C._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&C.dequeue(this,t)})},dequeue:function(t){return this.each(function(){C.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=C.Deferred(),a=this,o=this.length,s=function(){--n||r.resolveWith(a,[a])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=Q.get(a[o],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(s));return s(),r.promise(e)}});var nt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rt=new RegExp("^(?:([+-])=|)("+nt+")([a-z%]*)$","i"),at=["Top","Right","Bottom","Left"],ot=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&C.contains(t.ownerDocument,t)&&"none"===C.css(t,"display")},st=function(t,e,i,n){var r,a,o={};for(a in e)o[a]=t.style[a],t.style[a]=e[a];for(a in r=i.apply(t,n||[]),e)t.style[a]=o[a];return r};function ut(t,e,i,n){var r,a,o=20,s=n?function(){return n.cur()}:function(){return C.css(t,e,"")},u=s(),c=i&&i[3]||(C.cssNumber[e]?"":"px"),l=(C.cssNumber[e]||"px"!==c&&+u)&&rt.exec(C.css(t,e));if(l&&l[3]!==c){for(u/=2,c=c||l[3],l=+u||1;o--;)C.style(t,e,l+c),(1-a)*(1-(a=s()/u||.5))<=0&&(o=0),l/=a;l*=2,C.style(t,e,l+c),i=i||[]}return i&&(l=+l||+u||0,r=i[1]?l+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=l,n.end=r)),r}var ct={};function lt(t){var e,i=t.ownerDocument,n=t.nodeName,r=ct[n];return r||(e=i.body.appendChild(i.createElement(n)),r=C.css(e,"display"),e.parentNode.removeChild(e),"none"===r&&(r="block"),ct[n]=r,r)}function pt(t,e){for(var i,n,r=[],a=0,o=t.length;a<o;a++)(n=t[a]).style&&(i=n.style.display,e?("none"===i&&(r[a]=Q.get(n,"display")||null,r[a]||(n.style.display="")),""===n.style.display&&ot(n)&&(r[a]=lt(n))):"none"!==i&&(r[a]="none",Q.set(n,"display",i)));for(a=0;a<o;a++)null!=r[a]&&(t[a].style.display=r[a]);return t}C.fn.extend({show:function(){return pt(this,!0)},hide:function(){return pt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){ot(this)?C(this).show():C(this).hide()})}});var ht=/^(?:checkbox|radio)$/i,dt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ft=/^$|^module$|\/(?:java|ecma)script/i,vt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function gt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&A(t,e)?C.merge([t],i):i}function mt(t,e){for(var i=0,n=t.length;i<n;i++)Q.set(t[i],"globalEval",!e||Q.get(e[i],"globalEval"))}vt.optgroup=vt.option,vt.tbody=vt.tfoot=vt.colgroup=vt.caption=vt.thead,vt.th=vt.td;var yt,_t,zt=/<|&#?\w+;/;function bt(t,e,i,n,r){for(var a,o,s,u,c,l,p=e.createDocumentFragment(),h=[],d=0,f=t.length;d<f;d++)if((a=t[d])||0===a)if("object"===w(a))C.merge(h,a.nodeType?[a]:a);else if(zt.test(a)){for(o=o||p.appendChild(e.createElement("div")),s=(dt.exec(a)||["",""])[1].toLowerCase(),u=vt[s]||vt._default,o.innerHTML=u[1]+C.htmlPrefilter(a)+u[2],l=u[0];l--;)o=o.lastChild;C.merge(h,o.childNodes),(o=p.firstChild).textContent=""}else h.push(e.createTextNode(a));for(p.textContent="",d=0;a=h[d++];)if(n&&C.inArray(a,n)>-1)r&&r.push(a);else if(c=C.contains(a.ownerDocument,a),o=gt(p.appendChild(a),"script"),c&&mt(o),i)for(l=0;a=o[l++];)ft.test(a.type||"")&&i.push(a);return p}yt=o.createDocumentFragment().appendChild(o.createElement("div")),(_t=o.createElement("input")).setAttribute("type","radio"),_t.setAttribute("checked","checked"),_t.setAttribute("name","t"),yt.appendChild(_t),m.checkClone=yt.cloneNode(!0).cloneNode(!0).lastChild.checked,yt.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!yt.cloneNode(!0).lastChild.defaultValue;var wt=o.documentElement,Ct=/^key/,St=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,xt=/^([^.]*)(?:\.(.+)|)/;function Mt(){return!0}function Tt(){return!1}function kt(){try{return o.activeElement}catch(t){}}function Et(t,e,i,n,r,a){var o,s;if("object"==typeof e){for(s in"string"!=typeof i&&(n=n||i,i=void 0),e)Et(t,s,i,n,e[s],a);return t}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=Tt;else if(!r)return t;return 1===a&&(o=r,(r=function(t){return C().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=C.guid++)),t.each(function(){C.event.add(this,e,r,n,i)})}C.event={global:{},add:function(t,e,i,n,r){var a,o,s,u,c,l,p,h,d,f,v,g=Q.get(t);if(g)for(i.handler&&(i=(a=i).handler,r=a.selector),r&&C.find.matchesSelector(wt,r),i.guid||(i.guid=C.guid++),(u=g.events)||(u=g.events={}),(o=g.handle)||(o=g.handle=function(e){return void 0!==C&&C.event.triggered!==e.type?C.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(B)||[""]).length;c--;)d=v=(s=xt.exec(e[c])||[])[1],f=(s[2]||"").split(".").sort(),d&&(p=C.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,p=C.event.special[d]||{},l=C.extend({type:d,origType:v,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&C.expr.match.needsContext.test(r),namespace:f.join(".")},a),(h=u[d])||((h=u[d]=[]).delegateCount=0,p.setup&&!1!==p.setup.call(t,n,f,o)||t.addEventListener&&t.addEventListener(d,o)),p.add&&(p.add.call(t,l),l.handler.guid||(l.handler.guid=i.guid)),r?h.splice(h.delegateCount++,0,l):h.push(l),C.event.global[d]=!0)},remove:function(t,e,i,n,r){var a,o,s,u,c,l,p,h,d,f,v,g=Q.hasData(t)&&Q.get(t);if(g&&(u=g.events)){for(c=(e=(e||"").match(B)||[""]).length;c--;)if(d=v=(s=xt.exec(e[c])||[])[1],f=(s[2]||"").split(".").sort(),d){for(p=C.event.special[d]||{},h=u[d=(n?p.delegateType:p.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=h.length;a--;)l=h[a],!r&&v!==l.origType||i&&i.guid!==l.guid||s&&!s.test(l.namespace)||n&&n!==l.selector&&("**"!==n||!l.selector)||(h.splice(a,1),l.selector&&h.delegateCount--,p.remove&&p.remove.call(t,l));o&&!h.length&&(p.teardown&&!1!==p.teardown.call(t,f,g.handle)||C.removeEvent(t,d,g.handle),delete u[d])}else for(d in u)C.event.remove(t,d+e[c],i,n,!0);C.isEmptyObject(u)&&Q.remove(t,"handle events")}},dispatch:function(t){var e,i,n,r,a,o,s=C.event.fix(t),u=new Array(arguments.length),c=(Q.get(this,"events")||{})[s.type]||[],l=C.event.special[s.type]||{};for(u[0]=s,e=1;e<arguments.length;e++)u[e]=arguments[e];if(s.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,s)){for(o=C.event.handlers.call(this,s,c),e=0;(r=o[e++])&&!s.isPropagationStopped();)for(s.currentTarget=r.elem,i=0;(a=r.handlers[i++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(a.namespace)||(s.handleObj=a,s.data=a.data,void 0!==(n=((C.event.special[a.origType]||{}).handle||a.handler).apply(r.elem,u))&&!1===(s.result=n)&&(s.preventDefault(),s.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,s),s.result}},handlers:function(t,e){var i,n,r,a,o,s=[],u=e.delegateCount,c=t.target;if(u&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(a=[],o={},i=0;i<u;i++)void 0===o[r=(n=e[i]).selector+" "]&&(o[r]=n.needsContext?C(r,this).index(c)>-1:C.find(r,this,null,[c]).length),o[r]&&a.push(n);a.length&&s.push({elem:c,handlers:a})}return c=this,u<e.length&&s.push({elem:c,handlers:e.slice(u)}),s},addProp:function(t,e){Object.defineProperty(C.Event.prototype,t,{enumerable:!0,configurable:!0,get:y(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[C.expando]?t:new C.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==kt()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===kt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&A(this,"input"))return this.click(),!1},_default:function(t){return A(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},C.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},C.Event=function(t,e){if(!(this instanceof C.Event))return new C.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Mt:Tt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&C.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[C.expando]=!0},C.Event.prototype={constructor:C.Event,isDefaultPrevented:Tt,isPropagationStopped:Tt,isImmediatePropagationStopped:Tt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Mt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Mt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Mt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Ct.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&St.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},C.event.addProp),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){C.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=t.relatedTarget,r=t.handleObj;return n&&(n===this||C.contains(this,n))||(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),C.fn.extend({on:function(t,e,i,n){return Et(this,t,e,i,n)},one:function(t,e,i,n){return Et(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,C(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=Tt),this.each(function(){C.event.remove(this,t,i,e)})}});var At=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Rt=/<script|<style|<link/i,Dt=/checked\s*(?:[^=]|=\s*.checked.)/i,It=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Lt(t,e){return A(t,"table")&&A(11!==e.nodeType?e:e.firstChild,"tr")&&C(t).children("tbody")[0]||t}function Nt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Ot(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Pt(t,e){var i,n,r,a,o,s,u,c;if(1===e.nodeType){if(Q.hasData(t)&&(a=Q.access(t),o=Q.set(e,a),c=a.events))for(r in delete o.handle,o.events={},c)for(i=0,n=c[r].length;i<n;i++)C.event.add(e,r,c[r][i]);Z.hasData(t)&&(s=Z.access(t),u=C.extend({},s),Z.set(e,u))}}function Bt(t,e,i,n){e=c.apply([],e);var r,a,o,s,u,l,p=0,h=t.length,d=h-1,f=e[0],v=y(f);if(v||h>1&&"string"==typeof f&&!m.checkClone&&Dt.test(f))return t.each(function(r){var a=t.eq(r);v&&(e[0]=f.call(this,r,a.html())),Bt(a,e,i,n)});if(h&&(a=(r=bt(e,t[0].ownerDocument,!1,t,n)).firstChild,1===r.childNodes.length&&(r=a),a||n)){for(s=(o=C.map(gt(r,"script"),Nt)).length;p<h;p++)u=r,p!==d&&(u=C.clone(u,!0,!0),s&&C.merge(o,gt(u,"script"))),i.call(t[p],u,p);if(s)for(l=o[o.length-1].ownerDocument,C.map(o,Ot),p=0;p<s;p++)u=o[p],ft.test(u.type||"")&&!Q.access(u,"globalEval")&&C.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?C._evalUrl&&C._evalUrl(u.src):b(u.textContent.replace(It,""),l,u))}return t}function qt(t,e,i){for(var n,r=e?C.filter(e,t):t,a=0;null!=(n=r[a]);a++)i||1!==n.nodeType||C.cleanData(gt(n)),n.parentNode&&(i&&C.contains(n.ownerDocument,n)&&mt(gt(n,"script")),n.parentNode.removeChild(n));return t}C.extend({htmlPrefilter:function(t){return t.replace(At,"<$1></$2>")},clone:function(t,e,i){var n,r,a,o,s,u,c,l=t.cloneNode(!0),p=C.contains(t.ownerDocument,t);if(!(m.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||C.isXMLDoc(t)))for(o=gt(l),n=0,r=(a=gt(t)).length;n<r;n++)s=a[n],u=o[n],c=void 0,"input"===(c=u.nodeName.toLowerCase())&&ht.test(s.type)?u.checked=s.checked:"input"!==c&&"textarea"!==c||(u.defaultValue=s.defaultValue);if(e)if(i)for(a=a||gt(t),o=o||gt(l),n=0,r=a.length;n<r;n++)Pt(a[n],o[n]);else Pt(t,l);return(o=gt(l,"script")).length>0&&mt(o,!p&&gt(t,"script")),l},cleanData:function(t){for(var e,i,n,r=C.event.special,a=0;void 0!==(i=t[a]);a++)if(K(i)){if(e=i[Q.expando]){if(e.events)for(n in e.events)r[n]?C.event.remove(i,n):C.removeEvent(i,n,e.handle);i[Q.expando]=void 0}i[Z.expando]&&(i[Z.expando]=void 0)}}}),C.fn.extend({detach:function(t){return qt(this,t,!0)},remove:function(t){return qt(this,t)},text:function(t){return j(this,function(t){return void 0===t?C.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return Bt(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Lt(this,t).appendChild(t)})},prepend:function(){return Bt(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Lt(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return Bt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Bt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(C.cleanData(gt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return C.clone(this,t,e)})},html:function(t){return j(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Rt.test(t)&&!vt[(dt.exec(t)||["",""])[1].toLowerCase()]){t=C.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(C.cleanData(gt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return Bt(this,arguments,function(e){var i=this.parentNode;C.inArray(this,t)<0&&(C.cleanData(gt(this)),i&&i.replaceChild(e,this))},t)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){C.fn[t]=function(t){for(var i,n=[],r=C(t),a=r.length-1,o=0;o<=a;o++)i=o===a?this:this.clone(!0),C(r[o])[e](i),l.apply(n,i.get());return this.pushStack(n)}});var Gt=new RegExp("^("+nt+")(?!px)[a-z%]+$","i"),Vt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=i),e.getComputedStyle(t)},Wt=new RegExp(at.join("|"),"i");function Ut(t,e,i){var n,r,a,o,s=t.style;return(i=i||Vt(t))&&(""!==(o=i.getPropertyValue(e)||i[e])||C.contains(t.ownerDocument,t)||(o=C.style(t,e)),!m.pixelBoxStyles()&&Gt.test(o)&&Wt.test(e)&&(n=s.width,r=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=i.width,s.width=n,s.minWidth=r,s.maxWidth=a)),void 0!==o?o+"":o}function Ft(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",wt.appendChild(c).appendChild(l);var t=i.getComputedStyle(l);n="1%"!==t.top,u=12===e(t.marginLeft),l.style.right="60%",s=36===e(t.right),r=36===e(t.width),l.style.position="absolute",a=36===l.offsetWidth||"absolute",wt.removeChild(c),l=null}}function e(t){return Math.round(parseFloat(t))}var n,r,a,s,u,c=o.createElement("div"),l=o.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===l.style.backgroundClip,C.extend(m,{boxSizingReliable:function(){return t(),r},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),n},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),a}}))}();var jt=/^(none|table(?!-c[ea]).+)/,Ht=/^--/,Yt={position:"absolute",visibility:"hidden",display:"block"},$t={letterSpacing:"0",fontWeight:"400"},Xt=["Webkit","Moz","ms"],Kt=o.createElement("div").style;function Jt(t){var e=C.cssProps[t];return e||(e=C.cssProps[t]=function(t){if(t in Kt)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=Xt.length;i--;)if((t=Xt[i]+e)in Kt)return t}(t)||t),e}function Qt(t,e,i){var n=rt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function Zt(t,e,i,n,r,a){var o="width"===e?1:0,s=0,u=0;if(i===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(u+=C.css(t,i+at[o],!0,r)),n?("content"===i&&(u-=C.css(t,"padding"+at[o],!0,r)),"margin"!==i&&(u-=C.css(t,"border"+at[o]+"Width",!0,r))):(u+=C.css(t,"padding"+at[o],!0,r),"padding"!==i?u+=C.css(t,"border"+at[o]+"Width",!0,r):s+=C.css(t,"border"+at[o]+"Width",!0,r));return!n&&a>=0&&(u+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-a-u-s-.5))),u}function te(t,e,i){var n=Vt(t),r=Ut(t,e,n),a="border-box"===C.css(t,"boxSizing",!1,n),o=a;if(Gt.test(r)){if(!i)return r;r="auto"}return o=o&&(m.boxSizingReliable()||r===t.style[e]),("auto"===r||!parseFloat(r)&&"inline"===C.css(t,"display",!1,n))&&(r=t["offset"+e[0].toUpperCase()+e.slice(1)],o=!0),(r=parseFloat(r)||0)+Zt(t,e,i||(a?"border":"content"),o,n,r)+"px"}function ee(t,e,i,n,r){return new ee.prototype.init(t,e,i,n,r)}C.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Ut(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,a,o,s=X(e),u=Ht.test(e),c=t.style;if(u||(e=Jt(s)),o=C.cssHooks[e]||C.cssHooks[s],void 0===i)return o&&"get"in o&&void 0!==(r=o.get(t,!1,n))?r:c[e];"string"===(a=typeof i)&&(r=rt.exec(i))&&r[1]&&(i=ut(t,e,r),a="number"),null!=i&&i==i&&("number"===a&&(i+=r&&r[3]||(C.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(u?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,n){var r,a,o,s=X(e);return Ht.test(e)||(e=Jt(s)),(o=C.cssHooks[e]||C.cssHooks[s])&&"get"in o&&(r=o.get(t,!0,i)),void 0===r&&(r=Ut(t,e,n)),"normal"===r&&e in $t&&(r=$t[e]),""===i||i?(a=parseFloat(r),!0===i||isFinite(a)?a||0:r):r}}),C.each(["height","width"],function(t,e){C.cssHooks[e]={get:function(t,i,n){if(i)return!jt.test(C.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?te(t,e,n):st(t,Yt,function(){return te(t,e,n)})},set:function(t,i,n){var r,a=Vt(t),o="border-box"===C.css(t,"boxSizing",!1,a),s=n&&Zt(t,e,n,o,a);return o&&m.scrollboxSize()===a.position&&(s-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(a[e])-Zt(t,e,"border",!1,a)-.5)),s&&(r=rt.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=C.css(t,e)),Qt(0,i,s)}}}),C.cssHooks.marginLeft=Ft(m.reliableMarginLeft,function(t,e){if(e)return(parseFloat(Ut(t,"marginLeft"))||t.getBoundingClientRect().left-st(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),C.each({margin:"",padding:"",border:"Width"},function(t,e){C.cssHooks[t+e]={expand:function(i){for(var n=0,r={},a="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+at[n]+e]=a[n]||a[n-2]||a[0];return r}},"margin"!==t&&(C.cssHooks[t+e].set=Qt)}),C.fn.extend({css:function(t,e){return j(this,function(t,e,i){var n,r,a={},o=0;if(Array.isArray(e)){for(n=Vt(t),r=e.length;o<r;o++)a[e[o]]=C.css(t,e[o],!1,n);return a}return void 0!==i?C.style(t,e,i):C.css(t,e)},t,e,arguments.length>1)}}),C.Tween=ee,ee.prototype={constructor:ee,init:function(t,e,i,n,r,a){this.elem=t,this.prop=i,this.easing=r||C.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=a||(C.cssNumber[i]?"":"px")},cur:function(){var t=ee.propHooks[this.prop];return t&&t.get?t.get(this):ee.propHooks._default.get(this)},run:function(t){var e,i=ee.propHooks[this.prop];return this.options.duration?this.pos=e=C.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):ee.propHooks._default.set(this),this}},ee.prototype.init.prototype=ee.prototype,ee.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=C.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){C.fx.step[t.prop]?C.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[C.cssProps[t.prop]]&&!C.cssHooks[t.prop]?t.elem[t.prop]=t.now:C.style(t.elem,t.prop,t.now+t.unit)}}},ee.propHooks.scrollTop=ee.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},C.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},C.fx=ee.prototype.init,C.fx.step={};var ie,ne,re=/^(?:toggle|show|hide)$/,ae=/queueHooks$/;function oe(){ne&&(!1===o.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(oe):i.setTimeout(oe,C.fx.interval),C.fx.tick())}function se(){return i.setTimeout(function(){ie=void 0}),ie=Date.now()}function ue(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)r["margin"+(i=at[n])]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function ce(t,e,i){for(var n,r=(le.tweeners[e]||[]).concat(le.tweeners["*"]),a=0,o=r.length;a<o;a++)if(n=r[a].call(i,e,t))return n}function le(t,e,i){var n,r,a=0,o=le.prefilters.length,s=C.Deferred().always(function(){delete u.elem}),u=function(){if(r)return!1;for(var e=ie||se(),i=Math.max(0,c.startTime+c.duration-e),n=1-(i/c.duration||0),a=0,o=c.tweens.length;a<o;a++)c.tweens[a].run(n);return s.notifyWith(t,[c,n,i]),n<1&&o?i:(o||s.notifyWith(t,[c,1,0]),s.resolveWith(t,[c]),!1)},c=s.promise({elem:t,props:C.extend({},e),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},i),originalProperties:e,originalOptions:i,startTime:ie||se(),duration:i.duration,tweens:[],createTween:function(e,i){var n=C.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var i=0,n=e?c.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)c.tweens[i].run(1);return e?(s.notifyWith(t,[c,1,0]),s.resolveWith(t,[c,e])):s.rejectWith(t,[c,e]),this}}),l=c.props;for(!function(t,e){var i,n,r,a,o;for(i in t)if(r=e[n=X(i)],a=t[i],Array.isArray(a)&&(r=a[1],a=t[i]=a[0]),i!==n&&(t[n]=a,delete t[i]),(o=C.cssHooks[n])&&"expand"in o)for(i in a=o.expand(a),delete t[n],a)i in t||(t[i]=a[i],e[i]=r);else e[n]=r}(l,c.opts.specialEasing);a<o;a++)if(n=le.prefilters[a].call(c,t,l,c.opts))return y(n.stop)&&(C._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return C.map(l,ce,c),y(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),C.fx.timer(C.extend(u,{elem:t,anim:c,queue:c.opts.queue})),c}C.Animation=C.extend(le,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return ut(i.elem,t,rt.exec(e),i),i}]},tweener:function(t,e){y(t)?(e=t,t=["*"]):t=t.match(B);for(var i,n=0,r=t.length;n<r;n++)i=t[n],le.tweeners[i]=le.tweeners[i]||[],le.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var n,r,a,o,s,u,c,l,p="width"in e||"height"in e,h=this,d={},f=t.style,v=t.nodeType&&ot(t),g=Q.get(t,"fxshow");for(n in i.queue||(null==(o=C._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,h.always(function(){h.always(function(){o.unqueued--,C.queue(t,"fx").length||o.empty.fire()})})),e)if(r=e[n],re.test(r)){if(delete e[n],a=a||"toggle"===r,r===(v?"hide":"show")){if("show"!==r||!g||void 0===g[n])continue;v=!0}d[n]=g&&g[n]||C.style(t,n)}if((u=!C.isEmptyObject(e))||!C.isEmptyObject(d))for(n in p&&1===t.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=Q.get(t,"display")),"none"===(l=C.css(t,"display"))&&(c?l=c:(pt([t],!0),c=t.style.display||c,l=C.css(t,"display"),pt([t]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===C.css(t,"float")&&(u||(h.done(function(){f.display=c}),null==c&&(l=f.display,c="none"===l?"":l)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",h.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),u=!1,d)u||(g?"hidden"in g&&(v=g.hidden):g=Q.access(t,"fxshow",{display:c}),a&&(g.hidden=!v),v&&pt([t],!0),h.done(function(){for(n in v||pt([t]),Q.remove(t,"fxshow"),d)C.style(t,n,d[n])})),u=ce(v?g[n]:0,n,h),n in g||(g[n]=u.start,v&&(u.end=u.start,u.start=0))}],prefilter:function(t,e){e?le.prefilters.unshift(t):le.prefilters.push(t)}}),C.speed=function(t,e,i){var n=t&&"object"==typeof t?C.extend({},t):{complete:i||!i&&e||y(t)&&t,duration:t,easing:i&&e||e&&!y(e)&&e};return C.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in C.fx.speeds?n.duration=C.fx.speeds[n.duration]:n.duration=C.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){y(n.old)&&n.old.call(this),n.queue&&C.dequeue(this,n.queue)},n},C.fn.extend({fadeTo:function(t,e,i,n){return this.filter(ot).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=C.isEmptyObject(t),a=C.speed(e,i,n),o=function(){var e=le(this,C.extend({},t),a);(r||Q.get(this,"finish"))&&e.stop(!0)};return o.finish=o,r||!1===a.queue?this.each(o):this.queue(a.queue,o)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",a=C.timers,o=Q.get(this);if(r)o[r]&&o[r].stop&&n(o[r]);else for(r in o)o[r]&&o[r].stop&&ae.test(r)&&n(o[r]);for(r=a.length;r--;)a[r].elem!==this||null!=t&&a[r].queue!==t||(a[r].anim.stop(i),e=!1,a.splice(r,1));!e&&i||C.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var e,i=Q.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],a=C.timers,o=n?n.length:0;for(i.finish=!0,C.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=a.length;e--;)a[e].elem===this&&a[e].queue===t&&(a[e].anim.stop(!0),a.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),C.each(["toggle","show","hide"],function(t,e){var i=C.fn[e];C.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(ue(e,!0),t,n,r)}}),C.each({slideDown:ue("show"),slideUp:ue("hide"),slideToggle:ue("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){C.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),C.timers=[],C.fx.tick=function(){var t,e=0,i=C.timers;for(ie=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||C.fx.stop(),ie=void 0},C.fx.timer=function(t){C.timers.push(t),C.fx.start()},C.fx.interval=13,C.fx.start=function(){ne||(ne=!0,oe())},C.fx.stop=function(){ne=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(t,e){return t=C.fx&&C.fx.speeds[t]||t,e=e||"fx",this.queue(e,function(e,n){var r=i.setTimeout(e,t);n.stop=function(){i.clearTimeout(r)}})},function(){var t=o.createElement("input"),e=o.createElement("select").appendChild(o.createElement("option"));t.type="checkbox",m.checkOn=""!==t.value,m.optSelected=e.selected,(t=o.createElement("input")).value="t",t.type="radio",m.radioValue="t"===t.value}();var pe,he=C.expr.attrHandle;C.fn.extend({attr:function(t,e){return j(this,C.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){C.removeAttr(this,t)})}}),C.extend({attr:function(t,e,i){var n,r,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===t.getAttribute?C.prop(t,e,i):(1===a&&C.isXMLDoc(t)||(r=C.attrHooks[e.toLowerCase()]||(C.expr.match.bool.test(e)?pe:void 0)),void 0!==i?null===i?void C.removeAttr(t,e):r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:null==(n=C.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!m.radioValue&&"radio"===e&&A(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,r=e&&e.match(B);if(r&&1===t.nodeType)for(;i=r[n++];)t.removeAttribute(i)}}),pe={set:function(t,e,i){return!1===e?C.removeAttr(t,i):t.setAttribute(i,i),i}},C.each(C.expr.match.bool.source.match(/\w+/g),function(t,e){var i=he[e]||C.find.attr;he[e]=function(t,e,n){var r,a,o=e.toLowerCase();return n||(a=he[o],he[o]=r,r=null!=i(t,e,n)?o:null,he[o]=a),r}});var de=/^(?:input|select|textarea|button)$/i,fe=/^(?:a|area)$/i;function ve(t){return(t.match(B)||[]).join(" ")}function ge(t){return t.getAttribute&&t.getAttribute("class")||""}function me(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(B)||[]}C.fn.extend({prop:function(t,e){return j(this,C.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[C.propFix[t]||t]})}}),C.extend({prop:function(t,e,i){var n,r,a=t.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&C.isXMLDoc(t)||(e=C.propFix[e]||e,r=C.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=C.find.attr(t,"tabindex");return e?parseInt(e,10):de.test(t.nodeName)||fe.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(C.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){C.propFix[this.toLowerCase()]=this}),C.fn.extend({addClass:function(t){var e,i,n,r,a,o,s,u=0;if(y(t))return this.each(function(e){C(this).addClass(t.call(this,e,ge(this)))});if((e=me(t)).length)for(;i=this[u++];)if(r=ge(i),n=1===i.nodeType&&" "+ve(r)+" "){for(o=0;a=e[o++];)n.indexOf(" "+a+" ")<0&&(n+=a+" ");r!==(s=ve(n))&&i.setAttribute("class",s)}return this},removeClass:function(t){var e,i,n,r,a,o,s,u=0;if(y(t))return this.each(function(e){C(this).removeClass(t.call(this,e,ge(this)))});if(!arguments.length)return this.attr("class","");if((e=me(t)).length)for(;i=this[u++];)if(r=ge(i),n=1===i.nodeType&&" "+ve(r)+" "){for(o=0;a=e[o++];)for(;n.indexOf(" "+a+" ")>-1;)n=n.replace(" "+a+" "," ");r!==(s=ve(n))&&i.setAttribute("class",s)}return this},toggleClass:function(t,e){var i=typeof t,n="string"===i||Array.isArray(t);return"boolean"==typeof e&&n?e?this.addClass(t):this.removeClass(t):y(t)?this.each(function(i){C(this).toggleClass(t.call(this,i,ge(this),e),e)}):this.each(function(){var e,r,a,o;if(n)for(r=0,a=C(this),o=me(t);e=o[r++];)a.hasClass(e)?a.removeClass(e):a.addClass(e);else void 0!==t&&"boolean"!==i||((e=ge(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Q.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+ve(ge(i))+" ").indexOf(e)>-1)return!0;return!1}});var ye=/\r/g;C.fn.extend({val:function(t){var e,i,n,r=this[0];return arguments.length?(n=y(t),this.each(function(i){var r;1===this.nodeType&&(null==(r=n?t.call(this,i,C(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=C.map(r,function(t){return null==t?"":t+""})),(e=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))})):r?(e=C.valHooks[r.type]||C.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(ye,""):null==i?"":i:void 0}}),C.extend({valHooks:{option:{get:function(t){var e=C.find.attr(t,"value");return null!=e?e:ve(C.text(t))}},select:{get:function(t){var e,i,n,r=t.options,a=t.selectedIndex,o="select-one"===t.type,s=o?null:[],u=o?a+1:r.length;for(n=a<0?u:o?a:0;n<u;n++)if(((i=r[n]).selected||n===a)&&!i.disabled&&(!i.parentNode.disabled||!A(i.parentNode,"optgroup"))){if(e=C(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,n,r=t.options,a=C.makeArray(e),o=r.length;o--;)((n=r[o]).selected=C.inArray(C.valHooks.option.get(n),a)>-1)&&(i=!0);return i||(t.selectedIndex=-1),a}}}}),C.each(["radio","checkbox"],function(){C.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=C.inArray(C(t).val(),e)>-1}},m.checkOn||(C.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),m.focusin="onfocusin"in i;var _e=/^(?:focusinfocus|focusoutblur)$/,ze=function(t){t.stopPropagation()};C.extend(C.event,{trigger:function(t,e,n,r){var a,s,u,c,l,p,h,d,v=[n||o],g=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];if(s=d=u=n=n||o,3!==n.nodeType&&8!==n.nodeType&&!_e.test(g+C.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),l=g.indexOf(":")<0&&"on"+g,(t=t[C.expando]?t:new C.Event(g,"object"==typeof t&&t)).isTrigger=r?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:C.makeArray(e,[t]),h=C.event.special[g]||{},r||!h.trigger||!1!==h.trigger.apply(n,e))){if(!r&&!h.noBubble&&!_(n)){for(c=h.delegateType||g,_e.test(c+g)||(s=s.parentNode);s;s=s.parentNode)v.push(s),u=s;u===(n.ownerDocument||o)&&v.push(u.defaultView||u.parentWindow||i)}for(a=0;(s=v[a++])&&!t.isPropagationStopped();)d=s,t.type=a>1?c:h.bindType||g,(p=(Q.get(s,"events")||{})[t.type]&&Q.get(s,"handle"))&&p.apply(s,e),(p=l&&s[l])&&p.apply&&K(s)&&(t.result=p.apply(s,e),!1===t.result&&t.preventDefault());return t.type=g,r||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(v.pop(),e)||!K(n)||l&&y(n[g])&&!_(n)&&((u=n[l])&&(n[l]=null),C.event.triggered=g,t.isPropagationStopped()&&d.addEventListener(g,ze),n[g](),t.isPropagationStopped()&&d.removeEventListener(g,ze),C.event.triggered=void 0,u&&(n[l]=u)),t.result}},simulate:function(t,e,i){var n=C.extend(new C.Event,i,{type:t,isSimulated:!0});C.event.trigger(n,null,e)}}),C.fn.extend({trigger:function(t,e){return this.each(function(){C.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return C.event.trigger(t,e,i,!0)}}),m.focusin||C.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){C.event.simulate(e,t.target,C.event.fix(t))};C.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=Q.access(n,e);r||n.addEventListener(t,i,!0),Q.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=Q.access(n,e)-1;r?Q.access(n,e,r):(n.removeEventListener(t,i,!0),Q.remove(n,e))}}});var be=i.location,we=Date.now(),Ce=/\?/;C.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new i.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||C.error("Invalid XML: "+t),e};var Se=/\[\]$/,xe=/\r?\n/g,Me=/^(?:submit|button|image|reset|file)$/i,Te=/^(?:input|select|textarea|keygen)/i;function ke(t,e,i,n){var r;if(Array.isArray(e))C.each(e,function(e,r){i||Se.test(t)?n(t,r):ke(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,i,n)});else if(i||"object"!==w(e))n(t,e);else for(r in e)ke(t+"["+r+"]",e[r],i,n)}C.param=function(t,e){var i,n=[],r=function(t,e){var i=y(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(t)||t.jquery&&!C.isPlainObject(t))C.each(t,function(){r(this.name,this.value)});else for(i in t)ke(i,t[i],e,r);return n.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=C.prop(this,"elements");return t?C.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!C(this).is(":disabled")&&Te.test(this.nodeName)&&!Me.test(t)&&(this.checked||!ht.test(t))}).map(function(t,e){var i=C(this).val();return null==i?null:Array.isArray(i)?C.map(i,function(t){return{name:e.name,value:t.replace(xe,"\r\n")}}):{name:e.name,value:i.replace(xe,"\r\n")}}).get()}});var Ee=/%20/g,Ae=/#.*$/,Re=/([?&])_=[^&]*/,De=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ie=/^(?:GET|HEAD)$/,Le=/^\/\//,Ne={},Oe={},Pe="*/".concat("*"),Be=o.createElement("a");function qe(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,a=e.toLowerCase().match(B)||[];if(y(i))for(;n=a[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function Ge(t,e,i,n){var r={},a=t===Oe;function o(s){var u;return r[s]=!0,C.each(t[s]||[],function(t,s){var c=s(e,i,n);return"string"!=typeof c||a||r[c]?a?!(u=c):void 0:(e.dataTypes.unshift(c),o(c),!1)}),u}return o(e.dataTypes[0])||!r["*"]&&o("*")}function Ve(t,e){var i,n,r=C.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&C.extend(!0,t,n),t}Be.href=be.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:be.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(be.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Pe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Ve(Ve(t,C.ajaxSettings),e):Ve(C.ajaxSettings,t)},ajaxPrefilter:qe(Ne),ajaxTransport:qe(Oe),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r,a,s,u,c,l,p,h,d,f=C.ajaxSetup({},e),v=f.context||f,g=f.context&&(v.nodeType||v.jquery)?C(v):C.event,m=C.Deferred(),y=C.Callbacks("once memory"),_=f.statusCode||{},z={},b={},w="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(l){if(!s)for(s={};e=De.exec(a);)s[e[1].toLowerCase()]=e[2];e=s[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return l?a:null},setRequestHeader:function(t,e){return null==l&&(t=b[t.toLowerCase()]=b[t.toLowerCase()]||t,z[t]=e),this},overrideMimeType:function(t){return null==l&&(f.mimeType=t),this},statusCode:function(t){var e;if(t)if(l)S.always(t[S.status]);else for(e in t)_[e]=[_[e],t[e]];return this},abort:function(t){var e=t||w;return n&&n.abort(e),x(0,e),this}};if(m.promise(S),f.url=((t||f.url||be.href)+"").replace(Le,be.protocol+"//"),f.type=e.method||e.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(B)||[""],null==f.crossDomain){c=o.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Be.protocol+"//"+Be.host!=c.protocol+"//"+c.host}catch(t){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=C.param(f.data,f.traditional)),Ge(Ne,f,e,S),l)return S;for(h in(p=C.event&&f.global)&&0==C.active++&&C.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Ie.test(f.type),r=f.url.replace(Ae,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Ee,"+")):(d=f.url.slice(r.length),f.data&&(f.processData||"string"==typeof f.data)&&(r+=(Ce.test(r)?"&":"?")+f.data,delete f.data),!1===f.cache&&(r=r.replace(Re,"$1"),d=(Ce.test(r)?"&":"?")+"_="+we+++d),f.url=r+d),f.ifModified&&(C.lastModified[r]&&S.setRequestHeader("If-Modified-Since",C.lastModified[r]),C.etag[r]&&S.setRequestHeader("If-None-Match",C.etag[r])),(f.data&&f.hasContent&&!1!==f.contentType||e.contentType)&&S.setRequestHeader("Content-Type",f.contentType),S.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Pe+"; q=0.01":""):f.accepts["*"]),f.headers)S.setRequestHeader(h,f.headers[h]);if(f.beforeSend&&(!1===f.beforeSend.call(v,S,f)||l))return S.abort();if(w="abort",y.add(f.complete),S.done(f.success),S.fail(f.error),n=Ge(Oe,f,e,S)){if(S.readyState=1,p&&g.trigger("ajaxSend",[S,f]),l)return S;f.async&&f.timeout>0&&(u=i.setTimeout(function(){S.abort("timeout")},f.timeout));try{l=!1,n.send(z,x)}catch(t){if(l)throw t;x(-1,t)}}else x(-1,"No Transport");function x(t,e,o,s){var c,h,d,z,b,w=e;l||(l=!0,u&&i.clearTimeout(u),n=void 0,a=s||"",S.readyState=t>0?4:0,c=t>=200&&t<300||304===t,o&&(z=function(t,e,i){for(var n,r,a,o,s=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in s)if(s[r]&&s[r].test(n)){u.unshift(r);break}if(u[0]in i)a=u[0];else{for(r in i){if(!u[0]||t.converters[r+" "+u[0]]){a=r;break}o||(o=r)}a=a||o}if(a)return a!==u[0]&&u.unshift(a),i[a]}(f,S,o)),z=function(t,e,i,n){var r,a,o,s,u,c={},l=t.dataTypes.slice();if(l[1])for(o in t.converters)c[o.toLowerCase()]=t.converters[o];for(a=l.shift();a;)if(t.responseFields[a]&&(i[t.responseFields[a]]=e),!u&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=a,a=l.shift())if("*"===a)a=u;else if("*"!==u&&u!==a){if(!(o=c[u+" "+a]||c["* "+a]))for(r in c)if((s=r.split(" "))[1]===a&&(o=c[u+" "+s[0]]||c["* "+s[0]])){!0===o?o=c[r]:!0!==c[r]&&(a=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+u+" to "+a}}}return{state:"success",data:e}}(f,z,S,c),c?(f.ifModified&&((b=S.getResponseHeader("Last-Modified"))&&(C.lastModified[r]=b),(b=S.getResponseHeader("etag"))&&(C.etag[r]=b)),204===t||"HEAD"===f.type?w="nocontent":304===t?w="notmodified":(w=z.state,h=z.data,c=!(d=z.error))):(d=w,!t&&w||(w="error",t<0&&(t=0))),S.status=t,S.statusText=(e||w)+"",c?m.resolveWith(v,[h,w,S]):m.rejectWith(v,[S,w,d]),S.statusCode(_),_=void 0,p&&g.trigger(c?"ajaxSuccess":"ajaxError",[S,f,c?h:d]),y.fireWith(v,[S,w]),p&&(g.trigger("ajaxComplete",[S,f]),--C.active||C.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,i){return C.get(t,e,i,"json")},getScript:function(t,e){return C.get(t,void 0,e,"script")}}),C.each(["get","post"],function(t,e){C[e]=function(t,i,n,r){return y(i)&&(r=r||n,n=i,i=void 0),C.ajax(C.extend({url:t,type:e,dataType:r,data:i,success:n},C.isPlainObject(t)&&t))}}),C._evalUrl=function(t){return C.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},C.fn.extend({wrapAll:function(t){var e;return this[0]&&(y(t)&&(t=t.call(this[0])),e=C(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return y(t)?this.each(function(e){C(this).wrapInner(t.call(this,e))}):this.each(function(){var e=C(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=y(t);return this.each(function(i){C(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){C(this).replaceWith(this.childNodes)}),this}}),C.expr.pseudos.hidden=function(t){return!C.expr.pseudos.visible(t)},C.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(t){}};var We={0:200,1223:204},Ue=C.ajaxSettings.xhr();m.cors=!!Ue&&"withCredentials"in Ue,m.ajax=Ue=!!Ue,C.ajaxTransport(function(t){var e,n;if(m.cors||Ue&&!t.crossDomain)return{send:function(r,a){var o,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)s[o]=t.xhrFields[o];for(o in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)s.setRequestHeader(o,r[o]);e=function(t){return function(){e&&(e=n=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===t?s.abort():"error"===t?"number"!=typeof s.status?a(0,"error"):a(s.status,s.statusText):a(We[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=e(),n=s.onerror=s.ontimeout=e("error"),void 0!==s.onabort?s.onabort=n:s.onreadystatechange=function(){4===s.readyState&&i.setTimeout(function(){e&&n()})},e=e("abort");try{s.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),C.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return C.globalEval(t),t}}}),C.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),C.ajaxTransport("script",function(t){var e,i;if(t.crossDomain)return{send:function(n,r){e=C("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),o.head.appendChild(e[0])},abort:function(){i&&i()}}});var Fe,je=[],He=/(=)\?(?=&|$)|\?\?/;C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=je.pop()||C.expando+"_"+we++;return this[t]=!0,t}}),C.ajaxPrefilter("json jsonp",function(t,e,n){var r,a,o,s=!1!==t.jsonp&&(He.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&He.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=y(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(He,"$1"+r):!1!==t.jsonp&&(t.url+=(Ce.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return o||C.error(r+" was not called"),o[0]},t.dataTypes[0]="json",a=i[r],i[r]=function(){o=arguments},n.always(function(){void 0===a?C(i).removeProp(r):i[r]=a,t[r]&&(t.jsonpCallback=e.jsonpCallback,je.push(r)),o&&y(a)&&a(o[0]),o=a=void 0}),"script"}),m.createHTMLDocument=((Fe=o.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Fe.childNodes.length),C.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(m.createHTMLDocument?((n=(e=o.implementation.createHTMLDocument("")).createElement("base")).href=o.location.href,e.head.appendChild(n)):e=o),a=!i&&[],(r=R.exec(t))?[e.createElement(r[1])]:(r=bt([t],e,a),a&&a.length&&C(a).remove(),C.merge([],r.childNodes)));var n,r,a},C.fn.load=function(t,e,i){var n,r,a,o=this,s=t.indexOf(" ");return s>-1&&(n=ve(t.slice(s)),t=t.slice(0,s)),y(e)?(i=e,e=void 0):e&&"object"==typeof e&&(r="POST"),o.length>0&&C.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){a=arguments,o.html(n?C("<div>").append(C.parseHTML(t)).find(n):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,a||[t.responseText,e,t])})}),this},C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){C.fn[e]=function(t){return this.on(e,t)}}),C.expr.pseudos.animated=function(t){return C.grep(C.timers,function(e){return t===e.elem}).length},C.offset={setOffset:function(t,e,i){var n,r,a,o,s,u,c=C.css(t,"position"),l=C(t),p={};"static"===c&&(t.style.position="relative"),s=l.offset(),a=C.css(t,"top"),u=C.css(t,"left"),("absolute"===c||"fixed"===c)&&(a+u).indexOf("auto")>-1?(o=(n=l.position()).top,r=n.left):(o=parseFloat(a)||0,r=parseFloat(u)||0),y(e)&&(e=e.call(t,i,C.extend({},s))),null!=e.top&&(p.top=e.top-s.top+o),null!=e.left&&(p.left=e.left-s.left+r),"using"in e?e.using.call(t,p):l.css(p)}},C.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){C.offset.setOffset(this,t,e)});var e,i,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,n=this[0],r={top:0,left:0};if("fixed"===C.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===C.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((r=C(t).offset()).top+=C.css(t,"borderTopWidth",!0),r.left+=C.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-C.css(n,"marginTop",!0),left:e.left-r.left-C.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===C.css(t,"position");)t=t.offsetParent;return t||wt})}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;C.fn[t]=function(n){return j(this,function(t,n,r){var a;if(_(t)?a=t:9===t.nodeType&&(a=t.defaultView),void 0===r)return a?a[e]:t[n];a?a.scrollTo(i?a.pageXOffset:r,i?r:a.pageYOffset):t[n]=r},t,n,arguments.length)}}),C.each(["top","left"],function(t,e){C.cssHooks[e]=Ft(m.pixelPosition,function(t,i){if(i)return i=Ut(t,e),Gt.test(i)?C(t).position()[e]+"px":i})}),C.each({Height:"height",Width:"width"},function(t,e){C.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){C.fn[n]=function(r,a){var o=arguments.length&&(i||"boolean"!=typeof r),s=i||(!0===r||!0===a?"margin":"border");return j(this,function(e,i,r){var a;return _(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(a=e.documentElement,Math.max(e.body["scroll"+t],a["scroll"+t],e.body["offset"+t],a["offset"+t],a["client"+t])):void 0===r?C.css(e,i,s):C.style(e,i,r,s)},e,o?r:void 0,o)}})}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){C.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),C.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),C.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),C.proxy=function(t,e){var i,n,r;if("string"==typeof e&&(i=t[e],e=t,t=i),y(t))return n=u.call(arguments,2),(r=function(){return t.apply(e||this,n.concat(u.call(arguments)))}).guid=t.guid=t.guid||C.guid++,r},C.holdReady=function(t){t?C.readyWait++:C.ready(!0)},C.isArray=Array.isArray,C.parseJSON=JSON.parse,C.nodeName=A,C.isFunction=y,C.isWindow=_,C.camelCase=X,C.type=w,C.now=Date.now,C.isNumeric=function(t){var e=C.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},void 0===(n=function(){return C}.apply(e,[]))||(t.exports=n);var Ye=i.jQuery,$e=i.$;return C.noConflict=function(t){return i.$===C&&(i.$=$e),t&&i.jQuery===C&&(i.jQuery=Ye),C},r||(i.jQuery=i.$=C),C})},function(t,e,i){"use strict";i(0),i(2),i(8);var n=i(4),r=i(5);t.exports={sprintf:n,epiviz:r}},function(t,e,i){var n,r,a;
/*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */r=[i(0),i(3)],void 0===(a="function"==typeof(n=function(t){var e,i=0,n=Array.prototype.slice;return t.cleanData=(e=t.cleanData,function(i){var n,r,a;for(a=0;null!=(r=i[a]);a++)try{(n=t._data(r,"events"))&&n.remove&&t(r).triggerHandler("remove")}catch(t){}e(i)}),t.widget=function(e,i,n){var r,a,o,s={},u=e.split(".")[0],c=u+"-"+(e=e.split(".")[1]);return n||(n=i,i=t.Widget),t.isArray(n)&&(n=t.extend.apply(null,[{}].concat(n))),t.expr[":"][c.toLowerCase()]=function(e){return!!t.data(e,c)},t[u]=t[u]||{},r=t[u][e],a=t[u][e]=function(t,e){if(!this._createWidget)return new a(t,e);arguments.length&&this._createWidget(t,e)},t.extend(a,r,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),(o=new i).options=t.widget.extend({},o.options),t.each(n,function(e,n){t.isFunction(n)?s[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function r(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=r,e=n.apply(this,arguments),this._super=i,this._superApply=a,e}}():s[e]=n}),a.prototype=t.widget.extend(o,{widgetEventPrefix:r&&o.widgetEventPrefix||e},s,{constructor:a,namespace:u,widgetName:e,widgetFullName:c}),r?(t.each(r._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete r._childConstructors):i._childConstructors.push(a),t.widget.bridge(e,a),a},t.widget.extend=function(e){for(var i,r,a=n.call(arguments,1),o=0,s=a.length;o<s;o++)for(i in a[o])r=a[o][i],a[o].hasOwnProperty(i)&&void 0!==r&&(t.isPlainObject(r)?e[i]=t.isPlainObject(e[i])?t.widget.extend({},e[i],r):t.widget.extend({},r):e[i]=r);return e},t.widget.bridge=function(e,i){var r=i.prototype.widgetFullName||e;t.fn[e]=function(a){var o="string"==typeof a,s=n.call(arguments,1),u=this;return o?this.length||"instance"!==a?this.each(function(){var i,n=t.data(this,r);return"instance"===a?(u=n,!1):n?t.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,s))!==n&&void 0!==i?(u=i&&i.jquery?u.pushStack(i.get()):i,!1):void 0:t.error("no such method '"+a+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+a+"'")}):u=void 0:(s.length&&(a=t.widget.extend.apply(null,[a].concat(s))),this.each(function(){var e=t.data(this,r);e?(e.option(a||{}),e._init&&e._init()):t.data(this,r,new i(a,this))})),u}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var n,r,a,o=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(o={},n=e.split("."),e=n.shift(),n.length){for(r=o[e]=t.widget.extend({},this.options[e]),a=0;a<n.length-1;a++)r[n[a]]=r[n[a]]||{},r=r[n[a]];if(e=n.pop(),1===arguments.length)return void 0===r[e]?null:r[e];r[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=i}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,n,r;for(i in e)r=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&r&&r.length&&(n=t(r.get()),this._removeClass(r,i),n.addClass(this._classes({element:n,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){var i=[],n=this;function r(r,a){var o,s;for(s=0;s<r.length;s++)o=n.classesElementLookup[r[s]]||t(),o=e.add?t(t.unique(o.get().concat(e.element.get()))):t(o.not(e.element).get()),n.classesElementLookup[r[s]]=o,i.push(r[s]),a&&e.classes[r[s]]&&i.push(e.classes[r[s]])}return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&r(e.keys.match(/\S+/g)||[],!0),e.extra&&r(e.extra.match(/\S+/g)||[]),i.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(n,r){-1!==t.inArray(e.target,r)&&(i.classesElementLookup[n]=t(r.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,n){n="boolean"==typeof n?n:i;var r="string"==typeof t||null===t,a={extra:r?e:i,keys:r?t:e,element:r?this.element:t,add:n};return a.element.toggleClass(this._classes(a),n),this},_on:function(e,i,n){var r,a=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=r=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),t.each(n,function(n,o){function s(){if(e||!0!==a.options.disabled&&!t(this).hasClass("ui-state-disabled"))return("string"==typeof o?a[o]:o).apply(a,arguments)}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||t.guid++);var u=n.match(/^([\w:-]*)\s*(.*)$/),c=u[1]+a.eventNamespace,l=u[2];l?r.on(c,l,s):i.on(c,s)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var i=this;return setTimeout(function(){return("string"==typeof t?i[t]:t).apply(i,arguments)},e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,n){var r,a,o=this.options[e];if(n=n||{},(i=t.Event(i)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(r in a)r in i||(i[r]=a[r]);return this.element.trigger(i,n),!(t.isFunction(o)&&!1===o.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,a){var o;"string"==typeof r&&(r={effect:r});var s=r?!0===r||"number"==typeof r?i:r.effect||i:e;"number"==typeof(r=r||{})&&(r={duration:r}),o=!t.isEmptyObject(r),r.complete=a,r.delay&&n.delay(r.delay),o&&t.effects&&t.effects.effect[s]?n[e](r):s!==e&&n[s]?n[s](r.duration,r.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}}),t.widget})?n.apply(e,r):n)||(t.exports=a)},function(t,e,i){var n,r,a;r=[i(0)],void 0===(a="function"==typeof(n=function(t){return t.ui=t.ui||{},t.ui.version="1.12.1"})?n.apply(e,r):n)||(t.exports=a)},function(t,e){var i=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t,e){for(var i=[];e>0;i[--e]=t);return i.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.object_stringify=function(t,e,i,r){var a="";if(null!=t)switch(typeof t){case"function":return"[Function"+(t.name?": "+t.name:"")+"]";case"object":if(t instanceof Error)return"["+t.toString()+"]";if(e>=i)return"[Object]";if(r&&(r=r.slice(0)).push(t),null!=t.length){a+="[";var o=[];for(var s in t)r&&r.indexOf(t[s])>=0?o.push("[Circular]"):o.push(n.object_stringify(t[s],e+1,i,r));a+=o.join(", ")+"]"}else{if("getMonth"in t)return"Date("+t+")";a+="{";o=[];for(var u in t)t.hasOwnProperty(u)&&(r&&r.indexOf(t[u])>=0?o.push(u+": [Circular]"):o.push(u+": "+n.object_stringify(t[u],e+1,i,r)));a+=o.join(", ")+"}"}return a;case"string":return'"'+t+'"'}return""+t},n.format=function(r,a){var o,s,u,c,l,p,h,d=1,f=r.length,v="",g=[];for(s=0;s<f;s++)if("string"===(v=t(r[s])))g.push(r[s]);else if("array"===v){if((c=r[s])[2])for(o=a[d],u=0;u<c[2].length;u++){if(!o.hasOwnProperty(c[2][u]))throw new Error(i('[sprintf] property "%s" does not exist',c[2][u]));o=o[c[2][u]]}else o=c[1]?a[c[1]]:a[d++];if(/[^sO]/.test(c[8])&&"number"!=t(o))throw new Error(i('[sprintf] expecting number but found %s "'+o+'"',t(o)));switch(c[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=c[7]?o.toExponential(c[7]):o.toExponential();break;case"f":o=c[7]?parseFloat(o).toFixed(c[7]):parseFloat(o);break;case"O":o=n.object_stringify(o,0,parseInt(c[7])||5);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&c[7]?o.substring(0,c[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(c[8])&&c[3]&&o>=0?"+"+o:o,p=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",h=c[6]-String(o).length,l=c[6]?e(p,h):"",g.push(c[5]?o+l:l+o)}return g.join("")},n.cache={},n.parse=function(t){for(var e=t,i=[],n=[],r=0;e;){if(null!==(i=/^[^\x25]+/.exec(e)))n.push(i[0]);else if(null!==(i=/^\x25{2}/.exec(e)))n.push("%");else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosOuxX])/.exec(e)))throw new Error("[sprintf] "+e);if(i[2]){r|=1;var a=[],o=i[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(o)))throw new Error("[sprintf] "+o);for(a.push(s[1]);""!==(o=o.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(o)))a.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(o)))throw new Error("[sprintf] "+o);a.push(s[1])}i[2]=a}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push(i)}e=e.substring(i[0].length)}return n},n}();t.exports=i,i.sprintf=i,i.vsprintf=function(t,e){var n=e.slice();return n.unshift(t),i.apply(null,n)}},function(t,e,i){"use strict";t.exports=i(6).epiviz},function(module,exports,__webpack_require__){(function(global){var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){if(i.get||i.set)throw new TypeError("ES3 does not support getters and setters.");t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},$jscomp.getGlobal=function(t){return"undefined"!=typeof window&&window===t?t:void 0!==global&&null!=global?global:t},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(t){return $jscomp.SYMBOL_PREFIX+(t||"")+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var t=$jscomp.global.Symbol.iterator;t||(t=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&$jscomp.defineProperty(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(t){var e=0;return $jscomp.iteratorPrototype(function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}})},$jscomp.iteratorPrototype=function(t){return $jscomp.initSymbolIterator(),(t={next:t})[$jscomp.global.Symbol.iterator]=function(){return this},t},$jscomp.array=$jscomp.array||{},$jscomp.iteratorFromArray=function(t,e){$jscomp.initSymbolIterator(),t instanceof String&&(t+="");var i=0,n={next:function(){if(i<t.length){var r=i++;return{value:e(r,t[r]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},$jscomp.polyfill=function(t,e,i,n){if(e){for(i=$jscomp.global,t=t.split("."),n=0;n<t.length-1;n++){var r=t[n];r in i||(i[r]={}),i=i[r]}(e=e(n=i[t=t[t.length-1]]))!=n&&null!=e&&$jscomp.defineProperty(i,t,{configurable:!0,writable:!0,value:e})}},$jscomp.polyfill("Array.prototype.keys",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(t){return t})}},"es6-impl","es3"),$jscomp.polyfill("Array.prototype.values",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(t,e){return e})}},"es6","es3"),$jscomp.checkStringArgs=function(t,e,i){if(null==t)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return t+""},$jscomp.polyfill("String.prototype.includes",function(t){return t||function(t,e){return-1!==$jscomp.checkStringArgs(this,t,"includes").indexOf(t,e||0)}},"es6-impl","es3"),$jscomp.findInternal=function(t,e,i){t instanceof String&&(t=String(t));for(var n=t.length,r=0;r<n;r++){var a=t[r];if(e.call(i,a,r,t))return{i:r,v:a}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(t){return t||function(t,e){return $jscomp.findInternal(this,t,e).v}},"es6-impl","es3");var COMPILED=!0,goog=goog||{};goog.global=this,goog.isDef=function(t){return void 0!==t},goog.exportPath_=function(t,e,i){t=t.split("."),i=i||goog.global,t[0]in i||!i.execScript||i.execScript("var "+t[0]);for(var n;t.length&&(n=t.shift());)!t.length&&goog.isDef(e)?i[n]=e:i=i[n]?i[n]:i[n]={}},goog.define=function(t,e){var i=e;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,t)?i=goog.global.CLOSURE_UNCOMPILED_DEFINES[t]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,t)&&(i=goog.global.CLOSURE_DEFINES[t])),goog.exportPath_(t,i)},goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!1,goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(t){if(goog.isInModuleLoader_())throw Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');goog.constructNamespace_(t)},goog.constructNamespace_=function(t,e){if(!COMPILED){delete goog.implicitNamespaces_[t];for(var i=t;(i=i.substring(0,i.lastIndexOf(".")))&&!goog.getObjectByName(i);)goog.implicitNamespaces_[i]=!0}goog.exportPath_(t,e)},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(t){if(!goog.isString(t)||!t||-1==t.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+t+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=t,!COMPILED){if(goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');delete goog.implicitNamespaces_[t]}},goog.module.get=function(t){return goog.module.getInternal_(t)},goog.module.getInternal_=function(t){if(!COMPILED){if(t in goog.loadedModules_)return goog.loadedModules_[t];if(!goog.implicitNamespaces_[t])return null!=(t=goog.getObjectByName(t))?t:null}return null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(t){if(goog.DISALLOW_TEST_ONLY_CODE)throw t=t||"",Error("Importing test-only code into non-debug environment"+(t?": "+t:"."))},goog.forwardDeclare=function(t){},COMPILED||(goog.isProvided_=function(t){return t in goog.loadedModules_||!goog.implicitNamespaces_[t]&&goog.isDefAndNotNull(goog.getObjectByName(t))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(t,e){for(var i,n=t.split("."),r=e||goog.global;i=n.shift();){if(!goog.isDefAndNotNull(r[i]))return null;r=r[i]}return r},goog.globalize=function(t,e){var i,n=e||goog.global;for(i in t)n[i]=t[i]},goog.addDependency=function(t,e,i,n){if(goog.DEPENDENCIES_ENABLED){var r;t=t.replace(/\\/g,"/");var a=goog.dependencies_;n&&"boolean"!=typeof n||(n=n?{module:"goog"}:{});for(var o=0;r=e[o];o++)a.nameToPath[r]=t,a.loadFlags[t]=n;for(n=0;e=i[n];n++)t in a.requires||(a.requires[t]={}),a.requires[t][e]=!0}},goog.ENABLE_DEBUG_LOADER=!0,goog.logToConsole_=function(t){goog.global.console&&goog.global.console.error(t)},goog.require=function(t){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(t),goog.isProvided_(t)){if(goog.isInModuleLoader_())return goog.module.getInternal_(t)}else if(goog.ENABLE_DEBUG_LOADER){var e=goog.getPathFromDeps_(t);if(!e)throw t="goog.require could not find: "+t,goog.logToConsole_(t),Error(t);goog.writeScripts_(e)}return null}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(t){t.instance_=void 0,t.getInstance=function(){return t.instance_?t.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=t),t.instance_=new t)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.TRANSPILE="detect",goog.TRANSPILER="transpile.js",goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={loadFlags:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var t=goog.global.document;return null!=t&&"write"in t},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var t=goog.global.document.getElementsByTagName("SCRIPT"),e=t.length-1;0<=e;--e){var i=t[e].src,n=-1==(n=i.lastIndexOf("?"))?i.length:n;if("base.js"==i.substr(n-7,7)){goog.basePath=i.substr(0,n-7);break}}},goog.importScript_=function(t,e){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(t,e)&&(goog.dependencies_.written[t]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importProcessedScript_=function(t,e,i){goog.importScript_("",'goog.retrieveAndExec_("'+t+'", '+e+", "+i+");")},goog.queuedModules_=[],goog.wrapModule_=function(t,e){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(e+"\n//# sourceURL="+t+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+e+"\n;return exports});\n//# sourceURL="+t+"\n"},goog.loadQueuedModules_=function(){var t=goog.queuedModules_.length;if(0<t){var e=goog.queuedModules_;goog.queuedModules_=[];for(var i=0;i<t;i++)goog.maybeProcessDeferredPath_(e[i])}},goog.maybeProcessDeferredDep_=function(t){goog.isDeferredModule_(t)&&goog.allDepsAreAvailable_(t)&&(t=goog.getPathFromDeps_(t),goog.maybeProcessDeferredPath_(goog.basePath+t))},goog.isDeferredModule_=function(t){var e=(t=goog.getPathFromDeps_(t))&&goog.dependencies_.loadFlags[t]||{},i=e.lang||"es3";return!(!t||"goog"!=e.module&&!goog.needsTranspile_(i))&&goog.basePath+t in goog.dependencies_.deferred},goog.allDepsAreAvailable_=function(t){if((t=goog.getPathFromDeps_(t))&&t in goog.dependencies_.requires)for(var e in goog.dependencies_.requires[t])if(!goog.isProvided_(e)&&!goog.isDeferredModule_(e))return!1;return!0},goog.maybeProcessDeferredPath_=function(t){if(t in goog.dependencies_.deferred){var e=goog.dependencies_.deferred[t];delete goog.dependencies_.deferred[t],goog.globalEval(e)}},goog.loadModuleFromUrl=function(t){goog.retrieveAndExec_(t,!0,!1)},goog.writeScriptSrcNode_=function(t){goog.global.document.write('<script type="text/javascript" src="'+t+'"><\/script>')},goog.appendScriptSrcNode_=function(t){var e=goog.global.document,i=e.createElement("script");i.type="text/javascript",i.src=t,i.defer=!1,i.async=!1,e.head.appendChild(i)},goog.writeScriptTag_=function(t,e){if(goog.inHtmlDocument_()){var i=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==i.readyState){if(/\bdeps.js$/.test(t))return!1;throw Error('Cannot write "'+t+'" after document load')}if(void 0===e)if(goog.IS_OLD_IE_){var n=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";i.write('<script type="text/javascript" src="'+t+'"'+n+"><\/script>")}else goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(t):goog.writeScriptSrcNode_(t);else i.write('<script type="text/javascript">'+goog.protectScriptTag_(e)+"<\/script>");return!0}return!1},goog.protectScriptTag_=function(t){return t.replace(/<\/(SCRIPT)/gi,"\\x3c\\$1")},goog.needsTranspile_=function(t){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(goog.requiresTranspilation_||(goog.requiresTranspilation_=goog.createRequiresTranspilation_()),t in goog.requiresTranspilation_)return goog.requiresTranspilation_[t];throw Error("Unknown language mode: "+t)},goog.requiresTranspilation_=null,goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(t,e){return"complete"==t.readyState&&goog.lastNonModuleScriptIndex_==e&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(t){var e=[],i={},n=goog.dependencies_;for(function t(r){if(!(r in n.written||r in n.visited)){if(n.visited[r]=!0,r in n.requires)for(var a in n.requires[r])if(!goog.isProvided_(a)){if(!(a in n.nameToPath))throw Error("Undefined nameToPath for "+a);t(n.nameToPath[a])}r in i||(i[r]=!0,e.push(r))}}(t),t=0;t<e.length;t++){var r=e[t];goog.dependencies_.written[r]=!0}var a=goog.moduleLoaderState_;for(goog.moduleLoaderState_=null,t=0;t<e.length;t++){if(!(r=e[t]))throw goog.moduleLoaderState_=a,Error("Undefined script input");var o=n.loadFlags[r]||{},s=goog.needsTranspile_(o.lang||"es3");"goog"==o.module||s?goog.importProcessedScript_(goog.basePath+r,"goog"==o.module,s):goog.importScript_(goog.basePath+r)}goog.moduleLoaderState_=a},goog.getPathFromDeps_=function(t){return t in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[t]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.loadModule=function(t){var e=goog.moduleLoaderState_;try{var i;if(goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1},goog.isFunction(t))i=t.call(void 0,{});else{if(!goog.isString(t))throw Error("Invalid module definition");i=goog.loadModuleFromSource_.call(void 0,t)}var n=goog.moduleLoaderState_.moduleName;if(!goog.isString(n)||!n)throw Error('Invalid module name "'+n+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(n,i):goog.SEAL_MODULE_EXPORTS&&Object.seal&&goog.isObject(i)&&Object.seal(i),goog.loadedModules_[n]=i}finally{goog.moduleLoaderState_=e}},goog.loadModuleFromSource_=function(a){return eval(a),{}},goog.normalizePath_=function(t){t=t.split("/");for(var e=0;e<t.length;)"."==t[e]?t.splice(e,1):e&&".."==t[e]&&t[e-1]&&".."!=t[e-1]?t.splice(--e,2):e++;return t.join("/")},goog.loadFileSync_=function(t){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(t);try{var e=new goog.global.XMLHttpRequest;return e.open("get",t,!1),e.send(),0==e.status||200==e.status?e.responseText:null}catch(t){return null}},goog.retrieveAndExec_=function(t,e,i){if(!COMPILED){var n=t;t=goog.normalizePath_(t);var r=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,a=goog.loadFileSync_(t);if(null==a)throw Error('Load of "'+t+'" failed');i&&(a=goog.transpile_.call(goog.global,a,t)),a=e?goog.wrapModule_(t,a):a+"\n//# sourceURL="+t,goog.IS_OLD_IE_?(goog.dependencies_.deferred[n]=a,goog.queuedModules_.push(n)):r(t,a)}},goog.transpile_=function(a,b){var c=goog.global.$jscomp;c||(goog.global.$jscomp=c={});var d=c.transpile;if(!d){var e=goog.basePath+goog.TRANSPILER,f=goog.loadFileSync_(e);if(f){if(eval(f+"\n//# sourceURL="+e),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,c=goog.global.$jscomp,d=c.transpile}}return d||(d=c.transpile=function(t,e){return goog.logToConsole_(e+" requires transpilation but no transpiler was found."),t}),d(a,b)},goog.typeOf=function(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e},goog.isNull=function(t){return null===t},goog.isDefAndNotNull=function(t){return null!=t},goog.isArray=function(t){return"array"==goog.typeOf(t)},goog.isArrayLike=function(t){var e=goog.typeOf(t);return"array"==e||"object"==e&&"number"==typeof t.length},goog.isDateLike=function(t){return goog.isObject(t)&&"function"==typeof t.getFullYear},goog.isString=function(t){return"string"==typeof t},goog.isBoolean=function(t){return"boolean"==typeof t},goog.isNumber=function(t){return"number"==typeof t},goog.isFunction=function(t){return"function"==goog.typeOf(t)},goog.isObject=function(t){var e=typeof t;return"object"==e&&null!=t||"function"==e},goog.getUid=function(t){return t[goog.UID_PROPERTY_]||(t[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(t){return!!t[goog.UID_PROPERTY_]},goog.removeUid=function(t){null!==t&&"removeAttribute"in t&&t.removeAttribute(goog.UID_PROPERTY_);try{delete t[goog.UID_PROPERTY_]}catch(t){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(t){if("object"==(i=goog.typeOf(t))||"array"==i){if(t.clone)return t.clone();var e,i="array"==i?[]:{};for(e in t)i[e]=goog.cloneObject(t[e]);return i}return t},goog.bindNative_=function(t,e,i){return t.call.apply(t.bind,arguments)},goog.bindJs_=function(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}},goog.bind=function(t,e,i){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}},goog.mixin=function(t,e){for(var i in e)t[i]=e[i]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(t){if(goog.global.execScript)goog.global.execScript(t,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),void 0!==goog.global._evalTest_){try{delete goog.global._evalTest_}catch(t){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(t);else{var e=goog.global.document,i=e.createElement("SCRIPT");i.type="text/javascript",i.defer=!1,i.appendChild(e.createTextNode(t)),e.body.appendChild(i),e.body.removeChild(i)}}},goog.evalWorksForGlobals_=null,goog.getCssName=function(t,e){if("."==String(t).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+t);var i=function(t){return goog.cssNameMapping_[t]||t},n=function(t){t=t.split("-");for(var e=[],n=0;n<t.length;n++)e.push(i(t[n]));return e.join("-")};n=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?i:n:function(t){return t},n=e?t+"-"+n(e):n(t);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(n):n},goog.setCssNameMapping=function(t,e){goog.cssNameMapping_=t,goog.cssNameMappingStyle_=e},!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(t,e){return e&&(t=t.replace(/\{\$([^}]+)}/g,function(t,i){return null!=e&&i in e?e[i]:t})),t},goog.getMsgWithFallback=function(t,e){return t},goog.exportSymbol=function(t,e,i){goog.exportPath_(t,e,i)},goog.exportProperty=function(t,e,i){t[e]=i},goog.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.base=function(t,i,n){for(var r=Array(arguments.length-2),a=2;a<arguments.length;a++)r[a-2]=arguments[a];return e.prototype[i].apply(t,r)}},goog.base=function(t,e,i){var n=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!n)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(n.superClass_){for(var r=Array(arguments.length-1),a=1;a<arguments.length;a++)r[a-1]=arguments[a];return n.superClass_.constructor.apply(t,r)}for(r=Array(arguments.length-2),a=2;a<arguments.length;a++)r[a-2]=arguments[a];a=!1;for(var o=t.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[e]===n)a=!0;else if(a)return o.prototype[e].apply(t,r);if(t[e]===n)return t.constructor.prototype[e].apply(t,r);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(t){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a goog.module.");t.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(t,e){var i=e.constructor,n=e.statics;return i&&i!=Object.prototype.constructor||(i=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),i=goog.defineClass.createSealingConstructor_(i,t),t&&goog.inherits(i,t),delete e.constructor,delete e.statics,goog.defineClass.applyProperties_(i.prototype,e),null!=n&&(n instanceof Function?n(i):goog.defineClass.applyProperties_(i,n)),i},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(t,e){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return t;var i=!goog.defineClass.isUnsealable_(e),n=function(){var e=t.apply(this,arguments)||this;return e[goog.UID_PROPERTY_]=e[goog.UID_PROPERTY_],this.constructor===n&&i&&Object.seal instanceof Function&&Object.seal(e),e};return n},goog.defineClass.isUnsealable_=function(t){return t&&t.prototype&&t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);for(var n=0;n<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;n++)i=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[n],Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},goog.tagUnsealableClass=function(t){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.createRequiresTranspilation_=function(){function a(t,e){d?c[t]=!0:e()?c[t]=!1:d=c[t]=!0}function b(a){try{return!!eval(a)}catch(t){return!1}}var c={es3:!1},d=!1;return a("es5",function(){return b("[1,].length==1")}),a("es6",function(){return b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')}),a("es6-impl",function(){return!0}),a("es7",function(){return b("2 ** 2 == 4")}),a("es8",function(){return b("async () => 1, true")}),c};var epiviz={deferred:{}};epiviz.deferred.Deferred=function(t){this._deferred=t||$.Deferred()},epiviz.deferred.Deferred.State={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},epiviz.deferred.Deferred.prototype.then=function(t,e,i){return new epiviz.deferred.Promise(this._deferred.then(t,e,i))},epiviz.deferred.Deferred.prototype.done=function(t,e){return new epiviz.deferred.Deferred(this._deferred.done(t,e))},epiviz.deferred.Deferred.prototype.fail=function(t,e){return new epiviz.deferred.Deferred(this._deferred.fail(t,e))},epiviz.deferred.Deferred.prototype.always=function(t,e){return new epiviz.deferred.Deferred(this._deferred.always(t,e))},epiviz.deferred.Deferred.prototype.state=function(){return this._deferred.state()},epiviz.deferred.Deferred.prototype.notify=function(t){return new epiviz.deferred.Deferred(this._deferred.notify(t))},epiviz.deferred.Deferred.prototype.notifyWith=function(t,e){return new epiviz.deferred.Deferred(this._deferred.notifyWith(t,e))},epiviz.deferred.Deferred.prototype.progress=function(t,e){return new epiviz.deferred.Deferred(this._deferred.progress(t,e))},epiviz.deferred.Deferred.prototype.promise=function(t){return new epiviz.deferred.Promise(this._deferred.promise(t))},epiviz.deferred.Deferred.prototype.reject=function(t){return new epiviz.deferred.Deferred(this._deferred.reject(t))},epiviz.deferred.Deferred.prototype.rejectWith=function(t,e){return new epiviz.deferred.Deferred(this._deferred.rejectWith(t,e))},epiviz.deferred.Deferred.prototype.resolve=function(t){return new epiviz.deferred.Deferred(this._deferred.resolve(t))},epiviz.deferred.Deferred.prototype.resolveWith=function(t,e){return new epiviz.deferred.Deferred(this._deferred.resolveWith(t,e))},epiviz.utils=function(){},epiviz.utils.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},epiviz.utils.stringContains=function(t,e){return-1!=t.indexOf(e)},epiviz.utils.stringStartsWith=function(t,e){return 0==t.indexOf(e)},epiviz.utils.stringEndsWith=function(t,e){return t.lastIndexOf(e)==t.length-e.length},epiviz.utils.fillArray=function(t,e){t=t||0;for(var i=Array(t),n=0;n<t;++n)i[n]=e;return i},epiviz.utils.indexOf=function(t,e){for(var i=0;i<t.length;++i)if(e(t[i]))return i;return-1},epiviz.utils.arraysEqual=function(t,e){if(t==e)return!0;if(!t||!e||t.length!=e.length||t<e||e<t)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0},epiviz.utils.elementsEqual=function(t,e){if(t==e)return!0;if(!t||!e||t.length!=e.length)return!1;var i,n={};for(i=0;i<t.length;++i)t[i]in n||(n[t[i]]=0),++n[t[i]];for(i=0;i<e.length;++i){if(!n[e[i]])return!1;--n[e[i]]}return!0},epiviz.utils.range=function(t,e){e=e||0,t=t||0;for(var i=Array(t),n=0;n<t;++n)i[n]=n+e;return i},epiviz.utils.arrayAppend=function(t,e){t.push.apply(t,e)},epiviz.utils.arrayFlip=function(t){for(var e={},i=0;i<t.length;++i)e[t[i]]=i;return e},epiviz.utils.indexOfMin=function(t,e){for(var i=null,n=null,r=0;r<t.length;++r)for(var a=e?r+1:0;a<t[r].length;++a)(null==n||t[r][a]<n)&&(n=t[r][a],i=[r,a]);return{min:n,index:i}},epiviz.utils.arrayIntersection=function(t,e){var i={};t.forEach(function(t){i[t]=t});var n=[];return e.forEach(function(t){t in i&&n.push(t)}),n},epiviz.utils.asyncFor=function(t,e,i){if(t){var n=function(r){r>=t?i&&i():e(r,function(t){t?i&&i():n(r+1)})};n(0)}else i&&i()},epiviz.utils.deferredFor=function(t,e){for(var i=new epiviz.deferred.Deferred,n=new epiviz.deferred.Deferred,r=i.promise(),a=0;a<t;++a)!function(i){r=r.then(function(){var r=e(i);return i==t-1&&r.then(function(){n.resolve()}),r})}(a);return i.resolve(),n},epiviz.utils.mapCopy=function(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i},epiviz.utils.mapEquals=function(t,e){if(t==e)return!0;if(!t||!e)return!1;for(var i in t)if(t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||t[i]!=e[i]))return!1;for(i in e)if(e.hasOwnProperty(i)&&!t.hasOwnProperty(i))return!1;return!0},epiviz.utils.mapCombine=function(t,e,i){var n,r={};if(e)for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);if(t)for(n in t)t.hasOwnProperty(n)&&(i&&r[n]&&$.isArray(r[n])&&t[n]&&$.isArray(t[n])?r[n]=r[n].concat(t[n]):r[n]=t[n]);return r},epiviz.utils.mapJoin=function(t,e,i){e||""===e||(e=":"),i||""===i||(i=",");var n,r="";for(n in t)t.hasOwnProperty(n)&&(r&&(r+=i),r+=n+e+t[n]);return r},epiviz.utils.mapKeyIntersection=function(t,e){var i=[];if(!t||!e)return i;for(var n in t)t.hasOwnProperty(n)&&n in e&&i.push(n);return i},epiviz.utils.forEach=function(t,e){for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i,t))break},epiviz.utils.evaluateFullyQualifiedTypeName=function(t){try{for(var e=t.split("."),i=e.pop(),n=window,r=0;r<e.length;++r)n=n[e[r]];var a=n[i];return"function"!=typeof a?(console.error("Unknown type name: "+t),null):a}catch(e){return console.error("Unknown type name: "+t),null}},epiviz.utils.applyConstructor=function(t,e){var i;return(i=function(){}).prototype=t.prototype,(i=new i).constructor=t,t.apply(i,e),i},epiviz.utils.RAD_TO_DEG=180/Math.PI,epiviz.utils.DEG_TO_RAD=Math.PI/180,epiviz.utils.getInternetExplorerVersion=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent);null!=e&&(t=parseFloat(e[1]))}return t},epiviz.utils.generatePseudoGUID=function(t){for(var e="",i=0;i<t;++i)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return e},epiviz.utils.colorize=function(t,e,i,n,r,a){return d3.scale.linear().domain([t,i,e]).range([n,a,r])},epiviz.utils.colorizeBinary=function(t,e,i,n){return d3.scale.linear().domain([t,e]).range([i,n])},epiviz.utils.sign=function(t){return 0>t?-1:0==t?0:1};var caja={};epiviz.caja={},caja.initialize=function(){},epiviz.caja.cajole=function(a,b){var c=new epiviz.deferred.Deferred;return setTimeout(function(){c.resolve(eval("("+a+")"))},0),c},epiviz.caja.run=function(t,e){var i=new epiviz.deferred.Deferred;return setTimeout(function(){var e=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,n.onreadystatechange=n.onload=function(){i.resolve()},e.appendChild(n)},0),i},epiviz.caja.chain=function(t,e){return $.isArray(e)||(e=epiviz.utils.fillArray(t.length,e)),epiviz.utils.deferredFor(t.length,function(i){return epiviz.caja.run(t[i],e[i])})},epiviz.caja.buildChartMethodContext=function(){return{epiviz:{ui:{charts:epiviz.ui.charts,controls:epiviz.ui.controls},utils:epiviz.utils,plugins:epiviz.plugins,measurements:epiviz.measurements,events:epiviz.events,deferred:epiviz.deferred,datatypes:epiviz.datatypes,data:{DataProvider:epiviz.data.DataProvider,Request:epiviz.data.Request,Response:epiviz.data.Response,WebServerDataProvider:{makeGetRequest:epiviz.data.WebServerDataProvider.makeGetRequest}},Config:epiviz.Config},d3:d3,$:$,sprintf:sprintf,goog:goog}},epiviz.events={},epiviz.events.EventListener=function(t){this._id=epiviz.events.EventListener._nextId++,this._updateCallback=t},epiviz.events.EventListener._nextId=0,epiviz.events.EventListener.prototype.update=function(t){this._updateCallback(t)},epiviz.events.EventListener.prototype.id=function(){return this._id},epiviz.ui={},epiviz.ui.WebArgsManager=function(t,e){this._locationManager=t,this._workspaceManager=e,this._registerLocationChanged(),this._registerActiveWorkspaceChanged()},epiviz.ui.WebArgsManager.WEB_ARGS=epiviz.ui.WebArgsManager.WEB_ARGS||{},epiviz.ui.WebArgsManager.extractWindowLocationArgs=function(){var t={};return(0<window.location.search.length?window.location.search.substr(1):"").split("&").forEach(function(e,i){if(0!=e.trim().length){var n,r,a=e.indexOf("[]");if(0!=a)0>(r=e.indexOf("="))?(n=0>a?e:e.substr(0,a),r="true"):(n=0>a?e.substr(0,r):e.substr(0,a),r=e.substr(r+1)),n=decodeURIComponent(n),r=decodeURIComponent(r),0>a?t[n]=r:(n in t||(t[n]=[]),t[n].push(r))}}),t},epiviz.ui.WebArgsManager.prototype._updateUrl=function(){var t="?",e=epiviz.ui.WebArgsManager.WEB_ARGS;for(var i in!("ws"in e)&&"workspace"in e&&(e.ws=e.workspace,delete e.workspace),e)if(e.hasOwnProperty(i))if(Array.isArray(e[i]))for(var n,r=0;r<e[i].length;++r)null==(n=e[i][r])&&(n="undefined"),t+=sprintf("%s[]=%s&",i,n);else null==(n=e[i])&&(n="undefined"),t+=sprintf("%s=%s&",i,n);if(0>(e=epiviz.utils.getInternetExplorerVersion())||10<=e)switch(window.location.protocol){case"http:":case"https:":history.replaceState(null,"",t)}},epiviz.ui.WebArgsManager.prototype._registerLocationChanged=function(){var t=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(e){epiviz.ui.WebArgsManager.WEB_ARGS.seqName=e.newValue.seqName(),epiviz.ui.WebArgsManager.WEB_ARGS.start=e.newValue.start(),epiviz.ui.WebArgsManager.WEB_ARGS.end=e.newValue.end(),epiviz.ui.WebArgsManager.WEB_ARGS.genome=e.newValue.genome(),t._updateUrl()}))},epiviz.ui.WebArgsManager.prototype._registerActiveWorkspaceChanged=function(){var t=this;this._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(e){epiviz.ui.WebArgsManager.WEB_ARGS.ws=e.workspaceId||"",delete epiviz.ui.WebArgsManager.WEB_ARGS.workspace,t._updateUrl()}))},epiviz.events.Event=function(){this._count=0,this._listeners={},this._firing=!1},epiviz.events.Event.prototype.addListener=function(t){this._listeners[t.id()]||++this._count,this._listeners[t.id()]=t},epiviz.events.Event.prototype.removeListener=function(t){this._listeners[t.id()]&&(delete this._listeners[t.id()],--this._count)},epiviz.events.Event.prototype.notify=function(t){if(!this._firing&&0!=this._count){for(var e in this._firing=!0,this._listeners)this._listeners.hasOwnProperty(e)&&this._listeners[e].update(t);this._firing=!1}},epiviz.events.Event.prototype.isFiring=function(){return this._firing},epiviz.data={},epiviz.data.MessageType={REQUEST:"request",RESPONSE:"response"},epiviz.data.Response=function(t,e){this._id=t,this._data=e},epiviz.data.Response.prototype.id=function(){return this._id},epiviz.data.Response.prototype.data=function(){var t=this._data,e=Object.keys(t);return 0<e.length&&-1!=e.indexOf("success")&&(e.splice(e.indexOf("success"),1),delete t.success),t},epiviz.data.Response.prototype.type=function(){return epiviz.data.MessageType.RESPONSE},epiviz.data.Response.prototype.raw=function(){return{requestId:this._id,type:this.type(),data:this._data}},epiviz.data.Response.fromRawObject=function(t){return new epiviz.data.Response(t.requestId,t.data)},epiviz.data.DataProvider=function(t){this._id=t,this._requestAddSeqInfos=new epiviz.events.Event,this._requestRemoveSeqNames=new epiviz.events.Event,this._requestAddMeasurements=new epiviz.events.Event,this._requestRemoveMeasurements=new epiviz.events.Event,this._requestAddChart=new epiviz.events.Event,this._requestRemoveChart=new epiviz.events.Event,this._requestFlushCache=new epiviz.events.Event,this._requestClearDatasourceGroupCache=new epiviz.events.Event,this._requestNavigate=new epiviz.events.Event,this._requestRedraw=new epiviz.events.Event,this._requestCurrentLocation=new epiviz.events.Event,this._requestPrintWorkspace=new epiviz.events.Event,this._requestSetChartSettings=new epiviz.events.Event,this._requestGetChartSettings=new epiviz.events.Event,this._requestGetAvailableCharts=new epiviz.events.Event,this._requestLoadWorkspace=new epiviz.events.Event,this._requestUiStatus=new epiviz.events.Event,this._requestLoadMeasurements=new epiviz.events.Event},epiviz.data.DataProvider.prototype.id=function(){return this._id},epiviz.data.DataProvider.prototype.getData=function(t,e){e(epiviz.data.Response.fromRawObject({requestId:t.id(),data:null}))},epiviz.data.DataProvider.prototype.onRequestAddSeqInfos=function(){return this._requestAddSeqInfos},epiviz.data.DataProvider.prototype.onRequestRemoveSeqNames=function(){return this._requestRemoveSeqNames},epiviz.data.DataProvider.prototype.onRequestAddMeasurements=function(){return this._requestAddMeasurements},epiviz.data.DataProvider.prototype.onRequestRemoveMeasurements=function(){return this._requestRemoveMeasurements},epiviz.data.DataProvider.prototype.onRequestLoadMeasurements=function(){return this._requestLoadMeasurements},epiviz.data.DataProvider.prototype.onRequestAddChart=function(){return this._requestAddChart},epiviz.data.DataProvider.prototype.onRequestRemoveChart=function(){return this._requestRemoveChart},epiviz.data.DataProvider.prototype.onRequestFlushCache=function(){return this._requestFlushCache},epiviz.data.DataProvider.prototype.onRequestClearDatasourceGroupCache=function(){return this._requestClearDatasourceGroupCache},epiviz.data.DataProvider.prototype.onRequestNavigate=function(){return this._requestNavigate},epiviz.data.DataProvider.prototype.onRequestRedraw=function(){return this._requestRedraw},epiviz.data.DataProvider.prototype.onRequestCurrentLocation=function(){return this._requestCurrentLocation},epiviz.data.DataProvider.prototype.onRequestPrintWorkspace=function(){return this._requestPrintWorkspace},epiviz.data.DataProvider.prototype.onRequestGetChartSettings=function(){return this._requestGetChartSettings},epiviz.data.DataProvider.prototype.onRequestSetChartSettings=function(){return this._requestSetChartSettings},epiviz.data.DataProvider.prototype.onRequestGetAvailableCharts=function(){return this._requestGetAvailableCharts},epiviz.data.DataProvider.prototype.onRequestLoadWorkspace=function(){return this._requestLoadWorkspace},epiviz.data.DataProvider.prototype.onRequestUiStatus=function(){return this._requestUiStatus},epiviz.data.Request=function(t,e,i){this._id=t,this._args=e,this._method=i},epiviz.data.Request.Method={GET:"get",POST:"post"},epiviz.data.Request.Action={GET_ROWS:"getRows",GET_VALUES:"getValues",GET_COMBINED:"getCombined",GET_MEASUREMENTS:"getMeasurements",SEARCH:"search",GET_SEQINFOS:"getSeqInfos",SAVE_WORKSPACE:"saveWorkspace",DELETE_WORKSPACE:"deleteWorkspace",GET_WORKSPACES:"getWorkspaces",GET_HIERARCHY:"getHierarchy",PROPAGATE_HIERARCHY_CHANGES:"propagateHierarchyChanges",GET_PCA:"getPCA",GET_DIVERSITY:"getDiversity",GET_CHART_SETTINGS:"getChartSettings",SET_CHART_SETTINGS:"setChartSettings",GET_AVAILABLE_CHARTS:"getAvailableCharts",ADD_MEASUREMENTS:"addMeasurements",REMOVE_MEASUREMENTS:"removeMeasurements",LOAD_MEASUREMENTS:"loadMeasurements",ADD_SEQINFOS:"addSeqInfos",REMOVE_SEQNAMES:"removeSeqNames",ADD_CHART:"addChart",REMOVE_CHART:"removeChart",CLEAR_DATASOURCE_GROUP_CACHE:"clearDatasourceGroupCache",FLUSH_CACHE:"flushCache",NAVIGATE:"navigate",REDRAW:"redraw",GET_CURRENT_LOCATION:"getCurrentLocation",WRITE_DEBUG_MSG:"writeMsg",PRINT_WORKSPACE:"printWorkspace",LOAD_WORKSPACE:"loadWorkspace",REGISTER_CHART_TYPES:"registerChartTypes",UI_STATUS:"uiStatus"},epiviz.data.Request.createRequest=function(t,e){return new epiviz.data.Request(epiviz.data.Request._nextId++,t,e||epiviz.data.Request.Method.GET)},epiviz.data.Request.fromRawObject=function(t){return new epiviz.data.Request(t.requestId,t.data)},epiviz.data.Request._nextId=0,epiviz.data.Request.prototype.id=function(){return this._id},epiviz.data.Request.prototype.type=function(){return epiviz.data.MessageType.REQUEST},epiviz.data.Request.prototype.method=function(){return this._method},epiviz.data.Request.prototype.joinArgs=function(t,e){t=t||"=",e=e||"&";var i,n=sprintf("requestId%s%s",t,this._id);for(i in this._args)if(this._args.hasOwnProperty(i))if(Array.isArray(this._args[i]))for(var r=0;r<this._args[i].length;++r)n+=sprintf("%s%s[]%s%s",e,i,t,this._args[i][r]);else n+=sprintf("%s%s%s%s",e,i,t,this._args[i]||"");return n},epiviz.data.Request.prototype.isEmpty=function(){for(var t in this._args)if(this._args.hasOwnProperty(t))return!1;return!0},epiviz.data.Request.prototype.get=function(t){return t in this._args?this._args[t]:null},epiviz.data.Request.prototype.raw=function(){return{requestId:this._id,type:this.type(),data:epiviz.utils.mapCopy(this._args)}},epiviz.data.Request.emptyRequest=function(){return epiviz.data.Request.createRequest({})},epiviz.data.Request.getRows=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_ROWS,datasourceGroup:t.dataprovider(),datasource:t.id(),seqName:e?e.seqName():void 0,start:e?e.start():void 0,end:e?e.end():void 0,genome:e?e.genome():void 0,metadata:t.metadata()})},epiviz.data.Request.getValues=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_VALUES,datasourceGroup:t.dataprovider(),datasource:t.datasource().id(),measurement:t.id(),seqName:e?e.seqName():void 0,start:e?e.start():void 0,end:e?e.end():void 0,genome:e?e.genome():void 0})},epiviz.data.Request.getCombined=function(t,e){var i,n,r={},a="",o="";for(n in t)a=n,t.hasOwnProperty(n)&&(r[n]=function(){var e=[];return t[n].foreach(function(t){"genes"==a&&(i=t),o=t.dataprovider(),e.push(t.id())}),e}());return"genes"==a?epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_COMBINED,seqName:e?e.seqName():void 0,start:e?e.start():void 0,end:e?e.end():void 0,measurements:r[a],datasourceGroup:o,datasource:a,genome:e?e.genome():void 0,metadata:i.metadata()}):epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_COMBINED,seqName:e?e.seqName():void 0,start:e?e.start():void 0,end:e?e.end():void 0,measurements:r[a],datasource:a,datasourceGroup:o,genome:e?e.genome():void 0})},epiviz.data.Request.getMeasurements=function(t){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_MEASUREMENTS,datasourceGroup:t})},epiviz.data.Request.search=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.SEARCH,q:t||"",maxResults:e})},epiviz.data.Request.getSeqInfos=function(t){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_SEQINFOS,datasourceGroup:t})},epiviz.data.Request.saveWorkspace=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.SAVE_WORKSPACE,id:t.id(),name:t.name(),content:encodeURIComponent(JSON.stringify(t.raw(e).content))},epiviz.data.Request.Method.POST)},epiviz.data.Request.deleteWorkspace=function(t){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.DELETE_WORKSPACE,id:t.id()},epiviz.data.Request.Method.POST)},epiviz.data.Request.getWorkspaces=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_WORKSPACES,q:t||"",ws:e})},epiviz.data.Request.getHierarchy=function(t,e){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_HIERARCHY,datasourceGroup:t,nodeId:e})},epiviz.data.Request.propagateHierarchyChanges=function(t,e,i,n){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.PROPAGATE_HIERARCHY_CHANGES,datasourceGroup:t,selection:e,order:i,selectedLevels:n})},epiviz.data.Request.getPCA=function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=function(){var e=[];return t[i].foreach(function(t){e.push(t.id())}),e}());return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_PCA,measurements:n})},epiviz.data.Request.getDiversity=function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=function(){var e=[];return t[i].foreach(function(t){e.push(t.id())}),e}());return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_DIVERSITY,measurements:n})},epiviz.measurements={},epiviz.measurements.Measurement=function(t,e,i,n,r,a,o,s,u,c,l,p){var h=epiviz.measurements.Measurement.Type;this._id=t,this._name=e,this._type=i,this._datasource=i==h.RANGE?this:new epiviz.measurements.Measurement(n,n,h.RANGE,n,r,a,null,"Blocks Track",null,null,null,p),this._datasourceGroup=r,this._dataprovider=a,this._formula=o||null,this._defaultChartType=s||null,this._annotation=u||null,this._minValue=c||0===c?c:null,this._maxValue=l||0===l?l:null,this._metadata=p||null},epiviz.measurements.Measurement.Type={FEATURE:"feature",RANGE:"range",UNORDERED:"unordered"},epiviz.measurements.Measurement.Type.isOrdered=function(t){return t==epiviz.measurements.Measurement.Type.FEATURE||t==epiviz.measurements.Measurement.Type.RANGE},epiviz.measurements.Measurement.Type.hasValues=function(t){return t==epiviz.measurements.Measurement.Type.FEATURE||t==epiviz.measurements.Measurement.Type.UNORDERED},epiviz.measurements.Measurement.prototype.id=function(){return this._id},epiviz.measurements.Measurement.prototype.name=function(){return this._name},epiviz.measurements.Measurement.prototype.type=function(){return this._type},epiviz.measurements.Measurement.prototype.datasource=function(){return this._datasource},epiviz.measurements.Measurement.prototype.datasourceId=function(){return this._datasource.id()},epiviz.measurements.Measurement.prototype.datasourceGroup=function(){return this._datasourceGroup},epiviz.measurements.Measurement.prototype.dataprovider=function(){return this._dataprovider},epiviz.measurements.Measurement.prototype.formula=function(){return this._formula},epiviz.measurements.Measurement.prototype.formulaStr=function(){if(!this._formula)return"";var t,e=this._formula.referredMeasurements,i=this._formula.expression.toString();for(t in e)e.hasOwnProperty(t)&&(i=i.replace(new RegExp("\\{"+t+"\\}","g")," {"+e[t].name()+"} "));return i},epiviz.measurements.Measurement.prototype.evaluate=function(t){var e,i={};for(e in this._formula.referredMeasurements)if(this._formula.referredMeasurements.hasOwnProperty(e)){var n=this._formula.referredMeasurements[e];i["{"+e+"}"]=n.isComputed()?n.evaluate(t):t.get(n)}return this._formula.expression.evaluate(i)},epiviz.measurements.Measurement.prototype.evaluateArr=function(t){var e,i={};for(e in this._formula.referredMeasurements)if(this._formula.referredMeasurements.hasOwnProperty(e)){var n=this._formula.referredMeasurements[e];i["{"+e+"}"]=n.isComputed()?n.evaluateArr(t):t.get(n)}return this._formula.expression.evaluateArr(i)},epiviz.measurements.Measurement.prototype.defaultChartType=function(){return this._defaultChartType},epiviz.measurements.Measurement.prototype.annotation=function(){return this._annotation},epiviz.measurements.Measurement.prototype.minValue=function(){return this._minValue},epiviz.measurements.Measurement.prototype.maxValue=function(){return this._maxValue},epiviz.measurements.Measurement.prototype.metadata=function(){return this._metadata||[]},epiviz.measurements.Measurement.prototype.componentMeasurements=function(){var t=new epiviz.measurements.MeasurementSet;if(!this._formula)return t.add(this),t;for(var e in this._formula.referredMeasurements)this._formula.referredMeasurements.hasOwnProperty(e)&&t.addAll(this._formula.referredMeasurements[e].componentMeasurements());return t},epiviz.measurements.Measurement.prototype.isComputed=function(){return!!this._formula},epiviz.measurements.Measurement.prototype.raw=function(t){if(this._formula){var e,i=this._formula.referredMeasurements,n={};for(e in i)i.hasOwnProperty(e)&&(n[e]=t.get(i[e]))}return{id:this._id,name:this._name,type:this._type,datasourceId:this._datasource._id,datasourceGroup:this._datasourceGroup,dataprovider:this._dataprovider,formula:this._formula?{expression:this._formula.expression.toString(),referredMeasurements:n}:null,defaultChartType:this._defaultChartType,annotation:this._annotation,minValue:this._minValue,maxValue:this._maxValue,metadata:this._metadata}},epiviz.measurements.Measurement.prototype.toString=function(){return this.name()},epiviz.measurements.Measurement.fromRawObject=function(t,e){var i=null;if(t.formula){for(var n={},r=(i=epiviz.utils.ExpressionParser.parse(t.formula.expression)).variables(),a=0;a<r.length;++a)if(epiviz.utils.stringStartsWith(r[a],"{")&&epiviz.utils.stringEndsWith(r[a],"}")){var o=parseInt(r[a].substring(1,r[a].length-1));n[o]=e[t.formula.referredMeasurements[o]]}i={expression:i,referredMeasurements:n}}return new epiviz.measurements.Measurement(t.id,t.name,t.type,t.datasourceId,t.datasourceGroup,t.dataprovider,i,t.defaultChartType,t.annotation,t.minValue,t.maxValue,t.metadata)},epiviz.utils.Iterable=function(){},epiviz.utils.Iterable.prototype.foreach=function(t){},epiviz.utils.Iterator=function(){},epiviz.utils.Iterator.prototype.first=function(){throw Error("unimplemented abstract method")},epiviz.utils.Iterator.prototype.next=function(){throw Error("unimplemented abstract method")},epiviz.measurements.MeasurementSet=function(t){this._measurementTree={},this._size=0,this._order=[],t&&this.addAll(t)},epiviz.measurements.MeasurementSet.prototype.add=function(t){return t.dataprovider()in this._measurementTree||(this._measurementTree[t.dataprovider()]={}),t.type()in this._measurementTree[t.dataprovider()]||(this._measurementTree[t.dataprovider()][t.type()]={}),t.datasourceGroup()in this._measurementTree[t.dataprovider()][t.type()]||(this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]={}),t.datasource().id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]||(this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()]={}),!(t.id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()])&&(this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()]={measurement:t,index:this._order.length},this._order.push({measurement:t,contained:!0}),++this._size,!0)},epiviz.measurements.MeasurementSet.prototype.remove=function(t){return t.dataprovider()in this._measurementTree&&t.type()in this._measurementTree[t.dataprovider()]&&t.datasourceGroup()in this._measurementTree[t.dataprovider()][t.type()]&&t.datasource().id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]&&t.id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()]&&(this._order[this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()].index].contained=!1,delete this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()],--this._size,!0)},epiviz.measurements.MeasurementSet.prototype.addAll=function(t){if(!t||!t.size())return!1;var e=!1,i=this;return t.foreach(function(t){return i.add(t)&&(e=!0),!1}),e},epiviz.measurements.MeasurementSet.prototype.removeAll=function(t){var e=!1,i=this;return t.foreach(function(t){return i.remove(t)&&(e=!0),!1}),e},epiviz.measurements.MeasurementSet.prototype.foreach=function(t,e){for(var i=this.iterator(),n=i.first(),r=0;null!==n&&(e&&!e(n)||!t(n,r));n=i.next(),++r);},epiviz.measurements.MeasurementSet.prototype.iterator=function(){return new epiviz.measurements.MeasurementSet.Iterator(this)},epiviz.measurements.MeasurementSet.prototype.subset=function(t){var e=new epiviz.measurements.MeasurementSet;return this.foreach(function(t){e.add(t)},t),e},epiviz.measurements.MeasurementSet.prototype.map=function(t){var e=new epiviz.measurements.MeasurementSet;return this.foreach(function(i){e.add(t(i))}),e},epiviz.measurements.MeasurementSet.prototype.size=function(){return this._size},epiviz.measurements.MeasurementSet.prototype.contains=function(t){return t.dataprovider()in this._measurementTree&&t.type()in this._measurementTree[t.dataprovider()]&&t.datasourceGroup()in this._measurementTree[t.dataprovider()][t.type()]&&t.datasource().id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]&&t.id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()]},epiviz.measurements.MeasurementSet.prototype.first=function(){return this.iterator().first()},epiviz.measurements.MeasurementSet.prototype.get=function(t){if(t>=this._size||0>t)return null;if(this._size==this._order.length)return this._order[t].measurement;var e=null;return this.foreach(function(i,n){return n==t&&(e=i,!0)}),e},epiviz.measurements.MeasurementSet.prototype.toArray=function(){var t=Array(this._size);return this.foreach(function(e,i){t[i]=e}),t},epiviz.measurements.MeasurementSet.prototype.sorted=function(t){t=this.toArray().sort(t);var e=new epiviz.measurements.MeasurementSet;return t.forEach(function(t){e.add(t)}),e},epiviz.measurements.MeasurementSet.prototype.raw=function(){var t=Array(this._size);return this.foreach(function(e,i){t[i]=e.raw()}),t},epiviz.measurements.MeasurementSet.prototype.remoteRaw=function(){var t=[];return this.foreach(function(e,i){-1==e.dataprovider().indexOf("websocket")&&(t[i]=e.raw())}),t},epiviz.measurements.MeasurementSet.prototype.split=function(t){var e={};return this.foreach(function(i,n){var r=t(i),a=e[r];null==a&&(a=new epiviz.measurements.MeasurementSet,e[r]=a),a.add(i)}),e},epiviz.measurements.MeasurementSet.Iterator=function(t){this._parent=t,this._lastIndex=null},epiviz.measurements.MeasurementSet.Iterator.prototype.first=function(){if(0==this._parent.size())return null;for(var t=0;t<this._parent._order.length;++t)if(this._parent._order[t].contained)return this._lastIndex=t,this._parent._order[t].measurement;throw Error("Inconsistent MeasurementSet with size() > 0 and no first element")},epiviz.measurements.MeasurementSet.Iterator.prototype.next=function(){if(null===this._lastIndex)throw Error("Iterator.next() called before calling Iterator.first()");for(var t=this._lastIndex+1;t<this._parent._order.length;++t)if(this._parent._order[t].contained)return this._lastIndex=t,this._parent._order[t].measurement;return this._lastIndex=this._parent._order.length,null},epiviz.ui.controls={},epiviz.ui.controls.VisConfigSelection=function(t,e,i,n,r,a,o,s){this.measurements=t,this.datasource=e,this.datasourceGroup=i,this.dataprovider=n,this.annotation=r,this.defaultChartType=a,this.minSelectedMeasurements=o||1,this.customData=s},epiviz.events.EventResult=function(){this.value=this.errorMessage=this.success=null},epiviz.datatypes={},epiviz.datatypes.GenomicRange=function(t,e,i,n){null!=i&&0>i&&(i=-i,null!=e&&(e-=i)),this._seqname=t,this._start=e,this._width=i,this._genome=n},epiviz.datatypes.GenomicRange.fromStartEnd=function(t,e,i,n){return new epiviz.datatypes.GenomicRange(t,e,null!=e&&null!=i?i-e:void 0,n)},epiviz.datatypes.GenomicRange.prototype.seqName=function(){return this._seqname},epiviz.datatypes.GenomicRange.prototype.genome=function(){return this._genome},epiviz.datatypes.GenomicRange.prototype.start=function(){return this._start},epiviz.datatypes.GenomicRange.prototype.width=function(){return this._width},epiviz.datatypes.GenomicRange.prototype.end=function(){return null!=this._start&&null!=this._width?this._start+this._width:void 0},epiviz.datatypes.GenomicRange.prototype.isEmpty=function(){return 0>=this._width},epiviz.datatypes.GenomicRange.prototype.subtract=function(t){return!t||t.genome()!=this._genome||t.seqName()!=this._seqname||t.isEmpty()||t.start()>=this.end()||this._start>=t.end()?[this]:t.start()<=this._start&&t.end()>=this.end()?[]:t.start()>this._start&&t.end()<this.end()?[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,this._start,t.start()),epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,t.end(),this.end())]:t.start()>this._start?[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,this._start,t.start(),this._genome)]:[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,t.end(),this.end(),this._genome)]},epiviz.datatypes.GenomicRange.prototype.equals=function(t){return!!t&&(t==this||this._genome==t._genome&&this._seqname==t._seqname&&this._start==t._start&&this._width==t._width)},epiviz.datatypes.GenomicRange.prototype.overlapsWith=function(t){return!!t&&(this==t||this.genome()==t.genome()&&this.seqName()==t.seqName()&&(this.start()<t.end()&&this.end()>t.start()))},epiviz.datatypes.GenomicRange.prototype.raw=function(){return{seqName:this._seqname,start:this._start,width:this._width,genome:this._genome}},epiviz.datatypes.GenomicRange.fromRawObject=function(t){return new epiviz.datatypes.GenomicRange(t.seqName,t.start,t.width,t.genome)},epiviz.ui.charts={},epiviz.ui.charts.ColorPalette=function(t,e,i,n){this._colors=t,this._id=i||epiviz.utils.generatePseudoGUID(6),this._name=e||"Custom ("+this._id+")",this._keyIndices=n||{},this._nKeys=0},epiviz.ui.charts.ColorPalette.prototype.id=function(){return this._id},epiviz.ui.charts.ColorPalette.prototype.name=function(){return this._name},epiviz.ui.charts.ColorPalette.prototype.get=function(t){return this._colors[t%this._colors.length]},epiviz.ui.charts.ColorPalette.prototype.getByKey=function(t){var e=this._keyIndices[t];return null==e&&(e=this._nKeys,this._keyIndices[t]=this._nKeys,++this._nKeys),this.get(e)},epiviz.ui.charts.ColorPalette.prototype.keyColorIndex=function(t){return null==(t=this._keyIndices[t])?-1:t},epiviz.ui.charts.ColorPalette.prototype.keyIndices=function(){return this._keyIndices},epiviz.ui.charts.ColorPalette.prototype.size=function(){return this._colors.length},epiviz.ui.charts.ColorPalette.prototype.equals=function(t){return this==t||!!t&&epiviz.utils.arraysEqual(this._colors,t._colors)},epiviz.ui.charts.ColorPalette.prototype.copy=function(){return new epiviz.ui.charts.ColorPalette(this._colors.slice(0))},epiviz.ui.charts.ColorPalette.prototype.raw=function(t){return t&&this._id in t.colorPalettesMap?{id:this._id}:{id:this._id,name:this._name,colors:this._colors}},epiviz.ui.charts.ColorPalette.fromRawObject=function(t,e){return $.isArray(t)?new epiviz.ui.charts.ColorPalette(t):e&&t.id in e.colorPalettesMap?e.colorPalettesMap[t.id]:(t.colors&&t.colors.length||(t.colors=epiviz.Config.COLORS_BRIGHT),new epiviz.ui.charts.ColorPalette(t.colors,t.name,t.id))},epiviz.data.WebsocketDataProvider=function(t,e){epiviz.data.DataProvider.call(this,t||epiviz.data.WebsocketDataProvider.DEFAULT_ID),this._websocketHost=e,this._socket=null,this._useUI="true"!=epiviz.ui.WebArgsManager.WEB_ARGS.websocketNoUI,this._debug="true"==epiviz.ui.WebArgsManager.WEB_ARGS.debug,this._callbacks={},this._requestsStack=[],this._initialize()},epiviz.data.WebsocketDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype),epiviz.data.WebsocketDataProvider.constructor=epiviz.data.WebsocketDataProvider,epiviz.data.WebsocketDataProvider.DEFAULT_ID="websocket",epiviz.data.WebsocketDataProvider.prototype._initialize=function(){if(this._websocketHost&&"None"!=this._websocketHost)try{this._socket=new WebSocket(this._websocketHost),this._log("WebSocket - status "+this._socket.readyState);var t=this;this._socket.onopen=function(){t._onSocketOpen()},this._socket.onmessage=function(e){t._onSocketMessage(e)},this._socket.onclose=function(){t._onSocketClose()}}catch(t){this._log(t.toString())}},epiviz.data.WebsocketDataProvider.prototype._onSocketOpen=function(){for(var t=0;t<this._requestsStack.length;++t)this._socket.send(this._requestsStack[t]);this._requestsStack=[],this._registerAvailableCharts()},epiviz.data.WebsocketDataProvider.prototype._onSocketClose=function(){this._socket=null},epiviz.data.WebsocketDataProvider.prototype._sendMessage=function(t){this.connected()&&this._socket.readyState?this._socket.send(t):this._requestsStack.push(t)},epiviz.data.WebsocketDataProvider.prototype._onSocketMessage=function(t){this._log("Local Controller Received: "+t.data);var e=JSON.parse(t.data);if(e.data.dataprovidertype="websocket",e.type==epiviz.data.MessageType.RESPONSE)t=epiviz.data.Response.fromRawObject(e),e=this._callbacks[t.id()],delete this._callbacks[t.id()],e(t);else if(e.type==epiviz.data.MessageType.REQUEST)switch(t=epiviz.data.Request.Action,e=epiviz.data.Request.fromRawObject(e),e.get("action")){case t.ADD_MEASUREMENTS:this._addMeasurements(e);break;case t.REMOVE_MEASUREMENTS:this._removeMeasurements(e);break;case t.ADD_SEQINFOS:this._addSeqInfos(e);break;case t.REMOVE_SEQNAMES:this._removeSeqNames(e);break;case t.ADD_CHART:this._addChart(e);break;case t.REMOVE_CHART:this._removeChart(e);break;case t.CLEAR_DATASOURCE_GROUP_CACHE:this._clearDatasourceGroupCache(e);break;case t.FLUSH_CACHE:this._flushCache(e);break;case t.NAVIGATE:this._navigate(e);break;case t.REDRAW:this._redraw(e);break;case t.GET_CURRENT_LOCATION:this._getCurrentLocation(e);break;case t.WRITE_DEBUG_MSG:this._writeDebugMsg(e);break;case t.PRINT_WORKSPACE:this._printWorkspace(e);break;case t.SET_CHART_SETTINGS:this._setChartSettings(e);break;case t.GET_CHART_SETTINGS:this._getChartSettings(e);break;case t.GET_AVAILABLE_CHARTS:this._getAvailableCharts(e);break;case t.LOAD_WORKSPACE:this._loadWorkspace(e);break;case t.UI_STATUS:this._uiStatus(e);case t.LOAD_MEASUREMENTS:this._loadMeasurements(e)}},epiviz.data.WebsocketDataProvider.prototype._log=function(t){this._debug&&console.log(t)},epiviz.data.WebsocketDataProvider.prototype._fireEvent=function(t,e){this._useUI?t.notify(e):e.result.success=!0},epiviz.data.WebsocketDataProvider.prototype.connected=function(){return null!=this._socket},epiviz.data.WebsocketDataProvider.prototype.getData=function(t,e){var i=JSON.stringify(t.raw());this._callbacks[t.id()]=e,this._sendMessage(i)},epiviz.data.WebsocketDataProvider.prototype._addMeasurements=function(t){for(var e=new epiviz.events.EventResult,i=new epiviz.measurements.MeasurementSet,n=JSON.parse(t.get("measurements")),r=0;r<n.length;++r)i.add(new epiviz.measurements.Measurement(n[r].id,n[r].name,n[r].type,n[r].datasourceId,n[r].datasourceGroup,this.id(),null,n[r].defaultChartType,n[r].annotation,n[r].minValue,n[r].maxValue,n[r].metadata));this._fireEvent(this.onRequestAddMeasurements(),{measurements:i,result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._removeMeasurements=function(t){for(var e=new epiviz.events.EventResult,i=new epiviz.measurements.MeasurementSet,n=JSON.parse(t.get("measurements")),r=0;r<n.length;++r)i.add(new epiviz.measurements.Measurement(n[r].id,n[r].name,n[r].type,n[r].datasourceId,n[r].datasourceGroup,this.id(),null,n[r].defaultChartType,n[r].annotation,n[r].minValue,n[r].maxValue,n[r].metadata));this._fireEvent(this.onRequestRemoveMeasurements(),{measurements:i,result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._addSeqInfos=function(t){var e=new epiviz.events.EventResult,i=JSON.parse(t.get("seqInfos"));this._fireEvent(this.onRequestAddSeqInfos(),{seqInfos:i,result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._removeSeqNames=function(t){var e=new epiviz.events.EventResult,i=JSON.parse(t.get("seqNames"));this._fireEvent(this.onRequestRemoveSeqNames(),{seqNames:i,result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._addChart=function(t){var e,i,n,r=new epiviz.events.EventResult;if(i=this.id(),null!=t.get("measurements")){e=new epiviz.measurements.MeasurementSet,n=JSON.parse(t.get("measurements"));for(var a=0;a<n.length;++a)null!=n[a].dataprovider&&0!=n[a].dataprovider.length&&(i=n[a].dataprovider),e.add(new epiviz.measurements.Measurement(n[a].id,n[a].name,n[a].type,n[a].datasourceId,n[a].datasourceGroup,i,null,n[a].defaultChartType,n[a].annotation,n[a].minValue,n[a].maxValue,n[a].metadata))}i=t.get("datasource"),n=t.get("datasourceGroup")||i,this._fireEvent(this.onRequestAddChart(),{type:t.get("type"),visConfigSelection:new epiviz.ui.controls.VisConfigSelection(e,i,n),result:r}),t=new epiviz.data.Response(t.id(),r),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._removeChart=function(t){var e=t.get("chartId"),i=new epiviz.events.EventResult;this._fireEvent(this.onRequestRemoveChart(),{id:e,result:i}),t=new epiviz.data.Response(t.id(),i),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._clearDatasourceGroupCache=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestClearDatasourceGroupCache(),{datasourceGroup:t.get("datasourceGroup"),result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._flushCache=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestFlushCache(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._navigate=function(t){var e=JSON.parse(t.get("range")),i=new epiviz.events.EventResult;this._fireEvent(this.onRequestNavigate(),{range:epiviz.datatypes.GenomicRange.fromStartEnd(e.seqName,e.start,e.end),result:i}),t=new epiviz.data.Response(t.id(),i),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._redraw=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestRedraw(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._getCurrentLocation=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestCurrentLocation(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._writeDebugMsg=function(t){var e=t.get("msg"),i=document.createElement("pre");i.innerHTML=e.replace(/&/g,"&amp;").replace(/\\</g,"&lt;"),t=new epiviz.data.Response(t.id(),{msg:"that msg"}),document.getElementById("chart-container").appendChild(i),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._printWorkspace=function(t){var e=t.get("chartId"),i=t.get("fileName"),n=t.get("fileType"),r=new epiviz.events.EventResult;this._fireEvent(this.onRequestPrintWorkspace(),{chartId:e,fileName:i,fileType:n,result:r}),t=new epiviz.data.Response(t.id(),r),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._setChartSettings=function(t){var e=t.get("chartId"),i=t.get("settings"),n=t.get("colorMap"),r=(n=new epiviz.ui.charts.ColorPalette(n),new epiviz.events.EventResult);this._fireEvent(this.onRequestSetChartSettings(),{chartId:e,settings:i,colorMap:n,result:r}),t=new epiviz.data.Response(t.id(),r),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._getChartSettings=function(t){var e=t.get("chartId"),i=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{chartId:e,result:i}),t=new epiviz.data.Response(t.id(),i),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._getAvailableCharts=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._registerAvailableCharts=function(){var t=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{result:t}),request=epiviz.data.Request.createRequest({action:epiviz.data.Request.Action.REGISTER_CHART_TYPES,data:t.value}),t=JSON.stringify(request.raw()),this._callbacks[request.id()]=function(t){},this._sendMessage(t)},epiviz.data.WebsocketDataProvider.prototype.updateChartSettings=function(t,e){var i=JSON.stringify(t.raw());this._callbacks[t.id()]=e,this._sendMessage(i)},epiviz.data.WebsocketDataProvider.prototype._loadWorkspace=function(t){var e=t.get("workspaceId"),i=new epiviz.events.EventResult;this._fireEvent(this.onRequestLoadWorkspace(),{workspace:e}),t=new epiviz.data.Response(t.id(),i),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._uiStatus=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestUiStatus(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebsocketDataProvider.prototype._loadMeasurements=function(t){var e=new epiviz.events.EventResult;this._fireEvent(this.onRequestLoadMeasurements(),{result:e}),t=new epiviz.data.Response(t.id(),e),this._sendMessage(JSON.stringify(t.raw()))},epiviz.data.WebServerDataProvider=function(t,e){epiviz.data.DataProvider.call(this,t||epiviz.Config.DEFAULT_DATA_PROVIDER_ID),this._serverEndpoint=e||epiviz.data.WebServerDataProvider.DEFAULT_SERVER_ENDPOINT},epiviz.data.WebServerDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype),epiviz.data.WebServerDataProvider.constructor=epiviz.data.WebServerDataProvider,epiviz.data.WebServerDataProvider.DEFAULT_SERVER_ENDPOINT="data/main.php",epiviz.data.WebServerDataProvider.prototype.getData=function(t,e,i){t.isEmpty()||(t.method()==epiviz.data.Request.Method.GET?(t=sprintf("%s?%s",this._serverEndpoint,t.joinArgs()),epiviz.data.WebServerDataProvider.makeGetRequest(t,function(t){e(epiviz.data.Response.fromRawObject(t))},function(t,e,n){i(t,e,n)})):epiviz.data.WebServerDataProvider.makePostRequest(this._serverEndpoint,t.joinArgs(),function(t){e(epiviz.data.Response.fromRawObject(t))},function(t,e,n){i(t,e,n)}))},epiviz.data.WebServerDataProvider.makeGetRequest=function(t,e,i){(t=$.ajax({type:"get",url:t,dataType:"json",async:!0,cache:!1,processData:!0})).done(function(t){e(t)}),t.fail(function(t,e,n){i(t,e,n)}),t.always(function(){})},epiviz.data.WebServerDataProvider.makePostRequest=function(t,e,i,n){(t=$.ajax({type:"post",url:t,data:e,dataType:"json",async:!0,cache:!1,processData:!0})).done(function(t,e,n){i(t)}),t.fail(function(t,e,i){console.error("The following error occured: "+e,i),n(t,e,i)}),t.always(function(){})},epiviz.Config=function(t){if(this.workspacesDataProvider=this.dataProviders=this.defaultWorkspaceSettings=this.navigationDelay=this.navigationStepRatio=this.zoomoutRatio=this.zoominRatio=this.chartSaverLocation=this.dataServerLocation=null,this.useCache=!0,this.useCookie=null,this.cacheUpdateIntervalMilliseconds=3e4,this.colorPalettesMap=this.colorPalettes=this.clustering=this.chartCustomSettings=this.chartSettings=this.chartTypes=this.maxSearchResults=null,t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if("epivizr_standalone"!=t.configType&&(e=epiviz.ui.WebArgsManager.WEB_ARGS["websocket-host"])&&e.length)for(var i=0;i<e.length;++i)this.dataProviders.push(sprintf("epiviz.data.WebsocketDataProvider,%s,%s",epiviz.data.WebsocketDataProvider.DEFAULT_ID+"-"+i,e[i]))}var n={};this.colorPalettes.forEach(function(t){n[t.id()]=t}),this.colorPalettesMap=n,"default"!=t.configType&&(this.useCookie=epiviz.ui.WebArgsManager.WEB_ARGS.useCookie)},epiviz.Config.SETTINGS={},epiviz.Config.DEFAULT_DATA_PROVIDER_ID="umd",epiviz.Config.DEFAULT_WORKSPACE_NAME="Default Workspace",epiviz.Config.EPIVIZ_V1_COLORS="#025167 #e7003e #ffcd00 #057d9f #970026 #ffe373 #ff8100".split(" "),epiviz.Config.COLORS_BRIGHT="#1859a9 #ed2d2e #008c47 #010101 #f37d22 #662c91 #a11d20 #b33893".split(" "),epiviz.Config.COLORS_LIGHT="#b8d2eb #f2aeac #d8e4aa #cccccc #f2d1b0 #d4b2d3 #ddb8a9 #ebbfd9".split(" "),epiviz.Config.COLORS_MEDIUM="#599ad3 #f1595f #79c36a #727272 #f9a65a #9e66ab #cd7058 #d77fb3".split(" "),epiviz.Config.COLORS_D3_CAT10="#1f77b4 #ff7f0e #2ca02c #d62728 #9467bd #8c564b #e377c2 #7f7f7f #bcbd22 #17becf".split(" "),epiviz.Config.COLORS_D3_CAT20="#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5".split(" "),epiviz.Config.COLORS_D3_CAT20B="#393b79 #5254a3 #6b6ecf #9c9ede #637939 #8ca252 #b5cf6b #cedb9c #8c6d31 #bd9e39 #e7ba52 #e7cb94 #843c39 #ad494a #d6616b #e7969c #7b4173 #a55194 #ce6dbd #de9ed6".split(" "),epiviz.Config.COLORS_D3_CAT20C="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" "),epiviz.Config.VisualizationPropertySettings={WIDTH:"width",HEIGHT:"height",MARGINS:"margins",COLORS:"colors",DECORATIONS:"decorations"},epiviz.data.RequestStack=function(){this._requests=[],this._callbacks={},this._dataMap={}},epiviz.data.RequestStack.prototype.pushRequest=function(t,e){this._requests.push(t),this._callbacks[t.id()]=e},epiviz.data.RequestStack.prototype.serveData=function(t){if(this._callbacks[t.id()])if(0<this._requests.length&&this._requests[0].id()==t.id()){var e=this._callbacks[t.id()];for(delete this._callbacks[t.id()],this._requests=this._requests.slice(1),e(t.data());0<this._requests.length&&this._requests[0].id()in this._dataMap;)e=this._callbacks[this._requests[0].id()],t=this._dataMap[this._requests[0].id()],delete this._callbacks[this._requests[0].id()],delete this._dataMap[this._requests[0].id()],this._requests=this._requests.slice(1),e(t)}else this._dataMap[t.id()]=t.data()},epiviz.data.RequestStack.prototype.clear=function(){this._requests=[],this._callbacks={},this._dataMap={}},epiviz.measurements.MeasurementHashtable=function(){this._size=0,this._measurementTree={},this._order=[]},epiviz.measurements.MeasurementHashtable.prototype.put=function(t,e){if(this.contains(t)){var i=this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()];this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()]={key:t,value:e,index:i.index},this._order[i.index]={key:t,value:e,contained:!0}}else t.dataprovider()in this._measurementTree||(this._measurementTree[t.dataprovider()]={}),t.type()in this._measurementTree[t.dataprovider()]||(this._measurementTree[t.dataprovider()][t.type()]={}),t.datasourceGroup()in this._measurementTree[t.dataprovider()][t.type()]||(this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]={}),t.datasource().id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]||(this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()]={}),this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()]={key:t,value:e,index:this._order.length},this._order.push({key:t,value:e,contained:!0}),++this._size},epiviz.measurements.MeasurementHashtable.prototype.get=function(t){return this.contains(t)?this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()].value:null},epiviz.measurements.MeasurementHashtable.prototype.remove=function(t){if(!this.contains(t))return!1;var e=this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()];return delete this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()][t.id()],this._order[e.index].contained=!1,--this._size,!0},epiviz.measurements.MeasurementHashtable.prototype.contains=function(t){return t.dataprovider()in this._measurementTree&&t.type()in this._measurementTree[t.dataprovider()]&&t.datasourceGroup()in this._measurementTree[t.dataprovider()][t.type()]&&t.datasource().id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()]&&t.id()in this._measurementTree[t.dataprovider()][t.type()][t.datasourceGroup()][t.datasource().id()]},epiviz.measurements.MeasurementHashtable.prototype.clear=function(){this._size=0,this._measurementTree={},this._order=[]},epiviz.measurements.MeasurementHashtable.prototype.isEmpty=function(){return 0==this._size},epiviz.measurements.MeasurementHashtable.prototype.size=function(){return this._size},epiviz.measurements.MeasurementHashtable.prototype.foreach=function(t,e){for(var i=this.iterator(),n=i.first(),r=0;null!==n&&(e&&!e(n.key)||!t(n.key,n.value,r));n=i.next(),++r);},epiviz.measurements.MeasurementHashtable.prototype.first=function(){return this.iterator().first()},epiviz.measurements.MeasurementHashtable.prototype.sorted=function(t){var e=new epiviz.measurements.MeasurementHashtable,i=this._order.slice(0);return i.sort(function(e,i){return t(e.key,i.key)}),i.forEach(function(t){t.contained&&e.put(t.key,t.value)}),e},epiviz.measurements.MeasurementHashtable.prototype.keys=function(){var t=[];return this._order.forEach(function(e){e.contained&&t.push(e.key)}),t},epiviz.measurements.MeasurementHashtable.prototype.iterator=function(){return new epiviz.measurements.MeasurementHashtable.Iterator(this)},epiviz.measurements.MeasurementHashtable.prototype.toString=function(){var t={};return this.foreach(function(e,i){for(var n=e.id(),r=2;n in t;)n=e.id()+" ("+r+++")";t[n]=i}),JSON.stringify(t)},epiviz.measurements.MeasurementHashtable.Iterator=function(t){this._parent=t,this._lastIndex=null},epiviz.measurements.MeasurementHashtable.Iterator.prototype.first=function(){if(0==this._parent.size())return null;for(var t=0;t<this._parent._order.length;++t)if(this._parent._order[t].contained)return this._lastIndex=t,{key:this._parent._order[t].key,value:this._parent._order[t].value};throw Error("Inconsistent MeasurementHashtable with size() > 0 and no first element")},epiviz.measurements.MeasurementHashtable.Iterator.prototype.next=function(){if(null===this._lastIndex)throw Error("Iterator.next() called before calling Iterator.first()");for(var t=this._lastIndex+1;t<this._parent._order.length;++t)if(this._parent._order[t].contained)return this._lastIndex=t,{key:this._parent._order[t].key,value:this._parent._order[t].value};return this._lastIndex=this._parent._order.length,null},epiviz.measurements.MeasurementHashtable.prototype.split=function(t){var e={};return this.foreach(function(i,n){var r=t(i),a=e[r];null==a&&(a=new epiviz.measurements.MeasurementSet,e[r]=a),a.add(i)}),e},epiviz.datatypes.MeasurementGenomicData=function(){},epiviz.datatypes.MeasurementGenomicData.prototype.get=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.getRow=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.measurement=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.globalStartIndex=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.globalEndIndex=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.size=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.getByGlobalIndex=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.getRowByGlobalIndex=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicData.prototype.binarySearchStarts=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.MeasurementGenomicDataArrayWrapper=function(t,e,i){this._measurement=t,this._items=e,this._itemsByGlobalIndex=i},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.get=function(t){return this._items&&0<=t&&t<this._items.length?this._items[t]:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getRow=function(t){return this._items&&0<=t&&t<this._items.length?this._items[t].rowItem:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.measurement=function(){return this._measurement},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.globalStartIndex=function(){return this._items&&this._items.length?this._items[0].globalIndex:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.globalEndIndex=function(){return this._items&&this._items.length?this._items[this._items.length-1].globalIndex+1:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.size=function(){return this._items?this._items.length:0},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getByGlobalIndex=function(t){return this._itemsByGlobalIndex&&t in this._itemsByGlobalIndex?this._itemsByGlobalIndex[t]:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getRowByGlobalIndex=function(t){return this._itemsByGlobalIndex&&t in this._itemsByGlobalIndex?this._itemsByGlobalIndex[t].rowItem:null},epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.binarySearchStarts=function(t){if(!this._items||!this._items.length||this._items[0].rowItem.start()>t.end()||this._items[this._items.length-1].rowItem.start()<t.start())return{index:null,length:0};for(var e,i=0,n=this._items.length-1,r=null;i<=n;)e=Math.floor(.5*(i+n)),this._items[e].rowItem.start()==t.start()?(r=e,n=e-1):this._items[e].rowItem.start()<t.start()?i=e+1:n=e-1;null===r&&(r=i);i=0,n=this._items.length-1;for(var a=null;i<=n;)e=Math.floor(.5*(i+n)),this._items[e].rowItem.start()==t.end()?(a=e,i=e+1):this._items[e].rowItem.start()<t.end()?i=e+1:n=e-1;return null===a&&(a=i-1),{index:r,length:a+1-r}},epiviz.datatypes.GenomicData=function(){},epiviz.datatypes.GenomicData.prototype.ready=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.isReady=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.firstSeries=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.getSeries=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.get=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.getRow=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.measurements=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.globalStartIndex=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.globalEndIndex=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.size=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.getByGlobalIndex=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.getRowByGlobalIndex=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.binarySearchStarts=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.prototype.foreach=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.ValueItem=function(t,e,i,n,r){this.globalIndex=t,this.rowItem=e,this.value=0===i||i?i:null,this.measurement=n,this.valueAnnotation=r},epiviz.datatypes.GenomicData.RowItem=function(){},epiviz.datatypes.GenomicData.RowItem.prototype.id=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.seqName=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.start=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.end=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.globalIndex=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.strand=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.metadata=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicData.RowItem.prototype.rowMetadata=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.MapGenomicData=function(t){this._measurements=(this._map=t)?t.keys():null,this._mapLoaded=new epiviz.deferred.Deferred,this._map&&this._mapLoaded.resolve()},epiviz.datatypes.MapGenomicData.prototype.ready=function(t){this._mapLoaded.done(t)},epiviz.datatypes.MapGenomicData.prototype.isReady=function(){return this._mapLoaded.state()==epiviz.deferred.Deferred.State.RESOLVED},epiviz.datatypes.MapGenomicData.prototype._setMap=function(t){if(this._map)throw Error("MapGenomicData is immutable");(this._map=t)&&(this._measurements=t.keys(),this._mapLoaded.resolve())},epiviz.datatypes.MapGenomicData.prototype.firstSeries=function(){return 0==this._map.size()?null:this._map.first().value},epiviz.datatypes.MapGenomicData.prototype.getSeries=function(t){return this._map.get(t)},epiviz.datatypes.MapGenomicData.prototype.get=function(t,e){var i=this._map.get(t);return i?i.get(e):null},epiviz.datatypes.MapGenomicData.prototype.getRow=function(t,e){var i=this._map.get(t);return i?i.getRow(e):null},epiviz.datatypes.MapGenomicData.prototype.measurements=function(){return this._measurements},epiviz.datatypes.MapGenomicData.prototype.globalStartIndex=function(t){return(t=this._map.get(t))?t.globalStartIndex():null},epiviz.datatypes.MapGenomicData.prototype.globalEndIndex=function(t){return(t=this._map.get(t))?t.globalEndIndex():null},epiviz.datatypes.MapGenomicData.prototype.size=function(t){return(t=this._map.get(t))?t.size():null},epiviz.datatypes.MapGenomicData.prototype.getByGlobalIndex=function(t,e){var i=this._map.get(t);return i?i.getByGlobalIndex(e):null},epiviz.datatypes.MapGenomicData.prototype.getRowByGlobalIndex=function(t,e){var i=this._map.get(t);return i?i.getRowByGlobalIndex(e):null},epiviz.datatypes.MapGenomicData.prototype.binarySearchStarts=function(t,e){var i=this._map.get(t);return i?i.binarySearchStarts(e):{index:null,length:0}},epiviz.datatypes.MapGenomicData.prototype.foreach=function(t){this._map.foreach(function(e,i,n){t(e,i,n)})},epiviz.datatypes.PartialSummarizedExperiment=function(){this._rowData=null,this._values=new epiviz.measurements.MeasurementHashtable},epiviz.datatypes.PartialSummarizedExperiment.prototype.ranges=function(){return this.rowData()},epiviz.datatypes.PartialSummarizedExperiment.prototype.rowData=function(){return this._rowData},epiviz.datatypes.PartialSummarizedExperiment.prototype.addRowData=function(t){t&&(!this._rowData||this._rowData.boundaries().seqName()!=t.boundaries().seqName()||this._rowData.boundaries().start()>t.boundaries().end()||this._rowData.boundaries().end()<t.boundaries().start()||t.measurement().type()==epiviz.measurements.Measurement.Type.UNORDERED?this._rowData=t:this._rowData=this._rowData.merge(t))},epiviz.datatypes.PartialSummarizedExperiment.prototype.addValues=function(t){if(t){var e=this._values.get(t.measurement());!e||e.boundaries().seqName()!=t.boundaries().seqName()||e.boundaries().start()>t.boundaries().end()||e.boundaries().end()<t.boundaries().start()||t.measurement().type()==epiviz.measurements.Measurement.Type.UNORDERED?this._values.put(t.measurement(),t):this._values.put(t.measurement(),e.merge(t))}},epiviz.datatypes.PartialSummarizedExperiment.prototype.trim=function(t){var e=new epiviz.datatypes.PartialSummarizedExperiment;return this._rowData&&e.addRowData(this._rowData.trim(t)),e.rowData()&&this._values.foreach(function(i,n){e.addValues(n.trim(t,e.rowData().globalStartIndex(),e.rowData().size()))}),e},epiviz.datatypes.PartialSummarizedExperiment.prototype.values=function(t){return this._values.get(t)},epiviz.datatypes.PartialSummarizedExperiment.prototype.calcMinGlobalIndex=function(){var t=this._rowData?this._rowData.globalStartIndex():null;return this._values&&this._values.foreach(function(e,i){i&&null!=i.globalStartIndex()&&(null==t||t>i.globalStartIndex())&&(t=i.globalStartIndex())}),t},epiviz.datatypes.PartialSummarizedExperiment.prototype.calcMaxGlobalIndex=function(){var t=this._rowData&&null!=this._rowData.globalStartIndex()?this._rowData.globalStartIndex()+this._rowData.size():null;return this._values&&this._values.foreach(function(e,i){i&&null!=i.globalStartIndex()&&(null==t||t<i.globalStartIndex()+i.size())&&(t=i.globalStartIndex()+i.size())}),t},epiviz.datatypes.PartialSummarizedExperiment.prototype.toString=function(){var t,e,i,n,r,a="",o=this.calcMinGlobalIndex(),s=this.calcMaxGlobalIndex();a+=sprintf("%25s",this._rowData&&this._rowData.measurement()?this._rowData.measurement().name().substr(0,22):"[undefined datasource]");this._rowData&&this._rowData.boundaries()?(t=this._rowData.boundaries().seqName(),e=this._rowData.boundaries().start(),i=this._rowData.boundaries().end(),n=null!=this._rowData.globalStartIndex()?this._rowData.globalStartIndex():"*",r=this._rowData.size()):(t=e=i=n="*",r=0);a+=sprintf(" [%6s%10s%10s] [globalStartIndex: %10s] [size: %7s]\n",t,e,i,n,r);var u=sprintf("%15s%15s%15s%15s%15s","id","idx","chr","start","end");this._values&&this._values.foreach(function(n,r){a+=sprintf("%25s",n.name().substr(0,22)),r&&r.boundaries()?(t=r.boundaries().seqName(),e=r.boundaries().start(),i=r.boundaries().end()):t=e=i="*",a+=sprintf(" [%6s%10s%10s] [globalStartIndex: %10s] [size: %7s]\n",t,e,i,null!=r.globalStartIndex()?r.globalStartIndex():"*",r.size()),u+=sprintf("%25s",n.name().substr(0,22))});a+=u+"\n";for(var c=o;c<s;++c)this._rowData&&null!=this._rowData.globalStartIndex()&&this._rowData.globalStartIndex()<=c&&this._rowData.globalStartIndex()+this._rowData.size()>c?(o=(n=this._rowData.getByGlobalIndex(c)).id(),t=n.seqName(),e=n.start(),i=n.end()):o=t=e=i="*",a+=sprintf("%15s%15s%15s%15s%15s",o,c,t,e,i),this._values&&this._values.foreach(function(t,e){a=e&&null!=e.globalStartIndex()&&e.globalStartIndex()<=c&&e.globalStartIndex()+e.size()>c?a+sprintf("%25s",e.getByGlobalIndex(c)):a+sprintf("%25s","*")}),a+="\n";return a},epiviz.data.Cache=function(t,e){if(this._config=t,this._dataProviderFactory=e,this._data={},this._measurementRequestStackMap=new epiviz.measurements.MeasurementHashtable,this._measurementPendingRequestsMap=new epiviz.measurements.MeasurementHashtable,this._lastRequest=null,0<this._config.cacheUpdateIntervalMilliseconds){var i=this;this._intervalId=window.setTimeout(function(){i._clearUnneededData()},t.cacheUpdateIntervalMilliseconds)}},epiviz.data.Cache.prototype.getData=function(t,e,i,n){var r=epiviz.measurements.Measurement.Type,a=this;this._lastRequest=epiviz.datatypes.GenomicRange.fromStartEnd(t.seqName(),t.start()-t.width(),t.end()+t.width(),t.genome()),0<this._config.cacheUpdateIntervalMilliseconds&&(window.clearInterval(this._intervalId),this._intervalId=window.setTimeout(function(){a._clearUnneededData()},this._config.cacheUpdateIntervalMilliseconds));var o=this._extractComputedMeasurements(e);this._updateComputedMeasurementsData(o),this._serveAvailableData(t,e,i),o=[new epiviz.datatypes.GenomicRange(t.seqName(),Math.max(t.start()-t.width(),0),t.end()+t.width()-Math.max(t.start()-t.width(),0),t.genome())],this._calcMeasurementNeededRanges(o,e).foreach(function(o,s){var u,c=a._measurementRequestStackMap.get(o);if(c||(c=new epiviz.data.RequestStack,a._measurementRequestStackMap.put(o,c)),0==s.length)u=epiviz.data.Request.emptyRequest(),c.pushRequest(u,function(){a._handleResponse(i,t,e,u,null,o,null)}),c.serveData(new epiviz.data.Response(u.id(),{}));else for(var l=0;l<s.length;++l){u=o.type()==r.RANGE?epiviz.data.Request.getRows(o,s[l]):epiviz.data.Request.getValues(o,s[l]),function(n,r){c.pushRequest(r,function(s){a._handleResponse(i,t,e,r,n,o,s)})}(s[l],u);var p=a._measurementPendingRequestsMap.get(o);p||(p={},a._measurementPendingRequestsMap.put(o,p)),p[u.id()]=s[l],(a._dataProviderFactory.get(o.dataprovider())||a._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(u,function(t){c.serveData(t)},function(t,e,i){n(t,e,i)})}})},epiviz.data.Cache.prototype._handleResponse=function(t,e,i,n,r,a,o){if(r){if(a.type()==epiviz.measurements.Measurement.Type.RANGE)r=new epiviz.datatypes.GenomicRangeArray(a,r,o.globalStartIndex,o.values,o.useOffset);else{var s=a.datasource();0==Object.keys(o.rows.values.metadata).length&&delete o.rows.values.metadata;var u=new epiviz.datatypes.GenomicRangeArray(s,r,o.rows.globalStartIndex,o.rows.values,o.rows.useOffset);this._mergeData(s,u),r=new epiviz.datatypes.FeatureValueArray(a,r,o.values.globalStartIndex,o.values.values[a.id()])}this._mergeData(a,r)}r=this._extractComputedMeasurements(i),this._updateComputedMeasurementsData(r),(a=this._measurementPendingRequestsMap.get(a))&&delete a[n.id()],this._serveAvailableData(e,i,t)},epiviz.data.Cache.prototype._serveAvailableData=function(t,e,i){var n,r=epiviz.measurements.Measurement.Type,a=this,o=[];for(n in e)if(e.hasOwnProperty(n)){var s=e[n],u=!0,c=new epiviz.measurements.MeasurementHashtable;!function(e){s.foreach(function(i){if(!(o=a._data[i.datasourceGroup()])||!o.rowData()||i.type()==r.FEATURE&&!o.values(i))return u=!1,!0;var n=o.rowData(),o=i.type()==r.FEATURE?o.values(i):null;return(n=t.subtract(n.boundaries())).length||o&&(n=t.subtract(o.boundaries())).length?(u=!1,!0):(e.put(i,new epiviz.datatypes.MeasurementGenomicDataWrapper(i,a._data[i.datasourceGroup()])),!1)})}(c),u&&(i(n,new epiviz.datatypes.MapGenomicData(c)),o.push(n))}for(i=0;i<o.length;++i)delete e[o[i]]},epiviz.data.Cache.prototype._calcMeasurementNeededRanges=function(t,e){var i,n=epiviz.measurements.Measurement.Type,r=this,a=new epiviz.measurements.MeasurementHashtable;for(i in e)if(e.hasOwnProperty(i)){var o=new epiviz.measurements.MeasurementSet;!function(t){e[i].foreach(function(e){e.componentMeasurements().foreach(function(e){t.add(e)})})}(o),o.foreach(function(e){var i;if(!(i=r._data[e.datasourceGroup()])||e.type()==n.FEATURE&&!i.values(e))i=t.slice(0);else if(o=e.type()==n.FEATURE?i.values(e):i.rowData()){i=[];for(var o=o.boundaries(),s=0;s<t.length;++s)i=i.concat(t[s].subtract(o))}else i=t.slice(0);if(o=r._measurementPendingRequestsMap.get(e))for(s=0;s<i.length;++s)for(var u in o)if(o.hasOwnProperty(u)){var c=i[s].subtract(o[u]);if(Array.prototype.splice.apply(i,[s,1].concat(c)),0==c.length){--s;break}if(s>=i.length)break}a.put(e,i)})}return a},epiviz.data.Cache.prototype._extractComputedMeasurements=function(t){var e,i=new epiviz.measurements.MeasurementSet;for(e in t)t.hasOwnProperty(e)&&t[e].foreach(function(t){t.isComputed()&&i.add(t)});return i},epiviz.data.Cache.prototype._mergeData=function(t,e){var i=epiviz.measurements.Measurement.Type,n=this._data[t.datasourceGroup()];n||(n=new epiviz.datatypes.PartialSummarizedExperiment,this._data[t.datasourceGroup()]=n),t.type()==i.RANGE?n.addRowData(e):n.addValues(e)},epiviz.data.Cache.prototype._clearUnneededData=function(){if(this._lastRequest){console.log(sprintf("Clearing data outside of range [%7s%10s%10s]",this._lastRequest.seqName(),this._lastRequest.start(),this._lastRequest.end()));var t,e={};for(t in this._data)this._data.hasOwnProperty(t)&&(e[t]=this._data[t].trim(this._lastRequest));this._data=e}},epiviz.data.Cache.prototype._updateComputedMeasurementsData=function(t){var e=this,i=epiviz.datatypes.GenomicRange;t.foreach(function(t){var n=e._data[t.datasourceGroup()];if(!n)return!1;var r=t.componentMeasurements(),a=null,o=null,s=null;if(r.foreach(function(t){if(!(t=n.values(t))||!t.boundaries())return s=o=a=null,!0;if(null===s)return a=t.globalStartIndex(),o=t.size(),s=t.boundaries(),null===a;if(t.boundaries().seqName()!=s.seqName())return o=0,!0;if(a<t.globalStartIndex()){if(0>(o-=t.globalStartIndex()-a))return o=0,!0;a=t.globalStartIndex();var e=t.boundaries().start(),r=s.end();o>t.size()&&(o=t.size(),r=t.boundaries().end()),s=i.fromStartEnd(s.seqName(),e,r,s.genome())}else if(e=t.size()-a+t.globalStartIndex(),o>e){if(0>=(o=e))return o=0,!0;s=i.fromStartEnd(s.seqName(),s.start(),t.boundaries().end(),s.genome())}return 0==o}),null===s)return!1;var u=n.values(t);if(u&&(null===a||u.globalStartIndex()<a&&u.globalStartIndex()+u.size()>a+o))return!1;var c=new epiviz.measurements.MeasurementHashtable,l=null;return u&&u.size()?(r.foreach(function(t){var e=n.values(t),i=[];if(null!==a)for(var r=a;r<u.globalStartIndex();++r)i.push(e.getByGlobalIndex(r));c.put(t,i)}),l=new epiviz.datatypes.FeatureValueArray(t,i.fromStartEnd(s.seqName(),s.start(),u.boundaries().start()),a,t.evaluateArr(c),s.genome()),e._mergeData(t,l),c=new epiviz.measurements.MeasurementHashtable,r.foreach(function(t){var e=n.values(t),i=[];if(null!==a)for(var r=u.globalStartIndex()+u.size();r<a+o;++r)i.push(e.getByGlobalIndex(r));c.put(t,i)}),l=new epiviz.datatypes.FeatureValueArray(t,i.fromStartEnd(s.seqName(),u.boundaries().end(),s.end(),s.genome()),u.globalStartIndex()+u.size(),t.evaluateArr(c)),e._mergeData(t,l),!1):(c=new epiviz.measurements.MeasurementHashtable,r.foreach(function(t){var e=n.values(t),i=[];if(null!==a)for(var r=a;r<a+o;++r)i.push(e.getByGlobalIndex(r));c.put(t,i)}),l=new epiviz.datatypes.FeatureValueArray(t,s,a,t.evaluateArr(c)),e._mergeData(t,l),!1)})},epiviz.data.Cache.prototype.flush=function(){this._data={},this._measurementRequestStackMap.foreach(function(t,e){e.clear()}),this._measurementPendingRequestsMap.clear()},epiviz.data.Cache.prototype.clearDatasourceGroupCache=function(t){delete this._data[t],this._measurementRequestStackMap.foreach(function(e,i){e.datasourceGroup()==t&&i.clear()});var e=[];this._measurementPendingRequestsMap.foreach(function(i,n){i.datasourceGroup()==t&&e.push(i)});for(var i=0;i<e.length;++i)this._measurementPendingRequestsMap.put(e[i],{})},epiviz.data.EmptyResponseDataProvider=function(){epiviz.data.DataProvider.call(this,epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)},epiviz.data.EmptyResponseDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype),epiviz.data.EmptyResponseDataProvider.constructor=epiviz.data.EmptyResponseDataProvider,epiviz.data.EmptyResponseDataProvider.DEFAULT_ID="empty",epiviz.data.EmptyResponseDataProvider.prototype.getData=function(t,e){var i=t.id();switch(t.get("action")){case epiviz.data.Request.Action.GET_ROWS:e(epiviz.data.Response.fromRawObject({data:{values:{id:null,start:[],end:[],strand:[],metadata:{my_metadata:[]}},globalStartIndex:null,useOffset:!1},requestId:i}));break;case epiviz.data.Request.Action.GET_VALUES:e(epiviz.data.Response.fromRawObject({data:{values:[],globalStartIndex:null},requestId:i}));break;case epiviz.data.Request.Action.GET_MEASUREMENTS:e(epiviz.data.Response.fromRawObject({requestId:t.id(),data:{id:[],name:[],type:[],datasourceId:[],datasourceGroup:[],defaultChartType:[],annotation:[],minValue:[],maxValue:[],metadata:[]}}));break;case epiviz.data.Request.Action.GET_SEQINFOS:case epiviz.data.Request.Action.SEARCH:case epiviz.data.Request.Action.SAVE_WORKSPACE:case epiviz.data.Request.Action.DELETE_WORKSPACE:case epiviz.data.Request.Action.GET_WORKSPACES:e(epiviz.data.Response.fromRawObject({requestId:t.id(),data:[]}));break;default:epiviz.data.DataProvider.prototype.getData.call(this,t,e)}},epiviz.data.DataProviderFactory=function(t){this._config=t,this._providers={};for(var e=this._size=0;e<this._config.dataProviders.length;++e){t=$.isArray(this._config.dataProviders[e])?this._config.dataProviders[e]:this._config.dataProviders[e].split(",");var i=epiviz.utils.evaluateFullyQualifiedTypeName(t[0]);i&&(t=epiviz.utils.applyConstructor(i,t.slice(1)),this._providers[t.id()]=t,++this._size)}t=new epiviz.data.EmptyResponseDataProvider,this._providers[t.id()]=t,++this._size,t=this._config.workspacesDataProvider.split(","),e=epiviz.utils.evaluateFullyQualifiedTypeName(t[0]),this._workspacesDataProvider=epiviz.utils.applyConstructor(e,t.slice(1))},epiviz.data.DataProviderFactory.prototype.foreach=function(t){for(var e in this._providers)if(this._providers.hasOwnProperty(e)&&t(this._providers[e]))break},epiviz.data.DataProviderFactory.prototype.isEmpty=function(){return!this._size},epiviz.data.DataProviderFactory.prototype.size=function(){return this._size},epiviz.data.DataProviderFactory.prototype.get=function(t){return t in this._providers?this._providers[t]:null},epiviz.data.DataProviderFactory.prototype.workspacesDataProvider=function(){return this._workspacesDataProvider},epiviz.datatypes.GenomicArray=function(t,e,i,n){this._measurement=t,this._boundaries=e,this._globalStartIndex=i,this._values=n},epiviz.datatypes.GenomicArray.prototype.boundaries=function(){return this._boundaries},epiviz.datatypes.GenomicArray.prototype.globalStartIndex=function(){return this._globalStartIndex},epiviz.datatypes.GenomicArray.prototype.measurement=function(){return this._measurement},epiviz.datatypes.GenomicArray.prototype.get=function(t){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicArray.prototype.size=function(){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicArray.prototype.getByGlobalIndex=function(t){return this.get(t-this._globalStartIndex)},epiviz.datatypes.GenomicArray.prototype.concatValues=function(t,e){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicArray.prototype.createNew=function(t,e,i,n){throw Error("unimplemented abstract method")},epiviz.datatypes.GenomicArray.prototype.merge=function(t){if(!t||null==t.boundaries())return this;if(this.boundaries().seqName()!=t.boundaries().seqName()||this.boundaries().start()>t.boundaries().end()||t.boundaries().start()>this.boundaries().end())throw Error("Two genomic arrays can only be merged if they overlap or are in continuation to one another");var e=(a=this.boundaries().start()<t.boundaries().start()?this:t)==this?t:this;if(a.boundaries().end()>=e.boundaries().end())return a;var i=null!=a.globalStartIndex()&&null!=e.globalStartIndex()?a.globalStartIndex()+a.size()-e.globalStartIndex():0;t=a.measurement();var n=null!=a.globalStartIndex()?a.globalStartIndex():e.globalStartIndex(),r=epiviz.datatypes.GenomicRange.fromStartEnd(a.boundaries().seqName(),a.boundaries().start(),e.boundaries().end(),a.boundaries().genome()),a=a.concatValues(e,i);return this.createNew(t,r,n,a)},epiviz.datatypes.GenomicRangeArray=function(t,e,i,n,r){if(epiviz.datatypes.GenomicArray.call(this,t,e,i,n),this._id=n.id,this._seqName=n.chr,this._start=n.start,this._end=n.end,this._strand=n.strand||null,this._metadata=n.metadata,this._size=null,r)for(t=1;t<this._start.length;++t)this._start[t]+=this._start[t-1],this._end&&(this._end[t]+=this._end[t-1])},epiviz.datatypes.GenomicRangeArray.prototype=epiviz.utils.mapCopy(epiviz.datatypes.GenomicArray.prototype),epiviz.datatypes.GenomicRangeArray.constructor=epiviz.datatypes.GenomicRangeArray,epiviz.datatypes.GenomicRangeArray.prototype.createNew=function(t,e,i,n){return new epiviz.datatypes.GenomicRangeArray(t,e,i,n)},epiviz.datatypes.GenomicRangeArray.prototype.get=function(t){return 0>t||t>=this.size()?null:new epiviz.datatypes.GenomicRangeArray.RowItemWrapper(this,t)},epiviz.datatypes.GenomicRangeArray.prototype.size=function(){return null==this._size&&(this._size=Math.max(this._id?this._id.length:0,this._start?this._start.length:0,this._end?this._end.length:0,this._metadata&&Object.keys(this._metadata).length?Math.max.apply(void 0,$.map(this._metadata,function(t){return t.length})):0)),this._size},epiviz.datatypes.GenomicRangeArray.prototype.concatValues=function(t,e){var i;if(Array.isArray(this._strand)||Array.isArray(t._strand)||this._strand!=t._strand){i=Array.isArray(this._strand)?this._strand:epiviz.utils.fillArray(this.size(),this._strand);var n=Array.isArray(t._strand)?t._strand:epiviz.utils.fillArray(t.size(),t._strand);i=i.concat(n.slice(e))}else i=this._strand;n=this._id?this._id.concat(t._id.slice(e)):null;var r,a=this._start.concat(t._start.slice(e)),o=this._end?this._end.concat(t._end.slice(e)):null,s=this._seqName?this._seqName.concat(t._seqName.slice(e)):null,u={};for(r in this._metadata)this._metadata.hasOwnProperty(r)&&(u[r]=this._metadata[r].concat(t._metadata[r].slice(e)));return{id:n,start:a,end:o,strand:i,metadata:u,chr:s}},epiviz.datatypes.GenomicRangeArray.prototype.trim=function(t){if(null==this.globalStartIndex()||!this.size()||!t||!this.boundaries()||this.boundaries().seqName()!=t.seqName())return null;var e,i=Math.max(this.boundaries().start(),t.start());if((n=Math.min(this.boundaries().end(),t.end()))<=i)return null;t=epiviz.datatypes.GenomicRange.fromStartEnd(t.seqName(),i,n,t.genome());for(var n=i=-1,r=0;r<this.size();++r)0>i&&this.end(r)>=t.start()&&(i=r),this._start[r]<t.end()&&(n=r+1);if(n<=i)return null;if(0<=i&&n>=i){for(e in r={id:this._id?this._id.slice(i,n):null,start:this._start.slice(i,n),end:this._end?this._end.slice(i,n):null,chr:this._seqName?this._seqName.slice(i,n):null,strand:Array.isArray(this._strand)?this._strand.slice(i,n):this._strand,metadata:{}},this._metadata)this._metadata.hasOwnProperty(e)&&(r.metadata[e]=this._metadata[e].slice(i,n));e=this.globalStartIndex()+i}else{for(e in r={id:this._id?[]:null,start:[],chr:this._seqName?[]:null,end:this._end?[]:null,strand:Array.isArray(this._strand)?[]:this._strand,metadata:{}},this._metadata)this._metadata.hasOwnProperty(e)&&(r.metadata[e]=[]);e=null}return new epiviz.datatypes.GenomicRangeArray(this.measurement(),t,e,r)},epiviz.datatypes.GenomicRangeArray.prototype.ranges=function(){return this},epiviz.datatypes.GenomicRangeArray.prototype.foreach=function(t){for(var e=this.size(),i=0;i<e&&!t(this.get(i));++i);},epiviz.datatypes.GenomicRangeArray.prototype.metadataColumns=function(){return this._metadata?Object.keys(this._metadata):[]},epiviz.datatypes.GenomicRangeArray.prototype.id=function(t){return this._id?this._id[t]:this.globalStartIndex()+t},epiviz.datatypes.GenomicRangeArray.prototype.seqName=function(t){return this._seqName?this._seqName[t]:void 0},epiviz.datatypes.GenomicRangeArray.prototype.start=function(t){return this._start?this._start[t]:void 0},epiviz.datatypes.GenomicRangeArray.prototype.end=function(t){return this._end?this._end[t]:this.start(t)},epiviz.datatypes.GenomicRangeArray.prototype.strand=function(t){return Array.isArray(this._strand)?this._strand[t]:this._strand},epiviz.datatypes.GenomicRangeArray.prototype.metadata=function(t,e){return this._metadata&&this._metadata[t]?this._metadata[t][e]:null},epiviz.datatypes.GenomicRangeArray.prototype.rowMetadata=function(t){var e,i={};for(e in this._metadata)this._metadata.hasOwnProperty(e)&&(i[e]=this._metadata[e][t]);return i},epiviz.datatypes.GenomicRangeArray.prototype.toString=function(){var t,e,i;this.boundaries()?(this.boundaries().genome(),t=this.boundaries().seqName(),e=this.boundaries().start(),i=this.boundaries().end()):t=e=i="*",t=sprintf("%25s",this.measurement().name().substr(0,22))+sprintf(" [%6s%10s%10s]",t,e,i),e=sprintf("%10s:","id"),i=sprintf("%10s:","idx");var n=sprintf("%10s:","chr"),r=sprintf("%10s:","start"),a=sprintf("%10s:","end");if(null!=this.globalStartIndex())for(var o=this.globalStartIndex();o<this.globalStartIndex()+this.size();++o){var s=this.getByGlobalIndex(o);e+=sprintf("%10s",s.id()),i+=sprintf("%10s",o),n+=sprintf("%10s",s.seqName()),r+=sprintf("%10s",s.start()),a+=sprintf("%10s",s.end())}return[t,e,i,n,r,a].join("\n")},epiviz.datatypes.GenomicRangeArray.RowItemWrapper=function(t,e){this._index=e,this._parent=t},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.parent=function(){return this._parent},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.id=function(){return this._parent.id(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.seqName=function(){return this._parent.seqName(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.start=function(){return this._parent.start(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.end=function(){return this._parent.end(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.index=function(){return this._index},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.globalIndex=function(){return this._index+this._parent.globalStartIndex()},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.equals=function(t){return!!t&&(this==t||t.seqName()==this.seqName()&&t.start()==this.start()&&t.end()==this.end())},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.strand=function(){return this._parent.strand(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.metadata=function(t){return this._parent.metadata(t,this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.rowMetadata=function(){return this._parent.rowMetadata(this._index)},epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.overlapsWith=function(t){return!!t&&(this==t||this.seqName()==t.seqName()&&(this.start()<t.end()&&this.end()>t.start()))},epiviz.datatypes.FeatureValueArray=function(t,e,i,n){var r;!n||$.isArray(n)?(r=n,n={values:n}):r=n.values,epiviz.datatypes.GenomicArray.call(this,t,e,i,r),this._valuesAnnotation=n},epiviz.datatypes.FeatureValueArray.prototype=epiviz.utils.mapCopy(epiviz.datatypes.GenomicArray.prototype),epiviz.datatypes.FeatureValueArray.constructor=epiviz.datatypes.FeatureValueArray,epiviz.datatypes.FeatureValueArray.prototype.createNew=function(t,e,i,n){return new epiviz.datatypes.FeatureValueArray(t,e,i,n)},epiviz.datatypes.FeatureValueArray.prototype.get=function(t){return this._values[t]},epiviz.datatypes.FeatureValueArray.prototype.getAnnotation=function(t){if(null==this._valuesAnnotation)return null;var e,i={};for(e in this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(e)&&(i[e]=this._valuesAnnotation[e][t]);return i},epiviz.datatypes.FeatureValueArray.prototype.size=function(){return this._values?this._values.length:0},epiviz.datatypes.FeatureValueArray.prototype.concatValues=function(t,e){if(!t||!t.size())return this._valuesAnnotation;this._valuesAnnotation&&this._valuesAnnotation.values||(this._valuesAnnotation={values:[]});var i,n={};for(i in this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(i)&&t._valuesAnnotation.hasOwnProperty(i)&&(n[i]=this._valuesAnnotation[i].concat(t._valuesAnnotation[i].slice(e)));return n},epiviz.datatypes.FeatureValueArray.prototype.trim=function(t,e,i){if(null==this.globalStartIndex()||!this.size()||null==e||!t||!this.boundaries()||this.boundaries().seqName()!=t.seqName())return null;var n=Math.max(this.boundaries().start(),t.start()),r=Math.min(this.boundaries().end(),t.end());if(r<=n)return null;if(t=epiviz.datatypes.GenomicRange.fromStartEnd(t.seqName(),n,r,t.genome()),n=Math.max(e,this.globalStartIndex())-this.globalStartIndex(),(e=Math.min(e+i,this.globalStartIndex()+this.size())-this.globalStartIndex())<=n)return null;for(var a in i={},this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(a)&&(i[a]=this._valuesAnnotation[a].slice(n,e));return new epiviz.datatypes.FeatureValueArray(this.measurement(),t,n+this.globalStartIndex(),i)},epiviz.datatypes.FeatureValueArray.prototype.toString=function(){var t,e,i;if(this.boundaries()?(t=this.boundaries().seqName(),e=this.boundaries().start(),i=this.boundaries().end()):t=e=i="*",t=sprintf("%25s",this.measurement().name().substr(0,22))+sprintf(" [%6s%10s%10s]",t,e,i),e=sprintf("%10s:","idx"),i=sprintf("%10s:","val"),null!=this.globalStartIndex())for(var n=this.globalStartIndex();n<this.globalStartIndex()+this.size();++n){var r=this.getByGlobalIndex(n);e+=sprintf("%10s",n),i+=sprintf("%10s",r)}return[t,e,i].join("\n")},epiviz.datatypes.MeasurementGenomicDataWrapper=function(t,e){this._measurement=t,this._container=e,this._globalStartIndex=this._size=null},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.get=function(t){var e,i=this._container.rowData(),n=this.globalStartIndex(),r=null,a=null,o=e=null,s=this.size();return!s||t>=s||0>t?new epiviz.datatypes.GenomicData.ValueItem(o,r,a,this._measurement,e):(null!=n&&(this._measurement.type()!=epiviz.measurements.Measurement.Type.FEATURE&&this._measurement.type()!=epiviz.measurements.Measurement.Type.UNORDERED||(r=n-(e=this._container.values(this._measurement)).globalStartIndex()+t,a=e.get(r),e=e.getAnnotation(r)),r=n-i.globalStartIndex()+t,r=i.get(r),o=n+t),new epiviz.datatypes.GenomicData.ValueItem(o,r,a,this._measurement,e))},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getRow=function(t){var e=this._container.rowData(),i=this.globalStartIndex(),n=null,r=this.size();return!r||t>=r||0>t?n:(null!=i&&(t=i-e.globalStartIndex()+t,n=e.get(t)),n)},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.measurement=function(){return this._measurement},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.globalStartIndex=function(){if(null!==this._globalStartIndex)return this._globalStartIndex;var t,e=this._container.rowData().globalStartIndex();if(null===e)return e;if(this._measurement.type()==epiviz.measurements.Measurement.Type.FEATURE||this._measurement.type()==epiviz.measurements.Measurement.Type.UNORDERED){if(!(t=this._container.values(this._measurement)).globalStartIndex())return t.globalStartIndex();e=Math.max(e,t.globalStartIndex())}return this._globalStartIndex=e},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.globalEndIndex=function(){var t=this.globalStartIndex();return null==t?null:t+this.size()},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.size=function(){if(null!==this._size)return this._size;var t=this.globalStartIndex();if(null==t)return 0;var e=this._container.rowData(),i=this._container.values(this._measurement);e=e.size()-t+e.globalStartIndex();return this._measurement.type()!=epiviz.measurements.Measurement.Type.FEATURE&&this._measurement.type()!=epiviz.measurements.Measurement.Type.UNORDERED||(e=Math.min(e,i.size()-t+i.globalStartIndex())),this._size=Math.max(0,e)},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getByGlobalIndex=function(t){var e=this.globalStartIndex();return null==e?new epiviz.datatypes.GenomicData.ValueItem(null,null,null,this._measurement,null):this.get(t-e)},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getRowByGlobalIndex=function(t){var e=this.globalStartIndex();return null==e?null:this.getRow(t-e)},epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.binarySearchStarts=function(t){var e=this._container.rowData();if(0==this.size()||!e||0==e.size()||e.start(0)>=t.end()||e.start(e.size()-1)<=t.start())return{index:null,length:0};for(var i,n=0,r=e.size()-1,a=null;n<=r;)i=Math.floor(.5*(n+r)),e.start(i)==t.start()?(a=i,r=i-1):e.start(i)<t.start()?n=i+1:r=i-1;null===a&&(a=n);n=0,r=e.size()-1;for(var o=null;n<=r;)i=Math.floor(.5*(n+r)),e.start(i)==t.end()?(o=i,n=i+1):e.start(i)<t.end()?n=i+1:r=i-1;return null===o&&(o=n-1),t=Math.max(a+e.globalStartIndex(),this.globalStartIndex()),e=Math.min(o+e.globalStartIndex(),this.globalStartIndex()+this.size()-1),{index:t-this.globalStartIndex(),length:e-t+1}},epiviz.datatypes.SeqInfo=function(t,e,i,n){this.genome=n,this.seqName=t,this.min=e,this.max=i},epiviz.datatypes.SeqInfo.prototype.raw=function(){return[this.seqName,this.min,this.max,this.genome]},epiviz.datatypes.SeqInfo.fromRawObject=function(t){return new epiviz.datatypes.SeqInfo(t[0],parseFloat(t[1]),parseFloat(t[2]),t[3])},epiviz.datatypes.SeqInfo.compare=function(t,e){if(t.genome==e.genome){if(t.seqName==e.seqName)return 0;if(null==t.seqName)return-1;if(null==e.seqName)return 1;var i=t.seqName.replace(/\D/g,""),n=e.seqName.replace(/\D/g,"");return""==i||""==n||!epiviz.utils.stringStartsWith(t.seqName,i)&&!epiviz.utils.stringEndsWith(t.seqName,i)||!epiviz.utils.stringStartsWith(e.seqName,n)&&!epiviz.utils.stringEndsWith(e.seqName,n)?t.seqName<e.seqName?-1:t.seqName>e.seqName?1:0:parseInt(i)-parseInt(n)}return i=t.genome.replace(/\D/g,""),n=e.genome.replace(/\D/g,""),""==i||""==n||!epiviz.utils.stringStartsWith(t.genome,i)&&!epiviz.utils.stringEndsWith(t.genome,i)||!epiviz.utils.stringStartsWith(e.genome,n)&&!epiviz.utils.stringEndsWith(e.genome,n)?t.genome<e.genome?-1:t.genome>e.genome?1:0:parseInt(i)-parseInt(n)},epiviz.data.DataManager=function(t,e){this._config=t,this._measurements=new epiviz.measurements.MeasurementSet,this._dataProviderFactory=e,this._cache=new epiviz.data.Cache(t,e),this._combinedRequestsStacks={},this._requestAddMeasurements=new epiviz.events.Event,this._requestRemoveMeasurements=new epiviz.events.Event,this._requestAddChart=new epiviz.events.Event,this._requestRemoveChart=new epiviz.events.Event,this._requestPrintWorkspace=new epiviz.events.Event,this._requestLoadWorkspace=new epiviz.events.Event,this._requestAddSeqInfos=new epiviz.events.Event,this._requestRemoveSeqNames=new epiviz.events.Event,this._requestNavigate=new epiviz.events.Event,this._requestRedraw=new epiviz.events.Event,this._flushCache=new epiviz.events.Event,this._clearDatasourceGroupCache=new epiviz.events.Event,this._requestCurrentLocation=new epiviz.events.Event,this._requestGetChartSettings=new epiviz.events.Event,this._requestSetChartSettings=new epiviz.events.Event,this._requestGetAvailableCharts=new epiviz.events.Event,this._requestLoadMeasurements=new epiviz.events.Event,this._requestUiStatus=new epiviz.events.Event,this._registerProviderAddMeasurements(),this._registerProviderRemoveMeasurements(),this._registerProviderAddChart(),this._registerProviderRemoveChart(),this._registerProviderPrintWorkspace(),this._registerProviderLoadWorkspace(),this._registerProviderAddSeqInfos(),this._registerProviderRemoveSeqNames(),this._registerProviderNavigate(),this._registerProviderRedraw(),this._registerProviderFlushCache(),this._registerProviderClearDatasourceGroupCache(),this._registerProviderGetCurrentLocation(),this._registerProviderGetChartSettings(),this._registerProviderSetChartSettings(),this._registerProviderGetAvailableCharts(),this._registerProviderUiStatus(),this._registerProviderLoadMeasurements()},epiviz.data.DataManager.prototype.onRequestAddMeasurements=function(){return this._requestAddMeasurements},epiviz.data.DataManager.prototype.onRequestRemoveMeasurements=function(){return this._requestRemoveMeasurements},epiviz.data.DataManager.prototype.onRequestLoadMeasurements=function(){return this._requestLoadMeasurements},epiviz.data.DataManager.prototype.onRequestAddChart=function(){return this._requestAddChart},epiviz.data.DataManager.prototype.onRequestRemoveChart=function(){return this._requestRemoveChart},epiviz.data.DataManager.prototype.onRequestPrintWorkspace=function(){return this._requestPrintWorkspace},epiviz.data.DataManager.prototype.onRequestLoadWorkspace=function(){return this._requestLoadWorkspace},epiviz.data.DataManager.prototype.onRequestAddSeqInfos=function(){return this._requestAddSeqInfos},epiviz.data.DataManager.prototype.onRequestRemoveSeqNames=function(){return this._requestRemoveSeqNames},epiviz.data.DataManager.prototype.onRequestNavigate=function(){return this._requestNavigate},epiviz.data.DataManager.prototype.onRequestRedraw=function(){return this._requestRedraw},epiviz.data.DataManager.prototype.onClearDatasourceGroupCache=function(){return this._clearDatasourceGroupCache},epiviz.data.DataManager.prototype.onFlushCache=function(){return this._flushCache},epiviz.data.DataManager.prototype.onRequestCurrentLocation=function(){return this._requestCurrentLocation},epiviz.data.DataManager.prototype.onRequestGetChartSettings=function(){return this._requestGetChartSettings},epiviz.data.DataManager.prototype.onRequestSetChartSettings=function(){return this._requestSetChartSettings},epiviz.data.DataManager.prototype.onRequestGetAvailableCharts=function(){return this._requestGetAvailableCharts},epiviz.data.DataManager.prototype.onRequestUiStatus=function(){return this._requestUiStatus},epiviz.data.DataManager.prototype.getSeqInfos=function(t,e){var i=this,n=0,r={},a=[];this._dataProviderFactory.foreach(function(o){o.getData(epiviz.data.Request.getSeqInfos(o.id()),function(e){if(e=e.data(),5==epiviz.EpiViz.VERSION){if(e&&!Array.isArray(e))for(var o=Object.keys(e),s=0;s<o.length;s++)for(var u=0;u<e[o[s]].length;u++)a.push(epiviz.datatypes.SeqInfo.fromRawObject([e[o[s]][u][0],e[o[s]][u][1],e[o[s]][u][2],o[s]]))}else if(e)if(Array.isArray(e))for(s=0;s<e.length;++s)e[s][0]in r||(a.push(epiviz.datatypes.SeqInfo.fromRawObject(e[s])),r[e[s][0]]=!0);else for(o=Object.keys(e),s=0;s<o.length;s++)o[s]in r||(a.push(epiviz.datatypes.SeqInfo.fromRawObject([o[s],e[o[s]][0],e[o[s]][1]])),r[o[s]]=!0);++n<i._dataProviderFactory.size()||t(a.sort(epiviz.datatypes.SeqInfo.compare))},function(t,i,n){e(t,i,n)})})},epiviz.data.DataManager.prototype.updateChartSettings=function(t){this._dataProviderFactory.foreach(function(e){if(e.id().includes("websocket-")){var i=null;null!=t.colorMap&&(i=t.colorMap._colors),e.updateChartSettings(epiviz.data.Request.createRequest({action:epiviz.data.Request.Action.SET_CHART_SETTINGS,settings:t.settings,colorMap:i,chartId:t.chartId}),function(){})}})},epiviz.data.DataManager.prototype.getMeasurements=function(a,b){var c=this,d=new epiviz.measurements.MeasurementSet,e=0;this._dataProviderFactory.foreach(function(f){f.getData(epiviz.data.Request.getMeasurements(f.id()),function(b){if(b=b.data())for(var g=b.id&&b.id.length||0,l=0;l<g;++l)d.add(new epiviz.measurements.Measurement(b.id[l],b.name[l],$.isArray(b.type)?b.type[l]:b.type,$.isArray(b.datasourceId)?b.datasourceId[l]:b.datasourceId,$.isArray(b.datasourceGroup)?b.datasourceGroup[l]:b.datasourceGroup,f.id(),null,$.isArray(b.defaultChartType)?b.defaultChartType[l]:b.defaultChartType,b.annotation[l],$.isArray(b.minValue)?b.minValue[l]:b.minValue,$.isArray(b.maxValue)?b.maxValue[l]:b.maxValue,eval(b.metadata[l])));++e<c._dataProviderFactory.size()||a(d)},function(t,e,i){b(t,e,i)})})},epiviz.data.DataManager.prototype.getData=function(t,e,i,n){this._config.useCache&&null!=t&&"all"!=t.seqName()&&null!=t.seqName()?this._cache.getData(t,e,i,n):this._getDataNoCache(t,e,i,n)},epiviz.data.DataManager.prototype._getDataNoCache=function(t,e,i,n){var r,a=this,o={};for(r in e)if(e.hasOwnProperty(r)){var s,u=e[r].split(function(t){return t.dataprovider()});for(s in u)if(u.hasOwnProperty(s)){var c=o[s];null==c?o[s]=u[s]:c.addAll(u[s])}}var l={};epiviz.utils.forEach(o,function(r,o){var s=r.split(function(t){return t.datasource().id()}),u=epiviz.data.Request.getCombined(s,t),c=a._combinedRequestsStacks[o];null==c&&(c=new epiviz.data.RequestStack,a._combinedRequestsStacks[o]=c),c.pushRequest(u,function(n){var r={};epiviz.utils.forEach(s,function(e,i){var a=e.first().datasource(),o=new epiviz.datatypes.PartialSummarizedExperiment,s=n.rows.globalStartIndex,u=t;null!=t&&"all"!=t.seqName()&&null!=t.seqName()||(u=new epiviz.datatypes.GenomicRange("all",n.rows.values.start[0],n.rows.values.start.length)),isNaN(u._start)&&(u._start=s),isNaN(u._width)&&(u._width=n.rows.end[n.rows.end.length-1]-t._start),a=new epiviz.datatypes.GenomicRangeArray(a,u,s,n.rows.values,n.rows.useOffset),o.addRowData(a),e.foreach(function(t){t=new epiviz.datatypes.FeatureValueArray(t,u,s,n.values.values[t.id()]),o.addValues(t)}),r[i]=o}),l[o]=r,a._serveAvailableData(t,e,i,l)}),(a._dataProviderFactory.get(o)||a._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(u,function(t){c.serveData(t)},function(t,e,i){n(t,e,i)})})},epiviz.data.DataManager.prototype._serveAvailableData=function(t,e,i,n){var r=[];epiviz.utils.forEach(e,function(t,e){var a=!0,o=new epiviz.measurements.MeasurementHashtable;if(t.foreach(function(t){if(!(t.dataprovider()in n))return a=!1,!0;var e=new epiviz.datatypes.MeasurementGenomicDataWrapper(t,n[t.dataprovider()][t.datasource().id()]);o.put(t,e)}),a){var s=new epiviz.datatypes.MapGenomicData(o);i(e,s),r.push(e)}}),r.forEach(function(t){delete e[t]})},epiviz.data.DataManager.prototype.getPCA=function(t,e,i){var n,r=this,a={};for(n in e)if(e.hasOwnProperty(n)){var o,s=e[n].split(function(t){return t.dataprovider()});for(o in s)if(s.hasOwnProperty(o)){var u=a[o];null==u?a[o]=s[o]:u.addAll(s[o])}}epiviz.utils.forEach(a,function(e,a){var o=e.split(function(t){return t.datasource().id()}),s=epiviz.data.Request.getPCA(o,t),u=Object.keys(o)[0];(r._dataProviderFactory.get(a)||r._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(s,function(t){var e=t.data();"websocket"==t.data().dataprovidertype&&(e=e[u]),i(n,e)})})},epiviz.data.DataManager.prototype.getDiversity=function(t,e,i){var n,r=this,a={};for(n in e)if(e.hasOwnProperty(n)){var o,s=e[n].split(function(t){return t.dataprovider()});for(o in s)if(s.hasOwnProperty(o)){var u=a[o];null==u?a[o]=s[o]:u.addAll(s[o])}}epiviz.utils.forEach(a,function(e,a){var o=e.split(function(t){return t.datasource().id()}),s=epiviz.data.Request.getDiversity(o,t),u=Object.keys(o)[0];(r._dataProviderFactory.get(a)||r._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(s,function(t){var e=t.data();"websocket"==t.data().dataprovidertype&&(e=e[u]),i(n,e)})})},epiviz.data.DataManager.prototype.getHierarchy=function(t,e){for(var i in t)if(t.hasOwnProperty(i))var n=t[i];var r=n.dataprovider;r||n.measurements.foreach(function(t){return!!t.dataprovider()&&(r=t.dataprovider(),!0)});var a=n.datasourceGroup;a||n.measurements.foreach(function(t){return!!t.datasourceGroup()&&(a=t.datasourceGroup(),!0)}),(this._dataProviderFactory.get(r)||this._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(epiviz.data.Request.getHierarchy(a,n.customData),function(t){e(i,t.data())})},epiviz.data.DataManager.prototype.propagateHierarchyChanges=function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r=n.dataprovider;r||n.measurements.foreach(function(t){return!!t.dataprovider()&&(r=t.dataprovider(),!0)}),function(t,i,n){i.getData(epiviz.data.Request.propagateHierarchyChanges(n.datasourceGroup,n.customData.selection,n.customData.order,n.customData.selectedLevels),function(r){setTimeout(function(){i.onRequestClearDatasourceGroupCache().notify({datasourceGroup:n.datasourceGroup,result:new epiviz.events.EventResult}),i.onRequestRedraw().notify({result:new epiviz.events.EventResult}),e(t,r.data())},0)})}(i,this._dataProviderFactory.get(r)||this._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID),n)}},epiviz.data.DataManager.prototype.getWorkspaces=function(t,e,i){var n=this._dataProviderFactory.workspacesDataProvider();if(!n)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");n.getData(epiviz.data.Request.getWorkspaces(e,i),function(e){var i=[];if((e=e.data())&&e.length)for(var n=0;n<e.length;++n)i.push({id:e[n].id,name:e[n].name,content:JSON.parse(e[n].content)});t(i)})},epiviz.data.DataManager.prototype.saveWorkspace=function(t,e,i){var n=this._dataProviderFactory.workspacesDataProvider();if(!n)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");n.getData(epiviz.data.Request.saveWorkspace(t,e),function(t){t=t.data(),i(t)})},epiviz.data.DataManager.prototype.deleteWorkspace=function(t){var e=this._dataProviderFactory.workspacesDataProvider();if(!e)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");e.getData(epiviz.data.Request.deleteWorkspace(t),function(t){t.data()})},epiviz.data.DataManager.prototype.search=function(t,e){var i=this,n=this._dataProviderFactory.size(),r=[];this._dataProviderFactory.foreach(function(a){a.getData(epiviz.data.Request.search(e,i._config.maxSearchResults),function(e){(e=e.data())&&epiviz.utils.arrayAppend(r,e),--n||t(r)})})},epiviz.data.DataManager.prototype.flushCache=function(){this._cache.flush(),this._flushCache.notify()},epiviz.data.DataManager.prototype.clearDatasourceGroupCache=function(t){this._cache.clearDatasourceGroupCache(t),this._clearDatasourceGroupCache.notify({datasourceGroup:t})},epiviz.data.DataManager.prototype._registerProviderAddMeasurements=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestAddMeasurements().addListener(new epiviz.events.EventListener(function(e){t._requestAddMeasurements.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderRemoveMeasurements=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestRemoveMeasurements().addListener(new epiviz.events.EventListener(function(e){t._requestRemoveMeasurements.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderLoadMeasurements=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestLoadMeasurements().addListener(new epiviz.events.EventListener(function(e){t._requestLoadMeasurements.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderAddChart=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestAddChart().addListener(new epiviz.events.EventListener(function(e){t._requestAddChart.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderRemoveChart=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestRemoveChart().addListener(new epiviz.events.EventListener(function(e){t._requestRemoveChart.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderPrintWorkspace=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestPrintWorkspace().addListener(new epiviz.events.EventListener(function(e){t._requestPrintWorkspace.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderLoadWorkspace=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestLoadWorkspace().addListener(new epiviz.events.EventListener(function(e){t._requestLoadWorkspace.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderAddSeqInfos=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestAddSeqInfos().addListener(new epiviz.events.EventListener(function(e){for(var i=[],n=0;n<e.seqInfos.length;++n)i.push(epiviz.datatypes.SeqInfo.fromRawObject(e.seqInfos[n]));t._requestAddSeqInfos.notify({seqInfos:i,result:e.result})}))})},epiviz.data.DataManager.prototype._registerProviderRemoveSeqNames=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestRemoveSeqNames().addListener(new epiviz.events.EventListener(function(e){t._requestRemoveSeqNames.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderNavigate=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestNavigate().addListener(new epiviz.events.EventListener(function(e){t._requestNavigate.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderRedraw=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestRedraw().addListener(new epiviz.events.EventListener(function(e){t._requestRedraw.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderClearDatasourceGroupCache=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestClearDatasourceGroupCache().addListener(new epiviz.events.EventListener(function(e){t.clearDatasourceGroupCache(e.datasourceGroup),e.result.success=!0}))})},epiviz.data.DataManager.prototype._registerProviderFlushCache=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestFlushCache().addListener(new epiviz.events.EventListener(function(e){t.flushCache(),e.result.success=!0}))})},epiviz.data.DataManager.prototype._registerProviderGetCurrentLocation=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestCurrentLocation().addListener(new epiviz.events.EventListener(function(e){t._requestCurrentLocation.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderSetChartSettings=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestSetChartSettings().addListener(new epiviz.events.EventListener(function(e){t._requestSetChartSettings.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderGetChartSettings=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(e){t._requestGetChartSettings.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderGetAvailableCharts=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(e){t._requestGetAvailableCharts.notify(e)}))})},epiviz.data.DataManager.prototype._registerProviderUiStatus=function(){var t=this;this._dataProviderFactory.foreach(function(e){e.onRequestUiStatus().addListener(new epiviz.events.EventListener(function(e){t._requestUiStatus.notify(e)}))})},epiviz.datatypes.ItemFilteredGenomicData=function(t,e){epiviz.datatypes.MapGenomicData.call(this),this._data=t,this._filter=e,this._deferredInit=null,this._initialize()},epiviz.datatypes.ItemFilteredGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype),epiviz.datatypes.ItemFilteredGenomicData.constructor=epiviz.datatypes.ItemFilteredGenomicData,epiviz.datatypes.ItemFilteredGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var t=this,e=this._filter,i=this._data;return i.ready(function(){e.preMark()(i).done(function(n){var r=new epiviz.measurements.MeasurementHashtable,a=i.measurements();epiviz.utils.deferredFor(a.length,function(t){var o=new epiviz.deferred.Deferred,s=a[t],u=[],c={};return epiviz.utils.deferredFor(i.size(s),function(t){var r=new epiviz.deferred.Deferred,a=i.get(s,t);return e.mark()(a,i,n).done(function(t){t&&(u.push(a),c[a.globalIndex]=a),r.resolve()}),r}).done(function(){r.put(s,new epiviz.datatypes.MeasurementGenomicDataArrayWrapper(s,u,c)),o.resolve()}),o}).done(function(){t._setMap(r),t._deferredInit.resolve()})})}),this._deferredInit},epiviz.datatypes.RowItemImpl=function(t,e,i,n,r,a,o){this._id=t,this._seqName=e,this._start=i,this._end=n,this._globalIndex=r,this._strand=a,this._rowMetadata=o},epiviz.datatypes.RowItemImpl.prototype.id=function(){return this._id},epiviz.datatypes.RowItemImpl.prototype.seqName=function(){return this._seqName},epiviz.datatypes.RowItemImpl.prototype.start=function(){return this._start},epiviz.datatypes.RowItemImpl.prototype.end=function(){return this._end},epiviz.datatypes.RowItemImpl.prototype.globalIndex=function(){return this._globalIndex},epiviz.datatypes.RowItemImpl.prototype.strand=function(){return this._strand},epiviz.datatypes.RowItemImpl.prototype.metadata=function(t){return null==(t=this._rowMetadata[t])?null:t},epiviz.datatypes.RowItemImpl.prototype.rowMetadata=function(){return this._rowMetadata},epiviz.datatypes.MeasurementAggregatedGenomicData=function(t,e,i){epiviz.datatypes.MapGenomicData.call(this),this._data=t,this._groupByMarker=e,this._aggregator=i,this._deferredInit=null,this._initialize()},epiviz.datatypes.MeasurementAggregatedGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype),epiviz.datatypes.MeasurementAggregatedGenomicData.constructor=epiviz.datatypes.MeasurementAggregatedGenomicData,epiviz.datatypes.MeasurementAggregatedGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var t=this,e=this._groupByMarker,i=this._data;return i.ready(function(){e.preMark()(i).done(function(n){var r=new epiviz.measurements.MeasurementHashtable,a={},o=i.measurements();epiviz.utils.deferredFor(o.length,function(t){var r=new epiviz.deferred.Deferred,s=o[t];return e.mark()(s,i,n).done(function(t){t in a||(a[t]=[]),a[t].push(s),r.resolve()}),r}).done(function(){var e,n,o={};for(e in a)if(a.hasOwnProperty(e)){var s=e+"-group",u=e,c=(n=a[e])[0].type(),l=n[0].datasourceId(),p=n[0].datasourceGroup(),h=n[0].dataprovider(),d=n[0].defaultChartType(),f=epiviz.utils.mapCopy(n[0].annotation()),v=n[0].minValue(),g=n[0].maxValue(),m=n[0].metadata(),y={};m.forEach(function(t){y[t]=t}),a[e].forEach(function(t){l!=t.datasourceId()&&(l="*"),p!=t.datasourceGroup()&&(p="*"),h!=t.dataprovider()&&(h="*"),d!=t.defaultChartType()&&(d="*");var e=t.annotation();if(f!=e)if(null==f)f=epiviz.utils.mapCopy(e);else if(null!=e)for(var i in e)e.hasOwnProperty(i)&&(i in f?f[i]!=e[i]&&(f[i]="*"):f[i]=e[i]);v=Math.min(v,t.minValue()),g=Math.max(g,t.maxValue()),t.metadata().forEach(function(t){t in y||(y[t]=t,m.push(t))})}),o[e]=new epiviz.measurements.Measurement(s,u,c,l,p,h,null,d,f,v,g,m)}for(e in a)if(a.hasOwnProperty(e)){s=o[e],u=[],c={},n=a[e];for(var _=Math.min.apply(void 0,n.map(function(t){return i.globalStartIndex(t)})),z=Math.max.apply(void 0,n.map(function(t){return i.globalEndIndex(t)})),b=_;b<z;++b){var w=n.map(function(t){return i.getByGlobalIndex(t,b)}).filter(function(t){return t});w.length&&(_=w.map(function(t){return t.value}),_=t._aggregator.aggregate(e,n,_),w=w[0].rowItem,w=new epiviz.datatypes.RowItemImpl(w.id(),w.seqName(),w.start(),w.end(),w.globalIndex(),w.strand(),w.rowMetadata()||{}),_=new epiviz.datatypes.GenomicData.ValueItem(b,w,_.value,s,{errMinus:_.errMinus,errPlus:_.errPlus}),u.push(_),c[b]=_)}n=new epiviz.datatypes.MeasurementGenomicDataArrayWrapper(s,u,c),r.put(s,n)}t._setMap(r),t._deferredInit.resolve()})})}),this._deferredInit},epiviz.datatypes.MeasurementOrderedGenomicData=function(t,e){epiviz.datatypes.MapGenomicData.call(this),this._data=t,this._order=e,this._deferredInit=null,this._initialize()},epiviz.datatypes.MeasurementOrderedGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype),epiviz.datatypes.MeasurementOrderedGenomicData.constructor=epiviz.datatypes.MeasurementOrderedGenomicData,epiviz.datatypes.MeasurementOrderedGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var t=this,e=this._data,i=this._order;return e.ready(function(){i.preMark()(e).done(function(n){var r=new epiviz.measurements.MeasurementHashtable,a=e.measurements(),o=new epiviz.measurements.MeasurementHashtable;epiviz.utils.deferredFor(a.length,function(t){var r=new epiviz.deferred.Deferred,s=a[t];return i.mark()(s,e,n).done(function(t){o.put(s,t),r.resolve()}),r}).done(function(){a.sort(function(t,e){var i=o.get(t),n=o.get(e);return i==n?0:i<n?-1:1}),a.forEach(function(t){r.put(t,e.getSeries(t))}),t._setMap(r),t._deferredInit.resolve()})})}),this._deferredInit},epiviz.deferred.Promise=function(t){this._promise=t},epiviz.deferred.Promise.prototype.then=function(t,e,i){return new epiviz.deferred.Promise(this._promise.then(t,e,i))},epiviz.deferred.Promise.prototype.done=function(t,e){return new epiviz.deferred.Deferred(this._promise.done(t,e))},epiviz.deferred.Promise.prototype.fail=function(t,e){return new epiviz.deferred.Deferred(this._promise.fail(t,e))},epiviz.deferred.Promise.prototype.always=function(t,e){return new epiviz.deferred.Deferred(this._promise.always(t,e))},epiviz.deferred.Promise.prototype.state=function(){return this._promise.state()},epiviz.ui.charts.CustomSetting=function(t,e,i,n,r){this.id=t,this.type=e,this.defaultValue=i,this.label=n||t,this.possibleValues=r||null},epiviz.ui.charts.CustomSetting.Type={NUMBER:"number",STRING:"string",ARRAY:"array",BOOLEAN:"boolean",CATEGORICAL:"categorical",MEASUREMENTS_METADATA:"measurementsMetadata",MEASUREMENTS_ANNOTATION:"measurementsAnnotation"},epiviz.ui.charts.CustomSetting.DEFAULT="default",epiviz.ui.charts.VisEventArgs=function(t,e){this.id=t,this.args=e},epiviz.ui.charts.Axis={X:"x",Y:"y"},epiviz.ui.charts.Margins=function(t,e,i,n){this._top=t,this._left=e,this._bottom=i,this._right=n},epiviz.ui.charts.Margins.ZERO_MARGIN=new epiviz.ui.charts.Margins(0,0,0,0),epiviz.ui.charts.Margins.prototype.top=function(){return this._top},epiviz.ui.charts.Margins.prototype.left=function(){return this._left},epiviz.ui.charts.Margins.prototype.bottom=function(){return this._bottom},epiviz.ui.charts.Margins.prototype.right=function(){return this._right},epiviz.ui.charts.Margins.prototype.sumAxis=function(t){switch(t){case epiviz.ui.charts.Axis.X:return this._left+this._right;case epiviz.ui.charts.Axis.Y:return this._top+this._bottom;default:throw Error("Invalid argument: "+t)}},epiviz.ui.charts.Margins.prototype.raw=function(){return{top:this._top,left:this._left,bottom:this._bottom,right:this._right}},epiviz.ui.charts.Margins.fromRawObject=function(t){return new epiviz.ui.charts.Margins(t.top,t.left,t.bottom,t.right)},epiviz.ui.charts.Margins.prototype.copy=function(){return new epiviz.ui.charts.Margins(this._top,this._left,this._bottom,this._right)},epiviz.ui.charts.Margins.prototype.equals=function(t){return!!t&&(this==t||this._top==t._top&&this._left==t._left&&this._bottom==t._bottom&&this._right==t._right)},epiviz.ui.charts.Visualization=function(t,e,i){this._id=t,this._container=e,this._properties=i,this._originalMethods={},this._hasModifiedMethods=!1,this._lastModifiedMethod="draw";var n=this;if(i.modifiedMethods){var r,a=new epiviz.deferred.Deferred,o=i.modifiedMethods,s=Object.keys(o),u={},c=0;for(r in o)o.hasOwnProperty(r)&&"_setModifiedMethods"!=r&&function(t){epiviz.caja.cajole(o[t],epiviz.caja.buildChartMethodContext()).done(function(e){e&&(u[t]=e,(c+=1)>=s.length&&a.resolve())})}(r);a.done(function(){for(var t in u)u.hasOwnProperty(t)&&(n._originalMethods[t]=n[t],n[t]=u[t],n._lastModifiedMethod=t);n._hasModifiedMethods=!0,n.draw()})}for(this._customSettingsValues={},t=0;t<i.customSettingsDefs.length;++t)switch(e=i.customSettingsDefs[t],r=i.customSettingsValues[e.id],e.type){case epiviz.ui.charts.CustomSetting.Type.BOOLEAN:this._customSettingsValues[e.id]=!1===r||r?r:e.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.NUMBER:this._customSettingsValues[e.id]=0===r||r?r:e.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.STRING:this._customSettingsValues[e.id]=""===r||r?r:e.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA:var l={};i.visConfigSelection.measurements.foreach(function(t){t.metadata().forEach(function(t){l[t]=t})}),e.possibleValues=Object.keys(l),e.possibleValues.sort(),r=r||e.defaultValue,this._customSettingsValues[e.id]=r in l?r:e.possibleValues.length?e.possibleValues[0]:"";break;case epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION:l={name:"name"},i.visConfigSelection.measurements.foreach(function(t){(t=t.annotation())&&Object.keys(t).forEach(function(t){l[t]=t})}),e.possibleValues=Object.keys(l),e.possibleValues.sort(),r=r||e.defaultValue,this._customSettingsValues[e.id]=r in l?r:e.possibleValues.length?e.possibleValues[0]:"";break;default:this._customSettingsValues[e.id]=r||e.defaultValue}this._svgId=sprintf("%s-svg",this._id),this._lastRange=this._lastData=this._unalteredData=this._svg=null,this._slide=0,this._zoom=1,this._markers=i.chartMarkers,this._markersMap={},this._markersIndices={},this._markers.forEach(function(t,e){t&&(n._markersMap[t.id()]=t,n._markersIndices[t.id()]=e)}),this._autoPropagateChanges=!0,this._hover=new epiviz.events.Event,this._unhover=new epiviz.events.Event,this._select=new epiviz.events.Event,this._deselect=new epiviz.events.Event,this._save=new epiviz.events.Event,this._remove=new epiviz.events.Event,this._colorsChanged=new epiviz.events.Event,this._methodsModified=new epiviz.events.Event,this._methodsReset=new epiviz.events.Event,this._markersModified=new epiviz.events.Event,this._customSettingsChanged=new epiviz.events.Event,this._sizeChanged=new epiviz.events.Event,this._marginsChanged=new epiviz.events.Event,this._dataWaitStart=new epiviz.events.Event,this._dataWaitEnd=new epiviz.events.Event},epiviz.ui.charts.Visualization.SVG_MARGIN=20,epiviz.ui.charts.Visualization.prototype._initialize=function(){"100%"==this._properties.height&&(this._properties.height=this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN),"100%"==this._properties.width&&(this._properties.width=this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN);var t=this.width(),e=this.height();this._container.addClass("visualization-container"),this._container.append(sprintf('<svg id="%s" class="visualization" width="%s" height="%s"><style type="text/css"></style><defs></defs></svg>',this._svgId,t,e)),this._svg=d3.select(this._container.find("#"+this._svgId)[0]),this._widthDif=$(this._container.find("#"+this._svgId)[0]).width()-(this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN),this._heightDif=e-(this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN),this._properties.width=t,this._properties.height=e;var i=this;this._container.click(function(){i._deselect.notify(new epiviz.ui.charts.VisEventArgs(i._id))})},epiviz.ui.charts.Visualization.prototype._clearAxes=function(t){(t=t||this._svg).selectAll(".xAxis").remove(),t.selectAll(".yAxis").remove()},epiviz.ui.charts.Visualization.prototype._drawAxes=function(t,e,i,n,r,a,o,s,u,c,l,p,h,d){r=r||this._svg,s=s||this.margins(),o=o||this.height(),a=a||this.width();var f=r.select(".axes"),v=f.select(".xAxis-grid");d=f.select(".yAxis-grid");var g=f.select(".xAxis-line");c=f.select(".yAxis-line"),f.empty()&&(f=r.append("g").attr("class","axes")),v.empty()&&(v=f.append("g").attr("class","xAxis xAxis-grid")),d.empty()&&(d=f.append("g").attr("class","yAxis yAxis-grid")),g.empty()&&(g=f.append("g").attr("class","xAxis xAxis-line")),c.empty()&&(c=f.append("g").attr("class","yAxis yAxis-line")),t&&(v.attr("transform","translate("+s.left()+", "+s.top()+")").selectAll("line.x").data(t.ticks(i)).enter().append("line").attr("x1",t).attr("x2",t).attr("y1",0).attr("y2",o-s.top()-s.bottom()).style("stroke","#eeeeee").style("shape-rendering","crispEdges"),r=u||(l?function(t){return l[t]}:function(t){return d3.format("s")(Math.round(1e3*t)/1e3)}),i=d3.svg.axis().scale(t).orient("bottom").ticks(i).tickFormat(r),g.attr("transform","translate("+s.left()+", "+(o-s.bottom())+")").call(i),l&&(o="rotate(-90)",h&&(o+="translate(0,"+(t(.5)-t(0))+")"),g.selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-0.5em").attr("transform",o))),e&&(d.attr("transform","translate("+s.left()+", "+s.top()+")").selectAll("line.y").data(e.ticks(n-1)).enter().append("line").attr("x1",0).attr("x2",a-s.left()-s.right()).attr("y1",e).attr("y2",e).style("stroke","#eeeeee").style("shape-rendering","crispEdges"),t=p?function(t){return p[t]}:function(t){return d3.format("s")(Math.round(1e3*t)/1e3)},e=d3.svg.axis().ticks(n-1).scale(e).orient("left").tickFormat(t),c.attr("transform","translate("+s.left()+", "+s.top()+")").call(e))},epiviz.ui.charts.Visualization.prototype._drawTitle=function(){var t=this._svg.selectAll(".visualization-title"),e=epiviz.ui.charts.Visualization.CustomSettings;(e=this.customSettingsValues()[e.TITLE])&&""!=e.trim()?(t.empty()&&(t=this._svg.append("text").attr("class","visualization-title").attr("text-anchor","middle")),t.attr("x",.5*this.width()).attr("y",25).text(e)):t.empty()||t.remove()},epiviz.ui.charts.Visualization.prototype.resize=function(t,e){t&&(this._properties.width=t),e&&(this._properties.height=e),this.draw(),this._sizeChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,{width:this._properties.width,height:this._properties.height}))},epiviz.ui.charts.Visualization.prototype.updateSize=function(){this.resize(this._widthDif+this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN,this._heightDif+this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN)},epiviz.ui.charts.Visualization.prototype.draw=function(t,e){return null!=t&&(this._lastRange=t),null!=e&&(this._unalteredData=this._lastData=e,this._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(this._id))),this._svg.attr("width",this.width()).attr("height",this.height()),this._drawTitle(),[]},epiviz.ui.charts.Visualization.prototype.container=function(){return this._container},epiviz.ui.charts.Visualization.prototype.id=function(){return this._id},epiviz.ui.charts.Visualization.prototype.properties=function(){return this._properties},epiviz.ui.charts.Visualization.prototype.height=function(){return this._properties.height},epiviz.ui.charts.Visualization.prototype.width=function(){return this._properties.width},epiviz.ui.charts.Visualization.prototype.margins=function(){return this._properties.margins},epiviz.ui.charts.Visualization.prototype.colors=function(){return this._properties.colors},epiviz.ui.charts.Visualization.prototype.setColors=function(t){t&&!t.equals(this._properties.colors)&&(this._properties.colors=t,this.draw(),this._colorsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._properties.colors)))},epiviz.ui.charts.Visualization.prototype.colorLabels=function(){var t=Array(this.measurements().size());return this.measurements().foreach(function(e,i){t[i]=e.name()}),t},epiviz.ui.charts.Visualization.prototype.measurements=function(){return this.properties().visConfigSelection.measurements},epiviz.ui.charts.Visualization.prototype.customSettingsValues=function(){return this._customSettingsValues},epiviz.ui.charts.Visualization.prototype.setCustomSettingsValues=function(t){if(this._customSettingsValues!=t&&t&&!epiviz.utils.mapEquals(this._customSettingsValues,t)){var e=epiviz.ui.charts.Visualization.CustomSettings,i=t[e.TITLE]||"";if(!((n=(this._customSettingsValues[e.TITLE]||"").trim().length)*(i=i.trim().length))&&n+i){var n=20*epiviz.utils.sign(i-n),r=(i=t[e.MARGIN_TOP]||this._properties.margins.top(),t[e.MARGIN_LEFT]||this._properties.margins.left()),a=t[e.MARGIN_RIGHT]||this._properties.margins.right(),o=t[e.MARGIN_BOTTOM]||this._properties.margins.bottom();t[e.MARGIN_TOP]=i+n,t[e.MARGIN_LEFT]=r,t[e.MARGIN_RIGHT]=a,t[e.MARGIN_BOTTOM]=o}if(n=this._customSettingsValues[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR],i=t[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR],this._customSettingsValues=t,e.MARGIN_TOP in t&&e.MARGIN_BOTTOM in t&&e.MARGIN_LEFT in t&&e.MARGIN_RIGHT in t&&(this._properties.margins=new epiviz.ui.charts.Margins(t[e.MARGIN_TOP],t[e.MARGIN_LEFT],t[e.MARGIN_BOTTOM],t[e.MARGIN_RIGHT]),this._marginsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._properties.margins))),n!=i){var s=this;this.transformData(this._lastRange,this._unalteredData).done(function(){s.draw()})}else this.draw();this._customSettingsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,t))}},epiviz.ui.charts.Visualization.prototype.setModifiedMethods=function(t){var e=this,i=!1;if(t){var n,r=Object.keys(t),a=new epiviz.deferred.Deferred,o=0,s={};for(n in t)t.hasOwnProperty(n)&&"_setModifiedMethods"!=n&&this[n].toString()!=t[n]&&(n in this._originalMethods||(this._originalMethods[n]=this[n]),function(e){epiviz.caja.cajole(t[e],epiviz.caja.buildChartMethodContext()).done(function(t){t&&(s[e]=t,i=!0,(o+=1)>=r.length&&a.resolve())})}(n));a.done(function(){if(i){for(var n in s)s.hasOwnProperty(n)&&(e[n]=s[n],e._lastModifiedMethod=n);e._hasModifiedMethods=!0,e.draw(),e._methodsModified.notify(new epiviz.ui.charts.VisEventArgs(e._id,t))}})}},epiviz.ui.charts.Visualization.prototype.hasModifiedMethods=function(){return this._hasModifiedMethods},epiviz.ui.charts.Visualization.prototype.lastModifiedMethod=function(){return this._lastModifiedMethod},epiviz.ui.charts.Visualization.prototype.resetModifiedMethods=function(){if(this._hasModifiedMethods){for(var t in this._originalMethods)this._originalMethods.hasOwnProperty(t)&&(this[t]=this._originalMethods[t]);this._hasModifiedMethods=!1,this.draw(),this._methodsReset.notify(new epiviz.ui.charts.VisEventArgs(this._id))}},epiviz.ui.charts.Visualization.prototype.putMarker=function(t){if(t){var e;if(t.id()in this._markersMap){e=this._markersIndices[t.id()];var i=this._markers[e];if(i==t||i.type()==t.type()&&i.preMarkStr()==t.preMarkStr()&&i.markStr()==t.markStr())return;this._markers[e]=t}else e=this._markers.length,this._markers.push(t),this._markersIndices[t.id()]=e;this._markersMap[t.id()]=t;var n=this;this.transformData(this._lastRange,this._unalteredData).done(function(){n.draw()}),this._markersModified.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._markers))}},epiviz.ui.charts.Visualization.prototype.removeMarker=function(t){if(t in this._markersMap){this._markers[this._markersIndices[t]]=null,delete this._markersMap[t],delete this._markersIndices[t];var e=this;this.transformData(this._lastRange,this._unalteredData).done(function(){e.draw()}),this._markersModified.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._markers))}},epiviz.ui.charts.Visualization.prototype.getMarker=function(t){return t&&t in this._markersMap?this._markersMap[t]:null},epiviz.ui.charts.Visualization.prototype.displayType=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.Visualization.prototype.autoPropagateChanges=function(){return this._autoPropagateChanges},epiviz.ui.charts.Visualization.prototype.setAutoPropagateChanges=function(t){this._autoPropagateChanges=t},epiviz.ui.charts.Visualization.prototype.transformData=function(t,e){var i=this._lastRange;return null!=t&&(this._lastRange=t),null!=e&&(this._unalteredData=this._lastData=e),i&&t&&i.overlapsWith(t)&&i.width()==t.width()&&(this._slide=t.start()-i.start()),i&&t&&i.overlapsWith(t)&&i.width()!=t.width()&&(this._zoom=i.width()/t.width()),(i=new epiviz.deferred.Deferred).resolve(),i},epiviz.ui.charts.Visualization.prototype.onHover=function(){return this._hover},epiviz.ui.charts.Visualization.prototype.onUnhover=function(){return this._unhover},epiviz.ui.charts.Visualization.prototype.onSelect=function(){return this._select},epiviz.ui.charts.Visualization.prototype.onDeselect=function(){return this._deselect},epiviz.ui.charts.Visualization.prototype.doHover=function(t){var e=(a=this._container.find(".items")).find("> .hovered"),i=a.find("> .selected"),n=i.find("> .hovered"),r=function(){if(Array.isArray(t)){for(var e=!1,i=0;i<t.length;i++)t[i].overlapsWith(d3.select(this).data()[0])&&(e=!0);return e}return t.overlapsWith(d3.select(this).data()[0])},a=a.find("> .item").filter(r);e.append(a),a=i.find("> .item").filter(r),n.append(a)},epiviz.ui.charts.Visualization.prototype.doUnhover=function(){var t=this._container.find(".items"),e=t.find("> .hovered"),i=t.find("> .selected"),n=i.find("> .hovered");t.prepend(e.children()),i.prepend(n.children())},epiviz.ui.charts.Visualization.prototype.doSelect=function(t){var e=(a=this._container.find(".items")).find("> .hovered"),i=a.find("> .selected"),n=i.find("> .hovered"),r=function(){return t.overlapsWith(d3.select(this).data()[0])},a=a.find("> .item").filter(r);i.append(a),a=e.find("> .item").filter(r),n.append(a)},epiviz.ui.charts.Visualization.prototype.doDeselect=function(){var t=this._container.find(".items"),e=t.find("> .hovered"),i=t.find("> .selected"),n=i.find("> .hovered");t.prepend(i.find("> .item")),e.prepend(n.children())},epiviz.ui.charts.Visualization.prototype.onSave=function(){return this._save},epiviz.ui.charts.Visualization.prototype.onRemove=function(){return this._remove},epiviz.ui.charts.Visualization.prototype.onColorsChanged=function(){return this._colorsChanged},epiviz.ui.charts.Visualization.prototype.onMethodsModified=function(){return this._methodsModified},epiviz.ui.charts.Visualization.prototype.onMethodsReset=function(){return this._methodsReset},epiviz.ui.charts.Visualization.prototype.onMarkersModified=function(){return this._markersModified},epiviz.ui.charts.Visualization.prototype.onCustomSettingsChanged=function(){return this._customSettingsChanged},epiviz.ui.charts.Visualization.prototype.onSizeChanged=function(){return this._sizeChanged},epiviz.ui.charts.Visualization.prototype.onMarginsChanged=function(){return this._marginsChanged},epiviz.ui.charts.Visualization.prototype.onDataWaitStart=function(){return this._dataWaitStart},epiviz.ui.charts.Visualization.prototype.onDataWaitEnd=function(){return this._dataWaitEnd},epiviz.ui.charts.Visualization.CustomSettings={TITLE:"title",MARGIN_LEFT:"marginLeft",MARGIN_RIGHT:"marginRight",MARGIN_TOP:"marginTop",MARGIN_BOTTOM:"marginBottom",X_MIN:"xMin",X_MAX:"xMax",Y_MIN:"yMin",Y_MAX:"yMax",COL_LABEL:"colLabel",ROW_LABEL:"rowLabel"},epiviz.ui.charts.VisualizationType=function(t){var e=epiviz.Config.VisualizationPropertySettings;this._config=t,this._defaultSettings=epiviz.utils.mapCombine(epiviz.utils.mapCombine(t.chartSettings[this.typeName()],t.chartSettings[this.chartDisplayType()],!0),t.chartSettings.default,!0),this._defaultWidth=this._defaultSettings[e.WIDTH],this._defaultHeight=this._defaultSettings[e.HEIGHT],this._defaultMargins=this._defaultSettings[e.MARGINS],this._defaultColors=t.colorPalettesMap[this._defaultSettings[e.COLORS]],this._decorations=this._defaultSettings[e.DECORATIONS],this._customSettingsValues=t.chartCustomSettings[this.typeName()]||null},epiviz.ui.charts.VisualizationType.DisplayType={PLOT:"plot",TRACK:"track",DATA_STRUCTURE:"data-structure"},epiviz.ui.charts.VisualizationType.prototype.createNew=function(t,e,i){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.typeName=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.chartName=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.chartHtmlAttributeName=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.chartDisplayType=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.measurementsFilter=function(){return function(t){return!0}},epiviz.ui.charts.VisualizationType.prototype.isRestrictedToSameDatasourceGroup=function(){return!1},epiviz.ui.charts.VisualizationType.prototype.isRestrictedToRangeMeasurements=function(){return!1},epiviz.ui.charts.VisualizationType.prototype.isRestrictedToFeatureMeasurements=function(){return!this.isRestrictedToRangeMeasurements()},epiviz.ui.charts.VisualizationType.prototype.minSelectedMeasurements=function(){return 1},epiviz.ui.charts.VisualizationType.prototype.chartContainer=function(){return epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS[this.chartDisplayType()]},epiviz.ui.charts.VisualizationType.prototype.cssClass=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.VisualizationType.prototype.defaultWidth=function(){return this._defaultWidth},epiviz.ui.charts.VisualizationType.prototype.defaultHeight=function(){return this._defaultHeight},epiviz.ui.charts.VisualizationType.prototype.defaultMargins=function(){return this._defaultMargins},epiviz.ui.charts.VisualizationType.prototype.defaultColors=function(){return this._defaultColors},epiviz.ui.charts.VisualizationType.prototype.decorations=function(){return this._decorations},epiviz.ui.charts.VisualizationType.prototype.customSettingsValues=function(){return this._customSettingsValues},epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs=function(){return[new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.TITLE,epiviz.ui.charts.CustomSetting.Type.STRING,"","Title"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_TOP,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.top(),"Top margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_BOTTOM,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.bottom(),"Bottom margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_LEFT,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.left(),"Left margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_RIGHT,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.right(),"Right margin")]},epiviz.ui.charts.markers={},epiviz.ui.charts.markers.VisualizationMarker=function(t,e,i,n,r){this._type=t,this._id=e||epiviz.utils.generatePseudoGUID(6),this._name=i||"Custom Marker "+this._id,this._preMarkStr=n||"",this._markStr=r||"";var a=new epiviz.deferred.Deferred,o=null;epiviz.caja.cajole(this._preMarkStr).done(function(t){o=t,a.resolve()}),this._preMark=function(t){var e=new epiviz.deferred.Deferred;return a.done(function(){var i=o(t);e.resolve(i)}),e};var s=new epiviz.deferred.Deferred,u=null;epiviz.caja.cajole(this._markStr).done(function(t){u=t,s.resolve()}),this._mark=function(t,e,i){var n=new epiviz.deferred.Deferred;return s.done(function(){var r=u(t,e,i);n.resolve(r)}),n}},epiviz.ui.charts.markers.VisualizationMarker.prototype.type=function(){return this._type},epiviz.ui.charts.markers.VisualizationMarker.prototype.id=function(){return this._id},epiviz.ui.charts.markers.VisualizationMarker.prototype.name=function(){return this._name},epiviz.ui.charts.markers.VisualizationMarker.prototype.preMark=function(){return this._preMark},epiviz.ui.charts.markers.VisualizationMarker.prototype.mark=function(){return this._mark},epiviz.ui.charts.markers.VisualizationMarker.prototype.preMarkStr=function(){return this._preMarkStr},epiviz.ui.charts.markers.VisualizationMarker.prototype.markStr=function(){return this._markStr},epiviz.ui.charts.markers.VisualizationMarker.Type={FILTER:"filter",COLOR_BY_ROW:"colorByRow",ORDER_BY_MEASUREMENTS:"orderByMeasurements",COLOR_BY_MEASUREMENTS:"colorByMeasurements",GROUP_BY_MEASUREMENTS:"groupByMeasurements"},epiviz.ui.charts.markers.VisualizationMarker.prototype.raw=function(){return{type:this._type,id:this._id,name:this._name,preMark:this._preMarkStr,mark:this._markStr}},epiviz.ui.charts.markers.VisualizationMarker.fromRawObject=function(t){return new epiviz.ui.charts.markers.VisualizationMarker(t.type,t.id,t.name,t.preMark,t.mark)},epiviz.ui.charts.VisualizationProperties=function(t,e,i,n,r,a,o,s,u){this.width=t,this.height=e,this.margins=i,this.visConfigSelection=n,this.colors=r,this.modifiedMethods=a,this.customSettingsValues=o||{},this.customSettingsDefs=s||[],this.chartMarkers=u||[]},epiviz.ui.charts.VisualizationProperties.prototype.copy=function(){var t=new epiviz.ui.controls.VisConfigSelection(this.visConfigSelection.measurements?new epiviz.measurements.MeasurementSet(this.visConfigSelection.measurements):void 0,this.visConfigSelection.datasource,this.visConfigSelection.datasourceGroup,this.visConfigSelection.dataprovider,epiviz.utils.mapCopy(this.visConfigSelection.annotation),this.visConfigSelection.defaultChartType,this.visConfigSelection.minSelectedMeasurements);return new epiviz.ui.charts.VisualizationProperties(this.width,this.height,this.margins?this.margins.copy():this.margins,t,this.colors,this.modifiedMethods?epiviz.utils.mapCopy(this.modifiedMethods):this.modifiedMethods,this.customSettingsValues?epiviz.utils.mapCopy(this.customSettingsValues):this.customSettingsValues,this.customSettingsDefs?this.customSettingsDefs.slice(0):this.customSettingsDefs,this.chartMarkers.slice(0))},epiviz.workspaces={},epiviz.workspaces.Workspace=function(t,e,i){for(var n in this._id=t,this._name=e,this._range=i.range,this._chartsOrder={},this._chartsById={},i.charts)if(i.charts.hasOwnProperty(n))for(this._chartsOrder[n]=[],t=0;t<i.charts[n].length;++t)this._chartsById[i.charts[n][t].id]=i.charts[n][t],this._chartsOrder[n].push(i.charts[n][t].id);this._computedMeasurements=i.computedMeasurements||new epiviz.measurements.MeasurementSet,this._changed=!1,this._contentChanged=new epiviz.events.Event},epiviz.workspaces.Workspace.DEFAULT_WORKSPACE_NAME=epiviz.Config.DEFAULT_WORKSPACE_NAME,epiviz.workspaces.Workspace.prototype.id=function(){return this._id},epiviz.workspaces.Workspace.prototype.name=function(){return this._name},epiviz.workspaces.Workspace.prototype.range=function(){return this._range},epiviz.workspaces.Workspace.prototype.charts=function(){var t,e={};for(t in this._chartsOrder)if(this._chartsOrder.hasOwnProperty(t)){e[t]=[];for(var i=0;i<this._chartsOrder[t].length;++i)e[t].push(this._chartsById[this._chartsOrder[t][i]])}return e},epiviz.workspaces.Workspace.prototype.chartsOrder=function(){return this._chartsOrder},epiviz.workspaces.Workspace.prototype.computedMeasurements=function(){return this._computedMeasurements},epiviz.workspaces.Workspace.prototype.chartAdded=function(t,e,i,n){this._chartsById[t]={id:t,type:e,properties:i.copy()},this._chartsOrder=n,this._setChanged()},epiviz.workspaces.Workspace.prototype.chartRemoved=function(t,e){this._chartsById[t]&&(delete this._chartsById[t],this._chartsOrder=e,this._setChanged())},epiviz.workspaces.Workspace.prototype.chartSizeChanged=function(t,e,i){!this._chartsById[t]||this._chartsById[t].properties.width==e&&this._chartsById[t].properties.height==i||(this._chartsById[t].properties.width=e,this._chartsById[t].properties.height=i,this._setChanged())},epiviz.workspaces.Workspace.prototype.chartMarginsChanged=function(t,e){this._chartsById[t].properties.margins.equals(e)||(this._chartsById[t].properties.margins=e?e.copy():e,this._setChanged())},epiviz.workspaces.Workspace.prototype.chartColorsChanged=function(t,e){this._chartsById[t].properties.colors.equals(e)||(this._chartsById[t].properties.colors=e,this._setChanged())},epiviz.workspaces.Workspace.prototype.chartMethodsModified=function(t,e){epiviz.utils.mapEquals(this._chartsById[t].properties.modifiedMethods,e)||(this._chartsById[t].properties.modifiedMethods=epiviz.utils.mapCombine(e,this._chartsById[t].properties.modifiedMethods),this._setChanged())},epiviz.workspaces.Workspace.prototype.chartMethodsReset=function(t){this._chartsById[t].properties.modifiedMethods&&0!=Object.keys(this._chartsById[t].properties.modifiedMethods).length&&(this._chartsById[t].properties.modifiedMethods={},this._setChanged())},epiviz.workspaces.Workspace.prototype.chartMarkersModified=function(t,e){epiviz.utils.arraysEqual(this._chartsById[t].properties.chartMarkers,e)||(this._chartsById[t].properties.chartMarkers=e.filter(function(t){return null!=t}),this._setChanged())},epiviz.workspaces.Workspace.prototype.chartCustomSettingsChanged=function(t,e){epiviz.utils.mapEquals(this._chartsById[t].properties.customSettingsValues,e)||(this._chartsById[t].properties.customSettingsValues=e?epiviz.utils.mapCopy(e):e,this._setChanged())},epiviz.workspaces.Workspace.prototype.locationChanged=function(t){this._range.equals(t)||(this._range=t,this._setChanged())},epiviz.workspaces.Workspace.prototype.computedMeasurementsAdded=function(t){var e=this._computedMeasurements.size();this._computedMeasurements.addAll(t),e!=this._computedMeasurements.size()&&this._setChanged()},epiviz.workspaces.Workspace.prototype.computedMeasurementsRemoved=function(t){var e=this._computedMeasurements.size();this._computedMeasurements.removeAll(t),e!=this._computedMeasurements.size()&&this._setChanged()},epiviz.workspaces.Workspace.prototype.chartsOrderChanged=function(t){this._chartsOrder=t,this._setChanged()},epiviz.workspaces.Workspace.prototype.changed=function(){return this._changed},epiviz.workspaces.Workspace.prototype.resetChanged=function(){this._changed=!1},epiviz.workspaces.Workspace.prototype._setChanged=function(){this._changed=!0,this._contentChanged.notify(this)},epiviz.workspaces.Workspace.prototype.copy=function(t,e){var i=this.charts();return new epiviz.workspaces.Workspace(e||null,t,{range:this._range,computedMeasurements:new epiviz.measurements.MeasurementSet(this._computedMeasurements),charts:i})},epiviz.workspaces.Workspace.prototype.raw=function(t){var e=new epiviz.measurements.MeasurementHashtable,i={};for(var n in this._computedMeasurements.foreach(function(t){var i;t.componentMeasurements().foreach(function(t){var i=e.get(t);null===i&&(i=e.size(),e.put(t,i))});var n,r=t.formula().referredMeasurements;for(n in r)r.hasOwnProperty(n)&&(null===(i=e.get(r[n]))&&(i=e.size(),e.put(r[n],i)));null===(i=e.get(t))&&(i=e.size(),e.put(t,i))}),this._chartsOrder)if(this._chartsOrder.hasOwnProperty(n)){i[n]=[];for(var r=0;r<this._chartsOrder[n].length;++r){var a=this._chartsById[this._chartsOrder[n][r]],o=a.properties,s=[];!function(t){o.visConfigSelection.measurements.foreach(function(i){var n=e.get(i);null===n&&(n=e.size(),e.put(i,n)),t.push(n)})}(s),i[n].push({id:a.id,type:a.type.typeName(),properties:{width:o.width,height:o.height,margins:o.margins.raw(),visConfigSelection:{measurements:s,datasource:o.visConfigSelection.datasource,datasourceGroup:o.visConfigSelection.datasourceGroup,dataprovider:o.visConfigSelection.dataprovider,annotation:o.visConfigSelection.annotation,defaultChartType:o.visConfigSelection.defaultChartType,minSelectedMeasurements:o.visConfigSelection.minSelectedMeasurements,customData:o.visConfigSelection.customData},colors:o.colors.raw(t),modifiedMethods:epiviz.utils.mapCopy(o.modifiedMethods),customSettings:o.customSettingsValues||null,chartMarkers:o.chartMarkers.map(function(t){return t.raw()})}})}}var u=Array(e.size());return e.foreach(function(t,i){u[i]=t.raw(e)}),{id:this._id,name:this._name,content:{range:this._range.raw(),measurements:u,charts:i}}},epiviz.workspaces.Workspace.fromRawObject=function(t,e,i){var n,r=Array(t.content.measurements.length),a=new epiviz.measurements.MeasurementSet;for(n=0;n<t.content.measurements.length;++n)t.content.measurements[n].formula||(r[n]=epiviz.measurements.Measurement.fromRawObject(t.content.measurements[n]));for(n=0;n<t.content.measurements.length;++n)t.content.measurements[n].formula&&(r[n]=epiviz.measurements.Measurement.fromRawObject(t.content.measurements[n],r),a.add(r[n]));var o,s={};for(o in t.content.charts)if(t.content.charts.hasOwnProperty(o))for(s[o]=[],n=0;n<t.content.charts[o].length;++n){var u,c=t.content.charts[o][n],l=c.properties.visConfigSelection,p=l?l.measurements:c.properties.measurements;if(p){u=new epiviz.measurements.MeasurementSet;for(var h=0;h<p.length;++h)u.add(r[p[h]])}l=l?new epiviz.ui.controls.VisConfigSelection(u,l.datasource,l.datasourceGroup,l.dataprovider,l.annotation,l.defaultChartType,l.minSelectedMeasurements,l.customData):new epiviz.ui.controls.VisConfigSelection(u),(p=e.get(c.type))&&s[o].push({id:c.id,type:p,properties:new epiviz.ui.charts.VisualizationProperties(c.properties.width,c.properties.height,epiviz.ui.charts.Margins.fromRawObject(c.properties.margins),l,epiviz.ui.charts.ColorPalette.fromRawObject(c.properties.colors,i),c.properties.modifiedMethods,c.properties.customSettings,p.customSettingsDefs(),c.properties.chartMarkers?c.properties.chartMarkers.map(function(t){return epiviz.ui.charts.markers.VisualizationMarker.fromRawObject(t)}):[])})}return new epiviz.workspaces.Workspace(t.id,t.name,{range:epiviz.datatypes.GenomicRange.fromRawObject(t.content.range),computedMeasurements:a,charts:s})},epiviz.workspaces.Workspace.prototype.onContentChanged=function(){return this._contentChanged},epiviz.ui.controls.Dialog=function(t,e){this._container=$("#dialogs"),this._title=t,this._id=epiviz.ui.controls.Dialog.generateId(),this._handlers=e,this._container.append(sprintf('<div id="%s" title="%s" style="display: none;"></div>',this._id,this._title)),this._dialog=null},epiviz.ui.controls.Dialog._nextIdIndex=0,epiviz.ui.controls.Dialog.generateId=function(){return sprintf("dialog-%s",epiviz.utils.generatePseudoGUID(5))},epiviz.ui.controls.Dialog.prototype.show=function(){},epiviz.ui.controls.MessageDialog=function(t,e,i,n){epiviz.ui.controls.Dialog.call(this,t,e),this._message=i,this._icon=n||epiviz.ui.controls.MessageDialog.Icon.INFO},epiviz.ui.controls.MessageDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.MessageDialog.constructor=epiviz.ui.controls.MessageDialog,epiviz.ui.controls.MessageDialog.Icon={INFO:"info",ERROR:"error",QUESTION:"question"},epiviz.ui.controls.MessageDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var t=epiviz.ui.controls.MessageDialog.Icon;if(!this._dialog){var e=this;this._dialog=$("#"+this._id),this._dialog.css("display","inline"),this._dialog.append(sprintf('<div class="ui-state-%s ui-corner-all" style="margin: 5px; padding: 5px; height: auto;"><div class="ui-icon ui-icon-%s" style="float: left; margin-right: 5px;"></div><div class="dialog-text">%s</div></div>',this._icon==t.ERROR?"error":"highlight",this._icon==t.ERROR?"alert":"info",this._message));var i,n={};for(i in this._handlers)this._handlers.hasOwnProperty(i)&&function(t){n[t]=function(){e._handlers[t](),$(this).dialog("close")}}(i);this._dialog.dialog({autoOpen:!1,resizable:!1,buttons:n,modal:!0}),this._dialog.dialog({close:function(t,i){$(this).remove(),e._dialog=null}})}this._dialog.dialog("open"),this._dialog.dialog("option","position","center")},epiviz.EpiViz=function(t,e,i,n,r,a,o,s,u,c,l){this._config=t,this._locationManager=e,this._measurementsManager=i,this._controlManager=n,this._dataManager=r,this._chartFactory=a,this._chartManager=o,this._workspaceManager=s,this._userManager=u,this._webArgsManager=c,this._cookieManager=l,this._registerRequestSeqInfos(),this._registerRequestMeasurements(),this._registerUiAddChart(),this._registerUiSaveWorkspace(),this._registerUiDeleteActiveWorkspace(),this._registerUiRevertActiveWorkspace(),this._registerUiLoginLinkClicked(),this._registerUiSearchWorkspaces(),this._registerUiActiveWorkspaceChanged(),this._registerUiSearch(),this._registerChartRequestHierarchy(),this._registerChartPropagateHierarchySelection(),this._registerChartPropogateIcicleLocationChange(),this._registerChartPropagateNavigationChanges(),this._registerUiSettingsChanged(),this._registerDataAddMeasurements(),this._registerDataLoadMeasurements(),this._registerDataRemoveMeasurements(),this._registerDataAddChart(),this._registerDataRemoveChart(),this._registerDataAddSeqInfos(),this._registerDataRemoveSeqNames(),this._registerDataNavigate(),this._registerDataRedraw(),this._registerDataGetCurrentLocation(),this._registerPrintWorkspace(),this._registerLoadWorkspace(),this._registerDataSetChartSettings(),this._registerDataGetChartSettings(),this._registerDataGetAvailableCharts(),this._registerDataUiStatus(),this._registerRequestWorkspaces(),this._registerWorkspacesLoaded(),this._registerActiveWorkspaceChanged(),this._registerActiveWorkspaceContentChanged(),this._registerLocationChanged()},epiviz.EpiViz.VERSION="5",epiviz.EpiViz.prototype.start=function(){this._cookieManager.initialize(),this._controlManager.initialize(),this._workspaceManager.initialize(),this._measurementsManager.initialize(),this._locationManager.initialize()},epiviz.EpiViz.prototype.config=function(){return this._config},epiviz.EpiViz.prototype._addChart=function(t,e,i,n){i=this._chartManager.addChart(t,e,i,n);var r=this;if("epiviz.plugins.charts.CustomScatterPlot"==t.typeName()){var a=null;(t={})[i]=e.measurements,this._dataManager.getPCA(a,t,function(t,e){r._chartManager.updateCharts(a,e,[t])})}else"epiviz.plugins.charts.DiversityScatterPlot"==t.typeName()?(a=null,(t={})[i]=e.measurements,this._dataManager.getDiversity(a,t,function(t,e){r._chartManager.updateCharts(a,e,[t])})):t.chartDisplayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE?((t={})[i]=e,a=this._workspaceManager.activeWorkspace().range(),this._dataManager.getHierarchy(t,function(t,e){r._chartManager.updateCharts(a,e,[t])})):(a=this._workspaceManager.activeWorkspace().range(),this._chartManager.dataWaitStart(i),(t={})[i]=e.measurements,this._dataManager.getData(a,t,function(t,e){r._chartManager.updateCharts(a,e,[t])}));return i},epiviz.EpiViz.prototype._registerRequestSeqInfos=function(){var t=this;this._locationManager.onRequestSeqInfos().addListener(new epiviz.events.EventListener(function(){t._dataManager.getSeqInfos(function(e){t._locationManager.updateSeqInfos(e)})}))},epiviz.EpiViz.prototype._registerRequestMeasurements=function(){var t=this;this._measurementsManager.onRequestMeasurements().addListener(new epiviz.events.EventListener(function(){t._dataManager.getMeasurements(function(e){t._measurementsManager.addMeasurements(e)})}))},epiviz.EpiViz.prototype._registerRequestWorkspaces=function(){var t=this;this._workspaceManager.onRequestWorkspaces().addListener(new epiviz.events.EventListener(function(e){var i=t._cookieManager.getWorkspace(t._chartFactory,t._config);t._dataManager.getWorkspaces(function(n){for(var r=[],a=null,o=null,s=0;s<n.length;++s){var u=epiviz.workspaces.Workspace.fromRawObject(n[s],t._chartFactory,t._config);null===u.id()?a=u:(u.id()==e.activeWorkspaceId&&(i&&i.id()==e.activeWorkspaceId&&(o=u,u=i),a=u),r.push(u))}t._workspaceManager.updateWorkspaces(r,a,e.activeWorkspaceId,o),i||t._workspaceManager.activeWorkspace().resetChanged()},"",e.activeWorkspaceId)}))},epiviz.EpiViz.prototype._registerUiAddChart=function(){var t=this;this._controlManager.onAddChart().addListener(new epiviz.events.EventListener(function(e){t._addChart(e.type,e.visConfigSelection)}))},epiviz.EpiViz.prototype._registerUiSaveWorkspace=function(){var t=this;this._controlManager.onSaveWorkspace().addListener(new epiviz.events.EventListener(function(e){var i=(i=t._workspaceManager.getByName(e.name))?t._workspaceManager.activeWorkspace().copy(e.name,i.id()):t._workspaceManager.activeWorkspace().copy(e.name);t._dataManager.saveWorkspace(i,t._config,function(e){(i=i.copy(i.name(),e)).resetChanged(),t._workspaceManager.updateWorkspace(i),t._workspaceManager.changeActiveWorkspace(e)})}))},epiviz.EpiViz.prototype._registerUiDeleteActiveWorkspace=function(){var t=this;this._controlManager.onDeleteActiveWorkspace().addListener(new epiviz.events.EventListener(function(){t._dataManager.deleteWorkspace(t._workspaceManager.activeWorkspace()),t._workspaceManager.deleteActiveWorkspace()}))},epiviz.EpiViz.prototype._registerUiRevertActiveWorkspace=function(){var t=this;this._controlManager.onRevertActiveWorkspace().addListener(new epiviz.events.EventListener(function(){t._workspaceManager.revertActiveWorkspace()}))},epiviz.EpiViz.prototype._registerUiLoginLinkClicked=function(){var t=this;this._controlManager.onLoginLinkClicked().addListener(new epiviz.events.EventListener(function(){t._userManager.toggleLogin()}))},epiviz.EpiViz.prototype._registerUiSearchWorkspaces=function(){var t=this;this._controlManager.onSearchWorkspaces().addListener(new epiviz.events.EventListener(function(e){t._dataManager.getWorkspaces(function(t){e.callback(t)},e.searchTerm,e.searchTerm)}))},epiviz.EpiViz.prototype._registerUiActiveWorkspaceChanged=function(){var t=this;this._controlManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(e){var i=function(){e.newValue.id&&!t._workspaceManager.get(e.newValue.id)?t._dataManager.getWorkspaces(function(i){for(var n=null,r=0;r<i.length;++r){var a=epiviz.workspaces.Workspace.fromRawObject(i[r],t._chartFactory,t._config);if(null===a.id()){n=a;break}}n&&t._workspaceManager.changeActiveWorkspace(e.newValue.id,n)},e.newValue.name,e.newValue.id):t._workspaceManager.changeActiveWorkspace(e.newValue.id)};epiviz.workspaces.UserManager.USER_STATUS.loggedIn&&!t._workspaceManager.activeWorkspaceChanging()&&t._workspaceManager.activeWorkspace().changed()?new epiviz.ui.controls.MessageDialog("Discard workspace changes",{Yes:function(){i()},No:function(){e.cancel()}},"There are unsaved changes in the current workspace. Do you wish to discard them?",epiviz.ui.controls.MessageDialog.Icon.QUESTION).show():i()}))},epiviz.EpiViz.prototype._registerUiSearch=function(){var t=this;this._controlManager.onSearch().addListener(new epiviz.events.EventListener(function(e){t._dataManager.search(function(t){e.callback(t)},e.searchTerm)}))},epiviz.EpiViz.prototype._registerChartRequestHierarchy=function(){var t=this;this._chartManager.onChartRequestHierarchy().addListener(new epiviz.events.EventListener(function(e){var i={};i[e.id]=e.args,t._dataManager.getHierarchy(i,function(e,i){t._chartManager.updateCharts(void 0,i,[e])})}))},epiviz.EpiViz.prototype._registerChartPropagateHierarchySelection=function(){var t=this;this._chartManager.onChartPropagateHierarchyChanges().addListener(new epiviz.events.EventListener(function(e){var i={};i[e.id]=e.args,t._dataManager.propagateHierarchyChanges(i,function(e,i){t._chartManager.updateCharts(void 0,i,[e])})}))},epiviz.EpiViz.prototype._registerChartPropagateNavigationChanges=function(){var t=this;this._chartManager.onChartPropagateNavigationChanges().addListener(new epiviz.events.EventListener(function(e){t._locationManager.changeCurrentLocation(e.range)}))},epiviz.EpiViz.prototype._registerUiSettingsChanged=function(){var t=this;this._workspaceManager.onUiChartSettingsChanged().addListener(new epiviz.events.EventListener(function(e){t._dataManager.updateChartSettings(e)}))},epiviz.EpiViz.prototype._registerDataAddMeasurements=function(){var t=this;this._dataManager.onRequestAddMeasurements().addListener(new epiviz.events.EventListener(function(e){try{t._measurementsManager.addMeasurements(e.measurements),e.result.success=!0}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataRemoveMeasurements=function(){var t=this;this._dataManager.onRequestRemoveMeasurements().addListener(new epiviz.events.EventListener(function(e){try{t._measurementsManager.removeMeasurements(e.measurements),e.result.success=!0}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataLoadMeasurements=function(){var t=this;this._dataManager.onRequestLoadMeasurements().addListener(new epiviz.events.EventListener(function(e){try{var i=t._measurementsManager.getRemoteMeasurements();e.result.success=!0,e.result.measurements=i}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataAddChart=function(){var t=this;this._dataManager.onRequestAddChart().addListener(new epiviz.events.EventListener(function(e){try{var i=t._chartFactory.get(e.type),n=t._addChart(i,e.visConfigSelection);e.result.success=!0,e.result.value={id:n}}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataRemoveChart=function(){var t=this;this._dataManager.onRequestRemoveChart().addListener(new epiviz.events.EventListener(function(e){try{t._chartManager.removeChart(e.id),e.result.success=!0}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerPrintWorkspace=function(){this._dataManager.onRequestPrintWorkspace().addListener(new epiviz.events.EventListener(function(t){try{new epiviz.ui.PrintManager(t.chartId,t.fileName,t.fileType).print(),t.result.success=!0}catch(e){t.result.success=!1,t.errorMessage=e.toString()}}))},epiviz.EpiViz.prototype._registerLoadWorkspace=function(){var t=this;this._dataManager.onRequestLoadWorkspace().addListener(new epiviz.events.EventListener(function(e){try{t._workspaceManager._requestWorkspaces.notify({activeWorkspaceId:e.workspace})}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataSetChartSettings=function(){var t=this;this._dataManager.onRequestSetChartSettings().addListener(new epiviz.events.EventListener(function(e){try{t._chartManager.setChartSettings(e.chartId,e.settings,e.colorMap),e.result.success=!0}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataGetChartSettings=function(){var t=this;this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(e){try{t._chartManager.getChartSettings(e.chartId),e.result.success=!0}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataGetAvailableCharts=function(){var t=this;this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(e){try{e.result.value=[],t._chartFactory.foreach(function(t,i){e.result.value.push({chartName:t,customSettings:i.customSettingsDefs(),colorMap:i.defaultColors()._colors})}),e.result.success=!0}catch(t){e.result.success=!1,e.result.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataAddSeqInfos=function(){var t=this;this._dataManager.onRequestAddSeqInfos().addListener(new epiviz.events.EventListener(function(e){try{t._locationManager.addSeqInfos(e.seqInfos),e.result.success=!0}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataRemoveSeqNames=function(){var t=this;this._dataManager.onRequestRemoveSeqNames().addListener(new epiviz.events.EventListener(function(e){try{t._locationManager.removeSeqNames(e.seqNames),e.result.success=!0}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataNavigate=function(){var t=this;this._dataManager.onRequestNavigate().addListener(new epiviz.events.EventListener(function(e){try{t._locationManager.changeCurrentLocation(e.range),e.result.success=!0}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataRedraw=function(){var t=this;this._dataManager.onRequestRedraw().addListener(new epiviz.events.EventListener(function(e){try{var i=t._locationManager.currentLocation();t._locationManager.changeCurrentLocation(i),e.result.success=!0,t._chartManager.updateDataStructureCharts()}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerDataGetCurrentLocation=function(){var t=this;this._dataManager.onRequestCurrentLocation().addListener(new epiviz.events.EventListener(function(e){try{var i=t._locationManager.currentLocation();e.result.value={seqName:i.seqName(),start:i.start(),end:i.end()},e.result.success=!0}catch(t){e.result.success=!1,e.errorMessage=t.toString()}}))},epiviz.EpiViz.prototype._registerWorkspacesLoaded=function(){this._workspaceManager.onWorkspacesLoaded().addListener(new epiviz.events.EventListener(function(t){}))},epiviz.EpiViz.prototype._registerActiveWorkspaceChanged=function(){var t=this;this._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(e){for(var i in t._workspaceManager.startChangingActiveWorkspace(),t._controlManager.updateSelectedWorkspace({id:e.newValue.id(),name:e.newValue.name()}),t._locationManager.changeCurrentLocation(e.newValue.range()),t._measurementsManager.removeMeasurements(t._measurementsManager.computedMeasurements()),t._measurementsManager.addMeasurements(e.newValue.computedMeasurements()),t._chartManager.clear(),e=e.newValue.charts())if(e.hasOwnProperty(i))for(var n=0;n<e[i].length;++n)t._addChart(e[i][n].type,e[i][n].properties.visConfigSelection,e[i][n].id,e[i][n].properties.copy());t._workspaceManager.endChangingActiveWorkspace()}))},epiviz.EpiViz.prototype._registerActiveWorkspaceContentChanged=function(){var t=this;this._workspaceManager.onActiveWorkspaceContentChanged().addListener(new epiviz.events.EventListener(function(e){t._cookieManager.saveWorkspace(e,t._config)}))},epiviz.EpiViz.prototype._registerLocationChanged=function(){var t=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(e){t._chartManager.dataWaitStart(void 0,function(t){return t.displayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE});var i,n=t._chartManager.chartsMeasurements();for(i in n)-1==i.indexOf("pca_scatter")&&-1==i.indexOf("diversity_scatter")||delete n[i];t._dataManager.getData(e.newValue,n,function(i,n){t._chartManager.updateCharts(e.newValue,n,[i])}),t._chartManager.onChartPropogateIcicleLocationChanges().isFiring()||t._chartManager.onChartIcicleLocationChanges().notify()}))},epiviz.EpiViz.prototype._registerChartPropogateIcicleLocationChange=function(){var t=this;t._chartManager.onChartPropogateIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(e){var i=t._locationManager.currentLocation();null!=i&&t._locationManager.changeCurrentLocation(new epiviz.datatypes.GenomicRange(i.seqName(),e.start,e.width))}))},epiviz.EpiViz.prototype._registerDataUiStatus=function(){var t=this;this._dataManager.onRequestUiStatus().addListener(new epiviz.events.EventListener(function(e){null==t._workspaceManager._activeWorkspace?t._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(t){e.result.success=!0})):e.result.success=!0}))},epiviz.localstorage={},epiviz.localstorage.LocalStorageManager=function(t){this._workspace=t,this._availStorage="undefined"!=typeof Storage&&null!=localStorage},epiviz.localstorage.LocalStorageManager.MODE={INCOGNITO_MODE:"incognito_workspace",COOKIE_MODE:"workspace"},epiviz.localstorage.LocalStorageManager.prototype.initialize=function(){},epiviz.localstorage.LocalStorageManager.prototype.getWorkspace=function(t,e){if(this._availStorage){var i=localStorage.getItem(this._workspace);return i?epiviz.workspaces.Workspace.fromRawObject(JSON.parse(i),t,e):null}},epiviz.localstorage.LocalStorageManager.prototype.saveWorkspace=function(t,e){if(this._availStorage){var i=t.raw(e);localStorage.setItem(this._workspace,JSON.stringify(i))}},epiviz.localstorage.LocalStorageManager.prototype.clearWorkspace=function(){this._availStorage&&localStorage.removeItem(this._workspace)},epiviz.localstorage.LocalStorageManager.prototype.clearAll=function(){this._availStorage&&localStorage.clear()},epiviz.ui.LocationManager=function(t){this._seqInfos={},this._timeout=this._lastUnfilledRequest=this._currentLocation=null,this._navigationDelay=t.navigationDelay,this._currentLocationChanged=new epiviz.events.Event,this._seqInfosUpdated=new epiviz.events.Event,this._requestSeqInfos=new epiviz.events.Event},epiviz.ui.LocationManager.prototype.initialize=function(){this._requestSeqInfos.notify()},epiviz.ui.LocationManager.prototype.changeCurrentLocation=function(t){if(!this._currentLocationChanged.isFiring()){this._lastUnfilledRequest=t,null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);var e=this;t=function(){var t=e._lastUnfilledRequest;null!==t&&e._doChangeCurrentLocation(t)},this._navigationDelay?this._timeout=window.setTimeout(t,this._navigationDelay):t()}},epiviz.ui.LocationManager.prototype._doChangeCurrentLocation=function(t){var e=this._currentLocation,i=t.genome(),n=t.seqName();if(!(t.seqName()in this._seqInfos)){if(!e)return;n=e.seqName()}var r=void 0,a=void 0;this._seqInfos[n]&&null!=this._seqInfos[n].min&&null!=this._seqInfos[n].max&&(r=null!=t.start()&&t.start()>=this._seqInfos[n].min?t.start():this._seqInfos[n].min,a=null!=t.width()?r+t.width():r+9999),null!=r&&null!=a&&a>this._seqInfos[n].max&&(r=Math.max(this._seqInfos[n].min,this._seqInfos[n].max-a+r),a=this._seqInfos[n].max),this._lastUnfilledRequest=null,this._currentLocation=epiviz.datatypes.GenomicRange.fromStartEnd(n,r,a,i),this._currentLocationChanged.notify({oldValue:e,newValue:this._currentLocation})},epiviz.ui.LocationManager.prototype.currentLocation=function(){return this._currentLocation},epiviz.ui.LocationManager.prototype.lastUnfilledLocationChangeRequest=function(){return this._lastUnfilledRequest},epiviz.ui.LocationManager.prototype.updateSeqInfos=function(t){this._seqInfos={};for(var e=0;e<t.length;++e)this._seqInfos[t[e].seqName]=t[e];this._seqInfosUpdated.notify(t),null!==this._lastUnfilledRequest&&(this._lastUnfilledRequest.seqName()in this._seqInfos?this._doChangeCurrentLocation(this._lastUnfilledRequest):0<t.length&&(t=new epiviz.datatypes.GenomicRange(t[0].seqName,this._lastUnfilledRequest.start(),this._lastUnfilledRequest.width(),t[0].genome),this._doChangeCurrentLocation(t)))},epiviz.ui.LocationManager.prototype.addSeqInfos=function(t){for(var e=0;e<t.length;++e)this._seqInfos[t[e].seqName]||(this._seqInfos[t[e].seqName]=t[e]);for(var i in t=[],this._seqInfos)this._seqInfos.hasOwnProperty(i)&&t.push(this._seqInfos[i]);this._seqInfosUpdated.notify(t)},epiviz.ui.LocationManager.prototype.removeSeqNames=function(t){for(var e=0;e<t.length;++e)delete this._seqInfos[t[e]];for(var i in t=[],this._seqInfos)this._seqInfos.hasOwnProperty(i)&&t.push(this._seqInfos[i]);this._seqInfosUpdated.notify(t),this._currentLocation.seqName()in this._seqInfos||this.changeCurrentLocation(new epiviz.datatypes.GenomicRange(t[0].seqName,this._currentLocation.start(),this._currentLocation.width(),t[0].genome))},epiviz.ui.LocationManager.prototype.seqInfos=function(){return this._seqInfos},epiviz.ui.LocationManager.prototype.onCurrentLocationChanged=function(){return this._currentLocationChanged},epiviz.ui.LocationManager.prototype.onSeqInfosUpdated=function(){return this._seqInfosUpdated},epiviz.ui.LocationManager.prototype.onRequestSeqInfos=function(){return this._requestSeqInfos},epiviz.measurements.MeasurementsManager=function(){this._requestMeasurements=new epiviz.events.Event,this._measurementsAdded=new epiviz.events.Event,this._measurementsRemoved=new epiviz.events.Event,this._computedMeasurementsAdded=new epiviz.events.Event,this._computedMeasurementsRemoved=new epiviz.events.Event,this._measurements=new epiviz.measurements.MeasurementSet,this._computedMeasurements=new epiviz.measurements.MeasurementSet},epiviz.measurements.MeasurementsManager.prototype.initialize=function(){this._requestMeasurements.notify()},epiviz.measurements.MeasurementsManager.prototype.onRequestMeasurements=function(){return this._requestMeasurements},epiviz.measurements.MeasurementsManager.prototype.onMeasurementsAdded=function(){return this._measurementsAdded},epiviz.measurements.MeasurementsManager.prototype.onMeasurementsRemoved=function(){return this._measurementsRemoved},epiviz.measurements.MeasurementsManager.prototype.onComputedMeasurementsAdded=function(){return this._computedMeasurementsAdded},epiviz.measurements.MeasurementsManager.prototype.onComputedMeasurementsRemoved=function(){return this._computedMeasurementsRemoved},epiviz.measurements.MeasurementsManager.prototype.measurements=function(){return this._measurements},epiviz.measurements.MeasurementsManager.prototype.computedMeasurements=function(){return this._computedMeasurements},epiviz.measurements.MeasurementsManager.prototype.addMeasurements=function(t){if(t&&t.size()){var e=this;this._measurements.addAll(t);var i=new epiviz.measurements.MeasurementSet;t.foreach(function(t){t.isComputed()&&(i.add(t),e._computedMeasurements.add(t))}),this._measurementsAdded.notify(t),0<i.size()&&this._computedMeasurementsAdded.notify(i)}},epiviz.measurements.MeasurementsManager.prototype.removeMeasurements=function(t){var e=this;this._measurements.removeAll(t);var i=new epiviz.measurements.MeasurementSet;t.foreach(function(t){t.isComputed()&&(i.add(t),e._computedMeasurements.remove(t))}),this._measurementsRemoved.notify(t),0<i.size()&&this._computedMeasurementsRemoved.notify(i)},epiviz.measurements.MeasurementsManager.prototype.addMeasurement=function(t){var e=new epiviz.measurements.MeasurementSet;e.add(t),this.addMeasurements(e)},epiviz.measurements.MeasurementsManager.prototype.removeMeasurement=function(t){var e=new epiviz.measurements.MeasurementSet;e.add(t),this.removeMeasurements(e)},epiviz.measurements.MeasurementsManager.prototype.getRemoteMeasurements=function(){return this._measurements.remoteRaw()},epiviz.ui.charts.markers.MeasurementAggregator=function(t,e){this._id=t,this._aggregator=e},epiviz.ui.charts.markers.MeasurementAggregator.prototype.aggregate=function(t,e,i){return this._aggregator(t,e,i)},epiviz.ui.charts.markers.MeasurementAggregator.prototype.id=function(){return this._id},epiviz.ui.charts.markers.MeasurementAggregators={"mean-stdev":new epiviz.ui.charts.markers.MeasurementAggregator("mean-stdev",function(t,e,i){if(!i||0==i.length)return null;var n=i.reduce(function(t,e){return t+e})/i.length;return t=i.map(function(t){return(t-n)*(t-n)}).reduce(function(t,e){return t+e})/i.length,t=Math.sqrt(t),{value:n,errMinus:n-t,errPlus:n+t}}),quartiles:new epiviz.ui.charts.markers.MeasurementAggregator("quartiles",function(t,e,i){if(!i||0==i.length)return null;t=(i=i.slice(0).sort(function(t,e){return t-e})).length,e=Math.floor(.5*t);var n=Math.ceil(.5*t);return{value:.5*(i[Math.floor(.5*(t-1))]+i[e]),errMinus:.5*(i[Math.floor(.5*(e-1))]+i[Math.floor(.5*e)]),errPlus:.5*(i[n+Math.floor(.5*(t-n-1))]+i[n+Math.floor(.5*(t-n))])}}),count:new epiviz.ui.charts.markers.MeasurementAggregator("count",function(t,e,i){return i&&0!=i.length?{value:i.length}:0}),min:new epiviz.ui.charts.markers.MeasurementAggregator("min",function(t,e,i){return i&&0!=i.length?{value:Math.min.apply(void 0,i)}:null}),max:new epiviz.ui.charts.markers.MeasurementAggregator("max",function(t,e,i){return i&&0!=i.length?{value:Math.max.apply(void 0,i)}:null}),sum:new epiviz.ui.charts.markers.MeasurementAggregator("sum",function(t,e,i){return i&&0!=i.length?{value:i.reduce(function(t,e){return t+e})}:null})},epiviz.ui.charts.ChartType=function(t){epiviz.ui.charts.VisualizationType.call(this,t)},epiviz.ui.charts.ChartType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisualizationType.prototype),epiviz.ui.charts.ChartType.constructor=epiviz.ui.charts.ChartType,epiviz.ui.charts.ChartType.prototype.createNew=function(t,e,i){throw Error("unimplemented abstract method")},epiviz.ui.charts.ChartType.prototype.customSettingsDefs=function(){var t=epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs.call(this);if(this.isRestrictedToRangeMeasurements())return t;var e=Object.keys(epiviz.ui.charts.markers.MeasurementAggregators);return t.concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,e[0],"Aggregator for measurement groups",e)])},epiviz.ui.charts.ChartType.CustomSettings={MEASUREMENT_GROUPS_AGGREGATOR:"measurementGroupsAggregator"},epiviz.ui.charts.Chart=function(t,e,i){epiviz.ui.charts.Visualization.call(this,t,e,i),this._nBins=100,this._globalIndexColorLabels=this._measurementColorLabels=this._binSize=null},epiviz.ui.charts.Chart.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Visualization.prototype),epiviz.ui.charts.Chart.constructor=epiviz.ui.charts.Chart,epiviz.ui.charts.Chart.prototype._initialize=function(){epiviz.ui.charts.Visualization.prototype._initialize.call(this),this._svg.classed("base-chart",!0)},epiviz.ui.charts.Chart.prototype._addFilters=function(){var t=this._svg.append("defs"),e=t.append("filter").attr("id",this.id()+"-glow");e.append("feGaussianBlur").attr("id","gaussianBlur").attr("stdDeviation","2").attr("result","blurResult"),e.append("feComposite").attr("id","composite").attr("in","SourceGraphic").attr("in2","blurResult").attr("operator","over"),(e=t.append("filter").attr("id",this.id()+"-contour")).append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","1").attr("result","blur"),e.append("feColorMatrix").attr("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 10 -1 ").attr("result","colorMatrix"),e.append("feFlood").attr("result","fillColor").attr("flood-color","#800000").attr("in","blur"),e.append("feComposite").attr("result","composite").attr("in","fillColor").attr("in2","colorMatrix").attr("operator","atop"),e.append("feComposite").attr("in","SourceGraphic").attr("in2","composite").attr("operator","atop"),(e=(t=t.append("filter").attr("id",this.id()+"-dropshadow").attr("filterUnits","userSpaceOnUse").attr("color-interpolation-filters","sRGB")).append("feComponentTransfer").attr("in","SourceAlpha")).append("feFuncR").attr("type","discrete").attr("tableValues","1"),e.append("feFuncG").attr("type","discrete").attr("tableValues",198/255),e.append("feFuncB").attr("type","discrete").attr("tableValues","0"),t.append("feGaussianBlur").attr("stdDeviation","2"),t.append("feOffset").attr("dx","0").attr("dy","0").attr("result","shadow"),t.append("feComposite").attr("in","SourceGraphic").attr("in2","shadow").attr("operator","over")},epiviz.ui.charts.Chart.prototype.draw=function(t,e){return epiviz.ui.charts.Visualization.prototype.draw.call(this,t,e),t&&(this._binSize=Math.ceil((t.end()-t.start())/this._nBins)),[]},epiviz.ui.charts.Chart.prototype.transformData=function(t,e){var i=new epiviz.deferred.Deferred,n=this;return epiviz.ui.charts.Visualization.prototype.transformData.call(this,t,e).done(function(){n._lastData?n._lastData.ready(function(){var t,e,r,a=!1;if((n._lastData.measurements().every(function(t){return!(a=t.type()!==epiviz.measurements.Measurement.Type.RANGE)}),a)&&(n._markers.every(function(e){return e&&e.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS&&(t=e),!t}),t)){var o=epiviz.ui.charts.markers.MeasurementAggregators[n.customSettingsValues()[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR]];n._lastData=new epiviz.datatypes.MeasurementAggregatedGenomicData(n._lastData,t,o)}n._markers.every(function(t){return t&&t.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER&&(e=t),!e}),e&&(n._lastData=new epiviz.datatypes.ItemFilteredGenomicData(n._lastData,e)),n._markers.every(function(t){return t&&t.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.ORDER_BY_MEASUREMENTS&&(r=t),!r}),r&&(n._lastData=new epiviz.datatypes.MeasurementOrderedGenomicData(n._lastData,r)),n._lastData.ready(function(){var t=n._lastData;if(t.isReady()){var e,r=new epiviz.deferred.Deferred;if(n._markers.every(function(t){return t&&t.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_MEASUREMENTS&&(e=t),!e}),n._measurementColorLabels=null,e){var a=new epiviz.measurements.MeasurementHashtable;e.preMark()(t).done(function(i){var o=t.measurements();epiviz.utils.deferredFor(o.length,function(n){var r=new epiviz.deferred.Deferred;return e.mark()(o[n],t,i).done(function(t){a.put(o[n],t),r.resolve()}),r}).done(function(){n._measurementColorLabels=a,r.resolve()})})}else r.resolve();var o,s=new epiviz.deferred.Deferred;if(n._markers.every(function(t){return t&&t.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_ROW&&(o=t),!o}),n._globalIndexColorLabels=null,o){var u={};o.preMark()(t).done(function(e){var i=t.firstSeries();epiviz.utils.deferredFor(i.size(),function(n){var r=new epiviz.deferred.Deferred;return o.mark()(i.getRow(n),t,e).done(function(t){u[n+i.globalStartIndex()]=t,r.resolve()}),r}).done(function(){n._globalIndexColorLabels=u,s.resolve()})})}else s.resolve();r.done(function(){s.state()==epiviz.deferred.Deferred.State.RESOLVED&&(n._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(n.id())),i.resolve())}),s.done(function(){r.state()==epiviz.deferred.Deferred.State.RESOLVED&&(n._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(n.id())),i.resolve())})}})}):i.resolve()}),i},epiviz.ui.charts.Chart.prototype.properties=function(){return epiviz.ui.charts.Visualization.prototype.properties.call(this)},epiviz.ui.charts.VisObject=function(){},epiviz.ui.charts.VisObject.prototype.regionStart=function(){return null},epiviz.ui.charts.VisObject.prototype.regionEnd=function(){return null},epiviz.ui.charts.VisObject.prototype.regionSeqName=function(){return null},epiviz.ui.charts.VisObject.prototype.getMetadata=function(t,e,i){return null},epiviz.ui.charts.VisObject.prototype.getSeqName=function(t,e){return null},epiviz.ui.charts.VisObject.prototype.getStart=function(t,e){return null},epiviz.ui.charts.VisObject.prototype.getEnd=function(t,e){return null},epiviz.ui.charts.VisObject.prototype.metadataColumns=function(){return null},epiviz.ui.charts.VisObject.prototype.dimensions=function(){return[0,0]},epiviz.ui.charts.VisObject.prototype.metadataLooseCompare=function(){return!1},epiviz.ui.charts.VisObject.prototype.overlapsWith=function(t){if(!t)return!1;if(this===t)return!0;var e,i,n;if(this.regionSeqName()!=t.regionSeqName())return!1;var r=this.dimensions(),a=t.dimensions();if(!(r[0]&&a[0]||null!=this.regionStart()&&null!=t.regionStart()&&null!=this.regionEnd()&&null!=t.regionEnd()))return!1;if(!r[0]){if(!a[0])return this.regionStart()<t.regionEnd()&&this.regionEnd()>t.regionStart();for(i=0;i<a[1];++i)if(e=t.getStart(0,i),n=t.getEnd(0,i),null!=e&&null!=n&&this.regionStart()<n&&this.regionEnd()>e)return!0;return!1}var o=epiviz.utils.arrayIntersection(this.metadataColumns(),t.metadataColumns());if(o.length){for(e=0;e<r[1];++e)for(i=0;i<a[1];++i){var s=!0;for(n=0;n<o.length;++n){var u=this.metadataLooseCompare()||t.metadataLooseCompare(),c=this.getMetadata(0,e,o[n]),l=t.getMetadata(0,i,o[n]);if(c!=l){if(!u){s=!1;break}if(c.length<=l.length?(u=c,c=l):u=l,!new RegExp("^(.+,)?"+u+"(,.+)?$").test(c)){s=!1;break}}}if(s)return!0}return!1}for(e=0;e<r[1];++e)for(i=0;i<a[1];++i)if(this.getStart(0,e)<t.getEnd(0,i)&&this.getEnd(0,e)>t.getStart(0,i))return!0;return!1},epiviz.ui.charts.ChartObject=function(t,e,i,n,r,a,o,s,u){epiviz.ui.charts.VisObject.call(this),this.id=t,this.seqName=u,this.start=e,this.end=i,this.values=n,this.seriesIndex=r,this.valueItems=a,this.measurements=o,this.cssClasses=s},epiviz.ui.charts.ChartObject.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisObject.prototype),epiviz.ui.charts.ChartObject.constructor=epiviz.ui.charts.ChartObject,epiviz.ui.charts.ChartObject.prototype.regionStart=function(){return this.start},epiviz.ui.charts.ChartObject.prototype.regionEnd=function(){return this.end},epiviz.ui.charts.ChartObject.prototype.regionSeqName=function(){return this.seqName},epiviz.ui.charts.ChartObject.prototype.getMetadata=function(t,e,i){return this.valueItems?this.valueItems[t][e].rowItem.metadata(i):null},epiviz.ui.charts.ChartObject.prototype.getStart=function(t,e){return this.valueItems[t][e].rowItem.start()},epiviz.ui.charts.ChartObject.prototype.getSeqName=function(t,e){return this.seqName|this.valueItems[t][e].rowItem.seqName()},epiviz.ui.charts.ChartObject.prototype.getEnd=function(t,e){return this.valueItems[t][e].rowItem.end()},epiviz.ui.charts.ChartObject.prototype.metadataColumns=function(){return Object.keys(this.valueItems[0][0].rowItem.rowMetadata())},epiviz.ui.charts.ChartObject.prototype.dimensions=function(){var t=[];return this.valueItems?(t.push(this.valueItems.length),this.valueItems.length?t.push(this.valueItems[0].length):t.push(0),t):[0,0]},epiviz.ui.charts.Track=function(t,e,i){epiviz.ui.charts.Chart.call(this,t,e,i),this._highlightGroup=this._background=null,this._propagateNavigationChanges=new epiviz.events.Event},epiviz.ui.charts.Track.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Chart.prototype),epiviz.ui.charts.Track.constructor=epiviz.ui.charts.Track,epiviz.ui.charts.Track.prototype._initialize=function(){this._properties.width="100%",epiviz.ui.charts.Chart.prototype._initialize.call(this);var t=this;this._highlightGroup=this._svg.append("g").attr("class","track-highlight"),this._background=this._svg.append("rect").attr("class","chart-background").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","#ffffff").attr("fill-opacity","0"),this._background.on("mouseover",function(){t._captureMouseHover()}).on("mousemove",function(){t._captureMouseHover()}).on("mouseout",function(){t._unhover.notify(new epiviz.ui.charts.VisEventArgs(t.id()))})},epiviz.ui.charts.Track.prototype.draw=function(t,e,i,n){return t=epiviz.ui.charts.Chart.prototype.draw.call(this,t,e),this._drawLegend(),t},epiviz.ui.charts.Track.prototype.displayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.TRACK},epiviz.ui.charts.Track.prototype.doHover=function(t){if(epiviz.ui.charts.Chart.prototype.doHover.call(this,t),null!=t.start&&null!=t.end&&this._lastRange){this._highlightGroup.selectAll("rect").remove(),this._highlightGroup.attr("transform","translate("+this.margins().left()+", 0)");var e=epiviz.ui.charts.Axis,i=d3.scale.linear().domain([this._lastRange.start(),this._lastRange.end()]).range([0,this.width()-this.margins().sumAxis(e.X)]);e=[];if(t.measurements&&t.measurements.length)for(var n=0;n<t.valueItems[0].length;++n){var r=t.valueItems[0][n].rowItem;e.push({start:r.start(),end:r.end()})}else e.push({start:t.start,end:t.end});this._highlightGroup.selectAll("rect").data(e,function(t){return sprintf("%s-%s",t.start,t.end)}).enter().append("rect").style("fill",this.colors().get(0)).style("fill-opacity","0.1").attr("x",function(t){var e=i(t.end+1)-i(t.start),n=Math.max(5,e);return i(t.start)+.5*e-.5*n}).attr("width",function(t){return Math.max(5,i(t.end+1)-i(t.start))}).attr("y",0).attr("height",this.height())}},epiviz.ui.charts.Track.prototype.doUnhover=function(){epiviz.ui.charts.Chart.prototype.doUnhover.call(this),this._highlightGroup.selectAll("rect").remove()},epiviz.ui.charts.Track.prototype._captureMouseHover=function(){if(this._lastRange){this._unhover.notify(new epiviz.ui.charts.VisEventArgs(this.id()));var t=(i=d3.scale.linear().domain([0,this.width()]).range([this._lastRange.start(),this._lastRange.end()])(d3.mouse(this._background[0][0])[0])-this._binSize/2)+this._binSize,e=this._lastRange.seqName(),i=new epiviz.ui.charts.ChartObject(sprintf("%s-highlight",this.id()),i,t,null,null,null,null,null,e);this._hover.notify(new epiviz.ui.charts.VisEventArgs(this.id(),i))}},epiviz.ui.charts.Track.prototype._drawLegend=function(){var t=this;if(this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),this._lastData&&this._lastData.isReady()){var e=this._lastData.measurements(),i=this._svg.selectAll(".chart-title").data(e).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(e,i){return t._measurementColorLabels?t.colors().getByKey(t._measurementColorLabels.get(e)):t.colors().get(i)}).attr("y",t.margins().top()-5).text(function(t,e){return t.name()}),n=0,r=[];this._container.find(" .chart-title").each(function(t){r.push(n),n+=this.getBBox().width+15}),i.attr("x",function(e,i){return t.margins().left()+10+r[i]}),this._svg.selectAll(".chart-title-color").data(e).enter().append("circle").attr("class","chart-title-color").attr("cx",function(e,i){return t.margins().left()+4+r[i]}).attr("cy",t.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(e,i){return t._measurementColorLabels?t.colors().getByKey(t._measurementColorLabels.get(e)):t.colors().get(i)})}},epiviz.plugins={},epiviz.plugins.charts={},epiviz.plugins.charts.BlocksTrack=function(t,e,i){epiviz.ui.charts.Track.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.BlocksTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype),epiviz.plugins.charts.BlocksTrack.constructor=epiviz.plugins.charts.BlocksTrack,epiviz.plugins.charts.BlocksTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this),this._svg.classed("blocks-track",!0)},epiviz.plugins.charts.BlocksTrack.prototype.draw=function(t,e,i,n){return epiviz.ui.charts.Track.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,e&&t&&e.isReady()?this._drawBlocks(t,e,i||0,n||1):[]},epiviz.plugins.charts.BlocksTrack.prototype._drawBlocks=function(t,e,i,n){var r=epiviz.ui.charts.Axis,a=t.start(),o=t.end(),s=this.width(),u=this.height(),c=this.margins();this.measurements();var l=this.colors(),p=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],h=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_COLOR_BY],d=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY],f=d3.scale.linear().domain([a,o]).range([0,s-c.sumAxis(r.X)]),v=i*(s-c.sumAxis(r.X))/(o-a);this._clearAxes(),this._drawAxes(f,null,10,5);var g=this,m=[],y=0;return e.foreach(function(e,i,n){n=[];for(var r=0;r<i.size();++r){var a=i.get(r);if(!(a.rowItem.start()>t.end()||a.rowItem.end()<t.start())){var o=sprintf("item data-series-%s",y);if(null!==p&&0<n.length){var s=n[n.length-1];if(f(a.rowItem.start())-f(s.end)<p){s.end=Math.max(s.end,a.rowItem.end()),s.valueItems[0].push(a),s.id=sprintf("b-%s-%s-%s",y,s.start,s.end);continue}}n.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",y,a.rowItem.start(),a.rowItem.end()),a.rowItem.start(),a.rowItem.end(),a.rowItem.metadata(h),y,[[a]],[e],o,a.rowItem.seqName()))}}m=m.concat(n),++y}),a=(i=this._svg.select(".items")).select(".selected"),a=this._svg.select("#clip-"+this.id()),i.empty()&&(a.empty()&&this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("class","clip-path-rect"),a=(i=this._svg.append("g").attr("class","items").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")")).append("g").attr("class","selected"),i.append("g").attr("class","hovered"),a.append("g").attr("class","hovered")),i.attr("transform","translate("+c.left()+", "+c.top()+")"),this._svg.select(".clip-path-rect").attr("x",0).attr("y",0).attr("width",s-c.sumAxis(r.X)).attr("height",u-c.sumAxis(r.Y)),i.selectAll(".item").remove(),(s=i.selectAll(".item").data(m,function(t){return t.id})).enter().insert("rect",":first-child").attr("class",function(t){return t.cssClasses}).style("fill",function(t){return t=1<e.measurements().length?l.get(t.seriesIndex):d?l.getByKey(t.values):l.get(t.seriesIndex)}).attr("x",function(t){return f(t.start)/n+v}).attr("width",function(t){return n*(f(t.end+1)-f(t.start))}).on("mouseout",function(){g._unhover.notify(new epiviz.ui.charts.VisEventArgs(g.id()))}).on("mouseover",function(t){g._hover.notify(new epiviz.ui.charts.VisEventArgs(g.id(),t))}).on("click",function(t){g._deselect.notify(new epiviz.ui.charts.VisEventArgs(g.id())),g._select.notify(new epiviz.ui.charts.VisEventArgs(g.id(),t)),d3.event.stopPropagation()}),s.attr("class",function(t){return t.cssClasses}).attr("height",u-c.sumAxis(r.Y)).attr("y",0).transition().duration(500).attr("x",function(t){return f(t.start)}).attr("width",function(t){return f(t.end+1)-f(t.start)}),s.exit().transition().duration(500).attr("x",function(t){return f(t.start)}).remove(),m},epiviz.plugins.charts.BlocksTrack.prototype.setColors=function(t){this.container().find(".items").remove(),epiviz.ui.charts.Visualization.prototype.setColors.call(this,t)},epiviz.ui.charts.TrackType=function(t){epiviz.ui.charts.ChartType.call(this,t)},epiviz.ui.charts.TrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.ChartType.prototype),epiviz.ui.charts.TrackType.constructor=epiviz.ui.charts.TrackType,epiviz.ui.charts.TrackType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.TRACK},epiviz.ui.charts.TrackType.prototype.cssClass=function(){return"track-container ui-widget-content"},epiviz.plugins.charts.BlocksTrackType=function(t){epiviz.ui.charts.TrackType.call(this,t)},epiviz.plugins.charts.BlocksTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype),epiviz.plugins.charts.BlocksTrackType.constructor=epiviz.plugins.charts.BlocksTrackType,epiviz.plugins.charts.BlocksTrackType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.BlocksTrack(t,e,i)},epiviz.plugins.charts.BlocksTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.BlocksTrack"},epiviz.plugins.charts.BlocksTrackType.prototype.chartName=function(){return"Blocks Track"},epiviz.plugins.charts.BlocksTrackType.prototype.chartHtmlAttributeName=function(){return"blocks"},epiviz.plugins.charts.BlocksTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0},epiviz.plugins.charts.BlocksTrackType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.RANGE}},epiviz.plugins.charts.BlocksTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE,epiviz.ui.charts.CustomSetting.Type.NUMBER,5,"Minimum block distance"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Block Color by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Block color by")])},epiviz.plugins.charts.BlocksTrackType.CustomSettings={MIN_BLOCK_DISTANCE:"minBlockDistance",BLOCK_COLOR_BY:"blockColorBy",USE_COLOR_BY:"useColorBy"},epiviz.plugins.charts.StackedBlocksTrack=function(t,e,i){epiviz.ui.charts.Track.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.StackedBlocksTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype),epiviz.plugins.charts.StackedBlocksTrack.constructor=epiviz.plugins.charts.StackedBlocksTrack,epiviz.plugins.charts.StackedBlocksTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this),this._svg.classed("blocks-track",!0)},epiviz.plugins.charts.StackedBlocksTrack.prototype.draw=function(t,e,i,n){return epiviz.ui.charts.Track.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,e&&t&&e.isReady()?this._drawBlocks(t,e,i||0,n||1):[]},epiviz.plugins.charts.StackedBlocksTrack.prototype._drawBlocks=function(t,e,i,n){var r=epiviz.ui.charts.Axis,a=t.start(),o=t.end(),s=this.width(),u=this.height(),c=this.margins();this.measurements();var l=this.colors(),p=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],h=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.BLOCK_COLOR_BY],d=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.USE_COLOR_BY],f=d3.scale.linear().domain([a,o]).range([0,s-c.sumAxis(r.X)]),v=i*(s-c.sumAxis(r.X))/(o-a);this._clearAxes(),this._drawAxes(f,null,10,5);var g=this,m=[],y=0;e.foreach(function(e,i,n){n=[];for(var r=0;r<i.size();++r){var a=i.get(r);if(!(a.rowItem.start()>t.end()||a.rowItem.end()<t.start())){var o=sprintf("item data-series-%s",y);if(null!==p&&0<n.length){var s=n[n.length-1];if(f(a.rowItem.start())-f(s.end)<p){s.end=Math.max(s.end,a.rowItem.end()),s.valueItems[0].push(a),s.id=sprintf("b-%s-%s-%s",y,s.start,s.end);continue}}n.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",y,a.rowItem.start(),a.rowItem.end()),a.rowItem.start(),a.rowItem.end(),a.rowItem.metadata(h),y,[[a]],[e],o))}}m=m.concat(n),++y}),a=(i=this._svg.select(".items")).select(".selected"),a=this._svg.select("#clip-"+this.id()),i.empty()&&(a.empty()&&this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("class","clip-path-rect"),a=(i=this._svg.append("g").attr("class","items").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")")).append("g").attr("class","selected"),i.append("g").attr("class","hovered"),a.append("g").attr("class","hovered")),i.attr("transform","translate("+c.left()+", "+c.top()+")"),this._svg.select(".clip-path-rect").attr("x",0).attr("y",0).attr("width",s-c.sumAxis(r.X)).attr("height",u-c.sumAxis(r.Y)),i.selectAll(".item").remove();s=i.selectAll(".item").data(m,function(t){return t.id});var _=(u-c.sumAxis(r.Y))/y;return s.enter().insert("rect",":first-child").attr("class",function(t){return t.cssClasses}).style("fill",function(t){return t=1<e.measurements().length?l.get(t.seriesIndex):d?l.getByKey(t.values):l.get(t.seriesIndex)}).attr("x",function(t){return f(t.start)/n+v}).attr("y",function(t){return t.seriesIndex*_}).attr("width",function(t){return n*(f(t.end+1)-f(t.start))}).attr("height",function(t){return _}).on("mouseout",function(){g._unhover.notify(new epiviz.ui.charts.VisEventArgs(g.id()))}).on("mouseover",function(t){g._hover.notify(new epiviz.ui.charts.VisEventArgs(g.id(),t))}).on("click",function(t){g._deselect.notify(new epiviz.ui.charts.VisEventArgs(g.id())),g._select.notify(new epiviz.ui.charts.VisEventArgs(g.id(),t)),d3.event.stopPropagation()}),s.attr("class",function(t){return t.cssClasses}).transition().duration(500).attr("x",function(t){return f(t.start)}).attr("y",function(t){return t.seriesIndex*_}).attr("width",function(t){return f(t.end+1)-f(t.start)}).attr("height",function(t){return _}),s.exit().transition().duration(500).attr("x",function(t){return f(t.start)}).attr("y",function(t){return t.seriesIndex*_}).attr("width",function(t){return f(t.end+1)-f(t.start)}).attr("height",function(t){return _}).remove(),m},epiviz.plugins.charts.StackedBlocksTrack.prototype.setColors=function(t){this.container().find(".items").remove(),epiviz.ui.charts.Visualization.prototype.setColors.call(this,t)},epiviz.plugins.charts.StackedBlocksTrackType=function(t){epiviz.ui.charts.TrackType.call(this,t)},epiviz.plugins.charts.StackedBlocksTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype),epiviz.plugins.charts.StackedBlocksTrackType.constructor=epiviz.plugins.charts.StackedBlocksTrackType,epiviz.plugins.charts.StackedBlocksTrackType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.StackedBlocksTrack(t,e,i)},epiviz.plugins.charts.StackedBlocksTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedBlocksTrack"},epiviz.plugins.charts.StackedBlocksTrackType.prototype.chartName=function(){return"Stacked Blocks Track"},epiviz.plugins.charts.StackedBlocksTrackType.prototype.chartHtmlAttributeName=function(){return"stacked-blocks"},epiviz.plugins.charts.StackedBlocksTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0},epiviz.plugins.charts.StackedBlocksTrackType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.RANGE}},epiviz.plugins.charts.StackedBlocksTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE,epiviz.ui.charts.CustomSetting.Type.NUMBER,5,"Minimum block distance"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.USE_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Block Color by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.BLOCK_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Block color by")])},epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings={MIN_BLOCK_DISTANCE:"minBlockDistance",BLOCK_COLOR_BY:"blockColorBy",USE_COLOR_BY:"useColorBy"},epiviz.plugins.charts.LineTrack=function(t,e,i){epiviz.ui.charts.Track.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.LineTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype),epiviz.plugins.charts.LineTrack.constructor=epiviz.plugins.charts.LineTrack,epiviz.plugins.charts.LineTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this)},epiviz.plugins.charts.LineTrack.prototype.draw=function(t,e,i,n){if(epiviz.ui.charts.Track.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,i=i||this._slide||0,n=n||this._zoom||1,this._slide=0,this._zoom=1,!e||!t)return[];var r=epiviz.ui.charts.CustomSetting,a=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],o=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX];a==r.DEFAULT&&(a=null,this.measurements().foreach(function(t){null!==t&&(null===a||t.minValue()<a)&&(a=t.minValue())})),o==r.DEFAULT&&(o=null,this.measurements().foreach(function(t){null!==t&&(null===o||t.maxValue()>o)&&(o=t.maxValue())})),null===a&&null===o&&(a=-1,o=1),null===a&&(a=o-1),null===o&&(o=a+1);var s=epiviz.ui.charts.Axis,u=(r=d3.scale.linear().domain([t.start(),t.end()]).range([0,this.width()-this.margins().sumAxis(s.X)]),d3.scale.linear().domain([a,o]).range([this.height()-this.margins().sumAxis(s.Y),0]));this._clearAxes(),this._drawAxes(r,u,10,5),i=i*(this.width()-this.margins().sumAxis(s.X))/t.width();var c=this._svg.selectAll(".lines");for(c.empty()&&(c=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")")),e.measurements().forEach(function(t,e){var i=c.selectAll(".line-series-index-"+e),n=c.selectAll(".point-series-index-"+e);i.empty()&&c.append("g").attr("class","line-series-index-"+e),n.empty()&&c.append("g").attr("class","point-series-index-"+e)}),s=e.measurements().length;;++s){var l=c.selectAll(".line-series-index-"+s),p=c.selectAll(".point-series-index-"+s);if(l.empty())break;l.remove(),p.remove()}return this._drawLines(t,e,i,n,r,u)},epiviz.plugins.charts.LineTrack.prototype._drawLines=function(t,e,i,n,r,a){var o=this.colors(),s=parseInt(this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.STEP]),u=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_POINTS],c=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_LINES],l=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_ERROR_BARS],p=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.POINT_RADIUS],h=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.LINE_THICKNESS],d=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.INTERPOLATION];n=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.ABS_LINE_VAL];var f=this,v=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X)]).range([t.start(),t.end()])(i)-t.start(),g=epiviz.datatypes.GenomicRange.fromStartEnd(t.seqName(),Math.min(t.start(),t.start()+v),Math.max(t.end(),t.end()+v),t.genome()),m=this._svg.select(".lines"),y=[];return e.foreach(function(t,e,n){var v=f._measurementColorLabels?o.getByKey(f._measurementColorLabels.get(t)):o.get(n),_=e.binarySearchStarts(g);if(0!=_.length){var z=Math.ceil(_.index/s)*s;_.length=Math.max(0,_.length-z+_.index),_.index=z;z=epiviz.utils.range(_.length,_.index).filter(function(t){return!s||1>=s||0==(t-_.index)%s});for(var b=0;b<z.length;++b){var w=e.get(z[b]);y.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",n,w.globalIndex),w.rowItem.start(),w.rowItem.end(),[w.value],n,[[w]],[t],sprintf("item data-series-%s",n),w.rowItem.seqName()))}var C=function(t){return t=e.get(t),r(t.rowItem.start())};t=function(t){return t=e.get(t),a(t.value)},c?(b=d3.svg.line().x(C).y(t).interpolate(d),(w=m.select(".line-series-index-"+n).selectAll("path").data([z])).enter().append("path").attr("d",b).style("shape-rendering","auto").style("stroke-opacity","0.8").on("mouseover",function(){f._captureMouseHover()}).on("mousemove",function(){f._captureMouseHover()}).on("mouseout",function(){f._unhover.notify(new epiviz.ui.charts.VisEventArgs(f.id()))}),w.attr("d",b).style("stroke",v).style("stroke-width",h).attr("transform","translate("+ +i+")").transition().duration(500).attr("transform","translate(0)")):m.select(".line-series-index-"+n).selectAll("path").remove(),m.select(".point-series-index-"+n).selectAll("circle").remove(),m.select(".point-series-index-"+n).selectAll(".error-bar").remove(),u&&((b=m.select(".point-series-index-"+n).selectAll("circle").data(z)).enter().append("circle").attr("class","point-series-index-"+n).attr("r",p).attr("cx",C).attr("cy",t).attr("fill",v).attr("stroke",v).attr("transform","translate("+ +i+")").transition().duration(500).attr("transform","translate(0)"),b.on("mouseover",function(){f._captureMouseHover()}).on("mousemove",function(){f._captureMouseHover()}).on("mouseout",function(){f._unhover.notify(new epiviz.ui.charts.VisEventArgs(f.id()))}),b.exit().transition().duration(500).style("opacity",0).remove(),l&&((n=m.select(".point-series-index-"+n).selectAll(".error-bar").data(z)).enter().append("g").attr("class","error-bar").each(function(t){var i,n;i=null!=(i=(i=e.get(t)).valueAnnotation?i.valueAnnotation.errMinus:null)?a(i):null,n=null!=(n=(n=e.get(t)).valueAnnotation?n.valueAnnotation.errPlus:null)?a(n):null,null!=i&&null!=n&&(d3.select(this).append("line").attr("x1",C(t)).attr("x2",C(t)).attr("y1",i).attr("y2",n).style("stroke",v).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",C(t)-2).attr("x2",C(t)+2).attr("y1",i).attr("y2",i).style("stroke",v).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",C(t)-2).attr("x2",C(t)+2).attr("y1",n).attr("y2",n).style("stroke",v).style("shape-rendering","auto"))}).attr("transform","translate("+ +i+")").transition().duration(500).attr("transform","translate(0)"),n.on("mouseover",function(){f._captureMouseHover()}).on("mousemove",function(){f._captureMouseHover()}).on("mouseout",function(){f._unhover.notify(new epiviz.ui.charts.VisEventArgs(f.id()))}),n.exit().transition().duration(500).style("opacity",0).remove()))}}),n!=epiviz.ui.charts.CustomSetting.DEFAULT&&(m.selectAll(".abLine").remove(),m.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",f.width()-f.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",a(n)).attr("y2",a(n)).style("stroke","black").style("stroke-dasharray","5, 5")),y},epiviz.plugins.charts.LineTrackType=function(t){epiviz.ui.charts.TrackType.call(this,t)},epiviz.plugins.charts.LineTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype),epiviz.plugins.charts.LineTrackType.constructor=epiviz.plugins.charts.LineTrackType,epiviz.plugins.charts.LineTrackType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.LineTrack(t,e,i)},epiviz.plugins.charts.LineTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.LineTrack"},epiviz.plugins.charts.LineTrackType.prototype.chartName=function(){return"Line Track"};epiviz.plugins.charts.LineTrackType.prototype.chartHtmlAttributeName=function(){return"lines"},epiviz.plugins.charts.LineTrackType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.FEATURE}},epiviz.plugins.charts.LineTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.STEP,epiviz.ui.charts.CustomSetting.Type.NUMBER,50,"Step"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_POINTS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Show points"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_LINES,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show lines"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_ERROR_BARS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show error bars"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.POINT_RADIUS,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Point radius"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.LINE_THICKNESS,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Line thickness"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"linear","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])},epiviz.plugins.charts.LineTrackType.CustomSettings={STEP:"step",SHOW_POINTS:"showPoints",SHOW_ERROR_BARS:"showErrorBars",SHOW_LINES:"showLines",POINT_RADIUS:"pointRadius",LINE_THICKNESS:"lineThickness",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"},epiviz.plugins.charts.StackedLineTrack=function(t,e,i){epiviz.ui.charts.Track.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.StackedLineTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype),epiviz.plugins.charts.StackedLineTrack.constructor=epiviz.plugins.charts.StackedLineTrack,epiviz.plugins.charts.StackedLineTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this)},epiviz.plugins.charts.StackedLineTrack.prototype.draw=function(t,e,i,n){if(epiviz.ui.charts.Track.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,i=i||this._slide,n=n||this._zoom,this._slide=0,this._zoom=1,!e||!t)return[];var r=epiviz.ui.charts.Axis;return i=(i||0)*(this.width()-this.margins().sumAxis(r.X))/t.width(),this._drawLines(t,e,i,n||1)},epiviz.plugins.charts.StackedLineTrack.prototype._drawLines=function(t,e,i,n){var r=epiviz.ui.charts.Axis,a=this.colors(),o=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.STEP],s=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.INTERPOLATION],u=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.OFFSET];n=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.ABS_LINE_VAL];var c=this,l=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(r.X)]).range([t.start(),t.end()])(i)-t.start();epiviz.datatypes.GenomicRange.fromStartEnd(t.seqName(),Math.min(t.start(),t.start()+l),Math.max(t.end(),t.end()+l));var p=[],h=[],d=e.firstSeries().globalStartIndex(),f=e.firstSeries().globalEndIndex();e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>d&&(d=i),n<f&&(f=n)});var v;d=Math.ceil(d/o)*o,f=Math.floor(f/o)*o;e.foreach(function(t,e,i){for(var n=epiviz.utils.range((f-d)/o).map(function(t){return t*o+d}).filter(function(t){return e.getByGlobalIndex(t)}),r=0;r<n.length;++r){var a=e.getByGlobalIndex(n[r]);p.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",i,a.globalIndex),a.rowItem.start(),a.rowItem.end(),[a.value],i,[[a]],[t],sprintf("item data-series-%s",i),a.rowItem.seqName()))}var s=[];n.forEach(function(t){s.push({x:e.getByGlobalIndex(t).rowItem.start(),y:e.getByGlobalIndex(t).value})}),h.push(s),v||(v=[],n.forEach(function(t){t=e.getByGlobalIndex(t),v.push(t.rowItem.metadata("bacteria"))}))});var g=d3.scale.linear().domain([t.start(),t.end()]).range([0,this.width()-this.margins().sumAxis(r.X)]);this._clearAxes(),this._drawAxes(g,void 0,10),(t=this._svg.select(".lines")).empty()&&(t=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")")),e=d3.layout.stack().offset(u)(h);var m=d3.scale.linear().domain([Math.min(0,d3.min(e,function(t){return d3.min(t,function(t){return t.y0+t.y})})),d3.max(e,function(t){return d3.max(t,function(t){return t.y0+t.y})})]).range([this.height()-this.margins().sumAxis(r.Y),0]);r=d3.svg.area().x(function(t){return g(t.x)}).y0(function(t){return m(t.y0)}).y1(function(t){return m(t.y0+t.y)}).interpolate(s);return(s=t.selectAll("path").data(e)).enter().append("path").attr("d",r).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t,e){return a.get(e)}).on("mouseover",function(){c._captureMouseHover()}).on("mousemove",function(){c._captureMouseHover()}).on("mouseout",function(){c._unhover.notify(new epiviz.ui.charts.VisEventArgs(c.id()))}),s.attr("d",r).style("fill",function(t,e){return a.get(e)}).attr("transform","translate("+ +i+")").transition().duration(500).attr("transform","translate(0)"),n!=epiviz.ui.charts.CustomSetting.DEFAULT&&(t.selectAll(".abLine").remove(),t.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",c.width()-c.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",m(n)).attr("y2",m(n)).style("stroke","black").style("stroke-dasharray","5, 5")),p},epiviz.plugins.charts.StackedLineTrackType=function(t){epiviz.ui.charts.TrackType.call(this,t)},epiviz.plugins.charts.StackedLineTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype),epiviz.plugins.charts.StackedLineTrackType.constructor=epiviz.plugins.charts.StackedLineTrackType,epiviz.plugins.charts.StackedLineTrackType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.StackedLineTrack(t,e,i)},epiviz.plugins.charts.StackedLineTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedLineTrack"},epiviz.plugins.charts.StackedLineTrackType.prototype.chartName=function(){return"Stacked Track"},epiviz.plugins.charts.StackedLineTrackType.prototype.chartHtmlAttributeName=function(){return"stacked-lines"},epiviz.plugins.charts.StackedLineTrackType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.FEATURE}},epiviz.plugins.charts.StackedLineTrackType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.StackedLineTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.STEP,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Step"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.OFFSET,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"zero","Offset",["zero","wiggle"]),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"basis","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])},epiviz.plugins.charts.StackedLineTrackType.CustomSettings={STEP:"step",OFFSET:"offset",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"},epiviz.ui.charts.Plot=function(t,e,i){epiviz.ui.charts.Chart.call(this,t,e,i)},epiviz.ui.charts.Plot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Chart.prototype),epiviz.ui.charts.Plot.constructor=epiviz.ui.charts.Plot,epiviz.ui.charts.Plot.prototype.displayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.PLOT},epiviz.plugins.charts.ScatterPlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._legend=this._chartContent=null,this._measurementsX=[],this._measurementsY=[];var n=this;for(this.measurements().foreach(function(t,e){0==e%2?n._measurementsX.push(t):n._measurementsY.push(t)}),this._yLabel=this._xLabel="",t=0;t<Math.min(this._measurementsX.length,this._measurementsY.length);++t)0<t&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=this._measurementsX[t].name(),this._yLabel+=this._measurementsY[t].name();this._colorLabels=[],this._initialize()},epiviz.plugins.charts.ScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.ScatterPlot.constructor=epiviz.plugins.charts.ScatterPlot,epiviz.plugins.charts.ScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("scatter-plot",!0),this._chartContent=this._svg.append("g").attr("class","chart-content"),this._legend=this._svg.append("g").attr("class","chart-legend")},epiviz.plugins.charts.ScatterPlot.prototype.draw=function(t,e){return epiviz.ui.charts.Plot.prototype.draw.call(this,t,e),e=this._lastData,t=this._lastRange,e&&t?this._drawCircles(t,e):[]},epiviz.plugins.charts.ScatterPlot.prototype._drawCircles=function(t,e){var i=this,n=epiviz.ui.charts.Axis,r=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),a=Math.max(Math.floor(r),1),o=Math.min(this._measurementsX.length,this._measurementsY.length),s=this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.ABS_LINE_VAL],u=e.firstSeries().globalStartIndex(),c=e.firstSeries().globalEndIndex();e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>u&&(u=i),n<c&&(c=n)});var l=c-u,p=this.margins(),h=this.width(),d=this.height(),f=epiviz.ui.charts.CustomSetting,v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],m=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],y=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];m==f.DEFAULT&&(m=this._measurementsX[0].minValue()),v==f.DEFAULT&&(v=this._measurementsY[0].minValue()),y==f.DEFAULT&&(y=this._measurementsX[0].maxValue()),g==f.DEFAULT&&(g=this._measurementsY[0].maxValue());var _=epiviz.measurements.Measurement.Type.isOrdered(this._measurementsX[0].type()),z=(f=d3.scale.linear().domain([m,y]).range([0,h-p.sumAxis(n.X)]),d3.scale.linear().domain([v,g]).range([d-p.sumAxis(n.Y),0]));this._clearAxes(this._chartContent),this._drawAxes(f,z,15,15,this._chartContent);var b,w,C=[];for(b=0;b<l;++b){if(w=b+u,(S=e.getSeries(this._measurementsX[0]).getRowByGlobalIndex(w))&&(!_||null==t.start()||null==t.end()||S.start()<t.end()&&S.end()>t.start()))for(S=0;S<o;++S)C.push(S*l+b)}var S={},x=(o=[],1);for(b=0;b<C.length;++b){var M=(w=C[b]%l)+u;_=Math.floor(C[b]/l);w=i._measurementsX[_];var T=i._measurementsY[_],k=e.getSeries(w).getByGlobalIndex(M);M=e.getSeries(T).getByGlobalIndex(M);if(k&&M){var E=sprintf("item data-series-%s",_),A=f(k.value),R=z(M.value),D=(A=Math.floor(A/a)*a,null);S[R=Math.floor(R/a)*a]&&S[R][A]?((D=S[R][A]).id+="_"+k.globalIndex,D.start=Math.min(D.start,k.rowItem.start()),D.end=Math.max(D.end,k.rowItem.end()),D.values[0]=(D.values[0]*D.valueItems[0].length+k.value)/(D.valueItems[0].length+1),D.values[1]=(D.values[1]*D.valueItems[1].length+M.value)/(D.valueItems[1].length+1),D.valueItems[0].push(k),D.valueItems[1].push(M),D.valueItems[0].length>x&&(x=D.valueItems[0].length)):(D=new epiviz.ui.charts.ChartObject(sprintf("scatter_%s_%s",_,k.globalIndex),k.rowItem.start(),k.rowItem.end(),[k.value,M.value],_,[[k],[M]],[w,T],E,k.rowItem.seqName()),S[R]||(S[R]={}),S[R][A]=D,o.push(D))}}if((a=this._chartContent.select(".items")).empty()&&(l=(a=this._chartContent.append("g").attr("class","items")).append("g").attr("class","selected"),a.append("g").attr("class","hovered"),l.append("g").attr("class","hovered")),(l=a.selectAll("circle").data(o,function(t){return t.id})).enter().insert("circle",":first-child").attr("id",function(t){return sprintf("%s-item-%s-%s",i.id(),t.seriesIndex,t.valueItems[0][0].globalIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0),l.each(function(t){var e,r=d3.select(this);e=i._globalIndexColorLabels?i.colors().getByKey(i._globalIndexColorLabels[t.valueItems[0][0].globalIndex]):i.colors().get(t.seriesIndex),r.attr("cx",p.left()+(t.values[0]-m)*(h-p.sumAxis(n.X))/(y-m)).attr("cy",d-p.bottom()-(t.values[1]-v)*(d-p.sumAxis(n.Y))/(g-v)).attr("class",t.cssClasses).style("fill",e)}),l.transition().duration(1e3).style("fill-opacity",function(t){return Math.max(.6,t.valueItems[0].length/x)}).style("opacity",null).attr("r",r),l.exit().transition().duration(1e3).style("opacity",0).attr("r",0).remove(),l.on("mouseover",function(t){i._hover.notify(new epiviz.ui.charts.VisEventArgs(i.id(),t))}).on("mouseout",function(){i._unhover.notify(new epiviz.ui.charts.VisEventArgs(i.id()))}).on("click",function(t){i._deselect.notify(new epiviz.ui.charts.VisEventArgs(i.id())),i._select.notify(new epiviz.ui.charts.VisEventArgs(i.id(),t)),d3.event.stopPropagation()}),this._globalIndexColorLabels){for(r={},S=u;S<c;++S)r[this._globalIndexColorLabels[S]]=this._globalIndexColorLabels[S];this._colorLabels=Object.keys(r),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(r=this._svg.selectAll(".chart-title").data(this._colorLabels)).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",i.margins().top()-5),r.attr("fill",function(t,e){return i.colors().getByKey(t)}).text(function(t){return t});var I=0,L=[];this._container.find(" .chart-title").each(function(t){L.push(I),I+=this.getBBox().width+15}),r.attr("x",function(t,e){return i.margins().left()+10+L[e]}),this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return i.margins().left()+4+L[e]}).attr("cy",i.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t,e){return i.colors().getByKey(t)}).style("stroke-width",0)}else{for(r=Math.min(this._measurementsX.length,this._measurementsY.length),l=Array(r),S=0;S<r;++S)l[S]=sprintf("%s vs %s",this._measurementsX[S].name(),this._measurementsY[S].name());this._colorLabels=l}return s!=epiviz.ui.charts.CustomSetting.DEFAULT&&(a.selectAll(".abLine").remove(),a.append("svg:line").attr("class","abLine").attr("x1",p.left()+(m-m)*(h-p.sumAxis(n.X))/(y-m)).attr("x2",p.left()+(y-m)*(h-p.sumAxis(n.X))/(y-m)).attr("y1",d-p.bottom()-(s-v)*(d-p.sumAxis(n.Y))/(g-v)).attr("y2",d-p.bottom()-(s-v)*(d-p.sumAxis(n.Y))/(g-v)).style("stroke","black").style("stroke-dasharray","5, 5")),o},epiviz.plugins.charts.ScatterPlot.prototype.colorLabels=function(){return this._colorLabels},epiviz.plugins.charts.ScatterPlot.prototype._drawAxes=function(t,e,i,n,r,a,o,s){epiviz.ui.charts.Plot.prototype._drawAxes.call(this,t,e,i,n,r,a,o,s),this._legend.selectAll("text").remove(),t=this._measurementsX;var u=this;this._legend.selectAll(".x-measurement").remove(),this._legend.selectAll(".x-measurement-color").remove(),e=this._legend.selectAll(".x-measurement").data(t).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.height()-this.margins().bottom()+35).text(function(t,e){return t.name()});var c=0,l=[];this._container.find(" .x-measurement").each(function(t){l.push(c),c+=this.getBBox().width+15}),e.attr("x",function(t,e){return.5*(u.width()-c)+7+l[e]}),this._legend.selectAll(".x-measurement-color").data(t).enter().append("circle").attr("class","x-measurement-color").attr("cx",function(t,e){return.5*(u.width()-c)+1+l[e]}).attr("cy",this.height()-this.margins().bottom()+31).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t,e){return u._globalIndexColorLabels?"#ffffff":u.colors().get(e)}),t=this._measurementsY,this._legend.selectAll(".y-measurement").remove(),this._legend.selectAll(".y-measurement-color").remove(),e=this._legend.selectAll(".y-measurement").data(t).enter().append("text").attr("class","y-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.margins().left()-35).attr("transform","rotate(-90)").text(function(t,e){return t.name()});var p=0,h=[];this._container.find(" .y-measurement").each(function(t){h.push(p),p+=this.getBBox().width+15}),e.attr("x",function(t,e){return-u.height()+.5*(u.height()-p)+12+u.margins().top()+h[e]}),this._legend.selectAll(".y-measurement-color").data(t).enter().append("circle").attr("class","y-measurement-color").attr("cx",function(t,e){return-u.height()+.5*(u.height()-p)+6+u.margins().top()+h[e]}).attr("cy",this.margins().left()-39).attr("transform","rotate(-90)").attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t,e){return u._globalIndexColorLabels?"#ffffff":u.colors().get(e)})},epiviz.ui.charts.PlotType=function(t){epiviz.ui.charts.ChartType.call(this,t)},epiviz.ui.charts.PlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.ChartType.prototype),epiviz.ui.charts.PlotType.constructor=epiviz.ui.charts.PlotType,epiviz.ui.charts.PlotType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.PLOT},epiviz.ui.charts.PlotType.prototype.cssClass=function(){return"plot-container ui-widget-content"},epiviz.plugins.charts.ScatterPlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.ScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.ScatterPlotType.constructor=epiviz.plugins.charts.ScatterPlotType,epiviz.plugins.charts.ScatterPlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.ScatterPlot(t,e,i)},epiviz.plugins.charts.ScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.ScatterPlot"},epiviz.plugins.charts.ScatterPlotType.prototype.chartName=function(){return"Scatter Plot"},epiviz.plugins.charts.ScatterPlotType.prototype.chartHtmlAttributeName=function(){return"scatter"},epiviz.plugins.charts.ScatterPlotType.prototype.measurementsFilter=function(){return function(t){return epiviz.measurements.Measurement.Type.hasValues(t.type())}},epiviz.plugins.charts.ScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.ScatterPlotType.prototype.minSelectedMeasurements=function(){return 2},epiviz.plugins.charts.ScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.ScatterPlotType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])},epiviz.plugins.charts.ScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio",ABS_LINE_VAL:"abLine"},epiviz.plugins.charts.GenesTrack=function(t,e,i){epiviz.ui.charts.Track.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.GenesTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype),epiviz.plugins.charts.GenesTrack.constructor=epiviz.plugins.charts.GenesTrack,epiviz.plugins.charts.GenesTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this),this._svg.classed("genes-track",!0)},epiviz.plugins.charts.GenesTrack.prototype.draw=function(t,e,i,n){return epiviz.ui.charts.Track.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,e&&t?(i=i||this._slide,n=n||this._zoom,this._slide=0,this._zoom=1,this._drawGenes(t,e,i||0,n||1)):[]},epiviz.plugins.charts.GenesTrack.prototype._drawGenes=function(t,e,i,n){var r=epiviz.ui.charts.Axis,a=t.start(),o=t.end(),s=this.width(),u=this.height(),c=this.margins(),l=d3.scale.linear().domain([a,o]).range([0,s-c.sumAxis(r.X)]),p=i*(s-c.sumAxis(r.X))/(o-a);this._clearAxes(),this._drawAxes(l,null,10,5);var h=this,d=e.firstSeries();return e=epiviz.utils.range(d.size()).map(function(t){var e=(t=d.get(t)).rowItem,i=sprintf("item gene-%s",e.metadata("gene"));return new epiviz.ui.charts.ChartObject(e.metadata("gene"),e.start(),e.end(),null,0,[[t]],[d.measurement()],i,e.seqName())}),n&&(this._svg.select(".items").remove(),this._svg.select("defs").select("#clip-"+this.id()).remove()),i=(n=this._svg.select(".items")).select(".selected"),n.empty()&&(this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("x",0).attr("y",0).attr("width",s-c.sumAxis(r.X)).attr("height",u-c.sumAxis(r.Y)),i=(n=this._svg.append("g").attr("class","items").attr("transform","translate("+c.left()+", "+c.top()+")").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")")).append("g").attr("class","selected"),n.append("g").attr("class","hovered"),i.append("g").attr("class","hovered")),(r=n.selectAll(".item").data(e,function(t){return t.id})).enter().insert("g",":first-child").on("mouseout",function(){h._unhover.notify(new epiviz.ui.charts.VisEventArgs(h.id()))}).on("mouseover",function(t){h._hover.notify(new epiviz.ui.charts.VisEventArgs(h.id(),t))}).on("click",function(t){h._deselect.notify(new epiviz.ui.charts.VisEventArgs(h.id())),h._select.notify(new epiviz.ui.charts.VisEventArgs(h.id(),t)),d3.event.stopPropagation()}).attr("transform","translate("+p+", 0) scale(1, 1)").each(function(t){h._drawGene(this,t,l)}),u=d3.behavior.drag().on("drag",function(e){e=d3.event.dx,e=Math.round(t.start()+e/s*t.start()),e=new epiviz.datatypes.GenomicRange(t.seqName(),e,t.width(),t.genome()),h._propagateNavigationChanges.notify({id:h.id(),range:e})}),h._svg.call(u),p&&r.each(function(t){h._translateGene(this,t,p)}),r.exit().transition().duration(500).style("opacity",0).remove(),e},epiviz.plugins.charts.GenesTrack.prototype._translateGene=function(t,e,i){e=(t=d3.select(t)).attr("transform");var n=RegExp("translate\\([\\d\\.\\-]+[\\,\\s]+[\\d\\.\\-]+\\)","g"),r=RegExp("[\\d\\.\\-]+","g"),a=e.match(n)[0];r=parseFloat(a.match(r)[0]);e=e.replace(n,"translate("+(r-i)+", 0)"),t.transition().duration(500).attr("transform",e)},epiviz.plugins.charts.GenesTrack.prototype._drawGene=function(t,e,i){var n=epiviz.ui.charts.Axis,r=this,a=e.valueItems[0][0].rowItem,o=i(e.start),s=i(e.end),u="+"==a.strand()?1:-1,c=-u*(this.height()-this.margins().sumAxis(n.Y))*.25,l=a.metadata("exon_starts").split(",").map(function(t){return parseInt(t)}),p=a.metadata("exon_ends").split(",").map(function(t){return parseInt(t)}),h=d3.range(0,l.length),d=.08*this.height(),f=.16*this.height(),v=d*Math.sqrt(3)*.5;(t=d3.select(t)).attr("class",e.cssClasses),t.append("polygon").attr("class","gene-body").style("fill",this.colors().get(0)).attr("points",function(){var t,e;return e=[t=.5*(r.height()-r.margins().sumAxis(n.Y)-d)+c,t,t+.5*d,t+d,t+d],t="+"==a.strand()?[o,s,s+v,s,o]:[s,o,o-v,o,s],sprintf("%s,%s %s,%s %s,%s %s,%s %s,%s",t[0],e[0],t[1],e[1],t[2],e[2],t[3],e[3],t[4],e[4])}),t.append("g").attr("class","exons").style("fill",this.colors().get(1)).selectAll("rect").data(h).enter().append("rect").attr("x",function(t){return i(l[t])}).attr("y",.5*(r.height()-f-r.margins().sumAxis(n.Y))+c).attr("width",function(t){return i(p[t])-i(l[t])}).attr("height",f),t.append("text").attr("class","gene-name").attr("x",o+2).attr("y",.5*(r.height()-r.margins().sumAxis(n.Y))+c-u*(d+2)).style("dominant-baseline","central").text(e.id)},epiviz.plugins.charts.GenesTrack.prototype.colorLabels=function(){return["Genes","Exons"]},epiviz.plugins.charts.GenesTrack.prototype._drawAxes=function(t,e,i,n,r,a,o,s){epiviz.ui.charts.Track.prototype._drawAxes.call(this,t,e,i,n,r,a,o,s),t=epiviz.ui.charts.Axis,this._svg.select(".axes").append("g").attr("class","xAxis").append("line").attr("x1",this.margins().left()).attr("x2",this.width()-this.margins().left()).attr("y1",this.margins().top()+.5*(this.height()-this.margins().sumAxis(t.Y))).attr("y2",this.margins().top()+.5*(this.height()-this.margins().sumAxis(t.Y))).style("stroke","#555555").style("shape-rendering","crispEdges")},epiviz.plugins.charts.GenesTrackType=function(t){epiviz.ui.charts.TrackType.call(this,t)},epiviz.plugins.charts.GenesTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype),epiviz.plugins.charts.GenesTrackType.constructor=epiviz.plugins.charts.GenesTrackType,epiviz.plugins.charts.GenesTrackType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.GenesTrack(t,e,i)},epiviz.plugins.charts.GenesTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.GenesTrack"},epiviz.plugins.charts.GenesTrackType.prototype.chartName=function(){return"Genes Track"},epiviz.plugins.charts.GenesTrackType.prototype.chartHtmlAttributeName=function(){return"genes"},epiviz.plugins.charts.GenesTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0},epiviz.plugins.charts.GenesTrackType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.RANGE}},epiviz.ui.charts.transform={},epiviz.ui.charts.transform.clustering={},epiviz.ui.charts.transform.clustering.ClusterSubtree=function(t,e){this._children=t,this._weight=null,this._distance=e,this._sorted=!1},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.weight=function(){if(null==this._weight){for(var t=0,e=0;e<this._children.length;++e)t+=this._children[e].weight();this._weight=t}return this._weight},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.children=function(){return this._children},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.data=function(){for(var t=[],e=0;e<this._children.length;++e)t=t.concat(this._children[e].data());return t},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.sort=function(t){if(!this.sorted()&&(this._children.sort(function(t,e){return t.weight()-e.weight()}),t)){for(var e=0;e<this._children.length;++e)this._children[e].sort(t);this._sorted=!0}},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.copy=function(){for(var t=[],e=0;e<this._children.length;++e)t.push(this._children[e].copy());return new epiviz.ui.charts.transform.clustering.ClusterSubtree(t)},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.distance=function(){return this._distance},epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.sorted=function(){return this._sorted},epiviz.ui.charts.transform.clustering.ClusterLeaf=function(t){this._dataIndex=t},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.weight=function(){return 1},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.children=function(){return[]},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.data=function(){return[this._dataIndex]},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.sort=function(){},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.copy=function(){return new epiviz.ui.charts.transform.clustering.ClusterLeaf(this._dataIndex)},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.distance=function(){return 0},epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.sorted=function(){return!0},epiviz.ui.charts.transform.clustering.ClusterTree=function(t,e){this._root=t,this._data=e},epiviz.ui.charts.transform.clustering.ClusterTree.prototype.root=function(){return this._root},epiviz.ui.charts.transform.clustering.ClusterTree.prototype.orderedData=function(){this._root.sorted()||this._root.sort(!0);for(var t=this._root.data(),e=[],i=0;i<t.length;++i)e.push(this._data[t[i]]);return e},epiviz.ui.charts.transform.clustering.NoneClustering=function(){},epiviz.ui.charts.transform.clustering.NoneClustering.prototype.cluster=function(t,e,i){for(e=[],i=0;i<t.length;++i)e.push(new epiviz.ui.charts.transform.clustering.ClusterLeaf(i));return e=new epiviz.ui.charts.transform.clustering.ClusterSubtree(e,0),new epiviz.ui.charts.transform.clustering.ClusterTree(e,t)},epiviz.ui.charts.transform.clustering.NoneClustering.prototype.id=function(){return"none"},epiviz.ui.charts.transform.clustering.AgglomerativeClustering=function(){},epiviz.ui.charts.transform.clustering.AgglomerativeClustering.prototype.cluster=function(t,e,i){var n,r,a=Array(t.length);for(n=0;n<t.length;++n)for(a[n]=Array(t.length),r=n+1;r<t.length;++r)a[n][r]=e.distance(t[n],t[r]);for(e=[],n=0;n<t.length;++n)e.push(new epiviz.ui.charts.transform.clustering.ClusterLeaf(n));for(;1<e.length;){if(n=(r=epiviz.utils.indexOfMin(a,!0)).index,r=new epiviz.ui.charts.transform.clustering.ClusterSubtree([e[n[0]],e[n[1]]],r.min),n[0]<n[1]){var o=n[0];n[0]=n[1],n[1]=o}e.splice(n[0],1),e.splice(n[1],1),e.push(r),a=i.link(a,n)}return new epiviz.ui.charts.transform.clustering.ClusterTree(e[0],t)},epiviz.ui.charts.transform.clustering.AgglomerativeClustering.prototype.id=function(){return"agglomerative"},epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm=function(){},epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.prototype.cluster=function(t,e,i){},epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.prototype.id=function(){},epiviz.ui.charts.transform.clustering.EuclideanMetric=function(){},epiviz.ui.charts.transform.clustering.EuclideanMetric.prototype.distance=function(t,e){if(null==t||null==e)return null;var i,n=t.length,r=0,a=0,o=0;for(i=0;i<n;++i)if(null!=t[i]&&null!=e[i]){++r;var s=t[i]-e[i];a=a+s,o=o+s*s}return 0<r&&(a/=r),o+(n-r)*a*a},epiviz.ui.charts.transform.clustering.EuclideanMetric.prototype.id=function(){return"euclidean"},epiviz.ui.charts.transform.clustering.CompleteLinkage=function(){},epiviz.ui.charts.transform.clustering.CompleteLinkage.prototype.link=function(t,e){var i=Array(t.length-1);if(e[0]<e[1]){var n=e[0];e[0]=e[1],e[1]=n}for(var r=n=0;n<t.length;++n,++r)if(n==e[0]||n==e[1])--r;else{i[r]=t[n].slice(0),i[r].splice(e[0],1),i[r].splice(e[1],1);var a=[n<e[0]?t[n][e[0]]:t[e[0]][n],n<e[1]?t[n][e[1]]:t[e[1]][n]];i[r].push(Math.max(a[0],a[1]))}return i[i.length-1]=Array(i.length),i},epiviz.ui.charts.transform.clustering.CompleteLinkage.prototype.id=function(){return"complete"},epiviz.ui.charts.transform.clustering.ClusteringLinkage=function(){},epiviz.ui.charts.transform.clustering.ClusteringLinkage.prototype.link=function(t,e){},epiviz.ui.charts.transform.clustering.ClusteringLinkage.prototype.id=function(){},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory=function(t){var e;for(this._config=t,this._algorithms={},this._metrics={},this._linkages={},e=0;e<t.clustering.algorithms.length;++e){var i=epiviz.utils.evaluateFullyQualifiedTypeName(t.clustering.algorithms[e]);i=epiviz.utils.applyConstructor(i);this._algorithms[i.id()]=i}for(e=0;e<t.clustering.metrics.length;++e)i=epiviz.utils.evaluateFullyQualifiedTypeName(t.clustering.metrics[e]),i=epiviz.utils.applyConstructor(i),this._metrics[i.id()]=i;for(e=0;e<t.clustering.linkages.length;++e)i=epiviz.utils.evaluateFullyQualifiedTypeName(t.clustering.linkages[e]),i=epiviz.utils.applyConstructor(i),this._linkages[i.id()]=i},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance=null,epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance=function(){return epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.initialize=function(t){epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance=new epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory(t)},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.algorithm=function(t){return this._algorithms[t]},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.metric=function(t){return this._metrics[t]},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.linkage=function(t){return this._linkages[t]},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.algorithms=function(){return Object.keys(this._algorithms)},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.metrics=function(){return Object.keys(this._metrics)},epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.linkages=function(){return Object.keys(this._linkages)},epiviz.plugins.charts.HeatmapPlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._chartContent=null,this._min=this.measurements().first().minValue(),this._max=this.measurements().first().maxValue(),this._colorScale=epiviz.utils.colorizeBinary(this._min,this._max,"#ffffff",this.colors().getByKey("Max")),this._colorLabels=[],this._dendrogramRatio=.1,this._initialize()},epiviz.plugins.charts.HeatmapPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.HeatmapPlot.constructor=epiviz.plugins.charts.HeatmapPlot,epiviz.plugins.charts.HeatmapPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("heatmap-plot",!0),this._chartContent=this._svg.append("g").attr("class","chart-content")},epiviz.plugins.charts.HeatmapPlot.prototype.draw=function(t,e){if(epiviz.ui.charts.Plot.prototype.draw.call(this,t,e),e=this._lastData,t=this._lastRange,!e||!t)return[];this.customSettingsValues();var i=this._applyClustering(t,e);return this._drawCells(t,i.data,i.columnOrder)},epiviz.plugins.charts.HeatmapPlot.prototype._applyClustering=function(t,e){var i=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type()),n=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER],r=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM],a=(y=epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance()).algorithm(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_ALG]),o=y.metric(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_METRIC]),s=y.linkage(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_LINKAGE]),u=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS],c=e.firstSeries().globalStartIndex(),l=e.firstSeries().size()+c;e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>c&&(c=i),n<l&&(l=n)});var p,h,d,f,v,g,m=l-c,y=n==epiviz.plugins.charts.HeatmapPlotType.Cluster.ROWS||n==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,_=n==epiviz.plugins.charts.HeatmapPlotType.Cluster.COLS||n==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,z=(n=r*this._dendrogramRatio,u=r&&_&&u>=m,this._svg);["dendrogram-horizontal","dendrogram-vertical"].forEach(function(t){z.select("."+t).remove()});var b=e;if(y){p=[],e.foreach(function(e,n){for(var r=[],a=0;a<m;++a){var o=n.getByGlobalIndex(a+c),s=o.rowItem;(!i||null==t.start()||null==t.end()||s.start()<t.end()&&s.end()>=t.start())&&r.push(o.value)}p.push(r)}),h=(r=a.cluster(p,o,s)).root().data();var w=[];for(e.foreach(function(t){w.push(t)}),d=[],f=0;f<h.length;++f)d[f]=w[h[f]];for(h=new epiviz.measurements.MeasurementHashtable,f=0;f<d.length;++f)h.put(d[f],e.getSeries(d[f]));b=new epiviz.datatypes.MapGenomicData(h),n&&(g=this.width()*n,v=this.height()*(1-n*u)-this.margins().sumAxis(epiviz.ui.charts.Axis.Y),d=this.margins().top(),f=this.width()-g-this.margins().right(),this._drawDendrogram(r,d,f,v,g))}if(h=null,_){if(p=[],e.foreach(function(e,n){for(var r=0,a=0;r<m;++r){var o=n.getByGlobalIndex(r+c),s=o.rowItem;(!i||null==t.start()||null==t.end()||s.start()<t.end()&&s.end()>=t.start())&&(p.length<=a&&p.push([]),p[a].push(o.value),++a)}}),0==p.length)return{data:b,columnOrder:[]};h=(r=a.cluster(p,o,s)).root().data(),u&&(a=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS]?20:0,f=this.margins().left(),d=this.height()*(1-n)-this.margins().bottom(),g=this.height()*n,v=this.width()*(1-n*y)-this.margins().left()-this.margins().right()-a,this._drawDendrogram(r,d,f,v,g,!0))}return{data:b,columnOrder:h}},epiviz.plugins.charts.HeatmapPlot.prototype._drawCells=function(t,e,i){var n=this,r=epiviz.ui.charts.Axis,a=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS],o=e.firstSeries().globalStartIndex(),s=e.firstSeries().size()+o,u=[],c=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type());e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>o&&(o=i),n<s&&(s=n),u.push(t)});var l,p=s-o,h=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],d=(f=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER])==epiviz.plugins.charts.HeatmapPlotType.Cluster.ROWS||f==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,f=(f==epiviz.plugins.charts.HeatmapPlotType.Cluster.COLS||f==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH)&&a>=p,v=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM]*this._dendrogramRatio,g=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS]?20:0,m=(d=this.width()*(1-v*d)-g,f=this.height()*(1-v*f),[]),y=[];for(v=0;v<p;++v){var _;l=v+o,e.foreach(function(t,e){return _=e.getRowByGlobalIndex(l)}),_&&(!c||null==t.start()||null==t.end()||_.start()<t.end()&&_.end()>=t.start())&&(m.push(l),g=_.metadata(h)||""+_.id(),y.push(g))}if(i)for(t=m,c=y,m=Array(m.length),y=Array(y.length),v=0;v<m.length;++v)m[v]=t[i[v]],y[v]=c[i[v]];var z,b=[],w={};if(e.foreach(function(t,e,i){for(var n,r=0,o=a,s=0;s<y.length;++s)if(l=m[s],n=e.getByGlobalIndex(l)){var u;0==r?(r=sprintf("item data-series-%s",i),u=new epiviz.ui.charts.ChartObject(sprintf("heatmap_%s_%s",i,l),n.rowItem.start(),n.rowItem.end(),[n.value],i,[[n]],[t],r,n.rowItem.seqName()),b.push(u),r=n=Math.ceil((y.length-s)/o),--o):((u=b[b.length-1]).id+="_"+l,epiviz.measurements.Measurement.Type.isOrdered(e.measurement().type())&&(u.start=Math.min(u.start,n.rowItem.start()),u.end=Math.max(u.end,n.rowItem.end())),u.values[0]=(u.values[0]*u.valueItems[0].length+n.value)/(u.valueItems[0].length+1),u.valueItems[0].push(n)),0==i&&(w[l]=b.length-1),--r}}),this._min=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],this._max=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],i=epiviz.ui.charts.CustomSetting,this._min==i.DEFAULT&&(this._min=e.measurements()[0].minValue()),this._max==i.DEFAULT&&(this._max=e.measurements()[0].maxValue()),this._globalIndexColorLabels){for(i={},t=o;t<s;++t)i[this._globalIndexColorLabels[t]]=this._globalIndexColorLabels[t];this._colorLabels=Object.keys(i),z={},this._colorLabels.forEach(function(t,e){var i=n.colors().getByKey(t);z[t]=epiviz.utils.colorizeBinary(n._min,n._max,"#ffffff",i)})}else this._colorLabels=[sprintf("Max",e.firstSeries().measurement().maxValue())],this._colorScale=epiviz.utils.colorizeBinary(this._min,this._max,"#ffffff",this.colors().getByKey("Max"));var C=(i=Math.min(y.length,a))?(d-this.margins().sumAxis(r.X))/i:0,S=(f-this.margins().sumAxis(r.Y))/e.measurements().length;return(e=this._chartContent.select(".items")).empty()&&(r=(e=this._chartContent.append("g").attr("class","items")).append("g").attr("class","selected"),e.append("g").attr("class","hovered"),r.append("g").attr("class","hovered")),e.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"),(r=e.selectAll("rect").data(b,function(t){return t.id})).enter().append("rect").attr("id",function(t){return sprintf("%s-item-%s-%s",n.id(),t.seriesIndex,t.valueItems[0][0].globalIndex)}).attr("class",function(t){return t.cssClasses}).style("opacity",0).style("fill-opacity",0).attr("x",function(t){return C*w[t.valueItems[0][0].globalIndex]}).attr("y",function(t){return S*t.seriesIndex}).attr("width",C).attr("height",S).style("fill",function(t,e){return n._globalIndexColorLabels?z[n._globalIndexColorLabels[t.valueItems[0][0].globalIndex]](t.values[0]):n._colorScale(t.values[0])}),r.transition().duration(1e3).style("fill-opacity",null).style("opacity",null).attr("x",function(t){return C*w[t.valueItems[0][0].globalIndex]}).attr("y",function(t){return S*t.seriesIndex}).attr("width",C).attr("height",S).style("fill",function(t){return n._globalIndexColorLabels?z[n._globalIndexColorLabels[t.valueItems[0][0].globalIndex]](t.values[0]):n._colorScale(t.values[0])}),r.exit().transition().duration(1e3).style("opacity",0).remove(),r.on("mouseover",function(t){n._hover.notify(new epiviz.ui.charts.VisEventArgs(n.id(),t))}).on("mouseout",function(){n._unhover.notify(new epiviz.ui.charts.VisEventArgs(n.id()))}).on("click",function(t){n._deselect.notify(new epiviz.ui.charts.VisEventArgs(n.id())),n._select.notify(new epiviz.ui.charts.VisEventArgs(n.id(),t)),d3.event.stopPropagation()}),this._drawLabels(e,y,m,i,u,C,S,o,d),b},epiviz.plugins.charts.HeatmapPlot.prototype._drawDendrogram=function(t,e,i,n,r,a){var o=a?"dendrogram-horizontal":"dendrogram-vertical",s=this._svg.append("g").attr("class",o);a?s.attr("transform","translate("+i+","+e+")scale(-1, 1)rotate(90, 0, 0)"):s.attr("transform","translate("+i+","+e+")"),this._drawSubDendrogram(this._svg.select("."+o),t.root(),0,0,r,n,!1)},epiviz.plugins.charts.HeatmapPlot.prototype._drawSubDendrogram=function(t,e,i,n,r,a,o){var s=e.children();if(0==s.length)return i+.5*a;for(var u,c,l=d3.scale.linear().domain([0,e.distance()]).range([0,r]),p=0,h=0;h<s.length;++h){var d=i+p,f=a/e.weight()*s[h].weight(),v=l(s[h].distance());d=this._drawSubDendrogram(t,s[h],d,n,v,f,o);t.append("line").attr("x1",n+v).attr("x2",n+r).attr("y1",d).attr("y2",d).style("stroke","#555555").style("stroke-width",1).style("shape-rendering","auto"),0==h&&o&&t.append("text").attr("class","row-text").attr("x",Math.max(n+10,n+.5*(v+r))).attr("y",d-10).style("text-anchor","middle").text(Globalize.format(e.distance(),"n2")),(null==u||u>d)&&(u=d),(null==c||c<d)&&(c=d),p+=a/e.weight()*s[h].weight()}return t.append("line").attr("x1",n+r).attr("x2",n+r).attr("y1",u).attr("y2",c).style("stroke","#555555").style("stroke-width",1).style("shape-rendering","auto"),.5*(u+c)},epiviz.plugins.charts.HeatmapPlot.prototype._drawLabels=function(t,e,i,n,r,a,o,s,u){var c=this,l=function(t){return t="name"==f?t.name():(t=t.annotation())&&f in t?t[f]:"<NA>",v[t]=t},p=t.selectAll(".col-text"),h=0;e.length>n?p.transition().duration(500).style("opacity",0).remove():((p=p.data(e,function(t,e){return t+i[e]})).enter().append("text").attr("class","col-text").style("opacity","0").attr("x",0).attr("y",0).attr("transform",function(t,e){return"translate("+(e*a+.5*a)+",-5)rotate(-60)"}).text(function(t){return t}),p.transition().duration(500).attr("x",0).attr("y",0).attr("transform",function(t,e){return"translate("+(e*a+.5*a)+",-5)rotate(-60)"}).style("opacity",null).attr("fill",function(t,e){var i=e+s;return c._globalIndexColorLabels?c.colors().getByKey(c._globalIndexColorLabels[i]):"#000000"}),p.exit().transition().duration(500).style("opacity",0).remove(),this._container.find(" .col-text").each(function(t){t=this.getBBox().width,h<t&&(h=t)}));var d,f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];if((e=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS])||(t.selectAll(".row-color-label").remove(),(n=t.selectAll(".row-text").data(r,function(t){return t.id()})).enter().append("text").attr("class","row-text").attr("x",0).attr("y",0).attr("transform",function(t,e){return"translate(-5,"+(e*o+.5*o)+")rotate(30)"}),n.text(function(t){return"name"==f?t.name():(t=t.annotation())&&f in t?t[f]:"<NA>"}),n.transition().duration(500).attr("x",0).attr("y",0).attr("transform",function(t,e){return"translate(-5,"+(e*o+.5*o)+")rotate(30)"}),n.exit().remove()),e){t.selectAll(".row-text").remove();var v={};r.forEach(function(t){t=l(t),v[t]=t}),d=Object.keys(v),(t=t.selectAll(".row-color-label").data(r,function(t){return t.id()})).enter().append("rect").attr("class","row-color-label").attr("x",u-c.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y",.5*-o).attr("width",20).attr("height",o).attr("transform",function(t,e){return"translate(0,"+(e*o+.5*o)+")"}),t.style("fill",function(t){return t=l(t),c.colors().getByKey(t)}),t.transition().duration(500).attr("x",u-c.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y",.5*-o).attr("height",o).attr("transform",function(t,e){return"translate(0,"+(e*o+.5*o)+")"}),t.exit().remove()}this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(u=this._svg.selectAll(".chart-title").data(["Min"].concat(this._colorLabels))).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",c.margins().top()-5-h),u.attr("fill",function(t,e){return 0==e?"#000000":c.colors().getByKey(t)}).text(function(t){return t});var g=0,m=[];this._container.find(" .chart-title").each(function(t){m.push(g),g+=this.getBBox().width+15}),u.attr("x",function(t,e){return c.margins().left()+10+m[e]}),this._svg.selectAll(".chart-title-color").data(["Min"].concat(this._colorLabels)).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return c.margins().left()+4+m[e]}).attr("cy",c.margins().top()-9-h).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t,e){return 0==e?"#ffffff":c.colors().getByKey(t)}).style("stroke-width",function(t,e){return e?0:1}).style("stroke","#000000"),this._svg.selectAll(".row-legend").remove(),this._svg.selectAll(".row-legend-color").remove(),e&&((u=this._svg.selectAll(".row-legend").data(d)).enter().append("text").attr("class","row-legend").attr("font-weight","bold").attr("x",-20),u.attr("fill",function(t){return c.colors().getByKey(t)}).text(function(t){return t}).attr("transform",function(t,e){return"translate("+c.margins().left()+","+c.margins().top()+")"}),u.attr("y",function(t,e){return 10+15*e}),this._svg.selectAll(".row-legend-color").data(d).enter().append("rect").attr("class","chart-title-color").attr("x",-18).attr("y",function(t,e){return 2+15*e}).attr("width",10).attr("height",10).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t){return c.colors().getByKey(t)}).style("stroke-width",0).attr("transform",function(t,e){return"translate("+c.margins().left()+","+c.margins().top()+")"}),this._colorLabels=this._colorLabels.concat(d))},epiviz.plugins.charts.HeatmapPlot.prototype.colorLabels=function(){return this._colorLabels},epiviz.plugins.charts.HeatmapPlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.HeatmapPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.HeatmapPlotType.constructor=epiviz.plugins.charts.HeatmapPlotType,epiviz.plugins.charts.HeatmapPlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.HeatmapPlot(t,e,i)},epiviz.plugins.charts.HeatmapPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.HeatmapPlot"},epiviz.plugins.charts.HeatmapPlotType.prototype.chartName=function(){return"Heatmap"},epiviz.plugins.charts.HeatmapPlotType.prototype.chartHtmlAttributeName=function(){return"heatmap"},epiviz.plugins.charts.HeatmapPlotType.prototype.measurementsFilter=function(){return function(t){return epiviz.measurements.Measurement.Type.hasValues(t.type())}},epiviz.plugins.charts.HeatmapPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.HeatmapPlotType.prototype.customSettingsDefs=function(){var t=epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance();return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Columns labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Row labels"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Row labels as colors"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS,epiviz.ui.charts.CustomSetting.Type.NUMBER,40,"Max columns"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Value"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Value"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"rows","Cluster",Object.keys(epiviz.plugins.charts.HeatmapPlotType.Cluster).map(function(t){return epiviz.plugins.charts.HeatmapPlotType.Cluster[t]})),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_ALG,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,t.algorithms()[0],"Clustering Algorithm",t.algorithms()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_METRIC,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,t.metrics()[0],"Clustering Metric",t.metrics()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_LINKAGE,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,t.linkages()[0],"Clustering Linkage",t.linkages()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show Dendrogram")])},epiviz.plugins.charts.HeatmapPlotType.Cluster={NONE:"none",ROWS:"rows",COLS:"columns",BOTH:"both"},epiviz.plugins.charts.HeatmapPlotType.CustomSettings={MAX_COLUMNS:"maxColumns",CLUSTER:"cluster",CLUSTERING_ALG:"clusteringAlg",CLUSTERING_METRIC:"clusteringMetric",CLUSTERING_LINKAGE:"clusteringLinkage",SHOW_DENDROGRAM:"showDendrogram",SHOW_COLORS_FOR_ROW_LABELS:"showColorsForRowLabels"},epiviz.plugins.charts.LinePlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.LinePlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.LinePlot.constructor=epiviz.plugins.charts.LinePlot,epiviz.plugins.charts.LinePlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("line-plot",!0)},epiviz.plugins.charts.LinePlot.prototype.draw=function(t,e,i,n){if(epiviz.ui.charts.Plot.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,!e||!t)return[];i=epiviz.ui.charts.CustomSetting;var r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],a=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],o=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];if(r==i.DEFAULT&&(r=null,e.measurements().forEach(function(t){null!==t&&(null===r||t.minValue()<r)&&(r=t.minValue())})),a==i.DEFAULT&&(a=null,e.measurements().forEach(function(t){null!==t&&(null===a||t.maxValue()>a)&&(a=t.maxValue())})),null===r&&null===a&&(r=-1,a=1),null===r&&(r=a-1),null===a&&(a=r+1),n=epiviz.ui.charts.Axis,i=d3.scale.linear().domain([0,e.measurements().length-1]).range([0,this.width()-this.margins().sumAxis(n.X)]),n=d3.scale.linear().domain([r,a]).range([this.height()-this.margins().sumAxis(n.Y),0]),this._clearAxes(),this._drawAxes(i,n,e.measurements().length,5,void 0,void 0,void 0,void 0,void 0,void 0,e.measurements().map(function(t){return"name"==o?t.name():(t=t.annotation())&&o in t?t[o]:"<NA>"})),(s=this._svg.selectAll(".lines")).empty()){var s,u=(s=this._svg.append("g").attr("class","lines items")).append("g").attr("class","selected");s.append("g").attr("class","hovered"),u.append("g").attr("class","hovered")}return s.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"),this._drawLines(t,e,i,n)},epiviz.plugins.charts.LinePlot.prototype._drawLines=function(t,e,i,n){var r=this.colors(),a=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_POINTS],o=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_LINES],s=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_ERROR_BARS],u=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.POINT_RADIUS],c=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.LINE_THICKNESS],l=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.INTERPOLATION],p=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],h=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.ABS_LINE_VAL],d=this,f=this._svg.select(".lines"),v=e.firstSeries().globalStartIndex(),g=e.firstSeries().globalEndIndex();e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>v&&(v=i),n<g&&(g=n)});for(var m,y,_=g-v,z=epiviz.measurements.Measurement.Type.isOrdered(e.measurements()[0].type()),b=0;b<_;++b){var w=b+v,C=e.firstSeries().getRowByGlobalIndex(w);(!z||null==t.start()||null==t.end()||C.start()<t.end()&&C.end()>=t.start())&&(null==m&&(m=w),y=w+1)}v=m,g=y,_=y-m,this.width();var S,x=d3.svg.line().x(function(t){return i(t.x)}).y(function(t){return n(t.y)}).interpolate(l),M=function(t){return d._globalIndexColorLabels?d._globalIndexColorLabels[t.globalIndex()]:t.metadata(p)};t=epiviz.utils.range(_,v),o?(S=t.map(function(t){var i=e.firstSeries().getRowByGlobalIndex(t);return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",t),i.start(),i.end(),function(t){return e.measurements().map(function(i,n){var r=e.getByGlobalIndex(i,t);return{x:n,y:r?r.value:null,errMinus:r&&r.valueAnnotation?r.valueAnnotation.errMinus:null,errPlus:r&&r.valueAnnotation?r.valueAnnotation.errPlus:null}}).filter(function(t){return null!==t.y})}(t),t,e.measurements().map(function(i,n){return[e.getByGlobalIndex(i,t)]}),e.measurements(),"",i.seqName())}),(o=f.selectAll(".line-series").data(S,function(t){return t.id})).enter().insert("g",":first-child").attr("class","line-series item").style("opacity","0").on("mouseover",function(t){d._hover.notify(new epiviz.ui.charts.VisEventArgs(d.id(),t))}).on("mouseout",function(){d._unhover.notify(new epiviz.ui.charts.VisEventArgs(d.id()))}).each(function(t){d3.select(this).append("path").attr("class","bg-line").attr("d",x(t.values)).style("shape-rendering","auto").style("stroke-width",10).style("stroke","#dddddd").style("stroke-opacity","0.1"),d3.select(this).append("path").attr("class","main-line").attr("d",x(t.values)).style("shape-rendering","auto")}),o.transition().duration(500).style("opacity","0.7").each(function(t){var i=r.getByKey(M(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)));d3.select(this).selectAll(".bg-line").attr("d",x(t.values)),d3.select(this).selectAll(".main-line").attr("d",x(t.values)).style("stroke",i).style("stroke-width",c)}),o.exit().transition().duration(500).style("opacity","0").remove()):f.selectAll(".line-series").remove(),a?((a=f.selectAll(".points").data(S,function(t){return t.id})).enter().append("g").attr("class","points").style("opacity","0"),a.each(function(t){d3.select(this).selectAll(".data-point").remove();var a=d3.select(this).selectAll(".data-point").data(t.values);a.enter().append("g").attr("class","data-point").each(function(a){d3.select(this).append("circle").attr("cx",function(t){return i(t.x)}).attr("cy",function(t){return n(t.y)}).attr("r",u).style("stroke-width",2).attr("fill","none").attr("stroke",r.getByKey(M(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))),d3.select(this).selectAll(".error-bar").remove(),s&&null!=a.errMinus&&null!=a.errPlus&&(d3.select(this).append("line").attr("x1",i(a.x)).attr("x2",i(a.x)).attr("y1",n(a.errMinus)).attr("y2",n(a.errPlus)).style("stroke",r.getByKey(M(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"),d3.select(this).append("line").attr("x1",i(a.x)-4).attr("x2",i(a.x)+4).attr("y1",n(a.errMinus)).attr("y2",n(a.errMinus)).style("stroke",r.getByKey(M(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"),d3.select(this).append("line").attr("x1",i(a.x)-4).attr("x2",i(a.x)+4).attr("y1",n(a.errPlus)).attr("y2",n(a.errPlus)).style("stroke",r.getByKey(M(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"))}),a.exit().remove()}).transition().duration(500).style("opacity","1"),a.exit().transition().duration(500).style("opacity","0").remove()):f.selectAll(".points").remove();var T={};t.forEach(function(t){t=M(e.firstSeries().getRowByGlobalIndex(t)),T[t]=t}),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color").remove(),(a=this._svg.selectAll(".chart-title").data(Object.keys(T))).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",d.margins().top()-5),a.attr("fill",function(t){return r.getByKey(t)}).text(function(t){return t});var k=0,E=[];return this._container.find(" .chart-title").each(function(t){E.push(k),k+=this.getBBox().width+15}),a.attr("x",function(t,e){return d.margins().left()+10+E[e]}),this._svg.selectAll(".chart-title-color").data(Object.keys(T)).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return d.margins().left()+4+E[e]}).attr("cy",d.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t){return r.getByKey(t)}),h!=epiviz.ui.charts.CustomSetting.DEFAULT&&(f.selectAll(".abLine").remove(),f.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",d.width()-d.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",n(h)).attr("y2",n(h)).style("stroke","black").style("stroke-dasharray","5, 5")),S},epiviz.plugins.charts.LinePlot.prototype.colorLabels=function(){for(var t=[],e=0;e<this.colors().size()&&20>e;++e)t.push("Color "+(e+1));return t},epiviz.plugins.charts.LinePlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.LinePlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.LinePlotType.constructor=epiviz.plugins.charts.LinePlotType,epiviz.plugins.charts.LinePlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.LinePlot(t,e,i)},epiviz.plugins.charts.LinePlotType.prototype.typeName=function(){return"epiviz.plugins.charts.LinePlot"},epiviz.plugins.charts.LinePlotType.prototype.chartName=function(){return"Line Plot"},epiviz.plugins.charts.LinePlotType.prototype.chartHtmlAttributeName=function(){return"line-plot"},epiviz.plugins.charts.LinePlotType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.FEATURE}},epiviz.plugins.charts.LinePlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.LinePlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Columns labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Row labels"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_POINTS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Show points"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_LINES,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show lines"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_ERROR_BARS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show error bars"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.POINT_RADIUS,epiviz.ui.charts.CustomSetting.Type.NUMBER,4,"Point radius"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.LINE_THICKNESS,epiviz.ui.charts.CustomSetting.Type.NUMBER,3,"Line thickness"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"basis","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])},epiviz.plugins.charts.LinePlotType.CustomSettings={SHOW_POINTS:"showPoints",SHOW_ERROR_BARS:"showErrorBars",SHOW_LINES:"showLines",POINT_RADIUS:"pointRadius",LINE_THICKNESS:"lineThickness",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"},epiviz.plugins.charts.StackedLinePlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._initialize()},epiviz.plugins.charts.StackedLinePlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.StackedLinePlot.constructor=epiviz.plugins.charts.StackedLinePlot,epiviz.plugins.charts.StackedLinePlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("stacked-line-plot",!0)},epiviz.plugins.charts.StackedLinePlot.prototype.draw=function(t,e,i,n){if(epiviz.ui.charts.Plot.prototype.draw.call(this,t,e,i,n),e=this._lastData,t=this._lastRange,!e||!t)return[];e=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.ROW_GROUP_BY];var r=this,a=function(){for(var t=0;t<r._markers.length;t++)if(r._markers[t]._type==epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS){var e=r._markers[t].id();delete r._markersMap[e],delete r._markersIndices[e],delete r._markers[t],r._markers.length--}};t=function(t){if(!t)return null;var e;if(t.id()in r._markersMap){e=r._markersIndices[t.id()];var i=r._markers[e];if(i==t||i.type()==t.type()&&i.preMarkStr()==t.preMarkStr()&&i.markStr()==t.markStr())return null;r._markers[e]=t}else a(),e=r._markers.length,r._markers.push(t),r._markersIndices[t.id()]=e;r._markersMap[t.id()]=t},this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.USE_GROUP_BY]?t(e=new epiviz.ui.charts.markers.VisualizationMarker(epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS,null,null,"function(data){return null}","function(m, data, preMarkResult) {return m.annotation()['"+e+"'];}")):a(),r.transformData(r._lastRange,r._unalteredData).done(function(){r._drawPlot(r._lastRange,r._lastData,i,n)}),r._markersModified.notify(new epiviz.ui.charts.VisEventArgs(r._id,r._markers))},epiviz.plugins.charts.StackedLinePlot.prototype._drawPlot=function(t,e,i,n){var r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];n=0==(i=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION]).indexOf("step")?e.measurements().length:e.measurements().length-1;var a=epiviz.ui.charts.Axis;return n=d3.scale.linear().domain([0,n]).range([0,this.width()-this.margins().sumAxis(a.X)]),this._clearAxes(),this._drawAxes(n,void 0,e.measurements().length,5,void 0,void 0,void 0,void 0,void 0,void 0,e.measurements().map(function(t){return"name"==r?t.name():(t=t.annotation())&&r in t?t[r]:"<NA>"}),void 0,0==i.indexOf("step")),(i=this._svg.selectAll(".lines")).empty()&&(a=(i=this._svg.append("g").attr("class","lines items")).append("g").attr("class","selected"),i.append("g").attr("class","hovered"),a.append("g").attr("class","hovered")),i.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"),this._drawLines(t,e,n)},epiviz.plugins.charts.StackedLinePlot.prototype._drawLines=function(t,e,i){var n=epiviz.ui.charts.Axis,r=this.colors(),a=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION],o=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],s=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.OFFSET],u=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.SCALE_TO_PERCENT],c=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.HOVER_OPACITY],l=this,p=this._svg.select(".lines"),h=e.firstSeries().globalStartIndex(),d=e.firstSeries().globalEndIndex();e.foreach(function(t,e){var i=e.globalStartIndex(),n=e.globalEndIndex();i>h&&(h=i),n<d&&(d=n)});for(var f,v,g=d-h,m=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type()),y=0;y<g;++y){var _=y+h,z=e.firstSeries().getRowByGlobalIndex(_);z&&(!m||null==t.start()||null==t.end()||z.start()<t.end()&&z.end()>=t.start())&&(null==f&&(f=_),v=_+1)}h=f,d=v;var b=epiviz.utils.range(v-f,h);if(0==b.length)return[];var w=null;u&&(w=new epiviz.measurements.MeasurementHashtable,e.measurements().forEach(function(t){var i=b.filter(function(i){return e.getByGlobalIndex(t,i)}).map(function(i){return e.getByGlobalIndex(t,i).value}).reduce(function(t,e){return t+e});w.put(t,i)}));var C=function(t){return l._globalIndexColorLabels?l._globalIndexColorLabels[t.globalIndex()]:t.metadata(o)},S=function(t){var i=[];"step-before"==a&&i.push({x:0,y:0});var n=e.measurements();i=i.concat(n.map(function(n,r){var a=(a=u?w.get(n):1)||1,o=e.getByGlobalIndex(n,t);return{x:i.length+r,y:o?o.value/a:null}}));return"step-after"==a&&i.push({x:i.length,y:0}),i.filter(function(t){return null!==t.y})};t=b.filter(function(t){return e.firstSeries().getRowByGlobalIndex(t)}).map(function(t){var i=e.firstSeries().getRowByGlobalIndex(t),n=e.measurements();return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",t),i.start(),i.end(),S(t),t,n.map(function(i,n){return[e.getByGlobalIndex(i,t)]}),n,"",i.seqName())});g=b.map(function(t){return S(t)});var x=d3.layout.stack().offset(s)(g),M=d3.scale.linear().domain([Math.min(0,d3.min(x,function(t){return d3.min(t,function(t){return t.y0+t.y})})),d3.max(x,function(t){return d3.max(t,function(t){return t.y0+t.y})})]).range([this.height()-this.margins().sumAxis(n.Y),0]),T=d3.svg.area().x(function(t){return i(t.x)}).y0(function(t){return M(t.y0)}).y1(function(t){return M(t.y0+t.y)}).interpolate(a);(n=p.selectAll(".line-series").data(t,function(t){return t.seriesIndex})).enter().insert("path",":first-child").attr("class","line-series item").attr("d",function(t,e){return T(x[e])}).style("opacity","0").style("shape-rendering","auto").style("fill",function(t,i){return r.getByKey(C(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))}).on("mouseover",function(t,e){l._hover.notify(new epiviz.ui.charts.VisEventArgs(l.id(),t)),p.selectAll(".item").style("opacity",1-c),p.selectAll(".hovered .item").style("opacity",c)}).on("mouseout",function(){l._unhover.notify(new epiviz.ui.charts.VisEventArgs(l.id()))}),n.transition().duration(500).style("opacity","0.7").attr("d",function(t,e){return T(x[e])}).style("fill",function(t,i){return r.getByKey(C(e.firstSeries().getRowByGlobalIndex(t.seriesIndex)))}),n.exit().transition().duration(500).style("opacity","0").remove();var k={};b.forEach(function(t){e.firstSeries().getByGlobalIndex(t)&&(t=C(e.firstSeries().getRowByGlobalIndex(t)),k[t]=t)}),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(n=this._svg.selectAll(".chart-title").data(Object.keys(k))).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",l.margins().top()-5),n.attr("fill",function(t){return r.getByKey(t)}).text(function(t){return t});var E=0,A=[];return this._container.find(" .chart-title").each(function(t){A.push(E),E+=this.getBBox().width+15}),n.attr("x",function(t,e){return l.margins().left()+10+A[e]}),this._svg.selectAll(".chart-title-color").data(Object.keys(k)).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return l.margins().left()+4+A[e]}).attr("cy",l.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t){return r.getByKey(t)}),t},epiviz.plugins.charts.StackedLinePlot.prototype.colorLabels=function(){for(var t=[],e=0;e<this.colors().size()&&20>e;++e)t.push("Color "+(e+1));return t},epiviz.plugins.charts.StackedLinePlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.StackedLinePlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.StackedLinePlotType.constructor=epiviz.plugins.charts.StackedLinePlotType,epiviz.plugins.charts.StackedLinePlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.StackedLinePlot(t,e,i)},epiviz.plugins.charts.StackedLinePlotType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedLinePlot"},epiviz.plugins.charts.StackedLinePlotType.prototype.chartName=function(){return"Stacked Plot"},epiviz.plugins.charts.StackedLinePlotType.prototype.chartHtmlAttributeName=function(){return"stacked-line-plot"},epiviz.plugins.charts.StackedLinePlotType.prototype.measurementsFilter=function(){return function(t){return t.type()==epiviz.measurements.Measurement.Type.FEATURE}},epiviz.plugins.charts.StackedLinePlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.StackedLinePlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Color by"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Labels"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.OFFSET,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"zero","Offset",["zero","wiggle"]),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"step-after","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.SCALE_TO_PERCENT,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Scale to Percent"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.USE_GROUP_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Group by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.ROW_GROUP_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Group By"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.HOVER_OPACITY,epiviz.ui.charts.CustomSetting.Type.NUMBER,.6,"Hover Opacity")])},epiviz.plugins.charts.StackedLinePlotType.CustomSettings={INTERPOLATION:"interpolation",OFFSET:"offset",SCALE_TO_PERCENT:"scaleToPercent",ROW_GROUP_BY:"groupBy",USE_GROUP_BY:"useGroupBy",HOVER_OPACITY:"hoverOpacity"},epiviz.ui.charts.DataStructureVisualizationType=function(t){epiviz.ui.charts.VisualizationType.call(this,t)},epiviz.ui.charts.DataStructureVisualizationType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisualizationType.prototype),epiviz.ui.charts.DataStructureVisualizationType.constructor=epiviz.ui.charts.DataStructureVisualizationType,epiviz.ui.charts.DataStructureVisualizationType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE},epiviz.ui.charts.DataStructureVisualizationType.prototype.cssClass=function(){return"data-structure-container ui-widget-content"},epiviz.ui.charts.DataStructureVisualizationType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.ui.charts.DataStructureVisualizationType.prototype.hasMeasurements=function(){return!1},epiviz.ui.charts.DataStructureVisualizationType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs.call(this)},epiviz.ui.charts.tree={},epiviz.ui.charts.tree.HierarchyVisualizationType=function(t){epiviz.ui.charts.DataStructureVisualizationType.call(this,t)},epiviz.ui.charts.tree.HierarchyVisualizationType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.DataStructureVisualizationType.prototype),epiviz.ui.charts.tree.HierarchyVisualizationType.constructor=epiviz.ui.charts.tree.HierarchyVisualizationType,epiviz.ui.charts.tree.IcicleType=function(t){epiviz.ui.charts.tree.HierarchyVisualizationType.call(this,t)},epiviz.ui.charts.tree.IcicleType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.tree.HierarchyVisualizationType.prototype),epiviz.ui.charts.tree.IcicleType.constructor=epiviz.ui.charts.tree.IcicleType,epiviz.ui.charts.tree.IcicleType.prototype.createNew=function(t,e,i){return new epiviz.ui.charts.tree.Icicle(t,e,i)},epiviz.ui.charts.tree.IcicleType.prototype.typeName=function(){return"epiviz.ui.charts.tree.Icicle"},epiviz.ui.charts.tree.IcicleType.prototype.chartName=function(){return"Icicle"},epiviz.ui.charts.tree.IcicleType.prototype.chartHtmlAttributeName=function(){return"icicle"},epiviz.ui.charts.tree.IcicleType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.tree.HierarchyVisualizationType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.HOVER_OPACITY,epiviz.ui.charts.CustomSetting.Type.NUMBER,.9,"Hover Opacity"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.AGG_LEVEL,epiviz.ui.charts.CustomSetting.Type.STRING,"","Agg Level"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.NODE_SEL,epiviz.ui.charts.CustomSetting.Type.STRING,"{}","Node Selection")])},epiviz.ui.charts.tree.IcicleType.CustomSettings={HOVER_OPACITY:"hoverOpacity",AGG_LEVEL:"aggLevel",NODE_SEL:"nodeSel"},epiviz.ui.charts.ChartIndexObject=function(t,e,i,n,r,a,o,s){epiviz.ui.charts.VisObject.call(this),this.id=t,this.keys=e,this.keyValues=i,this.values=n,this.seriesIndex=o,this.valueItems=r,this.measurements=a,this.cssClasses=s},epiviz.ui.charts.ChartIndexObject.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisObject.prototype),epiviz.ui.charts.ChartIndexObject.constructor=epiviz.ui.charts.ChartIndexObject,epiviz.ui.charts.ChartIndexObject.prototype.getMetadata=function(t,e,i){return this.valueItems?this.valueItems[t][e][i]:null},epiviz.ui.charts.ChartIndexObject.prototype.metadataColumns=function(){return this.keys},epiviz.ui.charts.ChartIndexObject.prototype.dimensions=function(){return[1,1]},epiviz.plugins.charts.DiversityScatterPlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._dispatch=d3.dispatch("hover","click"),this._legend=this._chartContent=null,this._measurementsX=[],this._measurementsY=[];var n=this;for(this.measurements().foreach(function(t,e){0==e%2?n._measurementsX.push(t):n._measurementsY.push(t)}),this._yLabel=this._xLabel="",t=0;t<Math.min(this._measurementsX.length,this._measurementsY.length);++t)0<t&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=this._measurementsX[t].name(),this._yLabel+=this._measurementsY[t].name();this._colorLabels=[],this._initialize()},epiviz.plugins.charts.DiversityScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.DiversityScatterPlot.constructor=epiviz.plugins.charts.DiversityScatterPlot,epiviz.plugins.charts.DiversityScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("scatter-plot",!0),this._chartContent=this._svg.append("g").attr("class","chart-content"),this._legend=this._svg.append("g").attr("class","chart-legend")},epiviz.plugins.charts.DiversityScatterPlot.prototype.draw=function(){epiviz.ui.charts.Plot.prototype.draw.call(this,void 0,void 0),this.drawScatter(this._lastRange,this._lastData.data,"sample_id",this._xLabel,"alphaDiversity")},epiviz.plugins.charts.DiversityScatterPlot.prototype.drawScatter=function(t,e,i,n,r){return this.xTag=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL],t=this._measurementsX[0].annotation(),this._measurementsX=[],t=new epiviz.measurements.Measurement(this.xTag,this.xTag,"feature","ihmp","ihmp","ihmp",null,null,t,-1,1,[]),this._measurementsX.push(t),this._drawCircles(e,this.xTag,r,i)},epiviz.plugins.charts.DiversityScatterPlot.prototype._drawCircles=function(t,e,i,n){function r(t){return t.sort(d3.ascending),[d3.quantile(t,.25),t=d3.quantile(t,.75)]}var a=this,o=epiviz.ui.charts.Axis,s=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),u=Math.max(Math.floor(s),1),c=this.margins(),l=this.width(),p=this.height(),h=epiviz.ui.charts.CustomSetting,d=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];d==h.DEFAULT&&(d=this._measurementsY[0].minValue()),f==h.DEFAULT&&(f=this._measurementsY[0].maxValue());var m=[];t.forEach(function(t){m.push(t[e])});var y=[];m.forEach(function(t){-1==y.indexOf(t)&&y.push(t)}),console.log(y),this.xTickValues=y,t.forEach(function(t){var i=y.indexOf(t[e]);t._xVal=i+1});var _=0,z=[];y.forEach(function(t){z[_]=[],z[_][0]=_,z[_][1]=[],_++}),t.forEach(function(t){var n=y.indexOf(t[e]);z[n][1].push(t[i])}),v==h.DEFAULT&&(v=0),g==h.DEFAULT&&(g=y.length+1);h=d3.scale.linear().domain([v,g]).range([0,l-c.sumAxis(o.X)]);var b=d3.scale.linear().domain([d,f]).range([p-c.sumAxis(o.Y),0]);this._clearAxes(this._chartContent),xLabelsPadded=[""],y.forEach(function(t){xLabelsPadded.push(t)}),console.log(xLabelsPadded),this._drawAxes(h,b,xLabelsPadded.length,15,this._chartContent,l,p,c,void 0,void 0,xLabelsPadded,void 0,void 0);for(var w={},C=[],S=1,x=0;x<t.length;++x){console.log(t[x]);var M=t[x]._xVal,T=t[x][i];if(M&&T){var E=sprintf("item data-series-%s",0),A=h(M),R=b(T),D=(A=Math.floor(A/u)*u,null);w[R=Math.floor(R/u)*u]&&w[R][A]?((D=w[R][A]).id+="_"+t[x][n],D.values[0]=(D.values[0]*D.valueItems[0].length+M)/(D.valueItems[0].length+1),D.values[1]=(D.values[1]*D.valueItems[1].length+T)/(D.valueItems[1].length+1),D.valueItems[0].push(t[x]),D.valueItems[1].push(t[x]),D.valueItems[0].length>S&&(S=D.valueItems[0].length)):(D=new epiviz.ui.charts.ChartIndexObject(sprintf("scatter_%s_%s_%s_%s",M,T,0,t[x][n]),[n],t[x][n],[M,T],[[t[x]],[t[x]]],["_xVal",i],0,E),w[R]||(w[R]={}),w[R][A]=D,C.push(D))}}if(console.log("after loop"),(x=this._chartContent.select(".items")).empty()&&(t=(x=this._chartContent.append("g").attr("class","items")).append("g").attr("class","selected"),x.append("g").attr("class","hovered"),t.append("g").attr("class","hovered")),(t=x.selectAll("circle").data(C,function(t){return t.id})).enter().insert("circle",":first-child").attr("id",function(t){return sprintf("%s-item-%s",a.id(),t.seriesIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0),t.each(function(t){var e=d3.select(this),i=a.colors().get(t.seriesIndex);e.attr("cx",c.left()+(t.values[0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("cy",p-c.bottom()-(t.values[1]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("class",t.cssClasses).style("fill",i)}),t.transition().duration(1e3).style("fill-opacity",function(t){return Math.max(.6,t.valueItems[0].length/S)}).style("opacity",null).attr("r",s),t.exit().transition().duration(1e3).style("opacity",0).attr("r",0).remove(),t.on("click",function(t){console.log("click"),console.log(t),a._deselect.notify(new epiviz.ui.charts.VisEventArgs(a.id())),a._select.notify(new epiviz.ui.charts.VisEventArgs(a.id(),t)),a._dispatch.click(a.id(),null),d3.event.stopPropagation()}),this._globalIndexColorLabels){for(s={},j=firstGlobalIndex;j<lastGlobalIndex;++j)s[this._globalIndexColorLabels[j]]=this._globalIndexColorLabels[j];this._colorLabels=Object.keys(s),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(s=this._svg.selectAll(".chart-title").data(this._colorLabels)).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",a.margins().top()-5),s.attr("fill",function(t,e){return a.colors().getByKey(t)}).text(function(t){return t});var I=0,L=[];this._container.find(" .chart-title").each(function(t){L.push(I),I+=this.getBBox().width+15}),s.attr("x",function(t,e){return a.margins().left()+10+L[e]}),this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return a.margins().left()+4+L[e]}).attr("cy",a.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t,e){return a.colors().getByKey(t)}).style("stroke-width",0)}else{for(s=Math.min(this._measurementsX.length,this._measurementsY.length),t=Array(s),j=0;j<s;++j)t[j]=sprintf("%s vs %s",this._measurementsX[j].name(),this._measurementsY[j].name());this._colorLabels=t}for(s=x,console.log(y),s.selectAll(".iqr-range").remove(),s.selectAll(".whisker").remove(),x=0;x<z.length;x++){for(t=z[x][1],console.log(t),n=[],n=r(t),console.log(n),u=1.5*(n[1]-n[0]),w=0,M=t.length-1,j=0;j<t.length&&t[j]<n[0]-u;j++)w=j;for(k=t.length-1;0<k&&t[k]>n[1]+u;k--)M=k;s.append("rect").attr("id","0").attr("class","iqr-range").style("opacity",1).style("fill-opacity",.2).attr("x",c.left()+(.6+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y",p-c.bottom()-(n[1]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("width",h(.8)).attr("height",Math.abs(b(n[1])-b(n[0]))).attr("fill","#1E90FF"),s.append("line").style("stroke","gray").attr("class","whisker").attr("x1",c.left()+(1+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y1",p-c.bottom()-(n[1]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("x2",c.left()+(1+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y2",p-c.bottom()-(t[M]-d)*(p-c.sumAxis(o.Y))/(f-d)),s.append("line").style("stroke","gray").attr("class","whisker").attr("x1",c.left()+(1+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y1",p-c.bottom()-(n[0]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("x2",c.left()+(1+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y2",p-c.bottom()-(t[w]-d)*(p-c.sumAxis(o.Y))/(f-d)),s.append("line").style("stroke","gray").attr("class","whisker").attr("x1",c.left()+(.6+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y1",p-c.bottom()-(t[M]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("x2",c.left()+(1.4+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y2",p-c.bottom()-(t[M]-d)*(p-c.sumAxis(o.Y))/(f-d)),s.append("line").style("stroke","gray").attr("class","whisker").attr("x1",c.left()+(.6+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y1",p-c.bottom()-(t[w]-d)*(p-c.sumAxis(o.Y))/(f-d)).attr("x2",c.left()+(1.4+z[x][0]-v)*(l-c.sumAxis(o.X))/(g-v)).attr("y2",p-c.bottom()-(t[w]-d)*(p-c.sumAxis(o.Y))/(f-d))}return C},epiviz.plugins.charts.DiversityScatterPlot.prototype.colorLabels=function(){return this._colorLabels},epiviz.plugins.charts.DiversityScatterPlot.prototype._drawAxesOld=function(t,e,i,n,r,a,o,s){epiviz.ui.charts.Plot.prototype._drawAxes(t,e,i,n,r,a,o,s,void 0,void 0,this.xTickValues,void 0,void 0),this._legend.selectAll("text").remove(),t=this._measurementsX;var u=this;this._legend.selectAll(".x-measurement").remove(),this._legend.selectAll(".x-measurement-color").remove(),e=this._legend.selectAll(".x-measurement").data(t).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.height()-this.margins().bottom()+35).text(function(t,e){return t.name()});var c=0,l=[];this._container.find(" .x-measurement").each(function(t){l.push(c),c+=this.getBBox().width+15}),e.attr("x",function(t,e){return.5*(u.width()-c)+7+l[e]}),this._legend.selectAll(".x-measurement-color").data(t).enter().append("circle").attr("class","x-measurement-color").attr("cx",function(t,e){return.5*(u.width()-c)+1+l[e]}).attr("cy",this.height()-this.margins().bottom()+31).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t,e){return u._globalIndexColorLabels?"#ffffff":u.colors().get(e)}),t=["alphaDiversity"],this._legend.selectAll(".y-measurement").remove(),this._legend.selectAll(".y-measurement-color").remove(),e=this._legend.selectAll(".y-measurement").data(t).enter().append("text").attr("class","y-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.margins().left()-35).attr("transform","rotate(-90)").text(function(t,e){return t});var p=0,h=[];this._container.find(" .y-measurement").each(function(t){h.push(p),p+=this.getBBox().width+15}),e.attr("x",function(t,e){return-u.height()+.5*(u.height()-p)+12+u.margins().top()+h[e]}),this._legend.selectAll(".y-measurement-color").data(t).enter().append("circle").attr("class","y-measurement-color").attr("cx",function(t,e){return-u.height()+.5*(u.height()-p)+6+u.margins().top()+h[e]}).attr("cy",this.margins().left()-39).attr("transform","rotate(-90)").attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(t,e){return u._globalIndexColorLabels?"#ffffff":u.colors().get(e)})},epiviz.plugins.charts.DiversityScatterPlot.prototype.transformData=function(t,e){null!=t&&(this._lastRange=t),null!=e&&(this._unalteredData=this._lastData=e);var i=new epiviz.deferred.Deferred;return i.resolve(),i},epiviz.plugins.charts.DiversityScatterPlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.DiversityScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.DiversityScatterPlotType.constructor=epiviz.plugins.charts.DiversityScatterPlotType,epiviz.plugins.charts.DiversityScatterPlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.DiversityScatterPlot(t,e,i)},epiviz.plugins.charts.DiversityScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.DiversityScatterPlot"},epiviz.plugins.charts.DiversityScatterPlotType.prototype.chartName=function(){return"Diversity Scatter Plot"},epiviz.plugins.charts.DiversityScatterPlotType.prototype.chartHtmlAttributeName=function(){return"diversity_scatter"},epiviz.plugins.charts.DiversityScatterPlotType.prototype.measurementsFilter=function(){return function(t){return epiviz.measurements.Measurement.Type.hasValues(t.type())}},epiviz.plugins.charts.DiversityScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.DiversityScatterPlotType.prototype.minSelectedMeasurements=function(){return 2},epiviz.plugins.charts.DiversityScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Row labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y")])},epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio"},epiviz.plugins.charts.CustomScatterPlot=function(t,e,i){epiviz.ui.charts.Plot.call(this,t,e,i),this._legend=this._chartContent=null,this._measurementsX=[],this._measurementsY=[];var n=this;for(this.measurements().foreach(function(t,e){0==e%2?n._measurementsX.push(t):n._measurementsY.push(t)}),this._yLabel=this._xLabel="",t=0;t<Math.min(this._measurementsX.length,this._measurementsY.length);++t)0<t&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=this._measurementsX[t].name(),this._yLabel+=this._measurementsY[t].name();this._colorLabels=[],this._initialize()},epiviz.plugins.charts.CustomScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype),epiviz.plugins.charts.CustomScatterPlot.constructor=epiviz.plugins.charts.CustomScatterPlot,epiviz.plugins.charts.CustomScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this),this._svg.classed("scatter-plot",!0),this._chartContent=this._svg.append("g").attr("class","chart-content"),this._legend=this._svg.append("g").attr("class","chart-legend")},epiviz.plugins.charts.CustomScatterPlot.prototype.draw=function(){epiviz.ui.charts.Plot.prototype.draw.call(this,void 0,void 0),this._variance_labels=this._lastData.pca_variance_explained,this.drawScatter(this._lastRange,this._lastData.data,"sample_id","PC1","PC2")},epiviz.plugins.charts.CustomScatterPlot.prototype.drawScatter=function(t,e,i,n,r){return this._drawCircles(e,n,r,i)},epiviz.plugins.charts.CustomScatterPlot.prototype._drawCircles=function(t,e,i,n){var r=this,a=epiviz.ui.charts.Axis,o=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),s=Math.max(Math.floor(o),1),u=this.margins(),c=this.width(),l=this.height(),p=epiviz.ui.charts.CustomSetting,h=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],d=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX],g=this.customSettingsValues()[epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.COLOR_BY];f==p.DEFAULT&&(f=this._measurementsX[0].minValue()),h==p.DEFAULT&&(h=this._measurementsY[0].minValue()),v==p.DEFAULT&&(v=this._measurementsX[0].maxValue()),d==p.DEFAULT&&(d=this._measurementsY[0].maxValue());var m=d3.scale.linear().domain([f,v]).range([0,c-u.sumAxis(a.X)]).nice(),y=d3.scale.linear().domain([h,d]).range([l-u.sumAxis(a.Y),0]).nice();this._clearAxes(this._chartContent),this._drawAxes(m,y,15,15,this._chartContent);for(var _={},z=(p=[],1),b=0;b<t.length;++b){var w=t[b][e],C=t[b][i];if(w&&C){var S=sprintf("item data-series-%s",0),x=m(w),M=y(C),T=(x=Math.floor(x/s)*s,null);_[M=Math.floor(M/s)*s]&&_[M][x]?((T=_[M][x]).id+="_"+t[b][n],T.values[0]=(T.values[0]*T.valueItems[0].length+w)/(T.valueItems[0].length+1),T.values[1]=(T.values[1]*T.valueItems[1].length+C)/(T.valueItems[1].length+1),T.valueItems[0].push(t[b]),T.valueItems[1].push(t[b]),T.valueItems[0].length>z&&(z=T.valueItems[0].length)):(T=new epiviz.ui.charts.ChartIndexObject(sprintf("scatter_%s_%s_%s_%s",w,C,0,t[b][n]),[n],t[b][n],[w,C],[[t[b]],[t[b]]],[e,i],0,S),_[M]||(_[M]={}),_[M][x]=T,p.push(T))}}if((t=this._chartContent.select(".items")).empty()&&(e=(t=this._chartContent.append("g").attr("class","items")).append("g").attr("class","selected"),t.append("g").attr("class","hovered"),e.append("g").attr("class","hovered")),(t=t.selectAll("circle").data(p,function(t){return t.id})).enter().insert("circle",":first-child").attr("id",function(t){return sprintf("%s-item-%s",r.id(),t.seriesIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0),t.each(function(t){var e=d3.select(this),i=r.colors().getByKey(t.valueItems[0][0][g]);null!=r._globalIndexColorLabels&&-1==r._globalIndexColorLabels.indexOf(t.valueItems[0][0][g])&&r._globalIndexColorLabels.push(t.valueItems[0][0][g]),e.attr("cx",u.left()+(t.values[0]-f)*(c-u.sumAxis(a.X))/(v-f)).attr("cy",l-u.bottom()-(t.values[1]-h)*(l-u.sumAxis(a.Y))/(d-h)).attr("class",t.cssClasses).style("fill",i)}),t.transition().duration(1e3).style("fill-opacity",function(t){return Math.max(.6,t.valueItems[0].length/z)}).style("opacity",null).attr("r",o),t.exit().transition().duration(1e3).style("opacity",0).attr("r",0).remove(),t.on("click",function(t){console.log("click"),r._deselect.notify(new epiviz.ui.charts.VisEventArgs(r.id())),r._select.notify(new epiviz.ui.charts.VisEventArgs(r.id(),t)),d3.event.stopPropagation()}),this._globalIndexColorLabels){for(o={},j=firstGlobalIndex;j<lastGlobalIndex;++j)o[this._globalIndexColorLabels[j]]=this._globalIndexColorLabels[j];this._colorLabels=Object.keys(o),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(o=this._svg.selectAll(".chart-title").data(this._colorLabels)).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",r.margins().top()-5),o.attr("fill",function(t,e){return r.colors().getByKey(t)}).text(function(t){return t});var k=0,E=[];this._container.find(" .chart-title").each(function(t){E.push(k),k+=this.getBBox().width+15}),o.attr("x",function(t,e){return r.margins().left()+10+E[e]}),this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return r.margins().left()+4+E[e]}).attr("cy",r.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t,e){return r.colors().getByKey(t)}).style("stroke-width",0)}else{for(o=Math.min(this._measurementsX.length,this._measurementsY.length),t=Array(o),j=0;j<o;++j)t[j]=sprintf("%s vs %s",this._measurementsX[j].name(),this._measurementsY[j].name());this._colorLabels=t}return this._colorLabels=[],Object.keys(r.colors()._keyIndices).forEach(function(t){"undefined"!=t&&"Max"!=t&&r._colorLabels.push(t)}),this._svg.selectAll(".chart-title").remove(),this._svg.selectAll(".chart-title-color ").remove(),(o=this._svg.selectAll(".chart-title").data(this._colorLabels)).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",r.margins().top()-5),o.attr("fill",function(t,e){return r.colors().getByKey(t)}).text(function(t){return t}),k=0,E=[],this._container.find(" .chart-title").each(function(t){E.push(k),k+=this.getBBox().width+15}),o.attr("x",function(t,e){return r.margins().left()+10+E[e]}),this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(t,e){return r.margins().left()+4+E[e]}).attr("cy",r.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(t,e){return r.colors().getByKey(t)}).style("stroke-width",0),p},epiviz.plugins.charts.CustomScatterPlot.prototype.colorLabels=function(){return this._colorLabels},epiviz.plugins.charts.CustomScatterPlot.prototype._drawAxes=function(t,e,i,n,r,a,o,s){epiviz.ui.charts.Plot.prototype._drawAxes.call(this,t,e,i,n,r,a,o,s);var u;this._legend.selectAll("text").remove(),u=this,this._legend.selectAll(".x-measurement").remove(),this._legend.selectAll(".x-measurement-color").remove(),t=this._legend.selectAll(".x-measurement").data(["pca1"]).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.height()-this.margins().bottom()+35).text(function(t,e){return t+" (% Variance Explained = "+u._variance_labels[0]+")"});var c=0,l=[];this._container.find(" .x-measurement").each(function(t){l.push(c),c+=this.getBBox().width+15}),t.attr("x",function(t,e){return.5*(u.width()-c)+7+l[e]}),this._legend.selectAll(".y-measurement").remove(),this._legend.selectAll(".y-measurement-color").remove(),t=this._legend.selectAll(".y-measurement").data(["pca2"]).enter().append("text").attr("class","y-measurement").attr("font-weight","bold").attr("fill",function(t,e){return u._globalIndexColorLabels?"#000000":u.colors().get(e)}).attr("y",this.margins().left()-35).attr("transform","rotate(-90)").text(function(t,e){return t+" (% Variance Explained = "+u._variance_labels[1]+")"});var p=0,h=[];this._container.find(" .y-measurement").each(function(t){h.push(p),p+=this.getBBox().width+15}),t.attr("x",function(t,e){return-u.height()+.5*(u.height()-p)+12+u.margins().top()+h[e]})},epiviz.plugins.charts.CustomScatterPlot.prototype.transformData=function(t,e){null!=t&&(this._lastRange=t),null!=e&&(this._unalteredData=this._lastData=e);var i=new epiviz.deferred.Deferred;return i.resolve(),i},epiviz.plugins.charts.CustomScatterPlotType=function(t){epiviz.ui.charts.PlotType.call(this,t)},epiviz.plugins.charts.CustomScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype),epiviz.plugins.charts.CustomScatterPlotType.constructor=epiviz.plugins.charts.CustomScatterPlotType,epiviz.plugins.charts.CustomScatterPlotType.prototype.createNew=function(t,e,i){return new epiviz.plugins.charts.CustomScatterPlot(t,e,i)},epiviz.plugins.charts.CustomScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.CustomScatterPlot"},epiviz.plugins.charts.CustomScatterPlotType.prototype.chartName=function(){return"PCA Scatter Plot"},epiviz.plugins.charts.CustomScatterPlotType.prototype.chartHtmlAttributeName=function(){return"pca_scatter"},epiviz.plugins.charts.CustomScatterPlotType.prototype.measurementsFilter=function(){return function(t){return epiviz.measurements.Measurement.Type.hasValues(t.type())}},epiviz.plugins.charts.CustomScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0},epiviz.plugins.charts.CustomScatterPlotType.prototype.minSelectedMeasurements=function(){return 2},epiviz.plugins.charts.CustomScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Color By")])},epiviz.plugins.charts.CustomScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio",COLOR_BY:"colorBy"},epiviz.ui.charts.ChartFactory=function(t){this._config=t,this._types={};for(var e=this._size=0;e<t.chartTypes.length;++e)this.register(t.chartTypes[e])},epiviz.ui.charts.ChartFactory.prototype.size=function(){return this._size},epiviz.ui.charts.ChartFactory.prototype.registerType=function(t){t.typeName()in this._types||++this._size,this._types[t.typeName()]=t},epiviz.ui.charts.ChartFactory.prototype.unregisterType=function(t){return t.typeName()in this._types&&(--this._size,delete this._types[t.typeName()],!0)},epiviz.ui.charts.ChartFactory.prototype.register=function(t){return!!(t=epiviz.utils.evaluateFullyQualifiedTypeName(t))&&(this.registerType(new t(this._config)),!0)},epiviz.ui.charts.ChartFactory.prototype.unregister=function(t){return!!(t=epiviz.utils.evaluateFullyQualifiedTypeName(t))&&this.unregisterType(new t(this._config))},epiviz.ui.charts.ChartFactory.prototype.get=function(t){return t&&t in this._types?this._types[t]:null},epiviz.ui.charts.ChartFactory.prototype.foreach=function(t){for(var e in this._types)if(this._types.hasOwnProperty(e)&&t(e,this._types[e]))break},epiviz.ui.controls.Control=function(t,e,i){this._container=t,this._title=e||"",this._id=i||epiviz.utils.generatePseudoGUID(6)},epiviz.ui.controls.Control.prototype.initialize=function(){},epiviz.ui.controls.Control.prototype.id=function(){return this._id},epiviz.ui.controls.Control.prototype.title=function(){return this._title},epiviz.ui.controls.DataTable=function(t,e,i,n,r,a){epiviz.ui.controls.Control.call(this,t),this._columns=e,this._rows=i,this._rowsArray=[];var o=this;this._rows.foreach(function(t){o._rowsArray.push(t)}),this._rowParser=n,this._multiselect=r||!1,this._showColumnSelector=a||!1,this._columnSelector=this._table=null,this._selectedIndices=[],this._selectedIndicesMap={},this._lastSelection=this._deselectList=this._selectList=null},epiviz.ui.controls.DataTable.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Control.prototype),epiviz.ui.controls.DataTable.constructor=epiviz.ui.controls.DataTable,epiviz.ui.controls.DataTable.ColumnType={STRING:"string",NUMBER:"number",BOOLEAN:"boolean"},epiviz.ui.controls.DataTable.prototype.initialize=function(){this._container.append('<div class="epiviz-data-table"><table style="width: 100%!important;"><thead></thead><tbody></tbody><tfoot></tfoot></table></div>'),this._table=this._container.find("table");var t=this._table.find("thead"),e=this._table.find("tfoot"),i=this._table.find("tbody"),n=sprintf("<tr><th>%s</th></tr>",this._columns.join("</th><th>"));t.append(n),e.append(n);var r=this;for(this._rows.foreach(function(t){for(var e="",n=0;n<r._columns.length;++n)e+=sprintf("<td>%s</td>",r._rowParser(t,r._columns[n]));i.append(sprintf("<tr>%s</tr>",e))}),e=Array(this._columns.length),t=0;t<this._columns.length;++t)e[t]={type:"text",bRegex:!0,bSmart:!0};for(this._table.dataTable({bJQueryUI:!0,sDom:'<"H"lfr>Tt<"F"ip>',oTableTools:{sRowSelect:this._multiselect?"multi":"single",aButtons:["select_all"],fnPreRowSelect:function(t,e,i){return r._preRowSelect(this,t,e,i)},fnRowSelected:function(t){return r._select(this,t)},fnRowDeselected:function(t){return r._select(this,t)}}}).columnFilter({aoColumns:e}),e=-1,t=0;t<this._columns.length;++t)this._columns[t].isVisible&&++e,this._table.fnSetColumnVis(t,this._columns[t].isVisible),this._columns[t].defaultFilter&&(this._table.fnFilter(this._columns[t].defaultFilter,t,!0,!0),this._table.find("tfoot").find(sprintf("th:eq(%s)",e)).find("input").removeClass("search_init").val(this._columns[t].defaultFilter));if(this._container.find(".ui-buttonset").first().attr("style","position: absolute!important;"),this._showColumnSelector){for(this._container.find(".fg-toolbar").first().append(sprintf('<div style="float: right; margin-right: 5px;"><label>Selected Columns: </label><select class="%s" multiple="multiple" style=""><option value="-1">All</option></select></div>',"epiviz-data-table-column-selector")),this._columnSelector=this._container.find(".epiviz-data-table-column-selector"),t=0;t<this._columns.length;++t)e=sprintf('<option value="%s"%s%s>%s</option>',t,this._columns[t].isVisible?' selected="selected"':"",this._columns[t].isFixed?' disabled="disabled"':"",this._columns[t].name),this._columnSelector.append(e);this._columnSelector.dropdownchecklist({width:"80px",firstItemChecksAll:!0,onComplete:function(t){r._selectColumns(t)}})}},epiviz.ui.controls.DataTable.prototype.selectedIndices=function(){return this._selectedIndices||[]},epiviz.ui.controls.DataTable.prototype.selectedRows=function(){if(!this._selectedIndices)return[];for(var t=Array(this._selectedIndices.length),e=0;e<this._selectedIndices.length;++e)t[e]=this._rowsArray[this._selectedIndices[e]];return t},epiviz.ui.controls.DataTable.prototype._preRowSelect=function(t,e,i,n){return e&&(this._selectList=this._deselectList=null,e.shiftKey&&1==i.length?(this._deselectList=t.fnGetSelected(),this._lastSelection||(this._lastSelection=i[0]),this._selectList=this._getRangeOfRows(this._lastSelection,i[0])):(this._lastSelection=i[0],e.ctrlKey||e.metaKey||(this._deselectList=t.fnGetSelected(),n||(this._selectList=i)))),!0},epiviz.ui.controls.DataTable.prototype._getRangeOfRows=function(t,e){var i=this._table.fnGetPosition(t),n=this._table.fnGetPosition(e),r=this._table.fnSettings(),a=(i=$.inArray(i,r.aiDisplay),n=$.inArray(n,r.aiDisplay),[]);if(0<=i&&0<=n)for(var o=Math.min(i,n);o<=Math.max(i,n);++o)a.push(r.aoData[r.aiDisplay[o]].nTr);return 0<a.length?a:null},epiviz.ui.controls.DataTable.prototype._select=function(t,e){var i;this._deselectList&&(i=this._deselectList,this._deselectList=null,t.fnDeselect(i)),this._selectList&&(i=this._selectList,!this._multiselect&&0<i.length&&(i=[i[i.length-1]]),this._selectList=null,t.fnSelect(i)),i=t.fnGetSelected();var n,r=Array(i.length),a={};for(n=0;n<i.length;++n)r[n]=this._table.fnGetPosition(i[n]),a[r[n]]=!0;for(n=0;n<this._selectedIndices.length;++n)a[this._selectedIndices[n]]||(delete this._selectedIndicesMap[this._selectedIndices[n]],this._selectedIndices.splice(n,1),--n);for(n=0;n<r.length;++n)this._selectedIndicesMap[r[n]]||(this._selectedIndicesMap[r[n]]=!0,this._selectedIndices.push(r[n]));return!0},epiviz.ui.controls.DataTable.prototype._selectColumns=function(t){var e,i={};for(e=0;e<t.options.length;++e)t.options[e].selected&&t.options[e].value&&(i[parseInt(t.options[e].value)]=!0);for(e=0;e<this._columns.length;++e)this._table.fnSetColumnVis(e,i[e]||this._columns[e].isFixed)},epiviz.ui.controls.DataTable.Column=function(t,e,i,n,r,a){this.id=t,this.name=e,this.type=i,this.isVisible=!n,this.isFixed=r||!1,this.defaultFilter=a||""},epiviz.ui.controls.DataTable.Column.prototype.toString=function(){return this.name},epiviz.utils.IterableArray=function(t){this._array=t},epiviz.utils.IterableArray.prototype.foreach=function(t){for(var e=0;e<this._array.length&&!t(this._array[e]);++e);},epiviz.ui.controls.DatasourceGroupWizardStep=function(){this._data=this._dataTable=null},epiviz.ui.controls.DatasourceGroupWizardStep.prototype.initialize=function(t,e){this._data=e,t.find(".epiviz-data-table").remove();var i=[new epiviz.ui.controls.DataTable.Column("datasourceGroup","Data Source Group",epiviz.ui.controls.DataTable.ColumnType.STRING)],n={};e.measurements.foreach(function(t){if(!e.dataprovider||e.dataprovider==t.dataprovider()){if(e.annotation)for(var i in e.annotation)if(e.annotation.hasOwnProperty(i)&&(!t.annotation()||t.annotation()[i]!=e.annotation[i]))return;n[t.datasourceGroup()]=!0}}),this._dataTable=new epiviz.ui.controls.DataTable(t,i,new epiviz.utils.IterableArray(Object.keys(n)),function(t){return t}),this._dataTable.initialize()},epiviz.ui.controls.DatasourceGroupWizardStep.prototype.next=function(){var t=this._dataTable?this._dataTable.selectedRows():[];return 0==t.length?{error:"No rows selected"}:(this._data.datasourceGroup=t[0],{data:new epiviz.ui.controls.VisConfigSelection(this._data.measurements.subset(function(e){return e.datasourceGroup()==t[0]}),this._data.datasource,this._data.datasourceGroup,this._data.dataprovider,this._data.annotation?epiviz.utils.mapCopy(this._data.annotation):this._data.annotation,this._data.defaultChartType,this._data.minSelectedMeasurements,this._data.customData)})},epiviz.ui.controls.DatasourceGroupWizardStep.prototype.title=function(){return"Select Datasource Group"},epiviz.ui.controls.MeaurementsWizardStep=function(){this._measurements=this._data=this._dataTable=null},epiviz.ui.controls.MeaurementsWizardStep.prototype.initialize=function(t,e){this._data=e,t.find(".epiviz-data-table").remove();var i=2,n=epiviz.ui.controls.DataTable.ColumnType,r=[new epiviz.ui.controls.DataTable.Column("id","Id",n.STRING,!0),new epiviz.ui.controls.DataTable.Column("name","Name",n.STRING,!1,!0),new epiviz.ui.controls.DataTable.Column("type","Type",n.STRING,!0),new epiviz.ui.controls.DataTable.Column("datasourceId","Data Source",n.STRING,!0),new epiviz.ui.controls.DataTable.Column("datasourceGroup","Data Source Group",n.STRING,!0),new epiviz.ui.controls.DataTable.Column("dataprovider","Data Provider",n.STRING,!0),new epiviz.ui.controls.DataTable.Column("formulaStr","Formula",n.STRING,!0)],a=[],o={};e.measurements.foreach(function(t){if(null!=(t=t.annotation()))for(var e in t)!t.hasOwnProperty(e)||e in o||(a.push(e),o[e]=!0)}),a.sort(),r=r.concat(a.map(function(t){var e=!1;return 0>=i&&(e=!0),i--,new epiviz.ui.controls.DataTable.Column("[anno] "+t,t,n.STRING,e)})),this._measurements=e.measurements.subset(function(t){if(e.datasource&&e.datasource!=t.datasourceId()||e.datasourceGroup&&e.datasourceGroup!=t.datasourceGroup()||e.dataprovider&&e.dataprovider!=t.dataprovider())return!1;if(e.annotation)for(var i in e.annotation)if(e.annotation.hasOwnProperty(i)&&(!t.annotation()||t.annotation()[i]!=e.annotation[i]))return!1;return!0}),this._dataTable=new epiviz.ui.controls.DataTable(t,r,this._measurements,function(t,e){var i;if(epiviz.utils.stringStartsWith(e.id,"[anno] "))i="",null!=t.annotation()&&(i=t.annotation()[e.name]||"");else switch(e.id){case"annotation":i=epiviz.utils.mapJoin(t.annotation(),": ","<br />");break;default:i=t[e.id]()}return 0===i||i?i:""},!0,!0),this._dataTable.initialize()},epiviz.ui.controls.MeaurementsWizardStep.prototype.next=function(){var t=this._dataTable?this._dataTable.selectedRows():[];if(t.length<this._data.minSelectedMeasurements)return{error:"Minimum selected rows required is "+this._data.minSelectedMeasurements};for(var e=new epiviz.measurements.MeasurementSet,i=0;i<t.length;++i)e.add(t[i]);return this._data.measurements=e,{data:this._data}},epiviz.ui.controls.MeaurementsWizardStep.prototype.title=function(){return"Select Measurements"},epiviz.ui.controls.Wizard=function(t,e,i,n,r,a,o){epiviz.ui.controls.Dialog.call(this,t,e),this._steps=i,this._initialData=n,this._width=r,this._height=a,this._showTabs=o||!1,this._tabs=null,this._initialize()},epiviz.ui.controls.Wizard.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.Wizard.constructor=epiviz.ui.controls.Wizard,epiviz.ui.controls.Wizard.prototype._initialize=function(){var t=this;this._dialog=$("#"+this._id),this._dialog.append('<div id="wizardDialog" class="wizard-dialog"><div class="wizard-tabs"><ul class="wizard-tabs-title-list"></ul></div></div>'),this._tabs=this._dialog.find(".wizard-tabs");for(var e=this._tabs.find(".wizard-tabs-title-list"),i=0;i<this._steps.length;++i)e.append(sprintf('<li><a href="#%s-tab-%s">%s</a></li>',this._id,i,this._steps[i].title())),this._tabs.append(sprintf('<div id="%s-tab-%s"></div>',this._id,i));this._showTabs||(e.css("visibility","hidden"),e.css("position","absolute")),this._tabs.tabs({activate:function(e,i){t._tabActivate(i)},disabled:epiviz.utils.range(this._steps.length-1,1)}),this._dialog.dialog({autoOpen:!1,resizable:!0,width:this._width||void 0,height:this._height||void 0,buttons:{Back:function(){var e=t._tabs.tabs("option","active");0!=e&&(t._tabs.tabs("option","disabled",epiviz.utils.range(t._steps.length-e,e)),t._tabs.tabs("option","active",e-1))},Next:function(){var e=t._tabs.tabs("option","active"),i=t._steps[e].next();i.error?new epiviz.ui.controls.MessageDialog("Error",{Ok:function(){}},i.error,epiviz.ui.controls.MessageDialog.Icon.ERROR).show():(t._steps[e+1].initialize($(sprintf("#%s-tab-%s",t._id,e+1)),i.data),t._tabs.tabs("option","disabled",epiviz.utils.range(t._steps.length-e-2,e+2)),t._tabs.tabs("option","active",e+1))},Finish:function(){var e=t._steps[t._steps.length-1].next();e.error?new epiviz.ui.controls.MessageDialog("Error",{Ok:function(){}},e.error,epiviz.ui.controls.MessageDialog.Icon.ERROR).show():(t._handlers.finish&&t._handlers.finish(e.data),$(this).dialog("close"))},Cancel:function(){t._handlers.close&&t._handlers.close(),$(this).dialog("close")}},modal:!0}),1<this._steps.length?(this._dialog.parent().find('button:contains("Finish")').button("disable"),this._dialog.parent().find('button:contains("Next")').button("enable")):(this._dialog.parent().find('button:contains("Finish")').button("enable"),this._dialog.parent().find('button:contains("Next")').button("disable")),this._steps[0].initialize($(sprintf("#%s-tab-0",t._id)),this._initialData),this._dialog.css("overflow","visible")},epiviz.ui.controls.Wizard.prototype._tabActivate=function(t){t=this._tabs.tabs("option","active");var e=this._dialog.parent().find('button:contains("Finish")'),i=this._dialog.parent().find('button:contains("Next")');t==this._steps.length-1?(i.button("disable"),e.button("enable")):(i.button("enable"),e.button("disable")),this._tabs.tabs("option","disabled",epiviz.utils.range(this._steps.length-t-1,t+1))},epiviz.ui.controls.Wizard.prototype.show=function(){var t=this;this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(e,i){$(this).remove(),t._dialog=null}})},epiviz.ui.controls.Wizard.Step=function(){},epiviz.ui.controls.Wizard.Step.prototype.initialize=function(t,e){},epiviz.ui.controls.Wizard.Step.prototype.next=function(){},epiviz.ui.controls.Wizard.Step.prototype.title=function(){},epiviz.ui.controls.ComputedMeasurementsDialog=function(t,e,i,n){epiviz.ui.controls.Dialog.call(this,t,e),this._measurements=i,this._chartsMeasurements=n,this._measurementsList=this._maxTextBox=this._minTextBox=this._nameTextBox=this._idTextBox=this._expressionTextBox=null,this._addButtonProperties={text:!1,icons:{primary:"ui-icon ui-icon-plus"}},this._deleteButtonsProperties={text:!1,icons:{primary:"ui-icon ui-icon-trash"}},this._datasourceGroupMeasurements=this._selectedDatasourceGroup=this._tabs=null,this._addTabs(),this._addDialogContents(),this._addDatasourceGroupTable(i)},epiviz.ui.controls.ComputedMeasurementsDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.ComputedMeasurementsDialog.constructor=epiviz.ui.controls.ComputedMeasurementsDialog,epiviz.ui.controls.ComputedMeasurementsDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var t=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(e,i){$(this).remove(),t._dialog=null,t._handlers.close()}}))},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addDatasourceGroupTable=function(t){var e=this,i=$(sprintf("#datasource-group-tab-%s",this._id)),n="",r={};for(var a in t.foreach(function(t){t.type()==epiviz.measurements.Measurement.Type.FEATURE&&(t.datasourceGroup()in r||(r[t.datasourceGroup()]=[]),r[t.datasourceGroup()].push(t))}),r)r.hasOwnProperty(a)&&(n+=sprintf('<tr><td class="center">%s</td></tr>',a));i.append(sprintf('<table style="border-spacing:0; border-collapse:collapse; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: moz-none; -ms-user-select: none; user-select: none; width: 100%%;" class="computed-measurements-dialog-raw-table">%s</table>',"<thead><tr><th>Data Source Group</th></tr></thead>"+n+"<tfoot><tr><th>Data Source Group</th></tr></tfoot>"));var o=i.find(".computed-measurements-dialog-raw-table").dataTable({bJQueryUI:!0,sDom:'<"H"lfr>Tt<"F"ip>',oTableTools:{sRowSelect:"single",aButtons:[],fnPreRowSelect:function(t,e,i){return!0},fnRowSelected:function(t){t=o.fnGetData(t[0]),e._selectedDatasourceGroup=t[0],e._datasourceGroupMeasurements=r[e._selectedDatasourceGroup]},fnRowDeselected:function(t){o.fnGetData(t[0])==e._selectedDatasourceGroup&&(e._selectedDatasourceGroup=null,e._datasourceGroupMeasurements=null)}}});i.find(".DTTT_container").css("position","absolute")},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addTabs=function(){var t=this;this._selectDialog().append('<div id="computedMeasurementsDialog" class="computed-measurements-dialog"><div class="computed-measurements-tabs"><ul>'+sprintf('<li><a href="#datasource-group-tab-%s">Data Source Group</a></li>',this._id)+sprintf('<li><a href="#formula-tab-%s">Expression</a></li>',this._id)+"</ul>"+sprintf('<div id="datasource-group-tab-%s"></div>',this._id)+sprintf('<div id="formula-tab-%s"></div>',this._id)+"</div></div>"),this._tabs=this._selectTabs(),this._tabs.tabs({activate:function(e,i){t._tabActivate(i)}})},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addDialogContents=function(){var t=this;this._selectDialog().dialog({autoOpen:!1,resizable:!0,width:"600",height:"550",buttons:{Back:function(){0!=t._tabs.tabs("option","active")&&t._tabs.tabs("option","active",0)},Next:function(){1!=t._tabs.tabs("option","active")&&t._tabs.tabs("option","active",1)},Add:function(){for(var e=epiviz.utils.ExpressionParser.parse(t._selectExpressionTextBox().val().trim()),i={},n=e.variables(),r=null,a=null,o=[],s={},u=0;u<n.length;++u){var c=n[u];if(epiviz.utils.stringStartsWith(c,"{")&&epiviz.utils.stringEndsWith(c,"}")){var l=parseInt(c.substring(1,c.length-1));c=t._datasourceGroupMeasurements[l];if(i[l]=c,(null===r||r>c.minValue())&&(r=c.minValue()),(null===a||a<c.maxValue())&&(a=c.maxValue()),c.metadata())for(l=0;l<c.metadata().length;++l)s[c.metadata()[l]]||(s[c.metadata()[l]]=!0,o.push(c.metadata()[l]))}}n=t._selectMinTextBox().val().trim(),s=t._selectMaxTextBox().val().trim(),r=n?parseFloat(n):r,a=s?parseFloat(s):a,n=t._selectIdTextBox().val().trim()||epiviz.utils.generatePseudoGUID(5),e=new epiviz.measurements.Measurement(n,t._selectNameTextBox().val().trim()||"Unnamed ["+n+"]",epiviz.measurements.Measurement.Type.FEATURE,null,t._selectedDatasourceGroup,null,{referredMeasurements:i,expression:e},"any",null,r,a,o),i=t._datasourceGroupMeasurements.length,$(sprintf("#computed-measurement-measurements-%s",t._id)).append(sprintf('<div style="min-height: 30px; padding: 2px;"><div style="margin: 6px; float: left;">%1$s {<b>%2$s</b>}</div><div style="float: right;"><button id="delete-button-%2$s-%3$s" data-measurement="%2$s">Delete</button><button style="" id="measurement-button-%2$s-%3$s" data-measurement="%2$s">Insert %2$s</button></div></div>',e.name(),i,t._id)),$("#measurement-button-"+i+"-"+t._id).button(t._addButtonProperties).click(function(){t._addButtonClick($(this))}),$("#delete-button-"+i+"-"+t._id).button(t._deleteButtonsProperties).click(function(){t._deleteButtonClick($(this))}),t._datasourceGroupMeasurements.push(e),t._handlers.add(e)},Close:function(){t._handlers.close(),$(this).dialog("close")}},modal:!0})},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addButtonClick=function(t){t=t.data("measurement");var e=this._selectExpressionTextBox();e.val(e.val().trim()+" {"+t+"}")},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._deleteButtonClick=function(t){for(var e=t.data("measurement"),i=this._datasourceGroupMeasurements[e],n=0;n<this._datasourceGroupMeasurements.length;++n){var r=this._datasourceGroupMeasurements[n];if(null!=r&&r!==i&&r.isComputed()&&r.componentMeasurements().contains(i))return void(t=new epiviz.ui.controls.MessageDialog("Measurement cannot be deleted",{Ok:function(){}},"There are other measurements that depend on the one selected. Please delete those before deleting this.",epiviz.ui.controls.MessageDialog.Icon.ERROR)).show()}for(var a in this._chartsMeasurements)if(this._chartsMeasurements.hasOwnProperty(a)&&this._chartsMeasurements[a].contains(i))return void(t=new epiviz.ui.controls.MessageDialog("Measurement cannot be deleted",{Ok:function(){}},"There are charts using the selected measurement. Remove them from the workspace and then try again.",epiviz.ui.controls.MessageDialog.Icon.ERROR)).show();this._datasourceGroupMeasurements[e]=null,t.parent().parent().remove(),this._handlers.remove(i)},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._tabActivate=function(t){if(0!=this._selectTabs().tabs("option","active")&&(t.newPanel.empty(),this._measurementsList=this._maxTextBox=this._minTextBox=this._expressionTextBox=this._nameTextBox=this._idTextBox=null,this._selectedDatasourceGroup)){t.newPanel.append(sprintf('<label for="computed-measurement-key-%1$s"><b>Id:</b></label> <input id="computed-measurement-key-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/>&nbsp;<label for="computed-measurement-name-%1$s"><b>Name:</b></label> <input id="computed-measurement-name-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/><br /><br /><div id="computed-measurement-measurements-%1$s" style="overflow: auto; max-height: 200px; border-style: solid; border-width: 1px; border-color: #999999;"></div><br/><label for="computed-measurement-min-%1$s"><b>Min:</b></label> <input id="computed-measurement-min-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/>&nbsp;<label for="computed-measurement-max-%1$s"><b>Max:</b></label> <input id="computed-measurement-max-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/><br/><div style="overflow: hidden; padding: 10px; padding-right: 20px; margin: 0px;"><textarea id="computed-measurement-expr-%1$s" class="ui-widget-content ui-corner-all" style="width: 100%%; height: 55px; padding: 5px; margin: 0; resize: none;"></textarea></div>',this._id)),t=this._selectMeasurementsList();for(var e="",i=0;i<this._datasourceGroupMeasurements.length;++i){var n=this._datasourceGroupMeasurements[i],r="";n.isComputed()&&(r='<button id="delete-button-%2$s-%3$s" data-measurement="%2$s">Delete %2$s</button>'),e+=sprintf('<div style="min-height: 30px; padding: 2px;"><div style="margin: 6px; float: left;">%1$s {<b>%2$s</b>}</div><div style="float: right;">'+r+'<button style="" id="measurement-button-%2$s-%3$s" data-measurement="%2$s">Insert %2$s</button></div></div>',n.name(),i,this._id)}t.append(e);var a=this;for(i=0;i<this._datasourceGroupMeasurements.length;++i)(n=this._datasourceGroupMeasurements[i]).isComputed()&&$("#delete-button-"+i+"-"+this._id).button(this._deleteButtonsProperties).click(function(){a._deleteButtonClick($(this))}),$("#measurement-button-"+i+"-"+this._id).button(this._addButtonProperties).click(function(){a._addButtonClick($(this))});this._selectIdTextBox().watermark("[auto]"),this._selectNameTextBox().watermark("[auto]"),this._selectMinTextBox().watermark("[auto]"),this._selectMaxTextBox().watermark("[auto]"),this._selectExpressionTextBox().watermark("[expression; for example: {0} - {1}]")}},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectDialog=function(){return this._dialog||(this._dialog=$("#"+this._id)),this._dialog},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectExpressionTextBox=function(){return this._expressionTextBox||(this._expressionTextBox=$("#computed-measurement-expr-"+this._id)),this._expressionTextBox},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectIdTextBox=function(){return this._idTextBox||(this._idTextBox=$("#computed-measurement-key-"+this._id)),this._idTextBox},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectNameTextBox=function(){return this._nameTextBox||(this._nameTextBox=$("#computed-measurement-name-"+this._id)),this._nameTextBox},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMinTextBox=function(){return this._minTextBox||(this._minTextBox=$("#computed-measurement-min-"+this._id)),this._minTextBox},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMaxTextBox=function(){return this._maxTextBox||(this._maxTextBox=$("#computed-measurement-max-"+this._id)),this._maxTextBox},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectTabs=function(){return this._tabs||(this._tabs=this._dialog.find(".computed-measurements-tabs")),this._tabs},epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMeasurementsList=function(){return this._measurementsList||(this._measurementsList=$("#computed-measurement-measurements-"+this._id)),this._measurementsList},epiviz.ui.tutorials=function(){this._tutorialList=[{name:"Epiviz Overview",id:"tut_epiviz_overview",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br></p><p class='intro-text'>This tutorial will walk you through the functionality available in Epiviz.</p>",position:"center"},{target:"#intro-navigation",content:"<p class='intro-text'>The navigation section of Epiviz lets you select a chromosome and explore the genome. Options are available to move left/right and zoom in/out.</p><p class='intro-text'>The settings icon allows you to control the navigation parameters.</p>",position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#search-box",content:"<p class='intro-header'>Use the search input to look for a specific gene or target.</p><p class='intro-text'>This will navigate Epiviz to the selected gene location and update the workspace with the new data.</p>",position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#vis-menu-button",content:'<p class="intro-text">Choose from a list of available data sources, measurements or chart types to add visualizations to the Epiviz Workspace.</p>',position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#intro-workspace",content:'<p class="intro-header">managing workspaces.</p><p class="intro-text">If you are logged in, you will be able to save your Epiviz analysis and workspaces.You will also be able to retrieve them at a later time from your account.</p>',position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#login-link",content:'<p class="intro-text">Please login to save and manage Epiviz workspaces.</p>',position:"left",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',position:"center"}]},{name:"Data Visualization and Controls",id:"tut_data_controls",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br><br>Data visualization tutorial<br></p><p class='intro-text'>This tutorial will help create/add new data visualizations to the Epiviz workspace and controls available for each visualization.</p>",position:"center"},{target:"#vis-menu-button",content:'<p class="intro-text">The Data Visualizations button helps users add new charts to the workspace.</p><p>Users have the option to choose data sources and measurements to add to the workspace.</p>',position:"right",onHide:function(t,e,i,n){$("#vis-menu-button").button().trigger("click")},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#vis-menu",content:'<p class="intro-text">Choose the type of chart to add to your workspace. We choose scatter plot to continue with the tutorial</p>',position:"right",onShow:function(t,e,i){},onHide:function(t,e,i,n){$("#plot-menu-add-scatter").trigger("click")},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){var t=$("#wizardDialog").parent().attr("id");return $("#"+t).parent()},content:'<p class="intro-text">This window lets you choose form a list of data sources and the measurements available from each data source to add to your Epiviz workspace</p><p>We selected the first data source in the table or choose a data source from the list.</p>',showOverlay:function(){},onShow:function(t,e,i){$("#wizardDialog table tbody tr:first").trigger("click")},onHide:function(t,e,i,n){$('.ui-button:contains("Next")').trigger("click")},position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){var t=$("#wizardDialog").parent().attr("id");return $("#"+t).parent()},content:'<p class="intro-text">After choosing a data source, the next tab lists all the measurements (or features) available from this data source. If you have any computed measurements for this data source, they will be added to this list.</p><p>To add a plot to the workspace, pick a few measurements and select finish on this window. </p>',showOverlay:function(){},position:"right",onShow:function(t,e,i){},onHide:function(t,e,i,n){t=$("#wizardDialog").parent().attr("id"),$("#"+t).dialog("close")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#feature-view",content:'<p class="intro-text">Visualizations are added to the workspace based on the type of chart. </p><p>Brushing is implemented on all the plots. When you hover over a data point, it highlight that region in the gene on all the visualizations.</p>',position:{top:"24em",left:"14em"},showOverlay:function(){},onShow:function(t,e,i){$('button:contains("Remove"):first').css("display","block")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Remove"):first')},content:'<p class="intro-text">Removes the plot from the workspace</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(t,e,i){$('button:contains("Save"):eq(1)').css("display","block")},onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Save"):eq(1)')},content:'<p class="intro-text">Save a plot to your local machine (image, pdf)</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(t,e,i){$('button:contains("Custom settings"):first').css("display","inline-block")},onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Custom settings"):first')},content:'<p class="intro-text">Change chart display properties and aggregation methods for grouping.</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(t,e,i){$('button:contains("Code"):first').css("display","inline-block")},onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Code"):first')},content:'<p class="intro-text">Edit code to redraw the chart on the workspace.</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(t,e,i){$('button:contains("Colors"):first').css("display","inline-block")},onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Colors"):first')},content:'<p class="intro-text">Choose colors for data points on the plot</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(t,e,i){$('label:contains("Toggle tooltip"):first').css("display","block")},onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('label:contains("Toggle tooltip"):first')},content:'<p class="intro-text">Toggle tooltips for data points</p>',position:"right",showOverlay:function(){},className:"anno-width-175",onHide:function(t,e,i,n){$(e).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',position:"center"}]},{name:"Computed Measurements",id:"tut_comp_measurements",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br>Compute Measurements Tutorial<br></p><p class='intro-text'>This tutorial will help you create new measurements (derived from existing measurements) and generate plots to add to the workspace.</p>",position:"center"},{target:"#computed-measurements-button",content:"<p class='intro-text'>The computed measurements button helps users add new measurements to data sources</p>",position:"right",onShow:function(t,e,i){$("#computed-measurements-button").button().trigger("click")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>This tab lets you choose a data source where you will create a new measurement.</p><p>We choose the first data source in the list or choose any data source.</p>",position:{top:"20em",left:"1em"},showOverlay:function(){},onShow:function(t,e,i){$("#computedMeasurementsDialog table tbody tr td:first").trigger("click")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>The measurements tab lists all available measurements from the selected data source (including previously created computed measurements).</p><p>Use the buttons next to each measurement to add to the expression window</p>",position:{top:"20em",left:"1em"},showOverlay:function(){},onShow:function(t,e,i){$('.ui-button:contains("Next")').trigger("click")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'> After choosing measurements, use mathematical operators to evaluate the expression.</p><p><a target='_blank' href='https://silentmatt.com/javascript-expression-evaluator/'>supported operators</a> </p>",position:{top:"33em",left:"1em"},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>After adding a computed measurement, use the data visualization button to plot the measurement to your workspace.</p><p>To learn how to add new plots to the workspace, please use the Epiviz data visualization tutorial.</p>",position:{top:"10em",left:"1em"},showOverlay:function(){},onHide:function(t,e,i,n){t=$("#computedMeasurementsDialog").parent().attr("id"),$("#"+t).dialog("close")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',position:"center"}]}]},epiviz.ui.PrintManager=function(t,e,i,n){this._containerId=t||"pagemain",this._fName=e||"epiviz_"+Math.floor($.now()/1e3),this._fType=i||"pdf",this._workspaceId=n},epiviz.ui.PrintManager.prototype.print=function(){var t=this,e=$("#"+t._containerId),i=e.find("svg");i.each(function(){var t,e;(t=document.createElement("canvas")).className="tempCanvas",function(t){$(t).find(".domain").each(function(){$(this).css({fill:"none","stroke-width":"1px",stroke:"#000000","shape-rendering":"crispEdges"})}),$(t).find(".gene-name").each(function(){$(this).remove()}),epiviz.utils.stringContains($(t).attr("id"),"track-lines")&&$(t).find(".lines path").each(function(){$(this).css({fill:"none"})}),$(t).find("text").each(function(){$(this).css({"font-size":"11px"})}),$(t).find(".chart-legend").each(function(){$(this).css({border:"none",background:"transparent"})})}(this),e=(e=(new XMLSerializer).serializeToString(this)).replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,""),canvg(t,e,{useCORS:!0,renderCallback:function(){$(t).insertAfter(this),$(this).hide()}})}),html2canvas(e,{timeout:0,width:e[0].scrollWidth+200,height:e[0].scrollHeight+200,useCORS:!0}).then(function(n){(r=n.getContext("2d")).mozImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1;var r=t._fName+"."+t._fType,a=t._fType,o=n.toDataURL("image/png");"pdf"==a?(n=new jsPDF("l","px",[.6*(1400<e[0].scrollWidth?e[0].scrollWidth:1400),.65*(1e3<e[0].scrollHeight?e[0].scrollHeight:1e3)]),a="http://epiviz.cbcb.umd.edu/4/?ws="+t._workspaceId,n.addImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAAAyCAYAAABIxaeCAAASqElEQVR4nO2de5QU1Z3Hv/Wurn5M9wxvGBwGBUVF4hBFgwkaZOPukRBdGBaDkpUdY7LGaDxCEjUxehSMxizHF8QHMasug9mYaKJBRKMm7LKALwQxMCAPcXAe/Ziuqdet2j+qi+npqemZ7q7u6eH055w6Z7rurXtv99S37r2/3+/eouoa1++nYb3GmOoWXj62JV417TiGIf6WZpGtOfMCwgUu0rmqGSbFTTZpZiRtkpE662c5ImsmzXXQpn4QwE7a1LYInbs2x0fNjg1luw89s2goq69QplC1SzZYJz5ZxGIs/QPaNLbQlvEnoXPXX+KjZmtD2L6s+FuaeTJh7nxCc4tNmr+M0IKUy/WMqRmAuYkzkk/y0T0vxEfNJsVqqwesyPg74pJnJYDVpWlOhWwU+sDtLcwMGFProE3tGdoyH1S50IGCavKQquj7I5TApBsNWmgiND/KizIZUz3AEfk+vvPDJ8vkYVQPYCH6F6EbFWGWCYUKk86WSGi+WmcDN6hc4GNY5Klg8sCpBdVWOAGOyPd0VZ1xQGWDt3klSgAgtDBJ4SKPJmsa9opax1COLyMA1gLYD2AVBi/KcmUu7O9iAeiA/bCpMADs4LLRLCgsk6UJSwQjtkbs+uTOWHh6V3Gb1htBjzeqXOAXOiON6y8PYyqttGnsBqwDAN3JmIpMGJ8AIGxS9DhCcWeBYuqy1UMYXx1hfBs4I/ltXo9+O+kb/7HX3yULTbBFebIQAdCMnoeL8/lSAJtL3JZVsEcfO1L1d5a4/pwYpDBtCMXxhK26xQhNvTIgH1reJU3cUqyGOQTkwyNUvvoRlQv1edIyphZlTeUlg/H9WVTb3k6KYw+StDGADn+f8vzKsTEKXzOf0OwCAHMBmnOrV2f9F5s0926wa9/Pdv/hxz+vXbKh2PPPZgzcm2xGzw29DmV+cwFogHuP34DSC7Mpre4mlPmQP+scMysWMUU9tlqQj9wRC083PG4XAEBSWy9TufCThBbG9Jw1TcFIvgqLPEbtf+Fl5fRlar7lhzreGZesOr0JFHN9tmGxpLa+xcX3L42NvPCTfOvKQgTAq7BvGDdaYIuwrG+kfojAHsZmivOk7zELNv6c8Y37r9TZqikmRTWAYubojFSTSwEM6d4qah2NSd/4wwW1JA1/SzNLJsy9W+GqbgXFUPZZUxOMrv9kiLJaFkZ5OryU1FYfYXxNKhtYCdBj3PJwRI5yRvIaWRj5Bw+rHkiU18EW5XBmLmxRNMAWw3UANg5pi0qAF1bZEx8OP9tIn7bwsRmEYv/FpPnFhBYmDKYQxtRaBa3jSlkc89eCWgMg2LV/lOwb9zxhfBfZZ0xIavvvGC16ayJ42r5Cy8+GqHUEFL56JSxyCyhG6JPBIpZfPX7vR//9/Ts8Gtr2N3xtgf1Ub/GgjgpDgKfCTMff0kyTCV+do7P+fyc0Px+gmexFmaqoRb+r8NVP5NsYv3JshsJX/57QwsRUme/4ldabk+LYN/ItMx9EreNUnfU/TGhhnlu6pLS+TLdubew6ZUGigGpWwO5JMmkBMBPlP3+skIWiuUuS9YtMha/ZQmjxCn/3p1M5I/kEYOpZihIUPvy4YMTvOvxsI5VrQ0St/QpFGPE2oYWJsIgiGImbAXpmqUUJAApfve/gf139NcbUrgPMPuKTxdGX6eMv+VtV27ZJeVYRQe+AAYdODAOLYYXik9WP6ZD0Tdivs/7lweQn0xhTa4btk3ItTmVDt9U3PvVk6OgmV2tnJoefbaQ4o+s2hQs/TyjOz5jadlHvbFDZ4IMAzMF+Ea+pXbLBIjS/jiHqOQzp3pqZrrKhs7qqp28V9c7+5ofZyBa5MxTDVyeQwfE3ph/7U2kV/2MJGZQwHRL+SfsIzTeKWvtFjKl80F8+nZGWdY+Z/UJV27asIXKho5u4Uxeu/bXOBu4CRYEx1XsJzV+g8CN259KuYkIY3wHxkxe/zBH5XmQ8KAgtjtbZwOui1v7VHIqMoMd0n45jfS0lK2A7/ZthD6vrXfLUp9KaU3nd2p6NV9Fb6K9mpG9Pnd+eY7n9EYHdTgu9RyWrUueaB7g288E02KMD7qOgvMhJmA4KX/NX/7E3GwQj9kNYRHHLozPSP3ZFzn45FN8Tckuv6tjp7x79pd+rXHgpgChHlAWEFn4EoCiul0JI1i8ydEb6kai1L2BMLZ6eRiguqHOhP4lax2B7lIVw7y1L6Q6phy2EXCOLnKik7XAXcT4437sB/Vunc6EJdjs7UdoHXQT27znXi8LyEiYAxMfP01W2apWoR7/ImOp7bnkI4/ty0l+3JSAfHpF+PhT/qEauOv01nfVfxpjqXsFInKczkpduiKKg8DUvBmK7ZwlGYm/6eUJxvMJVPScYsW8Oohi3f1wnSudCaIAtrEJE4EUZDhvRM3z3Yrjs9OibkftcvRMAleexI1WGF79J/sJ0UPiaXYHOD84XjPgatykhYXwN3eLINyWldRwA+Ls/HZ0M1L2hM9L5HJHflLo/vVBlg38vtB2lIhaZsUdo3Xq+YMT/2CuBYhiVrVov6NFrByjC7R+Xz02UDw2wh5JuveQ6AIvQ94ZbCfeHhuOD9aLndMovVJhz0dOeUvpKG9Lq9SRwomBhAkCsZqaqsqEbRS26GBbpE0NLaPEMlY+8LSmtkylLNwBYgpF4TorunpfwT+rwog2lJD5+Xow99Mp8zkjck/EwYlQ2+CtBj17fz6URuN/IO1zOFYO16CvKHQAmo3/H/2rYgnXzqzqxr4Xi1OusqMkX59oWlE6Y9eiJB94Ij/6XngjTQeGrN0jq57MYU+kTukZofpLKh9/Suaox/rbtX9jXvPyqWM3MvMPphppk/SJTZ4M/9iut19rrOlNQDKVy4YcFPXqDy2X9zeccw0ShRzbjwwr07a03w/aZDsYSvBnu4nRiTwthB3puaC+EWcq5ZTNsce6A/XDzBE+FCQCyOOZDqfvYLMZUt2WmEVoYazDSm1r49Ia8Y3TLjKQ49klJPnw5YyrpIwVK5UJrBD36w4zsXhlM8iFTtJ2we8JccCKSMofdXlgj04ez+fxOjtEnvaxi44RTtsD+LT2bjnguTABI+Cd9JiU/uZgj8kuZafYaz9BrotZ+STHqHgoSgcmvBGIffYUzEp/1nKWhcuF7BD16fz4BFx7jZgleifxupBb0tSAXOgRFqkynPfmU5VyzGaXxBTsWWOcB52mdRREmACSCU2Qpse8bjKU/k5lGaD5guxjav16s+ktNLDJjp9T+7gWCHt+Tfl7lwj+oa1z/XCi+x4ehi33NtAQX6kpwu9YrCy2Q+9C4Hj3fsRS9ZRN6RgkrUQQbQdGECQCx8HSDfv/RazgjsT4zjVCcoHOh34pa29XFbEMx8XcfCXFGcpNgJDZw761hYqMvOih8vm22oEffSs9HGF9jt/+UvwhGvO8CUZvJyN9Mn3705wt1m1sWQif63oxe+O/SjUC5lJdu9Cn2/HIuehazryxWfUUVJgDo53yP6GzwXwUj9lhmGqE4RuEi6zkjcXOx2+E1ghGbqAij3tZZ/6Um6LFS7WwRAOLj5nawhzfNE7WOXk9unZG+qLKh1wGz1aU4T3xfWcics3nxhM8sw4stUNKHobkMZ50etti9pWOBBYq8Rrbowkxh7Wtu+o5gxH/ZJ4ViKJ0NPiAYiYe499YMsIKlPBC1tvMMRvpfQvNnc0byZSn64ddi1ecmnfRk/SLl789fv1hSjz+Y4U6pYUzdLUzRk2iRLGSKxgsjReaw3CvDltMD5RJJVQrfZfo2KZvhoQXWjZy2FimE2iUbLBW4SdCjXSoXui3zmaCywe9yZy2vFbWOqxS+uqT7CeWCYMSvUfgRjwLwCUbiN0Lr1mtj4+f1WXVTu2SDKQM3S8pnB2Vh5C9AMamHDhVwKXYh8jfGDMRQWoLzYR16gvybMPBQ0RFwusulGDTDHtk4OyC48sz/3AUAeGvyXdnKWgbglLTPd6bOrXdOlKrHPIHKhW8XtegNgNlnobHOSPN1NrBVUluHeje+PviVYyJH5LUqG1oPwCepnz+wr3n5NXEXUaYji2PWSFrbQlhEBgBC8xSAZEa2CIbf6o1MwXtl2OpEzxx4oN8kgtIYfdam6nHcIoUwA8BTAH6aOuoAhAE8mJ6p5MIEAIWvfkjUOhYzlt4nAJ7Q/FkqF/k/Ueu4bCja5kZAPjRT4cI7dEZqYiydiFrHDbIw8pbB+mJlYfTvBCNxMSxyHLD363XJNty2qsycF3tpcXZENtelnnRKEbC+IlWPV26RdAFGAdwE4EbY4jzBkAgTABR+xPOi2nYJY2qfZaYRmg8rfPVLHJHvr2rf3neLjxIRTHzMiXrnnd2+sVsJ45vGmFpcVI5frvDVD+ValsqFtzGmNosxtY8IzdcCZuZw3Vm5MRyoR1/BeDmMHGxgu5O2EcWZBixEzy4T16Hw7zgndTg4NpfvZ2YcMmECQFIcu1XQY+dxRH7XJZnWGekHXZGztola25mlbpuktn5F9te9o3CROwjFsYypfOxTW2clfeNfzrdMwvgOCFrHhRyRtzBEddvt3VmwXO64tdHroeRAge3py8SKMYytR2+3iBd1PJX290EA/wG7Bw1nZhxSYQKALIw8LMpHvsQReb1bOqHF6Qo/YidnJFdXRd93M5x4ir/76BSOyL+VhdGvE5o/EwAEI/HHQPzj87t8tXsGun4gZHFMp5TY9w+gmF8zlr7XJcsquO8FVC64xcZuhveGF2do2l9UUbrv0uutMJ2VMxF45xZZBns+6XAnbEEuc8s85MIE7CghnZG+JWrt/8ZYerdLFl5n/bd2haZ+JBiJb/pbmj23Jvu7j0zjjMTTSd/YD3VGugIAxVi6IWptK/c1L788Fp4e9aquWHi6QWj+Zto07odF3LbiXAHv1jt6SbofL51i+PPSBZdNmMWYWzqB6V65RTKNO+/CtsDW9XdBWQjTQeFrHpfkIzMZU9nplk5oYbzKBn+j1C3YK+jR71RF3xcLqc/f0syLWvuVnJHclPSN26WzwaUAzQIAY6oHReX4xQo/YnWxAu51xve4/Z4U8x2XZGcxcjOK4+d0RDZYd8pCuO9csBHF27w53QiUbhhrSrWjGEYfxwKb1S2SI5nGnZsGuqCshAkACf+k3VLy0CxBj97NWLrrW7cIzderXPjhrtDUY5J6/Olg1/75/pbmQYm06vO/jRW19kbBiD+t1C1oVfia53XWfylAOxtLgyPyE/6ulnOSvvFve/fN3FGEke8B9Lnofw6zED375ji7iRe6zCq97P2p8lfAXaQrUunp7yBx8HSpkwvOayAy90lKD1j30ujj/LbOKhovCKO3ceeN1JGVkgUY5EIiOEUHcLu/++gGjY+s1RnpQrd8hBbCsjBqKYRRSxlpgiYYsd0APqBM8ilgRQHLsihWMhgpDJhTAHpqbMT5k0C5BxgxpnZA0KPfk4VRL+mhMwbV1lz2D514VdY1xYsw8EuF0o0ubvnyfQ3fXPTsmD5YSvVyno2wf5eFsL9bsQLWnS1Fvd5CNNO4863BXFSWwnRI+sbvOvxs4+zT/vmRxTrrX0VocWJ/eQkt8IQWZsB24OYEY2px2jJ+7mvf+UB81Gy3OW6pWAe7F1iF8g442Ai7pyzFdijrYAuzAfZv4sy7vd6lwFka1wLvfLJ16G3cWQ/bGjsgZTeUzaR2yQZL4WueC3TumiIYsRsY0n3Uq7I5In8uGImfSfKROp2R7h5iUTo40SWTUbwwPSC/DcB2wG6bp4uCB1GnM4dtRs+oweu5pSPGehSwi8RVs263rpp1u/PwSHePOMEEg6Lshelg7ytU9RC961f1wa79S0WtYyusPF4fYhEiau2vBRN7rybvPlKrssGfJAL15bjzubMguRo9m2I5hxftdSJZ0st2Y0cqbWbqGIoXAi1CbwPTanhvCd4Mbx+Ec9A3mGDQlv1+310yHAjIh6Z2i2O+Dor6JwAXEopzHZozptZGm9prNMw/892fvZIITjnmVRs8nGMWi3rYBp50Toa3iJUlThA7gHfQM606COAL6CvMOQBeT/t8YqeLsp5jDkSXNHEvgPsA3Bc89KLPHHnuNItiphFWCsMyaZPmj8Ii77c0L99Xu2SDCQBq0HX/6QoVvGQZets67kQOvSUwzIWZTmLi5d3oZ+nPcB4VVBiW/CTtbyeYICdOGmFWqFAmLEDviJ6D6C3UdOoyPp/Ixxb6Hr8KFSr04pyMzwtSx2D4qfPHsLHKVqgwTOiz2Xk+VIayFSp4y3rYkT6D2Zo1jN5GojecPyrCrFDBe36JnkXQ2ZiD3u6Si50/KkPZChXKkIowK1QoQyrCrFChDKEs66R46VaFCmXBW5PPziX7HJyMIXkVKgxzouhn0fT/A3tQ05HQIpHYAAAAAElFTkSuQmCC","PNG",20,20,100,21),n.setFontSize(10),n.text(150,25,"Chromosome: Location"),n.setFontSize(14),n.text(150,40,$("#chromosome-selector").val()+" : "+$("#text-location").val()),n.setTextColor(0,0,0),n.setFontSize(10),null!=t._workspaceId&&(n.text(350,25,"Workspace ID"),n.setTextColor(0,0,255),n.setFontSize(16),n.text(350,45,a)),n.setFontSize(14),n.text(350,40,$("#save-workspace-text").val()),n.addImage(o,"PNG",15,55),n.save(r)):(navigator.msSaveBlob?(o=n.msToBlob(),n=new Blob([o],{type:"image/png"}),navigator.msSaveBlob(n,r)):(n=new Blob([o],{type:"image/png"}),void 0!==(a=document.createElement("a")).download?(URL.createObjectURL(n),a.setAttribute("href",o),a.setAttribute("download",r),a.style="visibility:hidden",a.setAttribute("target","_blank"),document.body.appendChild(a),a.click(),document.body.removeChild(a)):(r=o.replace("image/png","image/octet-stream"),window.open(r))),e.find(".tempCanvas").remove(),i.each(function(){$(this).show()}))})},epiviz.ui.ControlManager=function(t,e,i,n,r){this._config=t,this._chartFactory=e,this._chartManager=i,this._measurementsManager=n,this._locationManager=r,this._addChart=new epiviz.events.Event,this._activeWorkspaceChanged=new epiviz.events.Event,this._saveWorkspace=new epiviz.events.Event,this._deleteActiveWorkspace=new epiviz.events.Event,this._revertActiveWorkspace=new epiviz.events.Event,this._loginLinkClicked=new epiviz.events.Event,this._searchWorkspaces=new epiviz.events.Event,this._search=new epiviz.events.Event,this._activeWorkspaceInfo=null,this._stepRatio=t.navigationStepRatio,this._zoominRatio=t.zoominRatio,this._zoomoutRatio=t.zoomoutRatio},epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS={plot:"feature-view",track:"location-view","data-structure":"data-structure-view"},epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS={plot:"Feature",track:"Location","data-structure":"Data Structure"},epiviz.ui.ControlManager.prototype.initialize=function(){this._initializeChromosomeSelector(),this._initializeLocationTextbox(),this._initializeNavigationButtons(),this._initializeZoomButtons(),this._initializeLocationSettingsDialog(),this._initializeChartMenus(),this._initializeComputedMeasurementsMenu(),this._initializeHelpButton(),this._initializeSearchBox(),this._initializeWorkspaceSaving(),this._initializeTutorials(),this._initializeScreenshotMenu(),this._initializeLoginLink(),this._initializeLayout(),this._checkBrowserCompatibility(),this._registerLocationChanged(),this._registerSeqInfosUpdated()},epiviz.ui.ControlManager.prototype.onAddChart=function(){return this._addChart},epiviz.ui.ControlManager.prototype.onActiveWorkspaceChanged=function(){return this._activeWorkspaceChanged},epiviz.ui.ControlManager.prototype.onSaveWorkspace=function(){return this._saveWorkspace},epiviz.ui.ControlManager.prototype.onDeleteActiveWorkspace=function(){return this._deleteActiveWorkspace},epiviz.ui.ControlManager.prototype.onRevertActiveWorkspace=function(){return this._revertActiveWorkspace},epiviz.ui.ControlManager.prototype.onLoginLinkClicked=function(){return this._loginLinkClicked},epiviz.ui.ControlManager.prototype.onSearchWorkspaces=function(){return this._searchWorkspaces},epiviz.ui.ControlManager.prototype.onSearch=function(){return this._search},epiviz.ui.ControlManager.prototype._updateSeqNames=function(t){var e=$("#chromosome-selector");e.empty();for(var i=0;i<t.length;++i){var n=sprintf('<option value="%s"%s>%s</option>',t[i].seqName,this._locationManager.currentLocation()&&t[i].seqName==this._locationManager.currentLocation().seqName()?'selected="selected"':"",t[i].seqName);e.append(n)}e.selectmenu()},epiviz.ui.ControlManager.prototype._updateSelectedLocation=function(t){if(t){this._locationManager.changeCurrentLocation(t),t=this._locationManager.currentLocation(),$("#text-location").val(Globalize.format(t.start(),"n0")+" - "+Globalize.format(t.end(),"n0"));var e=$("#chromosome-selector");e.val(t.seqName()),e.selectmenu()}},epiviz.ui.ControlManager.prototype.updateSelectedWorkspace=function(t){var e=this,i=$("#save-workspace-text"),n=this._activeWorkspaceInfo;i.val(t.name),this._activeWorkspaceInfo=t,this._activeWorkspaceChanged.notify({oldValue:n,newValue:t,cancel:function(){i.val(n.name),e._activeWorkspaceInfo=n}})},epiviz.ui.ControlManager.prototype._initializeChromosomeSelector=function(){var t=$("#chromosome-selector");t.selectmenu({style:"popup",width:"90",maxHeight:"100",menuWidth:"90"});var e=this;t.change(function(){var t=e._locationManager.lastUnfilledLocationChangeRequest()||e._locationManager.currentLocation(),i=$(this).val();e._updateSelectedLocation(new epiviz.datatypes.GenomicRange(i,t.start(),t.width(),t.genome()))})},epiviz.ui.ControlManager.prototype._initializeLocationTextbox=function(){var t=this;$("#text-location").keypress(function(e){if(13!=e.which)return!0;try{var i=$(this).val().split("-"),n=Globalize.parseInt(i[0]),r=Globalize.parseInt(i[1]),a=t._locationManager.lastUnfilledLocationChangeRequest()||t._locationManager.currentLocation();return t._updateSelectedLocation(epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),n,r,a.genome())),!0}catch(t){return!1}})},epiviz.ui.ControlManager.prototype._initializeNavigationButtons=function(){var t=this;$("#moveright").button({icons:{primary:"ui-icon ui-icon-seek-next"},text:!1}).click(function(){var e=t._locationManager.lastUnfilledLocationChangeRequest()||t._locationManager.currentLocation(),i=e.start()+Math.round(e.width()*t._stepRatio);t._updateSelectedLocation(new epiviz.datatypes.GenomicRange(e.seqName(),i,e.width(),e.genome()))}),$("#moveleft").button({icons:{primary:"ui-icon ui-icon-seek-prev"},text:!1}).click(function(){var e=t._locationManager.lastUnfilledLocationChangeRequest()||t._locationManager.currentLocation(),i=e.start()-Math.round(e.width()*t._stepRatio);t._updateSelectedLocation(new epiviz.datatypes.GenomicRange(e.seqName(),i,e.width(),e.genome()))})},epiviz.ui.ControlManager.prototype._initializeZoomButtons=function(){var t=this,e=$("#zoomin");e.button({icons:{primary:"ui-icon ui-icon-zoomin"},text:!1});var i=$("#zoomout");i.button({icons:{primary:"ui-icon ui-icon-zoomout"},text:!1});var n=function(e){var i=t._locationManager.lastUnfilledLocationChangeRequest()||t._locationManager.currentLocation(),n=i.start()+.5*i.width();e=Math.round(i.width()*e),n=Math.round(n-.5*e),t._updateSelectedLocation(new epiviz.datatypes.GenomicRange(i.seqName(),n,e,i.genome()))};e.click(function(){n(t._zoominRatio)}),i.click(function(){n(t._zoomoutRatio)})},epiviz.ui.ControlManager.prototype._initializeLocationSettingsDialog=function(){var t=this;$("#location-settings").button({text:!1,icons:{primary:"ui-icon ui-icon-gear"}}).click(function(){$("#location-settings-dialog").dialog("open")}),$("#location-settings-dialog").dialog({autoOpen:!1,resizable:!1,width:"300",buttons:{Ok:function(){t._zoominRatio=$("#zoomin-ratio-text").val(),t._zoomoutRatio=$("#zoomout-ratio-text").val(),t._stepRatio=$("#navigation-step-ratio-text").val(),$(this).dialog("close")},Cancel:function(){$("#zoomin-ratio-text").val(Globalize.format(t._zoominRatio,"n3")),$("#zoomout-ratio-text").val(Globalize.format(t._zoomoutRatio,"n3")),$("#navigation-step-ratio-text").val(Globalize.format(t._stepRatio,"n6")),$(this).dialog("close")}},modal:!0}),$("#zoomout-ratio-text").spinner({min:1.001,max:1e3,step:.001,start:1.2,numberFormat:"n3"}).val(t._zoomoutRatio),$("#zoomin-ratio-text").spinner({min:.001,max:.999,step:.01,start:.8,numberFormat:"n3"}).val(t._zoominRatio),$("#navigation-step-ratio-text").spinner({min:1e-6,max:1,step:1e-6,start:.2,numberFormat:"n6"}).val(t._stepRatio)},epiviz.ui.ControlManager.prototype._initializeChartMenus=function(){var t=this,e=$("#vis-menu");$("#vis-menu-button").button({text:!1,icons:{primary:"ui-icon ui-icon-scatterplot",secondary:"ui-icon-triangle-1-s"}}).click(function(){var t=e.is(":visible");return $(".dropdown-menu").find(">:first-child").hide(),t?e.hide():e.show().position({my:"left top",at:"left bottom",of:this}),!1});var i={},n=epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS;for(var r in this._chartFactory.foreach(function(t,e){e.chartDisplayType()in i||(i[e.chartDisplayType()]=[]),i[e.chartDisplayType()].push(e)}),i)i.hasOwnProperty(r)&&($(sprintf('<li class="ui-widget-header">%s</li>',n[r])).appendTo(e),i[r].forEach(function(i,n){var r=sprintf("%s-menu-add-%s",i.chartDisplayType(),i.chartHtmlAttributeName());e.append(sprintf('<li><a href="javascript:void(0)" id="%s">Add New %s</a></li>',r,i.chartName())),$("#"+r).click(function(){var n=[];if(i.isRestrictedToSameDatasourceGroup()&&n.push(new epiviz.ui.controls.DatasourceGroupWizardStep),i.chartDisplayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&n.push(new epiviz.ui.controls.MeaurementsWizardStep),n.length){var r=t._measurementsManager.measurements().subset(i.measurementsFilter());r.addAll(t._measurementsManager.measurements().map(function(t){return t.datasource()}).subset(i.measurementsFilter())),new epiviz.ui.controls.Wizard(sprintf("Add new %s",i.chartName()),{finish:function(e){t._addChart.notify({type:i,visConfigSelection:e})}},n,new epiviz.ui.controls.VisConfigSelection(r,void 0,void 0,void 0,void 0,i.chartName(),i.minSelectedMeasurements()),"750",void 0,i.isRestrictedToSameDatasourceGroup()).show(),e.hide()}else t._addChart.notify({type:i,visConfigSelection:new epiviz.ui.controls.VisConfigSelection(t._measurementsManager.measurements().subset(i.measurementsFilter()))})})}));e.hide().menu()},epiviz.ui.ControlManager.prototype._initializeComputedMeasurementsMenu=function(){var t=this;$("#computed-measurements-button").button({text:!1,icons:{primary:"ui-icon ui-icon-calculator"}}).click(function(){new epiviz.ui.controls.ComputedMeasurementsDialog("Computed Measurements",{add:function(e){t._measurementsManager.addMeasurement(e)},remove:function(e){t._measurementsManager.removeMeasurement(e)},close:function(){}},t._measurementsManager.measurements(),t._chartManager.chartsMeasurements()).show()})},epiviz.ui.ControlManager.prototype._initializeHelpButton=function(){$("#help-button").button({text:!1,icons:{primary:"ui-icon ui-icon-help"}}).click(function(){window.open("http://epiviz.github.io/","_blank").focus()})},epiviz.ui.ControlManager.prototype._initializeTutorials=function(){var t=$("#help-tutorials"),e=new epiviz.ui.tutorials,i='<div class="dropdown-menu"><ul id="tutorial-list"><li class="ui-widget-header">Tutorials</li>';0<e._tutorialList.length?e._tutorialList.forEach(function(t){i+='<li><a href="javascript:void(0);" id="'+t.id+'">'+t.name+"</a></li>"}):i+="<li>No Tutorials available</li>",i+="</ul></div>",$(sprintf(i)).insertAfter(t);var n=$("#tutorial-list");n.hide().menu(),t.button({icons:{primary:"ui-icon ui-icon-info",secondary:"ui-icon-triangle-1-s"},text:!1}).click(function(){return n.is(":visible")?n.hide():n.show().position({my:"left top",at:"left bottom",of:this}),!1}),0<e._tutorialList.length&&e._tutorialList.forEach(function(t){$("#"+t.id).click(function(){new Anno(t.tutorial).show(),n.hide()})})},epiviz.ui.ControlManager.prototype._initializeScreenshotMenu=function(){var t=this,e=$("#save-page");e.button({icons:{primary:"ui-icon ui-icon-print"},text:!1}).click(function(){var i=$("#save-workspace-text").val();t._saveWorkspace.notify({name:i,id:i==t._activeWorkspaceInfo.name?t._activeWorkspaceInfo.id:null}),e.append(sprintf('<div id="loading" title="printing workspace"><p>Save/Print the existing EpiViz workspace.</p><div style="position:absolute; right:15px;"><select class="screenshot-file-format"><option value="pdf" selected="selected">PDF</option><option value="png" >PNG</option></select></div></div>')),e.find("#loading").dialog({resizable:!1,modal:!0,title:"Print workspace as image",buttons:{Print:function(){$(this).dialog("close");var e=$(".screenshot-file-format option:selected").val(),i=Math.floor($.now()/1e3);new epiviz.ui.PrintManager("pagemain","epiviz_"+i,e,t._activeWorkspaceInfo.id).print(),$(this).dialog("destroy").remove()},cancel:function(){$(this).dialog("destroy").remove()}}}).show()})},epiviz.ui.ControlManager.prototype._initializeSearchBox=function(){var t=this,e=$("#search-box");e.watermark("Find Gene/Probe"),e.autocomplete({source:function(e,i){t._search.notify({searchTerm:e.term,callback:function(t){for(var e=[],n=0;n<t.length;++n)e.push({value:t[n].probe||t[n].gene,label:t[n].probe||t[n].gene,html:t[n].probe?sprintf("<b>%s</b>, %s, [%s: %s - %s]",t[n].probe,t[n].gene,t[n].seqName,Globalize.format(t[n].start,"n0"),Globalize.format(t[n].end,"n0")):sprintf("<b>%s</b>, [%s: %s - %s]",t[n].gene,t[n].seqName,Globalize.format(t[n].start,"n0"),Globalize.format(t[n].end,"n0")),range:epiviz.datatypes.GenomicRange.fromStartEnd(t[n].seqName,t[n].start,t[n].end)});i(e)}})},minLength:1,select:function(e,i){t._locationManager.lastUnfilledLocationChangeRequest()||t._locationManager.currentLocation();var n=i.item.range.seqName(),r=Math.round(i.item.range.start()-11*i.item.range.width()),a=22*i.item.range.width();t._updateSelectedLocation(new epiviz.datatypes.GenomicRange(n,r,a))},focus:function(t){t.preventDefault()},open:function(){},close:function(){}}).data("autocomplete")._renderItem=function(t,e){return $("<li></li>").data("item.autocomplete",e).append(sprintf("<a>%s</a>",e.html)).appendTo(t)}},epiviz.ui.ControlManager.prototype._initializeWorkspaceSaving=function(){var t=this,e=$("#save-workspace-text"),i=$("#save-workspace-button"),n=$("#revert-workspace-button"),r=$("#delete-workspace-button");i.button({text:!1,icons:{primary:"ui-icon-disk"}}).click(function(){try{var i=e.val();/[a-zA-Z0-9_\s]+/g.exec(i)==i?epiviz.workspaces.UserManager.USER_STATUS.loggedIn?t._saveWorkspace.notify({name:i,id:i==t._activeWorkspaceInfo.name?t._activeWorkspaceInfo.id:null}):new epiviz.ui.controls.MessageDialog("User not logged in",{Yes:function(){t._loginLinkClicked.notify()},No:function(){}},"You need to log in in order to save the workspace. Do you wish to log in now?",epiviz.ui.controls.MessageDialog.Icon.QUESTION).show():new epiviz.ui.controls.MessageDialog("Invalid workspace name",{Ok:function(){$(this).remove()}},"Invalid workspace name: "+i,epiviz.ui.controls.MessageDialog.Icon.ERROR).show()}catch(t){new epiviz.ui.controls.MessageDialog("Error",{ok:function(){$(this).remove()}},"An error occurred while trying to save workspace: "+t.message,epiviz.ui.controls.MessageDialog.Icon.ERROR).show()}}),r.button({text:!1,icons:{primary:"ui-icon-trash"}}).click(function(e){epiviz.workspaces.UserManager.USER_STATUS.loggedIn&&new epiviz.ui.controls.MessageDialog("Delete active workspace",{Yes:function(){t._deleteActiveWorkspace.notify()},No:function(){}},"Are you sure you want to delete the active workspace?",epiviz.ui.controls.MessageDialog.Icon.QUESTION).show()}),n.button({text:!1,icons:{primary:"ui-icon-arrowreturnthick-1-w"}}).click(function(e){new epiviz.ui.controls.MessageDialog("Delete active workspace",{Yes:function(){t._revertActiveWorkspace.notify()},No:function(){}},"Are you sure you want to revert the changes on the active workspace?",epiviz.ui.controls.MessageDialog.Icon.QUESTION).show()}),e.watermark("Save Workspace Name"),e.autocomplete({source:function(e,i){t._searchWorkspaces.notify({searchTerm:e.term,callback:function(t){for(var e=[],n=0;n<t.length;++n)e.push({value:t[n].id,label:t[n].name,html:sprintf("<b>%s</b> %s",t[n].name,t[n].id||"")});i(e)}})},minLength:0,select:function(i,n){i.preventDefault(),t.updateSelectedWorkspace({id:n.item.value||e.val(),name:n.item.label})},focus:function(t){t.preventDefault()},open:function(){},close:function(){}}).data("autocomplete")._renderItem=function(t,e){return $("<li></li>").data("item.autocomplete",e).append(sprintf("<a>%s</a>",e.html)).appendTo(t)},e.click(function(){e.autocomplete("search","")})},epiviz.ui.ControlManager.prototype._initializeLoginLink=function(){var t=this;$("#login-link").live({click:function(){t._loginLinkClicked.notify()}})},epiviz.ui.ControlManager.prototype._initializeLayout=function(){$("body").layout({applyDefaultStyles:!0,east__size:390,east__minSize:390,east__initHidden:!0,north__resizable:!1,north__initHidden:!1,south__initHidden:!0,east__initClosed:!0})},epiviz.ui.ControlManager.prototype._checkBrowserCompatibility=function(){0<epiviz.utils.getInternetExplorerVersion()&&new epiviz.ui.controls.MessageDialog("Browser compatibility warning",{Ok:function(){}},"EpiViz works best on Google Chrome, Apple Safari or Mozilla Firefox. Please open it using one of those browsers.",epiviz.ui.controls.MessageDialog.Icon.ERROR).show()},epiviz.ui.ControlManager.prototype._registerLocationChanged=function(){var t=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(e){t._updateSelectedLocation(e.newValue)}))},epiviz.ui.ControlManager.prototype._registerSeqInfosUpdated=function(){var t=this;this._locationManager.onSeqInfosUpdated().addListener(new epiviz.events.EventListener(function(e){t._updateSeqNames(e)}))},epiviz.ui.controls.SaveSvgAsImageDialog=function(t,e,i){epiviz.ui.controls.Dialog.call(this,"Save Chart SVG as Image",t),this._dialog=$("#"+this._id),this._dialog.append('<div class="save-svg-dialog"><label class="dialog-label">Choose file format:</label><br/><br/><div style="position:absolute; right:15px;"><select class="svg-file-format"><option value="pdf" selected="selected">PDF</option><option value="ps" >PS</option><option value="png" >PNG</option><option value="svg">SVG</option><option value="eps">EPS</option></select></div>'+sprintf('<form name="%s-svg-save-form" method="POST">',this._id)+'<div><input type="hidden" name="svg" /><input type="hidden" name="format" /><br/><br/></div></form></div>'),this._chartId=e,this._chartSaverLocation=i;var n=this;this._dialog.dialog({autoOpen:!1,resizable:!1,width:"200",buttons:{Ok:function(){var t=$("#"+n._chartId).find("svg").clone();t.attr("xmlns","http://www.w3.org/2000/svg"),t.attr("version","1.1");var e=n._dialog.find(".svg-file-format"),i=document.forms[sprintf("%s-svg-save-form",n._id)];i.action=n._chartSaverLocation,i.svg.value=$("<div>").append(t).html(),i.format.value=e.val(),i.submit(),n._handlers.ok(),$(this).dialog("close")},Cancel:function(){n._handlers.cancel(),$(this).dialog("close")}},modal:!0})},epiviz.ui.controls.SaveSvgAsImageDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.SaveSvgAsImageDialog.constructor=epiviz.ui.controls.SaveSvgAsImageDialog,epiviz.ui.controls.SaveSvgAsImageDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var t=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(e,i){$(this).remove(),t._dialog=null}}))},epiviz.ui.charts.decoration={},epiviz.ui.charts.decoration.VisualizationDecoration=function(t,e,i){this._visualization=t,this._otherDecoration=e,this._config=i},epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate=function(){this._otherDecoration&&this._otherDecoration.decorate()},epiviz.ui.charts.decoration.VisualizationDecoration.prototype.visualization=function(){return this._visualization},epiviz.ui.charts.decoration.VisualizationDecoration.prototype.otherDecoration=function(){return this._otherDecoration},epiviz.ui.charts.decoration.VisualizationDecoration.prototype.config=function(){return this._config},epiviz.ui.charts.decoration.ChartOptionButton=function(t,e,i){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e,i),this.isChartOptionButton=!0},epiviz.ui.charts.decoration.ChartOptionButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.decoration.ChartOptionButton.constructor=epiviz.ui.charts.decoration.ChartOptionButton,epiviz.ui.charts.decoration.ChartOptionButton.prototype.decorate=function(){if(epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this),this.isChartOptionButton){for(var t=0,e=this.otherDecoration();e;e=e.otherDecoration())e.isChartOptionButton&&++t;var i=$(sprintf('<button style="position: absolute; top: 5px; right: %spx">%s</button>',5+30*t,this._text())).appendTo(this.visualization().container()).button(this._renderOptions()).click(this._click());this.visualization().container().mousemove(function(){i.show()}).mouseleave(function(){i.hide()})}},epiviz.ui.charts.decoration.ChartOptionButton.prototype._click=function(){return function(){}},epiviz.ui.charts.decoration.ChartOptionButton.prototype._renderOptions=function(){return{}},epiviz.ui.charts.decoration.ChartOptionButton.prototype._text=function(){return""},epiviz.ui.charts.decoration.RemoveChartButton=function(t,e){epiviz.ui.charts.decoration.ChartOptionButton.call(this,t,e)},epiviz.ui.charts.decoration.RemoveChartButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype),epiviz.ui.charts.decoration.RemoveChartButton.constructor=epiviz.ui.charts.decoration.RemoveChartButton,epiviz.ui.charts.decoration.RemoveChartButton.prototype._click=function(){var t=this;return function(){t.visualization().onRemove().notify(new epiviz.ui.charts.VisEventArgs(t.visualization().id()))}},epiviz.ui.charts.decoration.RemoveChartButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-cancel"},text:!1}},epiviz.ui.charts.decoration.RemoveChartButton.prototype._text=function(){return"Remove"},epiviz.ui.charts.decoration.SaveChartButton=function(t,e){epiviz.ui.charts.decoration.ChartOptionButton.call(this,t,e)},epiviz.ui.charts.decoration.SaveChartButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype),epiviz.ui.charts.decoration.SaveChartButton.constructor=epiviz.ui.charts.decoration.SaveChartButton,epiviz.ui.charts.decoration.SaveChartButton.prototype._click=function(){var t=this;return function(){t.visualization().onSave().notify(new epiviz.ui.charts.VisEventArgs(t.visualization().id()))}},epiviz.ui.charts.decoration.SaveChartButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-disk"},text:!1}},epiviz.ui.charts.decoration.SaveChartButton.prototype._text=function(){return"Save"},epiviz.ui.controls.CustomSettingsDialog=function(t,e,i,n){epiviz.ui.controls.Dialog.call(this,t,e),this._customSettingsDefs=i,this._customSettingsValues=epiviz.utils.mapCopy(n)},epiviz.ui.controls.CustomSettingsDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.CustomSettingsDialog.constructor=epiviz.ui.controls.CustomSettingsDialog,epiviz.ui.controls.CustomSettingsDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var t=epiviz.ui.charts.CustomSetting.Type;if(!this._dialog){var e=this;this._dialog=$("#"+this._id),this._dialog.css("display","inline");var i,n,r,a,o="";for(i=0;i<this._customSettingsDefs.length;++i){n=sprintf("%s-%s",this._id,this._customSettingsDefs[i].id);var s=sprintf('<tr><td><label for="%s">%s</label></td><td style="text-align: right;">%%s</td></tr>',n,this._customSettingsDefs[i].label);switch(r=null,a=this._customSettingsValues[this._customSettingsDefs[i].id],this._customSettingsDefs[i].type){case t.BOOLEAN:s=sprintf(s,sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',n,a?'checked="checked"':"",a?"":'checked="checked"'));break;case t.ARRAY:s=sprintf(s,sprintf('<input id="%s" value="%s" class="ui-widget-content ui-corner-all" style="text-align: right; padding: 5px;" />',n,a.join(",")));break;case t.NUMBER:case t.STRING:s=sprintf(s,sprintf('<input id="%s" value="%s" class="ui-widget-content ui-corner-all" style="text-align: right; padding: 5px;" />',n,a));break;case t.CATEGORICAL:case t.MEASUREMENTS_METADATA:case t.MEASUREMENTS_ANNOTATION:var u="",c=this._customSettingsDefs[i];if(c.possibleValues)for(var l=0;l<c.possibleValues.length;++l)u+=sprintf('<option value="%1$s"%2$s>%1$s</option>',c.possibleValues[l],c.possibleValues[l]==a?'selected="selected"':"");a=sprintf('<select id="%s">%s</select>',n,u),s=sprintf(s,a)}o+=s}for(o=sprintf('<div style="margin: 5px; padding: 5px; height: auto;"><table style="width: 100%%;">%s</table></div>',o),this._dialog.append(o),i=0;i<this._customSettingsDefs.length;++i)switch(n=sprintf("%s-%s",this._id,this._customSettingsDefs[i].id),r=$("#"+n),a=this._customSettingsValues[this._customSettingsDefs[i].id],this._customSettingsDefs[i].type){case t.BOOLEAN:r.buttonset();break;case t.NUMBER:case t.ARRAY:case t.STRING:r.watermark(this._customSettingsDefs[i].label);break;case t.CATEGORICAL:case t.MEASUREMENTS_METADATA:case t.MEASUREMENTS_ANNOTATION:r.selectmenu()}this._dialog.dialog({autoOpen:!1,resizable:!1,buttons:{Ok:function(){for(var i=0;i<e._customSettingsDefs.length;++i){n=sprintf("%s-%s",e._id,e._customSettingsDefs[i].id);var a=null;if((r=$("#"+n)).val()==epiviz.ui.charts.CustomSetting.DEFAULT)a=e._customSettingsDefs[i].defaultValue;else{try{switch(e._customSettingsDefs[i].type){case t.BOOLEAN:var o=$("#"+n+" :radio:checked").attr("id");a="true"==o.substr(o.lastIndexOf("-")+1);break;case t.NUMBER:if(a=r.val()==epiviz.ui.charts.CustomSetting.DEFAULT?e._customSettingsDefs[i].defaultValue:parseFloat(r.val()),isNaN(a))return void new epiviz.ui.controls.MessageDialog("Invalid property value",{Ok:function(){}},sprintf('Invalid value for setting "%s" (%s)',e._customSettingsDefs[i].label,e._customSettingsDefs[i].id),epiviz.ui.controls.MessageDialog.Icon.ERROR).show();break;case t.ARRAY:a=r.val().split(/[\s,]+/g);break;case t.STRING:case t.CATEGORICAL:case t.MEASUREMENTS_METADATA:case t.MEASUREMENTS_ANNOTATION:a=r.val()}}catch(t){return void new epiviz.ui.controls.MessageDialog("Invalid property value",{Ok:function(){}},sprintf('Invalid value for setting "%s" (%s)',e._customSettingsDefs[i].label,e._customSettingsDefs[i].id),epiviz.ui.controls.MessageDialog.Icon.ERROR).show()}}e._customSettingsValues[e._customSettingsDefs[i].id]=a}e._handlers.ok(e._customSettingsValues),$(this).dialog("close")},Cancel:function(){e._handlers.cancel(),$(this).dialog("close")}},modal:!0}),this._dialog.dialog({close:function(t,i){$(this).remove(),e._dialog=null}})}this._dialog.dialog("open"),this._dialog.dialog("option","position","center")},epiviz.ui.charts.decoration.CustomSettingsButton=function(t,e){epiviz.ui.charts.decoration.ChartOptionButton.call(this,t,e)},epiviz.ui.charts.decoration.CustomSettingsButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype),epiviz.ui.charts.decoration.CustomSettingsButton.constructor=epiviz.ui.charts.decoration.CustomSettingsButton,epiviz.ui.charts.decoration.CustomSettingsButton.prototype._click=function(){var t=this;return function(){new epiviz.ui.controls.CustomSettingsDialog("Edit custom settings",{ok:function(e){t.visualization().setCustomSettingsValues(e)},cancel:function(){}},t.visualization().properties().customSettingsDefs,t.visualization().customSettingsValues()).show()}},epiviz.ui.charts.decoration.CustomSettingsButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-gear"},text:!1}},epiviz.ui.charts.decoration.CustomSettingsButton.prototype._text=function(){return"Custom settings"},epiviz.ui.controls.CodeDialog=function(t,e,i){epiviz.ui.controls.Dialog.call(this,t,e),this._controlCreators=i,this._dialog=$("#"+this._id),this._controls=[];var n=this;this._dialog.append('<div class="code-tabs"><ul></ul></div>');var r=this._dialog.find(".code-tabs"),a=r.find("ul");this._controlCreators.forEach(function(t,e){var i=n._id+"-code-tab-"+e;r.append(sprintf('<div id="%s"></div>',i));var o=t(o=r.find("#"+i));a.append(sprintf('<li><a href="#%s">%s</a></li>',i,o.title())),n._controls.push(o)}),r.tabs({activate:function(t,e){n._tabActivate(r)}}),this._dialog.dialog({autoOpen:!1,resizable:!1,width:"800",buttons:{Save:function(){var t=[];n._controls.forEach(function(e){e.save(),t.push(e.result())}),n._handlers.save(t),$(this).dialog("close")},Cancel:function(){n._controls.forEach(function(t){t.revert()}),n._handlers.cancel(),$(this).dialog("close")}},modal:!0}),this._dialog.dialog("option","position","center")},epiviz.ui.controls.CodeDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.CodeDialog.constructor=epiviz.ui.controls.CodeDialog,epiviz.ui.controls.CodeDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this),this._dialog.dialog("open"),this._controls[0].initialize(),this._dialog.dialog("option","position","center")},epiviz.ui.controls.CodeDialog.prototype._tabActivate=function(t){t=t.tabs("option","active"),this._controls[t].initialize(),this._dialog.dialog("option","position","center")},epiviz.ui.charts.decoration.CodeButton=function(t,e,i){var n;for(epiviz.ui.charts.decoration.ChartOptionButton.call(this,t,e,i),this.isCodeButton=!0,this._controlCreators=[],t=!0,e=this.otherDecoration();e;e=e.otherDecoration())e.isCodeButton&&(t=!1,n=e);n&&n._addControlCreator(this._controlCreator(),this._saveHandler(),this._cancelHandler()),(this.isChartOptionButton=t)&&this._addControlCreator(this._controlCreator(),this._saveHandler(),this._cancelHandler())},epiviz.ui.charts.decoration.CodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype),epiviz.ui.charts.decoration.CodeButton.constructor=epiviz.ui.charts.decoration.CodeButton,epiviz.ui.charts.decoration.CodeButton.prototype._click=function(){var t=this;return function(){new epiviz.ui.controls.CodeDialog("Chart Code",{save:function(e){e.forEach(function(e,i){t._controlCreators[i].save(e)})},cancel:function(){t._controlCreators.forEach(function(t){t.cancel()})}},t._controlCreators.map(function(t){return t.creator})).show()}},epiviz.ui.charts.decoration.CodeButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-pencil"},text:!1}},epiviz.ui.charts.decoration.CodeButton.prototype._text=function(){return"Code"},epiviz.ui.charts.decoration.CodeButton.prototype._addControlCreator=function(t,e,i){this._controlCreators.push({creator:t,save:e,cancel:i})},epiviz.ui.charts.decoration.CodeButton.prototype._controlCreator=function(){return null},epiviz.ui.charts.decoration.CodeButton.prototype._saveHandler=function(){return null},epiviz.ui.charts.decoration.CodeButton.prototype._cancelHandler=function(){return null},epiviz.ui.controls.CodeControl=function(t,e,i,n){epiviz.ui.controls.Control.call(this,t,e,i),this._targetObj=n,this._text="// TODO: Your code here\n"},epiviz.ui.controls.CodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Control.prototype),epiviz.ui.controls.CodeControl.constructor=epiviz.ui.controls.CodeControl,epiviz.ui.controls.CodeControl.prototype.initialize=function(){},epiviz.ui.controls.CodeControl.prototype.save=function(){},epiviz.ui.controls.CodeControl.prototype.revert=function(){},epiviz.ui.controls.CodeControl.prototype.text=function(){return this._text},epiviz.ui.controls.CodeControl.prototype.result=function(){return null},epiviz.ui.controls.EditCodeControl=function(t,e,i,n,r,a){epiviz.ui.controls.CodeControl.call(this,t,e,i,n),this._defaultMethod=r,this._editor=null,this._methodsCode={},this._selectedMethod=null,this._hasModifiedMethods=a||!1},epiviz.ui.controls.EditCodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.CodeControl.prototype),epiviz.ui.controls.EditCodeControl.constructor=epiviz.ui.controls.EditCodeControl,epiviz.ui.controls.EditCodeControl.prototype.initialize=function(){if(!this._editor){this._container.append('<div style="float: left; margin-right: 5px;"><select class="obj-methods"></select></div>'+sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',this.id()+"-switch",this._hasModifiedMethods?'checked="checked"':"",this._hasModifiedMethods?"":'checked="checked"')+'<br /><div style="overflow-y: scroll; max-height: 500px;"><textarea autofocus="autofocus" class="code-edit"></textarea></div>'),this._methodsSelector=this._container.find(".obj-methods"),(r=this._container.find("#"+this.id()+"-switch")).buttonset();var t=this,e=function(e){e="true"==(e=$("#"+t.id()+"-switch :radio:checked").attr("id")).substr(e.lastIndexOf("-")+1),t._editor&&t._editor.setOption("disableInput",!e),t._hasModifiedMethods=e};r.find("#"+this.id()+"-switch-true").on("change",e),r.find("#"+this.id()+"-switch-false").on("change",e);var i,n=this._container.find(".code-edit"),r=[];e=this._targetObj;for(i in e)$.isFunction(e[i])&&r.push(i);r.sort();for(var a=0;a<r.length;++a){i=r[a];var o=0==a&&!this._defaultMethod||this._defaultMethod==i;this._methodsSelector.append(sprintf('<option value="%s"%s>%s</option>',i,o?' selected="selected"':"",i)),o&&(this._text=e[i].toString(),this._selectedMethod=i)}this._methodsSelector.change(function(){t._methodsCode[t._selectedMethod]=t._editor.getValue();var e=$(this).val(),i=t._methodsCode[e];i||(i=t._targetObj[e].toString(),t._methodsCode[e]=i),t._text=i,t._editor?t._editor.getDoc().setValue(t._text):n.val(t._text),t._selectedMethod=e}),n.val(this._text),this._methodsSelector.selectmenu({style:"popup",width:"150",maxHeight:"150",menuWidth:"150"}),this._editor=CodeMirror.fromTextArea(this._container.find(".code-edit")[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0}),this._editor.setOption("disableInput",!this._hasModifiedMethods)}},epiviz.ui.controls.EditCodeControl.prototype.save=function(){this._methodsCode[this._selectedMethod]=this._editor.getValue(),this._text=this._editor.getValue()},epiviz.ui.controls.EditCodeControl.prototype.revert=function(){this._editor&&this._editor.setOption("value",this._text)},epiviz.ui.controls.EditCodeControl.prototype.modifiedMethods=function(){var t,e={};for(t in this._methodsCode)this._methodsCode.hasOwnProperty(t)&&this._methodsCode[t]!=this._targetObj[t].toString()&&(e[t]=this._methodsCode[t]);return e},epiviz.ui.controls.EditCodeControl.prototype.result=function(){return{hasModifiedMethods:this._hasModifiedMethods,modifiedMethods:this._hasModifiedMethods?this.modifiedMethods():{}}},epiviz.ui.charts.decoration.EditCodeButton=function(t,e,i){epiviz.ui.charts.decoration.CodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.EditCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.CodeButton.prototype),epiviz.ui.charts.decoration.EditCodeButton.constructor=epiviz.ui.charts.decoration.EditCodeButton,epiviz.ui.charts.decoration.EditCodeButton.prototype._controlCreator=function(){var t=this;return function(e){return new epiviz.ui.controls.EditCodeControl(e,"Edit Code",null,t.visualization(),t.visualization().lastModifiedMethod(),t.visualization().hasModifiedMethods())}},epiviz.ui.charts.decoration.EditCodeButton.prototype._saveHandler=function(){var t=this;return function(e){e.hasModifiedMethods?t.visualization().setModifiedMethods(e.modifiedMethods):t.visualization().resetModifiedMethods()}},epiviz.ui.charts.decoration.EditCodeButton.prototype._cancelHandler=function(){return function(){}},epiviz.ui.controls.ColorPickerDialog=function(t,e,i,n){epiviz.ui.controls.Dialog.call(this,"Pick Colors",t),this._dialog=$("#"+this._id),this._dialog.append('<div class="color-picker-form" action="" style="width: 420px;"><div class="chart-picker" style="float: right;"></div></div>');var r=this._dialog.find(".color-picker-form");t="";for(var a=0;a<e.length;++a){var o=sprintf("color-%s",a);t+=sprintf('<tr><td><label>%s:&nbsp;</label></td><td><input type="text" name="%s" class="colorwell %s" value="%s" /></td></tr>',e[a],o,o,0<=n.keyColorIndex(e[a])?n.getByKey(e[a]):n.get(a))}r.append(sprintf('<table class="color-picker-table">%s</table>',t));var s,u=$.farbtastic(sprintf("#%s .chart-picker",this._id)),c=$(sprintf("#%s .chart-picker",this._id)).css("opacity",.25);$(sprintf("#%s .colorwell",this._id)).each(function(){u.linkTo(this),$(this).css("opacity",.75)}).focus(function(){s&&$(s).css("opacity",.75).removeClass("colorwell-selected"),u.linkTo(this),c.css("opacity",1),$(s=this).css("opacity",1).addClass("colorwell-selected")}),r.append('<select class="palettes-selector"></select>');var l=r.find(".palettes-selector"),p={};i&&i.forEach(function(t){l.append(sprintf('<option value="%s"%s>%s</option>',t.id(),t.id()==n.id()?' selected="selected"':"",t.name())),p[t.id()]=t}),n.id()in p||(l.prepend(sprintf('<option value="%s" selected="selected">%s</option>',n.id(),n.name())),p[n.id()]=n),l.selectmenu({style:"popup",width:"200",maxHeight:"150",menuWidth:"200"});var h=function(){for(var t=r.find(".colorwell"),e=0;e<t.length;++e)u.linkTo($(t[e])),u.setColor(n.get(e));s&&u.linkTo(s)};l.change(function(){n=p[$(this).val()],h()});var d=this;this._dialog.dialog({autoOpen:!1,resizable:!1,width:"440",buttons:{Ok:function(){var t,i=r.find(".colorwell"),a=!1,o=[];for(t=0;t<n.size();++t)o.push(n.get(t));for(t=0;t<i.length;++t){var s=i[t].value,u=n.keyColorIndex(e[t]);0>u&&(u=t),s!=o[u]&&(a=!0,o[u]=s)}a&&(n=new epiviz.ui.charts.ColorPalette(o,void 0,void 0,n.keyIndices())),d._handlers.ok(n),$(this).dialog("close")},Cancel:function(){d._handlers.cancel(),$(this).dialog("close")},Reset:function(){h(),d._handlers.reset()}},modal:!0})},epiviz.ui.controls.ColorPickerDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype),epiviz.ui.controls.ColorPickerDialog.constructor=epiviz.ui.controls.ColorPickerDialog,epiviz.ui.controls.ColorPickerDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var t=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(e,i){$(this).remove(),t._dialog=null}}))},epiviz.ui.charts.decoration.ChartColorsButton=function(t,e,i){epiviz.ui.charts.decoration.ChartOptionButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartColorsButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype),epiviz.ui.charts.decoration.ChartColorsButton.constructor=epiviz.ui.charts.decoration.ChartColorsButton,epiviz.ui.charts.decoration.ChartColorsButton.prototype._click=function(){var t=this;return function(){var e=t.visualization().colorLabels();new epiviz.ui.controls.ColorPickerDialog({ok:function(e){t.visualization().setColors(e)},cancel:function(){},reset:function(){}},e,t.config().colorPalettes,t.visualization().colors()).show()}},epiviz.ui.charts.decoration.ChartColorsButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-colorpicker"},text:!1}},epiviz.ui.charts.decoration.ChartColorsButton.prototype._text=function(){return"Colors"},epiviz.ui.charts.decoration.ChartLoaderAnimation=function(t,e){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e),this._loaderTimeout=0,this._animationShowing=!1},epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.decoration.ChartLoaderAnimation.constructor=epiviz.ui.charts.decoration.ChartLoaderAnimation,epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);var t=this;this.visualization().onDataWaitStart().addListener(new epiviz.events.EventListener(function(){t._addLoaderAnimation()})),this.visualization().onDataWaitEnd().addListener(new epiviz.events.EventListener(function(){t._removeLoaderAnimation()})),this.visualization().onSizeChanged().addListener(new epiviz.events.EventListener(function(){t._animationShowing&&t._addLoaderAnimation()}))},epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype._addLoaderAnimation=function(){this._loaderTimeout&&clearTimeout(this._loaderTimeout);var t=function(){e._animationShowing=!0;var t=e.visualization(),i=t.container();i.find(".chart-loader").remove(),i.append(sprintf('<div class="loader-icon %s" style="top: %spx; left: %spx;"></div>',"chart-loader",Math.floor(.5*t.height()),Math.floor(.5*t.width()))),i.find(".chart-loader").activity({segments:8,steps:5,opacity:.3,width:4,space:0,length:10,color:"#0b0b0b",speed:1})},e=this;this._animationShowing?t():this._loaderTimeout=setTimeout(t,500)},epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype._removeLoaderAnimation=function(){this._loaderTimeout&&clearTimeout(this._loaderTimeout),this._animationShowing=!1,this.visualization().container().find(".chart-loader").remove()},epiviz.ui.charts.decoration.ChartResize=function(t,e){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e)},epiviz.ui.charts.decoration.ChartResize.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.decoration.ChartResize.constructor=epiviz.ui.charts.decoration.ChartResize,epiviz.ui.charts.decoration.ChartResize.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);var t=this;this.visualization().container().resizable({stop:function(e,i){t.visualization().updateSize()}})},epiviz.ui.charts.decoration.ToggleTooltipButton=function(t,e){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e),this.isChartOptionButton=!0,this._checked=!1},epiviz.ui.charts.decoration.ToggleTooltipButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.decoration.ToggleTooltipButton.constructor=epiviz.ui.charts.decoration.ToggleTooltipButton,epiviz.ui.charts.decoration.ToggleTooltipButton.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var t=0,e=this.otherDecoration();e;e=e.otherDecoration())e.isChartOptionButton&&++t;var i=this;e=sprintf("%s-tooltip-button",this.visualization().id());this.visualization().container().append(sprintf('<div id="%1$s-container" style="position: absolute; top: 5px; right: %2$spx"><input type="checkbox" id="%1$s" %3$s /><label for="%1$s" >Toggle tooltip</label></div>',e,5+30*t,this._checked?'checked="checked"':""));var n=$("#"+e),r=$("#"+e+"-container");n.button({text:!1,icons:{primary:"ui-icon-comment"}}).click(function(){i._checked=n.is(":checked")}),this.visualization().container().mousemove(function(){r.show()}).mouseleave(function(){r.hide()})},epiviz.ui.charts.decoration.ToggleTooltipButton.prototype.checked=function(){return this._checked},epiviz.ui.charts.decoration.ChartTooltip=function(t,e){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e)},epiviz.ui.charts.decoration.ChartTooltip.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.decoration.ChartTooltip.constructor=epiviz.ui.charts.decoration.ChartTooltip,epiviz.ui.charts.decoration.ChartTooltip.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var t=void 0,e=this.otherDecoration();e;e=e.otherDecoration())if(e.constructor==epiviz.ui.charts.decoration.ToggleTooltipButton){t=e;break}var i=this;this.visualization().container().tooltip({items:".item",content:function(){if(!t.checked())return!1;var e=d3.select(this).data()[0];return e.valueItems[0].length>e.measurements.length+e.measurements[0].metadata().length?i._horizontalContent(e):i._verticalContent(e)},track:!0,show:!1})},epiviz.ui.charts.decoration.ChartTooltip.prototype._horizontalContent=function(t){for(var e=t.measurements[0].metadata(),i=sprintf("%s%s%s",null!=t.start&&null!=t.end?"<th><b>Start</b></th><th><b>End</b></th>":"",e?"<th><b>"+e.join("</b></th><th><b>")+"</b></th>":"",t.values?"<th><b>"+t.measurements.join("</b></th><th><b>")+"</b></th>":""),n="",r=0;r<t.valueItems[0].length&&10>r;++r){var a="",o=t.valueItems[0][r].rowItem,s=Globalize.format(o.start(),"n0"),u=Globalize.format(o.end(),"n0");if(null!=s&&null!=u&&(a+=sprintf("<td>%s</td><td>%s</td>",s,u)),o=o.rowMetadata(),e&&o)for(s=0;s<e.length;++s)u=o[e[s]]||"",a+=sprintf("<td>%s</td>",15>=u.length?u:u.substr(0,15)+"...");if(t.values)for(o=0;o<t.measurements.length;++o)a+=sprintf("<td>%s</td>",Globalize.format(t.valueItems[o][r].value,"n3"));n+=sprintf("<tr>%s</tr>",a)}return r<t.valueItems[0].length&&(n+=sprintf('<tr><td colspan="%s" style="text-align: center;">...</td></tr>',2+(e?e.length:0)+(t.values?t.measurements.length:0))),sprintf('<table class="tooltip-table"><thead><tr>%s</tr></thead><tbody>%s</tbody></table>',i,n)},epiviz.ui.charts.decoration.ChartTooltip.prototype._verticalContent=function(t){var e=[],i=[0,0];if(null!=t.start&&null!=t.end){var n=["Start"],r=["End"];t.valueItems[0].every(function(t,e){return n.push(Globalize.format(t.rowItem.start(),"n0")),r.push(Globalize.format(t.rowItem.end(),"n0")),5>e}),e.push(n),e.push(r),i=[0,2]}var a=t.measurements[0].metadata(),o=[i[1],i[1]+a.length];a.forEach(function(i){var n=[i];t.valueItems[0].every(function(t,e){var r=t.rowItem.metadata(i)||"[NA]";return 15<r.length&&(r=r.substr(0,15)+"..."),n.push(r),5>e}),e.push(n)}),a=[o[1],o[1]],t.values&&(a=[o[1],o[1]+t.measurements.length],t.measurements.forEach(function(i,n){var r=[i.name()];t.valueItems[n].every(function(t,e){return r.push(Globalize.format(t.value,"n3")),5>e}),e.push(r)})),10<(u=a[1])&&(i[1]=1,o[1]=Math.min(o[1],o[0]+4),10<(u=i[1]-i[0]+o[1]-o[0]+a[1]-a[0])&&(a[1]-=u-10));var s,u="";for(s=i[0];s<i[1];++s)u+="<tr><td><b>"+e[s][0]+"</b></td><td>"+e[s].slice(1).join("</td><td>")+"</td></tr>";for(s=o[0];s<o[1];++s)u+="<tr><td><b>"+e[s][0]+"</b></td><td>"+e[s].slice(1).join("</td><td>")+"</td></tr>";for(s=a[0];s<a[1];++s)u+="<tr><td><b>"+e[s][0]+"</b></td><td>"+e[s].slice(1).join("</td><td>")+"</td></tr>";return'<table class="tooltip-table"><tbody>'+u+"</tbody></table>"},epiviz.ui.controls.MarkerCodeControl=function(t,e,i,n,r,a,o){epiviz.ui.controls.CodeControl.call(this,t,e,i,n),this._markEditor=this._editor=null,this._editorText=r,this._markText=a,this._enabled=o||!1},epiviz.ui.controls.MarkerCodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.CodeControl.prototype),epiviz.ui.controls.MarkerCodeControl.constructor=epiviz.ui.controls.MarkerCodeControl,epiviz.ui.controls.MarkerCodeControl.prototype.initialize=function(){if(!this._editor){this._container.append(sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',this.id()+"-switch",this._enabled?'checked="checked"':"",this._enabled?"":'checked="checked"')+'<br /><div><label><b>Pre-mark Method</b></label></div><br /><div style="overflow-y: scroll; max-height: 250px;"><textarea autofocus="autofocus" class="pre-filter-code"></textarea></div><br/><div><label><b>Mark Method</b></label></div><br/><div style="overflow-y: scroll; max-height: 250px;"><textarea autofocus="autofocus" class="filter-code"></textarea></div>');var t=this._container.find("#"+this.id()+"-switch");t.buttonset();var e=this,i=function(t){t="true"==(t=$("#"+e.id()+"-switch :radio:checked").attr("id")).substr(t.lastIndexOf("-")+1),e._editor&&e._editor.setOption("disableInput",!t),e._markEditor&&e._markEditor.setOption("disableInput",!t),e._enabled=t};t.find("#"+this.id()+"-switch-true").on("change",i),t.find("#"+this.id()+"-switch-false").on("change",i),(t=this._container.find(".pre-filter-code")).val(this._editorText),(i=this._container.find(".filter-code")).val(this._markText),this._editor=CodeMirror.fromTextArea(t[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0}),this._editor.setOption("disableInput",!this._enabled),this._markEditor=CodeMirror.fromTextArea(i[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0}),this._markEditor.setOption("disableInput",!this._enabled)}},epiviz.ui.controls.MarkerCodeControl.prototype.save=function(){this._editor&&(this._editorText=this._editor.getValue(),this._markText=this._markEditor.getValue())},epiviz.ui.controls.MarkerCodeControl.prototype.revert=function(){this._editor&&this._editor.setOption("value",this._editorText),this._markEditor&&this._markEditor.setOption("value",this._markText)},epiviz.ui.controls.MarkerCodeControl.prototype.result=function(){return{enabled:this._enabled,preMark:this._enabled?this._editorText:null,mark:this._enabled?this._markText:null}},epiviz.ui.charts.decoration.MarkerCodeButton=function(t,e,i){epiviz.ui.charts.decoration.CodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.MarkerCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.CodeButton.prototype),epiviz.ui.charts.decoration.MarkerCodeButton.constructor=epiviz.ui.charts.decoration.MarkerCodeButton,epiviz.ui.charts.decoration.MarkerCodeButton.prototype._controlCreator=function(){var t=this;return function(e){var i,n,r=t.visualization().getMarker(t.markerId());return r&&(i=r.preMarkStr(),n=r.markStr()),i=i||t.preMarkTemplate(),n=n||t.markTemplate(),new epiviz.ui.controls.MarkerCodeControl(e,t.markerLabel(),null,t.visualization(),i,n,null!=r)}},epiviz.ui.charts.decoration.MarkerCodeButton.prototype._saveHandler=function(){var t=this;return function(e){e.enabled?t.visualization().putMarker(t.createMarker(e.preMark,e.mark)):t.visualization().removeMarker(t.markerId())}},epiviz.ui.charts.decoration.MarkerCodeButton.prototype._cancelHandler=function(){return function(){}},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.createMarker=function(t,e){return new epiviz.ui.charts.markers.VisualizationMarker(this.markerType(),this.markerId(),this.markerLabel(),t,e)},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerType=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerLabel=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerId=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.preMarkTemplate=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markTemplate=function(){throw Error("unimplemented abstract method")},epiviz.ui.charts.decoration.ChartFilterCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.ChartFilterCodeButton.constructor=epiviz.ui.charts.decoration.ChartFilterCodeButton,epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER},epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerLabel=function(){return"User Filter"},epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerId=function(){return"user-filter"},epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.datatypes.GenomicData.ValueItem} [item]\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {boolean}\n * @template InitialVars\n */\nfunction(item, data, preMarkResult) {\n  // TODO: Your code here\n  return true;\n}\n"},epiviz.ui.charts.tree.decoration={},epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton=function(t,e){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,t,e),this._checked=this.isChartOptionButton=!0},epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype),epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.constructor=epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton,epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var t=0,e=this.otherDecoration();e;e=e.otherDecoration())e.isChartOptionButton&&++t;var i=this;e=sprintf("%s-propagate-selection-button",this.visualization().id());this.visualization().container().append(sprintf('<div id="%1$s-container" style="position: absolute; top: 5px; right: %2$spx"><input type="checkbox" id="%1$s" %3$s /><label for="%1$s" >Toggle propagate selection</label></div>',e,5+30*t,this._checked?'checked="checked"':""));var n=$("#"+e),r=$("#"+e+"-container");n.button({text:!1,icons:{primary:"ui-icon ui-icon-refresh"}}).click(function(){i._checked=n.is(":checked"),i.visualization().setAutoPropagateChanges(i._checked)}),this.visualization().container().mousemove(function(){r.show()}).mouseleave(function(){r.hide()})},epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype.checked=function(){return this._checked},epiviz.ui.charts.decoration.HierarchyFilterCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.HierarchyFilterCodeButton.constructor=epiviz.ui.charts.decoration.HierarchyFilterCodeButton,epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER},epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerLabel=function(){return"User Filter"},epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerId=function(){return"user-filter"},epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.ui.charts.tree.Node} [root]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(root) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.ui.charts.tree.Node} [node]\n * @param {epiviz.ui.charts.tree.Node} [root]\n * @param {InitialVars} [preMarkResult]\n * @returns {boolean}\n * @template InitialVars\n */\nfunction(node, root, preMarkResult) {\n  // TODO: Your code here\n  return true;\n}\n"},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton,epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerLabel=function(){return"Group by"},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerId=function(){return"group-by-measurements"},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton,epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_MEASUREMENTS},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerLabel=function(){return"Color by Measurements"},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerId=function(){return"color-by-measurements"},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string|number}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton,epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.ORDER_BY_MEASUREMENTS},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerLabel=function(){return"Order By"},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerId=function(){return"order-by-measurements"},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string|number}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"},epiviz.ui.charts.decoration.ChartColorByRowCodeButton=function(t,e,i){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,t,e,i)},epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype),epiviz.ui.charts.decoration.ChartColorByRowCodeButton.constructor=epiviz.ui.charts.decoration.ChartColorByRowCodeButton,epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_ROW},epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerLabel=function(){return"Color By"},epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerId=function(){return"color-by"},epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"},epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.datatypes.GenomicData.RowItem} [row]\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string}\n * @template InitialVars\n */\nfunction(row, data, preMarkResult) {\n  // TODO: Your code here\n  return row.metadata('colLabel');\n}\n"},epiviz.ui.charts.ChartManager=function(t){this._config=t,this._charts={},this._chartsOrder={},this._resizeInterval=null,this._chartAdded=new epiviz.events.Event,this._chartRemoved=new epiviz.events.Event,this._chartsOrderChanged=new epiviz.events.Event,this._chartsCleared=new epiviz.events.Event,this._chartColorsChanged=new epiviz.events.Event,this._chartMethodsModified=new epiviz.events.Event,this._chartMethodsReset=new epiviz.events.Event,this._chartMarkersModified=new epiviz.events.Event,this._chartCustomSettingsChanged=new epiviz.events.Event,this._chartSizeChanged=new epiviz.events.Event,this._chartMarginsChanged=new epiviz.events.Event,this._chartRequestHierarchy=new epiviz.events.Event,this._chartPropagateHierarchyChanges=new epiviz.events.Event,this._chartPropogateIcicleLocationChanges=new epiviz.events.Event,this._chartIcicleLocationChanges=new epiviz.events.Event,this._chartPropagateNavigationChanges=new epiviz.events.Event,this._registerWindowResize()},epiviz.ui.charts.ChartManager.prototype.addChart=function(t,e,i,n){i=i||sprintf("%s-%s-%s",t.chartDisplayType(),t.chartHtmlAttributeName(),epiviz.utils.generatePseudoGUID(5));var r=t.cssClass(),a=$("#"+t.chartContainer()),o=a.find(".accordion"),s=o.find(".vis-container");if(0==o.length&&(o=$('<div class="accordion"></div>').appendTo(a),a=t.chartDisplayType(),o.append(sprintf('<h3><a href="#"><b><span style="color: #025167">Views by %s</span></b></a></h3>',epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS[a])),s=$('<div class="vis-container"></div>').appendTo(o),o.multiAccordion(),o.multiAccordion("option","active","all")),s.append(sprintf('<div id="%s" class="%s"></div>',i,r)),o=s.find("#"+i),a=[],null!=t._defaultSettings.chartMarkers||null!=t._defaultSettings.chartMarkers)for(r=0;r<t._defaultSettings.chartMarkers.length;r++)s=t._defaultSettings.chartMarkers[r],a.push(new epiviz.ui.charts.markers.VisualizationMarker(s.type,s.id,s.name,s.preMark,s.mark));if(n=n||new epiviz.ui.charts.VisualizationProperties(t.defaultWidth(),t.defaultHeight(),t.defaultMargins(),e,t.defaultColors(),null,t.customSettingsValues(),t.customSettingsDefs(),a),e=t.createNew(i,o,n),this._charts[i]=e,this._registerChartHover(e),this._registerChartUnhover(e),this._registerChartSelect(e),this._registerChartDeselect(e),this._registerChartColorsChanged(e),this._registerChartMethodsModified(e),this._registerChartMethodsReset(e),this._registerChartMarkersModified(e),this._registerChartCustomSettingsChanged(e),this._registerChartSizeChanged(e),this._registerChartMarginsChanged(e),this._registerChartRemove(e),this._registerChartSave(e),this._registerChartRequestHierarchy(e),this._registerChartPropagateHierarchyChanges(e),this._registerChartPropogateIcicleLocationChanges(e),this._registerChartIcicleLocationChanges(e),this._registerChartPropagateNavigationChanges(e),t.decorations()){for(o=void 0,r=0;r<t.decorations().length;++r)(a=epiviz.utils.evaluateFullyQualifiedTypeName(t.decorations()[r]))&&(o=epiviz.utils.applyConstructor(a,[e,o,this._config]));o&&o.decorate()}return t.chartDisplayType()in this._chartsOrder||(this._chartsOrder[t.chartDisplayType()]=[]),this._chartsOrder[t.chartDisplayType()].push(i),this._chartAdded.notify(new epiviz.ui.charts.VisEventArgs(i,{type:t,properties:n,chartsOrder:this._chartsOrder})),i},epiviz.ui.charts.ChartManager.prototype.removeChart=function(t){$("#"+t).remove();var e=this._charts[t];delete this._charts[t],this._chartsOrder[e.displayType()].splice(this._chartsOrder[e.displayType()].indexOf(t),1),0==(e=$("#"+epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS[e.displayType()])).find(".accordion").find(".vis-container").children().length&&e.empty(),this._chartRemoved.notify(new epiviz.ui.charts.VisEventArgs(t,this._chartsOrder))},epiviz.ui.charts.ChartManager.prototype.chartsMeasurements=function(){var t,e={};for(t in this._charts)this._charts.hasOwnProperty(t)&&this._charts[t].displayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&(e[t]=this._charts[t].measurements());return e},epiviz.ui.charts.ChartManager.prototype.updateCharts=function(t,e,i){i=i||Object.keys(this._charts);for(var n=0;n<i.length;++n)if(this._charts.hasOwnProperty(i[n])){var r=this._charts[i[n]];r&&function(i){i.transformData(t,e).done(function(){i.draw()})}(r)}},epiviz.ui.charts.ChartManager.prototype.updateDataStructureCharts=function(){for(var t=Object.keys(this._charts),e=0;e<t.length;++e)if(this._charts.hasOwnProperty(t[e])){var i=this._charts[t[e]];i&&i.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&function(t){setTimeout(function(){t.fireRequestHierarchy()},0)}(i)}},epiviz.ui.charts.ChartManager.prototype.clear=function(){this._charts={},this._chartsOrder={};var t,e=epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS;for(t in e)e.hasOwnProperty(t)&&$("#"+e[t]).empty();this._chartsCleared.notify()},epiviz.ui.charts.ChartManager.prototype.dataWaitStart=function(t,e){if(t&&this._charts[t])this._charts[t].onDataWaitStart().notify(new epiviz.ui.charts.VisEventArgs(t));else for(var i in this._charts)this._charts.hasOwnProperty(i)&&e&&e[this._charts[i]]&&this._charts[i].onDataWaitStart().notify(new epiviz.ui.charts.VisEventArgs(i))},epiviz.ui.charts.ChartManager.prototype.onChartAdded=function(){return this._chartAdded},epiviz.ui.charts.ChartManager.prototype.onChartRemoved=function(){return this._chartRemoved},epiviz.ui.charts.ChartManager.prototype.onChartsOrderChanged=function(){return this._chartsOrderChanged},epiviz.ui.charts.ChartManager.prototype.onChartsCleared=function(){return this._chartsCleared},epiviz.ui.charts.ChartManager.prototype.onChartColorsChanged=function(){return this._chartColorsChanged},epiviz.ui.charts.ChartManager.prototype.onChartMethodsModified=function(){return this._chartMethodsModified},epiviz.ui.charts.ChartManager.prototype.onChartMethodsReset=function(){return this._chartMethodsReset},epiviz.ui.charts.ChartManager.prototype.onChartMarkersModified=function(){return this._chartMarkersModified},epiviz.ui.charts.ChartManager.prototype.onChartCustomSettingsChanged=function(){return this._chartCustomSettingsChanged},epiviz.ui.charts.ChartManager.prototype.onChartSizeChanged=function(){return this._chartSizeChanged},epiviz.ui.charts.ChartManager.prototype.onChartMarginsChanged=function(){return this._chartMarginsChanged},epiviz.ui.charts.ChartManager.prototype.onChartRequestHierarchy=function(){return this._chartRequestHierarchy},epiviz.ui.charts.ChartManager.prototype.onChartPropagateHierarchyChanges=function(){return this._chartPropagateHierarchyChanges},epiviz.ui.charts.ChartManager.prototype.onChartPropogateIcicleLocationChanges=function(){return this._chartPropogateIcicleLocationChanges},epiviz.ui.charts.ChartManager.prototype.onChartIcicleLocationChanges=function(){return this._chartIcicleLocationChanges},epiviz.ui.charts.ChartManager.prototype.onChartPropagateNavigationChanges=function(){return this._chartPropagateNavigationChanges},epiviz.ui.charts.ChartManager.prototype._registerWindowResize=function(){var t=this;$(window).resize(function(){null!==t._resizeInterval&&window.clearTimeout(t._resizeInterval),t._resizeInterval=window.setTimeout(function(){for(var e in t._charts)t._charts.hasOwnProperty(e)&&t._charts[e].updateSize();t._resizeInterval=null},500)})},epiviz.ui.charts.ChartManager.prototype._registerChartHover=function(t){var e=this;t.onHover().addListener(new epiviz.events.EventListener(function(t){for(var i in e._charts)e._charts.hasOwnProperty(i)&&e._charts[i].doHover(t.args)}))},epiviz.ui.charts.ChartManager.prototype._registerChartUnhover=function(t){var e=this;t.onUnhover().addListener(new epiviz.events.EventListener(function(){for(var t in e._charts)e._charts.hasOwnProperty(t)&&e._charts[t].doUnhover()}))},epiviz.ui.charts.ChartManager.prototype._registerChartSelect=function(t){var e=this;t.onSelect().addListener(new epiviz.events.EventListener(function(t){for(var i in t=t.args,e._charts)e._charts.hasOwnProperty(i)&&e._charts[i].doSelect(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartDeselect=function(t){var e=this;t.onDeselect().addListener(new epiviz.events.EventListener(function(){for(var t in e._charts)e._charts.hasOwnProperty(t)&&e._charts[t].doDeselect()}))},epiviz.ui.charts.ChartManager.prototype._registerChartRemove=function(t){var e=this;t.onRemove().addListener(new epiviz.events.EventListener(function(t){e.removeChart(t.id)}))},epiviz.ui.charts.ChartManager.prototype._registerChartSave=function(t){var e=this;"default"!=e._config.configType?t.onSave().addListener(new epiviz.events.EventListener(function(t){new epiviz.ui.PrintManager(t.id,"epiviz_"+Math.floor($.now()/1e3),"pdf").print()})):t.onSave().addListener(new epiviz.events.EventListener(function(t){new epiviz.ui.controls.SaveSvgAsImageDialog({ok:function(){},cancel:function(){}},t.id,e._config.dataServerLocation+e._config.chartSaverLocation).show()}))},epiviz.ui.charts.ChartManager.prototype._registerChartColorsChanged=function(t){var e=this;t.onColorsChanged().addListener(new epiviz.events.EventListener(function(t){e._chartColorsChanged.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartMethodsModified=function(t){var e=this;t.onMethodsModified().addListener(new epiviz.events.EventListener(function(t){e._chartMethodsModified.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartMethodsReset=function(t){var e=this;t.onMethodsReset().addListener(new epiviz.events.EventListener(function(t){e._chartMethodsReset.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartMarkersModified=function(t){var e=this;t.onMarkersModified().addListener(new epiviz.events.EventListener(function(t){e._chartMarkersModified.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartCustomSettingsChanged=function(t){var e=this;t.onCustomSettingsChanged().addListener(new epiviz.events.EventListener(function(t){e._chartCustomSettingsChanged.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartSizeChanged=function(t){var e=this;t.onSizeChanged().addListener(new epiviz.events.EventListener(function(t){e._chartSizeChanged.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartMarginsChanged=function(t){var e=this;t.onMarginsChanged().addListener(new epiviz.events.EventListener(function(t){e._chartMarginsChanged.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartRequestHierarchy=function(t){var e=this;t.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&t.onRequestHierarchy().addListener(new epiviz.events.EventListener(function(t){e._chartRequestHierarchy.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartPropagateHierarchyChanges=function(t){var e=this;t.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&t.onPropagateHierarchyChanges().addListener(new epiviz.events.EventListener(function(t){e._chartPropagateHierarchyChanges.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartPropogateIcicleLocationChanges=function(t){var e=this;t.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&t.onPropagateIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(t){e._chartPropogateIcicleLocationChanges.notify(t)}))},epiviz.ui.charts.ChartManager.prototype._registerChartIcicleLocationChanges=function(t){this.onChartIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(e){t.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&(t._updateLocation(e.args.start,e.args.width),t._drawAxes(t._lastRoot))}))},epiviz.ui.charts.ChartManager.prototype._registerChartPropagateNavigationChanges=function(t){var e=this;t.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.TRACK&&t._propagateNavigationChanges.addListener(new epiviz.events.EventListener(function(t){e._chartPropagateNavigationChanges.notify(t)}))},epiviz.ui.charts.ChartManager.prototype.getChartSettings=function(t){t=this._charts[t];var e={};return e.settings=t.customSettingsValues(),e.colorMap=t.properties().colors,e},epiviz.ui.charts.ChartManager.prototype.setChartSettings=function(t,e,i){if(t=this._charts[t],null!=e){var n=t.customSettingsValues();Object.keys(e).forEach(function(t){n[t]=e[t]}),t.setCustomSettingsValues(n)}null!=i&&t.setColors(i),t.draw()},epiviz.workspaces.WorkspaceManager=function(t,e,i,n,r){this._config=t,this._locationManager=e,this._measurementsManager=i,this._chartManager=n,this._chartFactory=r,this._workspacesByName=this._workspaces=this._unchangedActiveWorkspace=this._activeWorkspace=null,this._workspacesLoaded=new epiviz.events.Event,this._activeWorkspaceChanged=new epiviz.events.Event,this._activeWorkspaceChanging=!1,this._requestWorkspaces=new epiviz.events.Event,this._activeWorkspaceContentChanged=new epiviz.events.Event,this._uiChartSettingsChanged=new epiviz.events.Event;var a=this;this._activeWorkspaceContentChangedListener=new epiviz.events.EventListener(function(t){a._activeWorkspaceContentChanged.notify(t)}),this._registerLocationChanged(),this._registerComputedMeasurementAdded(),this._registerComputedMeasurementRemoved(),this._registerChartAdded(),this._registerChartRemoved(),this._registerChartsOrderChanged(),this._registerChartColorsChanged(),this._registerChartMethodsModified(),this._registerChartMethodsReset(),this._registerChartMarkersModified(),this._registerChartSizeChanged(),this._registerChartMarginsChanged(),this._registerChartCustomSettingsChanged()},epiviz.workspaces.WorkspaceManager.prototype.onUiChartSettingsChanged=function(){return this._uiChartSettingsChanged},epiviz.workspaces.WorkspaceManager.prototype.activeWorkspace=function(){return this._activeWorkspace||null},epiviz.workspaces.WorkspaceManager.prototype.get=function(t){return t&&this._workspaces&&this._workspaces[t]||null},epiviz.workspaces.WorkspaceManager.prototype.getByName=function(t){return t&&this._workspacesByName&&this._workspacesByName[t]||null},epiviz.workspaces.WorkspaceManager.prototype.initialize=function(){this._requestWorkspaces.notify({activeWorkspaceId:epiviz.ui.WebArgsManager.WEB_ARGS.ws||epiviz.ui.WebArgsManager.WEB_ARGS.workspace||null})},epiviz.workspaces.WorkspaceManager.prototype.updateWorkspaces=function(t,e,i,n){if(t){this._workspaces={},this._workspacesByName={};for(var r=0;r<t.length;++r)null!==t[r].id()&&(this._workspaces[t[r].id()]=t[r],this._workspacesByName[t[r].name()]=t[r])}e||(e=t&&t.length?t[0]:epiviz.workspaces.Workspace.fromRawObject(this._config.defaultWorkspaceSettings,this._chartFactory,this._config)),r=this._activeWorkspace,this._activeWorkspace=e,this._unchangedActiveWorkspace=n||(e?e.copy(e.name(),e.id()):null),r&&r.onContentChanged().removeListener(this._activeWorkspaceContentChangedListener),this._activeWorkspace&&this._activeWorkspace.onContentChanged().addListener(this._activeWorkspaceContentChangedListener),n=null!=(e=epiviz.ui.WebArgsManager.WEB_ARGS).genome?e.genome:this._activeWorkspace.range().genome();var a=null!=e.seqName?e.seqName:this._activeWorkspace.range().seqName(),o=null,s=null;"undefined"!=e.start&&(o=parseInt(e.start)||this._activeWorkspace.range().start()),"undefined"!=e.end&&(s=parseInt(e.end)||this._activeWorkspace.range().end()),this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(a,o,s,n)),this._workspacesLoaded.notify({activeWorkspace:this._activeWorkspace,workspaces:t}),this._activeWorkspaceChanged.notify({oldValue:r,newValue:this._activeWorkspace,workspaceId:this._activeWorkspace.id()||i})},epiviz.workspaces.WorkspaceManager.prototype.updateWorkspace=function(t){this._workspaces[t.id()]=t,this._workspacesByName[t.name()]=t},epiviz.workspaces.WorkspaceManager.prototype.deleteActiveWorkspace=function(){var t=this._activeWorkspace;if(t&&t.id()){delete this._workspaces[t.id()],delete this._workspacesByName[t.name()];var e,i=null;for(e in this._workspaces)if(this._workspaces.hasOwnProperty(e)){i=this._workspaces[e];break}i||(i=epiviz.workspaces.Workspace.fromRawObject(this._config.defaultWorkspaceSettings,this._chartFactory,this._config)),this._unchangedActiveWorkspace=(this._activeWorkspace=i)?i.copy(i.name(),i.id()):null,i=t.range().genome(),e=t.range().seqName();var n=t.range().start(),r=t.range().end();this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(e,n,r,i)),this._activeWorkspaceChanged.notify({oldValue:t,newValue:this._activeWorkspace,workspaceId:this._activeWorkspace.id()})}},epiviz.workspaces.WorkspaceManager.prototype.revertActiveWorkspace=function(){if(this._unchangedActiveWorkspace){var t=(n=this._activeWorkspace).range().genome(),e=n.range().seqName(),i=n.range().start(),n=n.range().end();this._activeWorkspace=this._unchangedActiveWorkspace.copy(this._unchangedActiveWorkspace.name(),this._unchangedActiveWorkspace.id()),this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(e,i,n,t)),this._activeWorkspaceChanged.notify({oldValue:null,newValue:this._activeWorkspace,workspaceId:this._activeWorkspace.id()})}},epiviz.workspaces.WorkspaceManager.prototype.onWorkspacesLoaded=function(){return this._workspacesLoaded},epiviz.workspaces.WorkspaceManager.prototype.onActiveWorkspaceChanged=function(){return this._activeWorkspaceChanged},epiviz.workspaces.WorkspaceManager.prototype.startChangingActiveWorkspace=function(){this._activeWorkspaceChanging=!0},epiviz.workspaces.WorkspaceManager.prototype.endChangingActiveWorkspace=function(){this._activeWorkspaceChanging=!1},epiviz.workspaces.WorkspaceManager.prototype.activeWorkspaceChanging=function(){return this._activeWorkspaceChanging},epiviz.workspaces.WorkspaceManager.prototype.onRequestWorkspaces=function(){return this._requestWorkspaces},epiviz.workspaces.WorkspaceManager.prototype.onActiveWorkspaceContentChanged=function(){return this._activeWorkspaceContentChanged},epiviz.workspaces.WorkspaceManager.prototype.changeActiveWorkspace=function(t,e){if((e=e||this._workspaces[t])&&e!==this._activeWorkspace){var i=this._activeWorkspace;this._unchangedActiveWorkspace=(this._activeWorkspace=e)?this._activeWorkspace.copy(this._activeWorkspace.name(),this._activeWorkspace.id()):null,this._activeWorkspaceChanged.notify({oldValue:i,newValue:this._activeWorkspace,workspaceId:t})}},epiviz.workspaces.WorkspaceManager.prototype._registerLocationChanged=function(){var t=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.locationChanged(e.newValue)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartAdded=function(){var t=this;this._chartManager.onChartAdded().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartAdded(e.id,e.args.type,e.args.properties,e.args.chartsOrder)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartRemoved=function(){var t=this;this._chartManager.onChartRemoved().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartRemoved(e.id,e.args)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartsOrderChanged=function(){var t=this;this._chartManager.onChartsOrderChanged().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartsOrderChanged(e)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartColorsChanged=function(){var t=this;this._chartManager.onChartColorsChanged().addListener(new epiviz.events.EventListener(function(e){!t._activeWorkspaceChanging&&t._activeWorkspace&&(t._activeWorkspace.chartColorsChanged(e.id,e.args),t.onUiChartSettingsChanged().notify({chartId:e.id,colorMap:e.args}))}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartMethodsModified=function(){var t=this;this._chartManager.onChartMethodsModified().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartMethodsModified(e.id,e.args)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartMethodsReset=function(){var t=this;this._chartManager.onChartMethodsReset().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartMethodsReset(e.id)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartMarkersModified=function(){var t=this;this._chartManager.onChartMarkersModified().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartMarkersModified(e.id,e.args)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartCustomSettingsChanged=function(){var t=this;this._chartManager.onChartCustomSettingsChanged().addListener(new epiviz.events.EventListener(function(e){!t._activeWorkspaceChanging&&t._activeWorkspace&&(t._activeWorkspace.chartCustomSettingsChanged(e.id,e.args),t.onUiChartSettingsChanged().notify({chartId:e.id,settings:e.args}))}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartSizeChanged=function(){var t=this;this._chartManager.onChartSizeChanged().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartSizeChanged(e.id,e.args.width,e.args.height)}))},epiviz.workspaces.WorkspaceManager.prototype._registerChartMarginsChanged=function(){var t=this;this._chartManager.onChartMarginsChanged().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.chartMarginsChanged(e.id,e.args)}))},epiviz.workspaces.WorkspaceManager.prototype._registerComputedMeasurementAdded=function(){var t=this;this._measurementsManager.onComputedMeasurementsAdded().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.computedMeasurementsAdded(e)}))},epiviz.workspaces.WorkspaceManager.prototype._registerComputedMeasurementRemoved=function(){var t=this;this._measurementsManager.onComputedMeasurementsRemoved().addListener(new epiviz.events.EventListener(function(e){t._activeWorkspaceChanging||t._activeWorkspace&&t._activeWorkspace.computedMeasurementsRemoved(e)}))},epiviz.workspaces.UserManager=function(t){this._config=t},epiviz.workspaces.UserManager.USER_STATUS=epiviz.workspaces.UserManager.USER_STATUS||{loggedIn:!1,userData:null,oauthProvider:null},epiviz.workspaces.UserManager.prototype.toggleLogin=function(){epiviz.workspaces.UserManager.USER_STATUS.loggedIn?this._logout():this._login()},epiviz.workspaces.UserManager.prototype._login=function(){var t=window.location.toString();0<t.length&&(t=encodeURIComponent(t)),window.location=this._config.dataServerLocation+"login.php?location="+t},epiviz.workspaces.UserManager.prototype._logout=function(){var t=window.location.toString();0<t.length&&(t=encodeURIComponent(t)),window.location=this._config.dataServerLocation+"logout.php?logout&location="+t},epiviz.main=function(){var t,e=new epiviz.Config(epiviz.Config.SETTINGS),i=new epiviz.ui.LocationManager(e),n=new epiviz.measurements.MeasurementsManager,r=new epiviz.ui.charts.ChartFactory(e),a=new epiviz.ui.charts.ChartManager(e),o=new epiviz.ui.ControlManager(e,r,a,n,i),s=new epiviz.data.DataProviderFactory(e);s=new epiviz.data.DataManager(e,s);"false"==e.useCookie?((t=new epiviz.localstorage.LocalStorageManager(epiviz.localstorage.LocalStorageManager.MODE.INCOGNITO_MODE)).clearWorkspace(),e.defaultWorkspaceSettings.content.charts=null):t=new epiviz.localstorage.LocalStorageManager(epiviz.localstorage.LocalStorageManager.MODE.COOKIE_MODE);var u=new epiviz.workspaces.WorkspaceManager(e,i,n,a,r),c=new epiviz.workspaces.UserManager(e),l=new epiviz.ui.WebArgsManager(i,u);i=new epiviz.EpiViz(e,i,n,o,s,r,a,u,c,l,t);epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.initialize(e),i.start()},goog.exportSymbol("epiviz",epiviz)}).call(this,__webpack_require__(7))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var n=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},r=function(t){var e;return 1===t.length&&(e=t,t=function(t,i){return n(e(t),i)}),{left:function(e,i,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}};var a=r(n),o=a.right,s=a.left,u=o,c=function(t,e){null==e&&(e=l);for(var i=0,n=t.length-1,r=t[0],a=new Array(n<0?0:n);i<n;)a[i]=e(r,r=t[++i]);return a};function l(t,e){return[t,e]}var p=function(t,e,i){var n,r,a,o,s=t.length,u=e.length,c=new Array(s*u);for(null==i&&(i=l),n=a=0;n<s;++n)for(o=t[n],r=0;r<u;++r,++a)c[a]=i(o,e[r]);return c},h=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},d=function(t){return null===t?NaN:+t},f=function(t,e){var i,n,r=t.length,a=0,o=-1,s=0,u=0;if(null==e)for(;++o<r;)isNaN(i=d(t[o]))||(u+=(n=i-s)*(i-(s+=n/++a)));else for(;++o<r;)isNaN(i=d(e(t[o],o,t)))||(u+=(n=i-s)*(i-(s+=n/++a)));if(a>1)return u/(a-1)},v=function(t,e){var i=f(t,e);return i?Math.sqrt(i):i},g=function(t,e){var i,n,r,a=t.length,o=-1;if(null==e){for(;++o<a;)if(null!=(i=t[o])&&i>=i)for(n=r=i;++o<a;)null!=(i=t[o])&&(n>i&&(n=i),r<i&&(r=i))}else for(;++o<a;)if(null!=(i=e(t[o],o,t))&&i>=i)for(n=r=i;++o<a;)null!=(i=e(t[o],o,t))&&(n>i&&(n=i),r<i&&(r=i));return[n,r]},m=Array.prototype,y=m.slice,_=m.map,z=function(t){return function(){return t}},b=function(t){return t},w=function(t,e,i){t=+t,e=+e,i=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+i;for(var n=-1,r=0|Math.max(0,Math.ceil((e-t)/i)),a=new Array(r);++n<r;)a[n]=t+n*i;return a},C=Math.sqrt(50),S=Math.sqrt(10),x=Math.sqrt(2),M=function(t,e,i){var n,r,a,o,s=-1;if(i=+i,(t=+t)===(e=+e)&&i>0)return[t];if((n=e<t)&&(r=t,t=e,e=r),0===(o=T(t,e,i))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),a=new Array(r=Math.ceil(e-t+1));++s<r;)a[s]=(t+s)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),a=new Array(r=Math.ceil(t-e+1));++s<r;)a[s]=(t-s)/o;return n&&a.reverse(),a};function T(t,e,i){var n=(e-t)/Math.max(0,i),r=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,r);return r>=0?(a>=C?10:a>=S?5:a>=x?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=C?10:a>=S?5:a>=x?2:1)}function k(t,e,i){var n=Math.abs(e-t)/Math.max(0,i),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/r;return a>=C?r*=10:a>=S?r*=5:a>=x&&(r*=2),e<t?-r:r}var E=function(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1},A=function(){var t=b,e=g,i=E;function n(n){var r,a,o=n.length,s=new Array(o);for(r=0;r<o;++r)s[r]=t(n[r],r,n);var c=e(s),l=c[0],p=c[1],h=i(s,l,p);Array.isArray(h)||(h=k(l,p,h),h=w(Math.ceil(l/h)*h,p,h));for(var d=h.length;h[0]<=l;)h.shift(),--d;for(;h[d-1]>p;)h.pop(),--d;var f,v=new Array(d+1);for(r=0;r<=d;++r)(f=v[r]=[]).x0=r>0?h[r-1]:l,f.x1=r<d?h[r]:p;for(r=0;r<o;++r)l<=(a=s[r])&&a<=p&&v[u(h,a,0,d)].push(n[r]);return v}return n.value=function(e){return arguments.length?(t="function"==typeof e?e:z(e),n):t},n.domain=function(t){return arguments.length?(e="function"==typeof t?t:z([t[0],t[1]]),n):e},n.thresholds=function(t){return arguments.length?(i="function"==typeof t?t:Array.isArray(t)?z(y.call(t)):z(t),n):i},n},R=function(t,e,i){if(null==i&&(i=d),n=t.length){if((e=+e)<=0||n<2)return+i(t[0],0,t);if(e>=1)return+i(t[n-1],n-1,t);var n,r=(n-1)*e,a=Math.floor(r),o=+i(t[a],a,t);return o+(+i(t[a+1],a+1,t)-o)*(r-a)}},D=function(t,e,i){return t=_.call(t,d).sort(n),Math.ceil((i-e)/(2*(R(t,.75)-R(t,.25))*Math.pow(t.length,-1/3)))},I=function(t,e,i){return Math.ceil((i-e)/(3.5*v(t)*Math.pow(t.length,-1/3)))},L=function(t,e){var i,n,r=t.length,a=-1;if(null==e){for(;++a<r;)if(null!=(i=t[a])&&i>=i)for(n=i;++a<r;)null!=(i=t[a])&&i>n&&(n=i)}else for(;++a<r;)if(null!=(i=e(t[a],a,t))&&i>=i)for(n=i;++a<r;)null!=(i=e(t[a],a,t))&&i>n&&(n=i);return n},N=function(t,e){var i,n=t.length,r=n,a=-1,o=0;if(null==e)for(;++a<n;)isNaN(i=d(t[a]))?--r:o+=i;else for(;++a<n;)isNaN(i=d(e(t[a],a,t)))?--r:o+=i;if(r)return o/r},O=function(t,e){var i,r=t.length,a=-1,o=[];if(null==e)for(;++a<r;)isNaN(i=d(t[a]))||o.push(i);else for(;++a<r;)isNaN(i=d(e(t[a],a,t)))||o.push(i);return R(o.sort(n),.5)},P=function(t){for(var e,i,n,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(i=new Array(o);--r>=0;)for(e=(n=t[r]).length;--e>=0;)i[--o]=n[e];return i},B=function(t,e){var i,n,r=t.length,a=-1;if(null==e){for(;++a<r;)if(null!=(i=t[a])&&i>=i)for(n=i;++a<r;)null!=(i=t[a])&&n>i&&(n=i)}else for(;++a<r;)if(null!=(i=e(t[a],a,t))&&i>=i)for(n=i;++a<r;)null!=(i=e(t[a],a,t))&&n>i&&(n=i);return n},q=function(t,e){for(var i=e.length,n=new Array(i);i--;)n[i]=t[e[i]];return n},G=function(t,e){if(i=t.length){var i,r,a=0,o=0,s=t[o];for(null==e&&(e=n);++a<i;)(e(r=t[a],s)<0||0!==e(s,s))&&(s=r,o=a);return 0===e(s,s)?o:void 0}},V=function(t,e,i){for(var n,r,a=(null==i?t.length:i)-(e=null==e?0:+e);a;)r=Math.random()*a--|0,n=t[a+e],t[a+e]=t[r+e],t[r+e]=n;return t},W=function(t,e){var i,n=t.length,r=-1,a=0;if(null==e)for(;++r<n;)(i=+t[r])&&(a+=i);else for(;++r<n;)(i=+e(t[r],r,t))&&(a+=i);return a},U=function(t){if(!(r=t.length))return[];for(var e=-1,i=B(t,F),n=new Array(i);++e<i;)for(var r,a=-1,o=n[e]=new Array(r);++a<r;)o[a]=t[a][e];return n};function F(t){return t.length}var j=function(){return U(arguments)},H=Array.prototype.slice,Y=function(t){return t},$=1,X=2,K=3,J=4,Q=1e-6;function Z(t){return"translate("+(t+.5)+",0)"}function tt(t){return"translate(0,"+(t+.5)+")"}function et(){return!this.__axis}function it(t,e){var i=[],n=null,r=null,a=6,o=6,s=3,u=t===$||t===J?-1:1,c=t===J||t===X?"x":"y",l=t===$||t===K?Z:tt;function p(p){var h=null==n?e.ticks?e.ticks.apply(e,i):e.domain():n,d=null==r?e.tickFormat?e.tickFormat.apply(e,i):Y:r,f=Math.max(a,0)+s,v=e.range(),g=+v[0]+.5,m=+v[v.length-1]+.5,y=(e.bandwidth?function(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(i){return+t(i)+e}}:function(t){return function(e){return+t(e)}})(e.copy()),_=p.selection?p.selection():p,z=_.selectAll(".domain").data([null]),b=_.selectAll(".tick").data(h,e).order(),w=b.exit(),C=b.enter().append("g").attr("class","tick"),S=b.select("line"),x=b.select("text");z=z.merge(z.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),b=b.merge(C),S=S.merge(C.append("line").attr("stroke","currentColor").attr(c+"2",u*a)),x=x.merge(C.append("text").attr("fill","currentColor").attr(c,u*f).attr("dy",t===$?"0em":t===K?"0.71em":"0.32em")),p!==_&&(z=z.transition(p),b=b.transition(p),S=S.transition(p),x=x.transition(p),w=w.transition(p).attr("opacity",Q).attr("transform",function(t){return isFinite(t=y(t))?l(t):this.getAttribute("transform")}),C.attr("opacity",Q).attr("transform",function(t){var e=this.parentNode.__axis;return l(e&&isFinite(e=e(t))?e:y(t))})),w.remove(),z.attr("d",t===J||t==X?o?"M"+u*o+","+g+"H0.5V"+m+"H"+u*o:"M0.5,"+g+"V"+m:o?"M"+g+","+u*o+"V0.5H"+m+"V"+u*o:"M"+g+",0.5H"+m),b.attr("opacity",1).attr("transform",function(t){return l(y(t))}),S.attr(c+"2",u*a),x.attr(c,u*f).text(d),_.filter(et).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===X?"start":t===J?"end":"middle"),_.each(function(){this.__axis=y})}return p.scale=function(t){return arguments.length?(e=t,p):e},p.ticks=function(){return i=H.call(arguments),p},p.tickArguments=function(t){return arguments.length?(i=null==t?[]:H.call(t),p):i.slice()},p.tickValues=function(t){return arguments.length?(n=null==t?null:H.call(t),p):n&&n.slice()},p.tickFormat=function(t){return arguments.length?(r=t,p):r},p.tickSize=function(t){return arguments.length?(a=o=+t,p):a},p.tickSizeInner=function(t){return arguments.length?(a=+t,p):a},p.tickSizeOuter=function(t){return arguments.length?(o=+t,p):o},p.tickPadding=function(t){return arguments.length?(s=+t,p):s},p}function nt(t){return it($,t)}function rt(t){return it(X,t)}function at(t){return it(K,t)}function ot(t){return it(J,t)}var st={value:function(){}};function ut(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n)throw new Error("illegal type: "+t);n[t]=[]}return new ct(n)}function ct(t){this._=t}function lt(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function pt(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=st,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}ct.prototype=ut.prototype={constructor:ct,on:function(t,e){var i,n,r=this._,a=(n=r,(t+"").trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,s=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=a[o]).type)r[i]=pt(r[i],t.name,e);else if(null==e)for(i in r)r[i]=pt(r[i],t.name,null);return this}for(;++o<s;)if((i=(t=a[o]).type)&&(i=lt(r[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new ct(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),a=0;a<i;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,i=(n=this._[t]).length;a<i;++a)n[a].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};var ht=ut,dt="http://www.w3.org/1999/xhtml",ft={svg:"http://www.w3.org/2000/svg",xhtml:dt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},vt=function(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),ft.hasOwnProperty(e)?{space:ft[e],local:t}:t};var gt=function(t){var e=vt(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===dt&&e.documentElement.namespaceURI===dt?e.createElement(t):e.createElementNS(i,t)}})(e)};function mt(){}var yt=function(t){return null==t?mt:function(){return this.querySelector(t)}};function _t(){return[]}var zt=function(t){return null==t?_t:function(){return this.querySelectorAll(t)}},bt=function(t){return function(){return this.matches(t)}},wt=function(t){return new Array(t.length)};function Ct(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ct.prototype={constructor:Ct,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var St="$";function xt(t,e,i,n,r,a){for(var o,s=0,u=e.length,c=a.length;s<c;++s)(o=e[s])?(o.__data__=a[s],n[s]=o):i[s]=new Ct(t,a[s]);for(;s<u;++s)(o=e[s])&&(r[s]=o)}function Mt(t,e,i,n,r,a,o){var s,u,c,l={},p=e.length,h=a.length,d=new Array(p);for(s=0;s<p;++s)(u=e[s])&&(d[s]=c=St+o.call(u,u.__data__,s,e),c in l?r[s]=u:l[c]=u);for(s=0;s<h;++s)(u=l[c=St+o.call(t,a[s],s,a)])?(n[s]=u,u.__data__=a[s],l[c]=null):i[s]=new Ct(t,a[s]);for(s=0;s<p;++s)(u=e[s])&&l[d[s]]===u&&(r[s]=u)}function Tt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var kt=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function Et(t,e){return t.style.getPropertyValue(e)||kt(t).getComputedStyle(t,null).getPropertyValue(e)}function At(t){return t.trim().split(/^|\s+/)}function Rt(t){return t.classList||new Dt(t)}function Dt(t){this._node=t,this._names=At(t.getAttribute("class")||"")}function It(t,e){for(var i=Rt(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function Lt(t,e){for(var i=Rt(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}Dt.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Nt(){this.textContent=""}function Ot(){this.innerHTML=""}function Pt(){this.nextSibling&&this.parentNode.appendChild(this)}function Bt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qt(){return null}function Gt(){var t=this.parentNode;t&&t.removeChild(this)}function Vt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Wt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var Ut={},Ft=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(Ut={mouseenter:"mouseover",mouseleave:"mouseout"}));function jt(t,e,i){return t=Ht(t,e,i),function(e){var i=e.relatedTarget;i&&(i===this||8&i.compareDocumentPosition(this))||t.call(this,e)}}function Ht(t,e,i){return function(n){var r=Ft;Ft=n;try{t.call(this,this.__data__,e,i)}finally{Ft=r}}}function Yt(t){return function(){var e=this.__on;if(e){for(var i,n=0,r=-1,a=e.length;n<a;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++r]=i:this.removeEventListener(i.type,i.listener,i.capture);++r?e.length=r:delete this.__on}}}function $t(t,e,i){var n=Ut.hasOwnProperty(t.type)?jt:Ht;return function(r,a,o){var s,u=this.__on,c=n(e,a,o);if(u)for(var l=0,p=u.length;l<p;++l)if((s=u[l]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=c,s.capture=i),void(s.value=e);this.addEventListener(t.type,c,i),s={type:t.type,name:t.name,value:e,listener:c,capture:i},u?u.push(s):this.__on=[s]}}function Xt(t,e,i,n){var r=Ft;t.sourceEvent=Ft,Ft=t;try{return e.apply(i,n)}finally{Ft=r}}function Kt(t,e,i){var n=kt(t),r=n.CustomEvent;"function"==typeof r?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}var Jt=[null];function Qt(t,e){this._groups=t,this._parents=e}function Zt(){return new Qt([[document.documentElement]],Jt)}Qt.prototype=Zt.prototype={constructor:Qt,select:function(t){"function"!=typeof t&&(t=yt(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,o,s=e[r],u=s.length,c=n[r]=new Array(u),l=0;l<u;++l)(a=s[l])&&(o=t.call(a,a.__data__,l,s))&&("__data__"in a&&(o.__data__=a.__data__),c[l]=o);return new Qt(n,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=zt(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var o,s=e[a],u=s.length,c=0;c<u;++c)(o=s[c])&&(n.push(t.call(o,o.__data__,c,s)),r.push(o));return new Qt(n,r)},filter:function(t){"function"!=typeof t&&(t=bt(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,o=e[r],s=o.length,u=n[r]=[],c=0;c<s;++c)(a=o[c])&&t.call(a,a.__data__,c,o)&&u.push(a);return new Qt(n,this._parents)},data:function(t,e){if(!t)return f=new Array(this.size()),l=-1,this.each(function(t){f[++l]=t}),f;var i,n=e?Mt:xt,r=this._parents,a=this._groups;"function"!=typeof t&&(i=t,t=function(){return i});for(var o=a.length,s=new Array(o),u=new Array(o),c=new Array(o),l=0;l<o;++l){var p=r[l],h=a[l],d=h.length,f=t.call(p,p&&p.__data__,l,r),v=f.length,g=u[l]=new Array(v),m=s[l]=new Array(v);n(p,h,g,m,c[l]=new Array(d),f,e);for(var y,_,z=0,b=0;z<v;++z)if(y=g[z]){for(z>=b&&(b=z+1);!(_=m[b])&&++b<v;);y._next=_||null}}return(s=new Qt(s,r))._enter=u,s._exit=c,s},enter:function(){return new Qt(this._enter||this._groups.map(wt),this._parents)},exit:function(){return new Qt(this._exit||this._groups.map(wt),this._parents)},join:function(t,e,i){var n=this.enter(),r=this,a=this.exit();return n="function"==typeof t?t(n):n.append(t+""),null!=e&&(r=e(r)),null==i?a.remove():i(a),n&&r?n.merge(r).order():r},merge:function(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var u,c=e[s],l=i[s],p=c.length,h=o[s]=new Array(p),d=0;d<p;++d)(u=c[d]||l[d])&&(h[d]=u);for(;s<n;++s)o[s]=e[s];return new Qt(o,this._parents)},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,r=t[e],a=r.length-1,o=r[a];--a>=0;)(n=r[a])&&(o&&4^n.compareDocumentPosition(o)&&o.parentNode.insertBefore(n,o),o=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=Tt);for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var o,s=i[a],u=s.length,c=r[a]=new Array(u),l=0;l<u;++l)(o=s[l])&&(c[l]=o);c.sort(e)}return new Qt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var o=n[r];if(o)return o}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r,a=e[i],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var i=vt(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?i.local?function(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}:function(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}:i.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}:function(t,e,i){return function(){this.style.setProperty(t,e,i)}})(t,e,null==i?"":i)):Et(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var i=At(t+"");if(arguments.length<2){for(var n=Rt(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?It:Lt)(this,t)}}:e?function(t){return function(){It(this,t)}}:function(t){return function(){Lt(this,t)}})(i,e))},text:function(t){return arguments.length?this.each(null==t?Nt:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Ot:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(Pt)},lower:function(){return this.each(Bt)},append:function(t){var e="function"==typeof t?t:gt(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var i="function"==typeof t?t:gt(t),n=null==e?qt:"function"==typeof e?e:yt(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(Gt)},clone:function(t){return this.select(t?Wt:Vt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,r,a=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}(t+""),o=a.length;if(!(arguments.length<2)){for(s=e?$t:Yt,null==i&&(i=!1),n=0;n<o;++n)this.each(s(a[n],e,i));return this}var s=this.node().__on;if(s)for(var u,c=0,l=s.length;c<l;++c)for(n=0,u=s[c];n<o;++n)if((r=a[n]).type===u.type&&r.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return Kt(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return Kt(this,t,e)}})(t,e))}};var te=Zt,ee=function(t){return"string"==typeof t?new Qt([[document.querySelector(t)]],[document.documentElement]):new Qt([[t]],Jt)},ie=function(t){return ee(gt(t).call(document.documentElement))},ne=0;function re(){return new ae}function ae(){this._="@"+(++ne).toString(36)}ae.prototype=re.prototype={constructor:ae,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var oe=function(){for(var t,e=Ft;t=e.sourceEvent;)e=t;return e},se=function(t,e){var i=t.ownerSVGElement||t;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]},ue=function(t){var e=oe();return e.changedTouches&&(e=e.changedTouches[0]),se(t,e)},ce=function(t){return"string"==typeof t?new Qt([document.querySelectorAll(t)],[document.documentElement]):new Qt([null==t?[]:t],Jt)},le=function(t,e,i){arguments.length<3&&(i=e,e=oe().changedTouches);for(var n,r=0,a=e?e.length:0;r<a;++r)if((n=e[r]).identifier===i)return se(t,n);return null},pe=function(t,e){null==e&&(e=oe().touches);for(var i=0,n=e?e.length:0,r=new Array(n);i<n;++i)r[i]=se(t,e[i]);return r};function he(){Ft.stopImmediatePropagation()}var de=function(){Ft.preventDefault(),Ft.stopImmediatePropagation()},fe=function(t){var e=t.document.documentElement,i=ee(t).on("dragstart.drag",de,!0);"onselectstart"in e?i.on("selectstart.drag",de,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function ve(t,e){var i=t.document.documentElement,n=ee(t).on("dragstart.drag",null);e&&(n.on("click.drag",de,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var ge=function(t){return function(){return t}};function me(t,e,i,n,r,a,o,s,u,c){this.target=t,this.type=e,this.subject=i,this.identifier=n,this.active=r,this.x=a,this.y=o,this.dx=s,this.dy=u,this._=c}function ye(){return!Ft.button}function _e(){return this.parentNode}function ze(t){return null==t?{x:Ft.x,y:Ft.y}:t}function be(){return"ontouchstart"in this}me.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var we=function(){var t,e,i,n,r=ye,a=_e,o=ze,s=be,u={},c=ht("start","drag","end"),l=0,p=0;function h(t){t.on("mousedown.drag",d).filter(s).on("touchstart.drag",g).on("touchmove.drag",m).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(){if(!n&&r.apply(this,arguments)){var o=_("mouse",a.apply(this,arguments),ue,this,arguments);o&&(ee(Ft.view).on("mousemove.drag",f,!0).on("mouseup.drag",v,!0),fe(Ft.view),he(),i=!1,t=Ft.clientX,e=Ft.clientY,o("start"))}}function f(){if(de(),!i){var n=Ft.clientX-t,r=Ft.clientY-e;i=n*n+r*r>p}u.mouse("drag")}function v(){ee(Ft.view).on("mousemove.drag mouseup.drag",null),ve(Ft.view,i),de(),u.mouse("end")}function g(){if(r.apply(this,arguments)){var t,e,i=Ft.changedTouches,n=a.apply(this,arguments),o=i.length;for(t=0;t<o;++t)(e=_(i[t].identifier,n,le,this,arguments))&&(he(),e("start"))}}function m(){var t,e,i=Ft.changedTouches,n=i.length;for(t=0;t<n;++t)(e=u[i[t].identifier])&&(de(),e("drag"))}function y(){var t,e,i=Ft.changedTouches,r=i.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),t=0;t<r;++t)(e=u[i[t].identifier])&&(he(),e("end"))}function _(t,e,i,n,r){var a,s,p,d=i(e,t),f=c.copy();if(Xt(new me(h,"beforestart",a,t,l,d[0],d[1],0,0,f),function(){return null!=(Ft.subject=a=o.apply(n,r))&&(s=a.x-d[0]||0,p=a.y-d[1]||0,!0)}))return function o(c){var v,g=d;switch(c){case"start":u[t]=o,v=l++;break;case"end":delete u[t],--l;case"drag":d=i(e,t),v=l}Xt(new me(h,c,a,t,v,d[0]+s,d[1]+p,d[0]-g[0],d[1]-g[1],f),f.apply,f,[c,n,r])}}return h.filter=function(t){return arguments.length?(r="function"==typeof t?t:ge(!!t),h):r},h.container=function(t){return arguments.length?(a="function"==typeof t?t:ge(t),h):a},h.subject=function(t){return arguments.length?(o="function"==typeof t?t:ge(t),h):o},h.touchable=function(t){return arguments.length?(s="function"==typeof t?t:ge(!!t),h):s},h.on=function(){var t=c.on.apply(c,arguments);return t===c?h:t},h.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,h):Math.sqrt(p)},h},Ce=function(t,e,i){t.prototype=e.prototype=i,i.constructor=t};function Se(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function xe(){}var Me="\\s*([+-]?\\d+)\\s*",Te="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ke="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ee=/^#([0-9a-f]{3})$/,Ae=/^#([0-9a-f]{6})$/,Re=new RegExp("^rgb\\("+[Me,Me,Me]+"\\)$"),De=new RegExp("^rgb\\("+[ke,ke,ke]+"\\)$"),Ie=new RegExp("^rgba\\("+[Me,Me,Me,Te]+"\\)$"),Le=new RegExp("^rgba\\("+[ke,ke,ke,Te]+"\\)$"),Ne=new RegExp("^hsl\\("+[Te,ke,ke]+"\\)$"),Oe=new RegExp("^hsla\\("+[Te,ke,ke,Te]+"\\)$"),Pe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Be(t){var e;return t=(t+"").trim().toLowerCase(),(e=Ee.exec(t))?new Ue((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=Ae.exec(t))?qe(parseInt(e[1],16)):(e=Re.exec(t))?new Ue(e[1],e[2],e[3],1):(e=De.exec(t))?new Ue(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ie.exec(t))?Ge(e[1],e[2],e[3],e[4]):(e=Le.exec(t))?Ge(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ne.exec(t))?je(e[1],e[2]/100,e[3]/100,1):(e=Oe.exec(t))?je(e[1],e[2]/100,e[3]/100,e[4]):Pe.hasOwnProperty(t)?qe(Pe[t]):"transparent"===t?new Ue(NaN,NaN,NaN,0):null}function qe(t){return new Ue(t>>16&255,t>>8&255,255&t,1)}function Ge(t,e,i,n){return n<=0&&(t=e=i=NaN),new Ue(t,e,i,n)}function Ve(t){return t instanceof xe||(t=Be(t)),t?new Ue((t=t.rgb()).r,t.g,t.b,t.opacity):new Ue}function We(t,e,i,n){return 1===arguments.length?Ve(t):new Ue(t,e,i,null==n?1:n)}function Ue(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function Fe(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function je(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Ye(t,e,i,n)}function He(t,e,i,n){return 1===arguments.length?function(t){if(t instanceof Ye)return new Ye(t.h,t.s,t.l,t.opacity);if(t instanceof xe||(t=Be(t)),!t)return new Ye;if(t instanceof Ye)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),o=NaN,s=a-r,u=(a+r)/2;return s?(o=e===a?(i-n)/s+6*(i<n):i===a?(n-e)/s+2:(e-i)/s+4,s/=u<.5?a+r:2-a-r,o*=60):s=u>0&&u<1?0:o,new Ye(o,s,u,t.opacity)}(t):new Ye(t,e,i,null==n?1:n)}function Ye(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function $e(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}Ce(xe,Be,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),Ce(Ue,We,Se(xe,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ue(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ue(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function(){return"#"+Fe(this.r)+Fe(this.g)+Fe(this.b)},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),Ce(Ye,He,Se(xe,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ye(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ye(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Ue($e(t>=240?t-240:t+120,r,n),$e(t,r,n),$e(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Xe=Math.PI/180,Ke=180/Math.PI,Je=.96422,Qe=1,Ze=.82521,ti=4/29,ei=6/29,ii=3*ei*ei,ni=ei*ei*ei;function ri(t){if(t instanceof si)return new si(t.l,t.a,t.b,t.opacity);if(t instanceof vi){if(isNaN(t.h))return new si(t.l,0,0,t.opacity);var e=t.h*Xe;return new si(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof Ue||(t=Ve(t));var i,n,r=pi(t.r),a=pi(t.g),o=pi(t.b),s=ui((.2225045*r+.7168786*a+.0606169*o)/Qe);return r===a&&a===o?i=n=s:(i=ui((.4360747*r+.3850649*a+.1430804*o)/Je),n=ui((.0139322*r+.0971045*a+.7141733*o)/Ze)),new si(116*s-16,500*(i-s),200*(s-n),t.opacity)}function ai(t,e){return new si(t,0,0,null==e?1:e)}function oi(t,e,i,n){return 1===arguments.length?ri(t):new si(t,e,i,null==n?1:n)}function si(t,e,i,n){this.l=+t,this.a=+e,this.b=+i,this.opacity=+n}function ui(t){return t>ni?Math.pow(t,1/3):t/ii+ti}function ci(t){return t>ei?t*t*t:ii*(t-ti)}function li(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function pi(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function hi(t){if(t instanceof vi)return new vi(t.h,t.c,t.l,t.opacity);if(t instanceof si||(t=ri(t)),0===t.a&&0===t.b)return new vi(NaN,0,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Ke;return new vi(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function di(t,e,i,n){return 1===arguments.length?hi(t):new vi(i,e,t,null==n?1:n)}function fi(t,e,i,n){return 1===arguments.length?hi(t):new vi(t,e,i,null==n?1:n)}function vi(t,e,i,n){this.h=+t,this.c=+e,this.l=+i,this.opacity=+n}Ce(si,oi,Se(xe,{brighter:function(t){return new si(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new si(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,i=isNaN(this.b)?t:t-this.b/200;return new Ue(li(3.1338561*(e=Je*ci(e))-1.6168667*(t=Qe*ci(t))-.4906146*(i=Ze*ci(i))),li(-.9787684*e+1.9161415*t+.033454*i),li(.0719453*e-.2289914*t+1.4052427*i),this.opacity)}})),Ce(vi,fi,Se(xe,{brighter:function(t){return new vi(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new vi(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return ri(this).rgb()}}));var gi=-.29227,mi=-.90649,yi=1.97294,_i=yi*mi,zi=1.78277*yi,bi=1.78277*gi- -.14861*mi;function wi(t,e,i,n){return 1===arguments.length?function(t){if(t instanceof Ci)return new Ci(t.h,t.s,t.l,t.opacity);t instanceof Ue||(t=Ve(t));var e=t.r/255,i=t.g/255,n=t.b/255,r=(bi*n+_i*e-zi*i)/(bi+_i-zi),a=n-r,o=(yi*(i-r)-gi*a)/mi,s=Math.sqrt(o*o+a*a)/(yi*r*(1-r)),u=s?Math.atan2(o,a)*Ke-120:NaN;return new Ci(u<0?u+360:u,s,r,t.opacity)}(t):new Ci(t,e,i,null==n?1:n)}function Ci(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function Si(t,e,i,n,r){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*i+(1+3*t+3*a-3*o)*n+o*r)/6}Ce(Ci,wi,Se(xe,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ci(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ci(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Xe,e=+this.l,i=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(t),r=Math.sin(t);return new Ue(255*(e+i*(-.14861*n+1.78277*r)),255*(e+i*(gi*n+mi*r)),255*(e+i*(yi*n)),this.opacity)}}));var xi=function(t){var e=t.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),r=t[n],a=t[n+1],o=n>0?t[n-1]:2*r-a,s=n<e-1?t[n+2]:2*a-r;return Si((i-n/e)*e,o,r,a,s)}},Mi=function(t){var e=t.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*e),r=t[(n+e-1)%e],a=t[n%e],o=t[(n+1)%e],s=t[(n+2)%e];return Si((i-n/e)*e,r,a,o,s)}},Ti=function(t){return function(){return t}};function ki(t,e){return function(i){return t+i*e}}function Ei(t,e){var i=e-t;return i?ki(t,i>180||i<-180?i-360*Math.round(i/360):i):Ti(isNaN(t)?e:t)}function Ai(t){return 1==(t=+t)?Ri:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):Ti(isNaN(e)?i:e)}}function Ri(t,e){var i=e-t;return i?ki(t,i):Ti(isNaN(t)?e:t)}var Di=function t(e){var i=Ai(e);function n(t,e){var n=i((t=We(t)).r,(e=We(e)).r),r=i(t.g,e.g),a=i(t.b,e.b),o=Ri(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return n.gamma=t,n}(1);function Ii(t){return function(e){var i,n,r=e.length,a=new Array(r),o=new Array(r),s=new Array(r);for(i=0;i<r;++i)n=We(e[i]),a[i]=n.r||0,o[i]=n.g||0,s[i]=n.b||0;return a=t(a),o=t(o),s=t(s),n.opacity=1,function(t){return n.r=a(t),n.g=o(t),n.b=s(t),n+""}}}var Li=Ii(xi),Ni=Ii(Mi),Oi=function(t,e){var i,n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),o=new Array(n);for(i=0;i<r;++i)a[i]=Yi(t[i],e[i]);for(;i<n;++i)o[i]=e[i];return function(t){for(i=0;i<r;++i)o[i]=a[i](t);return o}},Pi=function(t,e){var i=new Date;return e-=t=+t,function(n){return i.setTime(t+e*n),i}},Bi=function(t,e){return e-=t=+t,function(i){return t+e*i}},qi=function(t,e){var i,n={},r={};for(i in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)i in t?n[i]=Yi(t[i],e[i]):r[i]=e[i];return function(t){for(i in n)r[i]=n[i](t);return r}},Gi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vi=new RegExp(Gi.source,"g");var Wi,Ui,Fi,ji,Hi=function(t,e){var i,n,r,a=Gi.lastIndex=Vi.lastIndex=0,o=-1,s=[],u=[];for(t+="",e+="";(i=Gi.exec(t))&&(n=Vi.exec(e));)(r=n.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(i=i[0])===(n=n[0])?s[o]?s[o]+=n:s[++o]=n:(s[++o]=null,u.push({i:o,x:Bi(i,n)})),a=Vi.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var i,n=0;n<e;++n)s[(i=u[n]).i]=i.x(t);return s.join("")})},Yi=function(t,e){var i,n=typeof e;return null==e||"boolean"===n?Ti(e):("number"===n?Bi:"string"===n?(i=Be(e))?(e=i,Di):Hi:e instanceof Be?Di:e instanceof Date?Pi:Array.isArray(e)?Oi:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?qi:Bi)(t,e)},$i=function(t){var e=t.length;return function(i){return t[Math.max(0,Math.min(e-1,Math.floor(i*e)))]}},Xi=function(t,e){var i=Ei(+t,+e);return function(t){var e=i(t);return e-360*Math.floor(e/360)}},Ki=function(t,e){return e-=t=+t,function(i){return Math.round(t+e*i)}},Ji=180/Math.PI,Qi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Zi=function(t,e,i,n,r,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*i+e*n)&&(i-=t*u,n-=e*u),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,u/=s),t*n<e*i&&(t=-t,e=-e,u=-u,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Ji,skewX:Math.atan(u)*Ji,scaleX:o,scaleY:s}};function tn(t,e,i,n){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],u=[];return a=t(a),o=t(o),function(t,n,r,a,o,s){if(t!==r||n!==a){var u=o.push("translate(",null,e,null,i);s.push({i:u-4,x:Bi(t,r)},{i:u-2,x:Bi(n,a)})}else(r||a)&&o.push("translate("+r+e+a+i)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(t,e,i,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:i.push(r(i)+"rotate(",null,n)-2,x:Bi(t,e)})):e&&i.push(r(i)+"rotate("+e+n)}(a.rotate,o.rotate,s,u),function(t,e,i,a){t!==e?a.push({i:i.push(r(i)+"skewX(",null,n)-2,x:Bi(t,e)}):e&&i.push(r(i)+"skewX("+e+n)}(a.skewX,o.skewX,s,u),function(t,e,i,n,a,o){if(t!==i||e!==n){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Bi(t,i)},{i:s-2,x:Bi(e,n)})}else 1===i&&1===n||a.push(r(a)+"scale("+i+","+n+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(t){for(var e,i=-1,n=u.length;++i<n;)s[(e=u[i]).i]=e.x(t);return s.join("")}}}var en=tn(function(t){return"none"===t?Qi:(Wi||(Wi=document.createElement("DIV"),Ui=document.documentElement,Fi=document.defaultView),Wi.style.transform=t,t=Fi.getComputedStyle(Ui.appendChild(Wi),null).getPropertyValue("transform"),Ui.removeChild(Wi),t=t.slice(7,-1).split(","),Zi(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),nn=tn(function(t){return null==t?Qi:(ji||(ji=document.createElementNS("http://www.w3.org/2000/svg","g")),ji.setAttribute("transform",t),(t=ji.transform.baseVal.consolidate())?(t=t.matrix,Zi(t.a,t.b,t.c,t.d,t.e,t.f)):Qi)},", ",")",")"),rn=Math.SQRT2;function an(t){return((t=Math.exp(t))+1/t)/2}var on=function(t,e){var i,n,r=t[0],a=t[1],o=t[2],s=e[0],u=e[1],c=e[2],l=s-r,p=u-a,h=l*l+p*p;if(h<1e-12)n=Math.log(c/o)/rn,i=function(t){return[r+t*l,a+t*p,o*Math.exp(rn*t*n)]};else{var d=Math.sqrt(h),f=(c*c-o*o+4*h)/(2*o*2*d),v=(c*c-o*o-4*h)/(2*c*2*d),g=Math.log(Math.sqrt(f*f+1)-f),m=Math.log(Math.sqrt(v*v+1)-v);n=(m-g)/rn,i=function(t){var e,i=t*n,s=an(g),u=o/(2*d)*(s*(e=rn*i+g,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[r+u*l,a+u*p,o*s/an(rn*i+g)]}}return i.duration=1e3*n,i};function sn(t){return function(e,i){var n=t((e=He(e)).h,(i=He(i)).h),r=Ri(e.s,i.s),a=Ri(e.l,i.l),o=Ri(e.opacity,i.opacity);return function(t){return e.h=n(t),e.s=r(t),e.l=a(t),e.opacity=o(t),e+""}}}var un=sn(Ei),cn=sn(Ri);function ln(t,e){var i=Ri((t=oi(t)).l,(e=oi(e)).l),n=Ri(t.a,e.a),r=Ri(t.b,e.b),a=Ri(t.opacity,e.opacity);return function(e){return t.l=i(e),t.a=n(e),t.b=r(e),t.opacity=a(e),t+""}}function pn(t){return function(e,i){var n=t((e=fi(e)).h,(i=fi(i)).h),r=Ri(e.c,i.c),a=Ri(e.l,i.l),o=Ri(e.opacity,i.opacity);return function(t){return e.h=n(t),e.c=r(t),e.l=a(t),e.opacity=o(t),e+""}}}var hn=pn(Ei),dn=pn(Ri);function fn(t){return function e(i){function n(e,n){var r=t((e=wi(e)).h,(n=wi(n)).h),a=Ri(e.s,n.s),o=Ri(e.l,n.l),s=Ri(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=a(t),e.l=o(Math.pow(t,i)),e.opacity=s(t),e+""}}return i=+i,n.gamma=e,n}(1)}var vn=fn(Ei),gn=fn(Ri);function mn(t,e){for(var i=0,n=e.length-1,r=e[0],a=new Array(n<0?0:n);i<n;)a[i]=t(r,r=e[++i]);return function(t){var e=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return a[e](t-e)}}var yn,_n,zn=function(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t(n/(e-1));return i},bn=0,wn=0,Cn=0,Sn=1e3,xn=0,Mn=0,Tn=0,kn="object"==typeof performance&&performance.now?performance:Date,En="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function An(){return Mn||(En(Rn),Mn=kn.now()+Tn)}function Rn(){Mn=0}function Dn(){this._call=this._time=this._next=null}function In(t,e,i){var n=new Dn;return n.restart(t,e,i),n}function Ln(){An(),++bn;for(var t,e=yn;e;)(t=Mn-e._time)>=0&&e._call.call(null,t),e=e._next;--bn}function Nn(){Mn=(xn=kn.now())+Tn,bn=wn=0;try{Ln()}finally{bn=0,function(){var t,e,i=yn,n=1/0;for(;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:yn=e);_n=t,Pn(n)}(),Mn=0}}function On(){var t=kn.now(),e=t-xn;e>Sn&&(Tn-=e,xn=t)}function Pn(t){bn||(wn&&(wn=clearTimeout(wn)),t-Mn>24?(t<1/0&&(wn=setTimeout(Nn,t-kn.now()-Tn)),Cn&&(Cn=clearInterval(Cn))):(Cn||(xn=kn.now(),Cn=setInterval(On,Sn)),bn=1,En(Nn)))}Dn.prototype=In.prototype={constructor:Dn,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?An():+i)+(null==e?0:+e),this._next||_n===this||(_n?_n._next=this:yn=this,_n=this),this._call=t,this._time=i,Pn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pn())}};var Bn=function(t,e,i){var n=new Dn;return e=null==e?0:+e,n.restart(function(i){n.stop(),t(i+e)},e,i),n},qn=function(t,e,i){var n=new Dn,r=e;return null==e?(n.restart(t,e,i),n):(e=+e,i=null==i?An():+i,n.restart(function a(o){o+=r,n.restart(a,r+=e,i),t(o)},e,i),n)},Gn=ht("start","end","cancel","interrupt"),Vn=[],Wn=0,Un=1,Fn=2,jn=3,Hn=4,Yn=5,$n=6,Xn=function(t,e,i,n,r,a){var o=t.__transition;if(o){if(i in o)return}else t.__transition={};!function(t,e,i){var n,r=t.__transition;function a(u){var c,l,p,h;if(i.state!==Un)return s();for(c in r)if((h=r[c]).name===i.name){if(h.state===jn)return Bn(a);h.state===Hn?(h.state=$n,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete r[c]):+c<e&&(h.state=$n,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete r[c])}if(Bn(function(){i.state===jn&&(i.state=Hn,i.timer.restart(o,i.delay,i.time),o(u))}),i.state=Fn,i.on.call("start",t,t.__data__,i.index,i.group),i.state===Fn){for(i.state=jn,n=new Array(p=i.tween.length),c=0,l=-1;c<p;++c)(h=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(n[++l]=h);n.length=l+1}}function o(e){for(var r=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(s),i.state=Yn,1),a=-1,o=n.length;++a<o;)n[a].call(t,r);i.state===Yn&&(i.on.call("end",t,t.__data__,i.index,i.group),s())}function s(){for(var n in i.state=$n,i.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=i,i.timer=In(function(t){i.state=Un,i.timer.restart(a,i.delay,i.time),i.delay<=t&&a(t-i.delay)},0,i.time)}(t,i,{name:e,index:n,group:r,on:Gn,tween:Vn,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Wn})};function Kn(t,e){var i=Qn(t,e);if(i.state>Wn)throw new Error("too late; already scheduled");return i}function Jn(t,e){var i=Qn(t,e);if(i.state>jn)throw new Error("too late; already running");return i}function Qn(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}var Zn=function(t,e){var i,n,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(i=a[r]).name===e?(n=i.state>Fn&&i.state<Yn,i.state=$n,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete a[r]):o=!1;o&&delete t.__transition}};function tr(t,e,i){var n=t._id;return t.each(function(){var t=Jn(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)}),function(t){return Qn(t,n).value[e]}}var er=function(t,e){var i;return("number"==typeof e?Bi:e instanceof Be?Di:(i=Be(e))?(e=i,Di):Hi)(t,e)};var ir=te.prototype.constructor;function nr(t){return function(){this.style.removeProperty(t)}}var rr=0;function ar(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function or(t){return te().transition(t)}function sr(){return++rr}var ur=te.prototype;function cr(t){return+t}function lr(t){return t*t}function pr(t){return t*(2-t)}function hr(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function dr(t){return t*t*t}function fr(t){return--t*t*t+1}function vr(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}ar.prototype=or.prototype={constructor:ar,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=yt(t));for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o)for(var s,u,c=n[o],l=c.length,p=a[o]=new Array(l),h=0;h<l;++h)(s=c[h])&&(u=t.call(s,s.__data__,h,c))&&("__data__"in s&&(u.__data__=s.__data__),p[h]=u,Xn(p[h],e,i,h,p,Qn(s,i)));return new ar(a,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=zt(t));for(var n=this._groups,r=n.length,a=[],o=[],s=0;s<r;++s)for(var u,c=n[s],l=c.length,p=0;p<l;++p)if(u=c[p]){for(var h,d=t.call(u,u.__data__,p,c),f=Qn(u,i),v=0,g=d.length;v<g;++v)(h=d[v])&&Xn(h,e,i,v,d,f);a.push(d),o.push(u)}return new ar(a,o,e,i)},filter:function(t){"function"!=typeof t&&(t=bt(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,o=e[r],s=o.length,u=n[r]=[],c=0;c<s;++c)(a=o[c])&&t.call(a,a.__data__,c,o)&&u.push(a);return new ar(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var u,c=e[s],l=i[s],p=c.length,h=o[s]=new Array(p),d=0;d<p;++d)(u=c[d]||l[d])&&(h[d]=u);for(;s<n;++s)o[s]=e[s];return new ar(o,this._parents,this._name,this._id)},selection:function(){return new ir(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=sr(),n=this._groups,r=n.length,a=0;a<r;++a)for(var o,s=n[a],u=s.length,c=0;c<u;++c)if(o=s[c]){var l=Qn(o,e);Xn(o,t,i,c,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new ar(n,this._parents,t,i)},call:ur.call,nodes:ur.nodes,node:ur.node,size:ur.size,empty:ur.empty,each:ur.each,on:function(t,e){var i=this._id;return arguments.length<2?Qn(this.node(),i).on.on(t):this.each(function(t,e,i){var n,r,a=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Kn:Jn;return function(){var o=a(this,t),s=o.on;s!==n&&(r=(n=s).copy()).on(e,i),o.on=r}}(i,t,e))},attr:function(t,e){var i=vt(t),n="transform"===i?nn:er;return this.attrTween(t,"function"==typeof e?(i.local?function(t,e,i){var n,r,a;return function(){var o,s,u=i(this);if(null!=u)return(o=this.getAttributeNS(t.space,t.local))===(s=u+"")?null:o===n&&s===r?a:(r=s,a=e(n=o,u));this.removeAttributeNS(t.space,t.local)}}:function(t,e,i){var n,r,a;return function(){var o,s,u=i(this);if(null!=u)return(o=this.getAttribute(t))===(s=u+"")?null:o===n&&s===r?a:(r=s,a=e(n=o,u));this.removeAttribute(t)}})(i,n,tr(this,"attr."+t,e)):null==e?(i.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(i):(i.local?function(t,e,i){var n,r,a=i+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===n?r:r=e(n=o,i)}}:function(t,e,i){var n,r,a=i+"";return function(){var o=this.getAttribute(t);return o===a?null:o===n?r:r=e(n=o,i)}})(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=vt(t);return this.tween(i,(n.local?function(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e(i))}}(t,r)),i}return r._value=e,r}:function(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttribute(t,e(i))}}(t,r)),i}return r._value=e,r})(n,e))},style:function(t,e,i){var n="transform"==(t+="")?en:er;return null==e?this.styleTween(t,function(t,e){var i,n,r;return function(){var a=Et(this,t),o=(this.style.removeProperty(t),Et(this,t));return a===o?null:a===i&&o===n?r:r=e(i=a,n=o)}}(t,n)).on("end.style."+t,nr(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,r,a;return function(){var o=Et(this,t),s=i(this),u=s+"";return null==s&&(this.style.removeProperty(t),u=s=Et(this,t)),o===u?null:o===n&&u===r?a:(r=u,a=e(n=o,s))}}(t,n,tr(this,"style."+t,e))).each(function(t,e){var i,n,r,a,o="style."+e,s="end."+o;return function(){var u=Jn(this,t),c=u.on,l=null==u.value[o]?a||(a=nr(e)):void 0;c===i&&r===l||(n=(i=c).copy()).on(s,r=l),u.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,r,a=i+"";return function(){var o=Et(this,t);return o===a?null:o===n?r:r=e(n=o,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,function(t,e,i){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&function(t,e,i){return function(n){this.style.setProperty(t,e(n),i)}}(t,a,i)),n}return a._value=e,a}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(tr(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,r=Qn(this.node(),i).tween,a=0,o=r.length;a<o;++a)if((n=r[a]).name===t)return n.value;return null}return this.each((null==e?function(t,e){var i,n;return function(){var r=Jn(this,t),a=r.tween;if(a!==i)for(var o=0,s=(n=i=a).length;o<s;++o)if(n[o].name===e){(n=n.slice()).splice(o,1);break}r.tween=n}}:function(t,e,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var a=Jn(this,t),o=a.tween;if(o!==n){r=(n=o).slice();for(var s={name:e,value:i},u=0,c=r.length;u<c;++u)if(r[u].name===e){r[u]=s;break}u===c&&r.push(s)}a.tween=r}})(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){Kn(this,t).delay=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){Kn(this,t).delay=e}})(e,t)):Qn(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){Jn(this,t).duration=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){Jn(this,t).duration=e}})(e,t)):Qn(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Jn(this,t).ease=e}}(e,t)):Qn(this.node(),e).ease},end:function(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,o){var s={value:o},u={value:function(){0==--r&&a()}};i.each(function(){var i=Jn(this,n),r=i.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),i.on=e})})}};var gr=function t(e){function i(t){return Math.pow(t,e)}return e=+e,i.exponent=t,i}(3),mr=function t(e){function i(t){return 1-Math.pow(1-t,e)}return e=+e,i.exponent=t,i}(3),yr=function t(e){function i(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,i.exponent=t,i}(3),_r=Math.PI,zr=_r/2;function br(t){return 1-Math.cos(t*zr)}function wr(t){return Math.sin(t*zr)}function Cr(t){return(1-Math.cos(_r*t))/2}function Sr(t){return Math.pow(2,10*t-10)}function xr(t){return 1-Math.pow(2,-10*t)}function Mr(t){return((t*=2)<=1?Math.pow(2,10*t-10):2-Math.pow(2,10-10*t))/2}function Tr(t){return 1-Math.sqrt(1-t*t)}function kr(t){return Math.sqrt(1- --t*t)}function Er(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var Ar=4/11,Rr=6/11,Dr=8/11,Ir=.75,Lr=9/11,Nr=10/11,Or=.9375,Pr=21/22,Br=63/64,qr=1/Ar/Ar;function Gr(t){return 1-Vr(1-t)}function Vr(t){return(t=+t)<Ar?qr*t*t:t<Dr?qr*(t-=Rr)*t+Ir:t<Nr?qr*(t-=Lr)*t+Or:qr*(t-=Pr)*t+Br}function Wr(t){return((t*=2)<=1?1-Vr(1-t):Vr(t-1)+1)/2}var Ur=function t(e){function i(t){return t*t*((e+1)*t-e)}return e=+e,i.overshoot=t,i}(1.70158),Fr=function t(e){function i(t){return--t*t*((e+1)*t+e)+1}return e=+e,i.overshoot=t,i}(1.70158),jr=function t(e){function i(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,i.overshoot=t,i}(1.70158),Hr=2*Math.PI,Yr=function t(e,i){var n=Math.asin(1/(e=Math.max(1,e)))*(i/=Hr);function r(t){return e*Math.pow(2,10*--t)*Math.sin((n-t)/i)}return r.amplitude=function(e){return t(e,i*Hr)},r.period=function(i){return t(e,i)},r}(1,.3),$r=function t(e,i){var n=Math.asin(1/(e=Math.max(1,e)))*(i/=Hr);function r(t){return 1-e*Math.pow(2,-10*(t=+t))*Math.sin((t+n)/i)}return r.amplitude=function(e){return t(e,i*Hr)},r.period=function(i){return t(e,i)},r}(1,.3),Xr=function t(e,i){var n=Math.asin(1/(e=Math.max(1,e)))*(i/=Hr);function r(t){return((t=2*t-1)<0?e*Math.pow(2,10*t)*Math.sin((n-t)/i):2-e*Math.pow(2,-10*t)*Math.sin((n+t)/i))/2}return r.amplitude=function(e){return t(e,i*Hr)},r.period=function(i){return t(e,i)},r}(1,.3),Kr={time:null,delay:0,duration:250,ease:vr};function Jr(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return Kr.time=An(),Kr;return i}te.prototype.interrupt=function(t){return this.each(function(){Zn(this,t)})},te.prototype.transition=function(t){var e,i;t instanceof ar?(e=t._id,t=t._name):(e=sr(),(i=Kr).time=An(),t=null==t?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var o,s=n[a],u=s.length,c=0;c<u;++c)(o=s[c])&&Xn(o,t,e,c,s,i||Jr(o,e));return new ar(n,this._parents,t,e)};var Qr=[null],Zr=function(t,e){var i,n,r=t.__transition;if(r)for(n in e=null==e?null:e+"",r)if((i=r[n]).state>Un&&i.name===e)return new ar([[t]],Qr,e,+n);return null},ta=function(t){return function(){return t}},ea=function(t,e,i){this.target=t,this.type=e,this.selection=i};function ia(){Ft.stopImmediatePropagation()}var na=function(){Ft.preventDefault(),Ft.stopImmediatePropagation()},ra={name:"drag"},aa={name:"space"},oa={name:"handle"},sa={name:"center"},ua={name:"x",handles:["e","w"].map(ga),input:function(t,e){return t&&[[t[0],e[0][1]],[t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},ca={name:"y",handles:["n","s"].map(ga),input:function(t,e){return t&&[[e[0][0],t[0]],[e[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},la={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(ga),input:function(t){return t},output:function(t){return t}},pa={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},ha={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},da={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},fa={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},va={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function ga(t){return{type:t}}function ma(){return!Ft.button}function ya(){var t=this.ownerSVGElement||this;return[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function _a(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function za(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function ba(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function wa(){return xa(ua)}function Ca(){return xa(ca)}var Sa=function(){return xa(la)};function xa(t){var e,i=ya,n=ma,r=ht(o,"start","brush","end"),a=6;function o(e){var i=e.property("__brush",p).selectAll(".overlay").data([ga("overlay")]);i.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",pa.overlay).merge(i).each(function(){var t=_a(this).extent;ee(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),e.selectAll(".selection").data([ga("selection")]).enter().append("rect").attr("class","selection").attr("cursor",pa.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var n=e.selectAll(".handle").data(t.handles,function(t){return t.type});n.exit().remove(),n.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return pa[t.type]}),e.each(s).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",l)}function s(){var t=ee(this),e=_a(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?e[1][0]-a/2:e[0][0]-a/2}).attr("y",function(t){return"s"===t.type[0]?e[1][1]-a/2:e[0][1]-a/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+a:a}).attr("height",function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+a:a})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function u(t,e){return t.__brush.emitter||new c(t,e)}function c(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function l(){if(Ft.touches){if(Ft.changedTouches.length<Ft.touches.length)return na()}else if(e)return;if(n.apply(this,arguments)){var i,r,a,o,c,l,p,h,d,f,v,g,m,y=this,_=Ft.target.__data__.type,z="selection"===(Ft.metaKey?_="overlay":_)?ra:Ft.altKey?sa:oa,b=t===ca?null:fa[_],w=t===ua?null:va[_],C=_a(y),S=C.extent,x=C.selection,M=S[0][0],T=S[0][1],k=S[1][0],E=S[1][1],A=b&&w&&Ft.shiftKey,R=ue(y),D=R,I=u(y,arguments).beforestart();"overlay"===_?C.selection=x=[[i=t===ca?M:R[0],a=t===ua?T:R[1]],[c=t===ca?k:i,p=t===ua?E:a]]:(i=x[0][0],a=x[0][1],c=x[1][0],p=x[1][1]),r=i,o=a,l=c,h=p;var L=ee(y).attr("pointer-events","none"),N=L.selectAll(".overlay").attr("cursor",pa[_]);if(Ft.touches)L.on("touchmove.brush",P,!0).on("touchend.brush touchcancel.brush",q,!0);else{var O=ee(Ft.view).on("keydown.brush",function(){switch(Ft.keyCode){case 16:A=b&&w;break;case 18:z===oa&&(b&&(c=l-d*b,i=r+d*b),w&&(p=h-f*w,a=o+f*w),z=sa,B());break;case 32:z!==oa&&z!==sa||(b<0?c=l-d:b>0&&(i=r-d),w<0?p=h-f:w>0&&(a=o-f),z=aa,N.attr("cursor",pa.selection),B());break;default:return}na()},!0).on("keyup.brush",function(){switch(Ft.keyCode){case 16:A&&(g=m=A=!1,B());break;case 18:z===sa&&(b<0?c=l:b>0&&(i=r),w<0?p=h:w>0&&(a=o),z=oa,B());break;case 32:z===aa&&(Ft.altKey?(b&&(c=l-d*b,i=r+d*b),w&&(p=h-f*w,a=o+f*w),z=sa):(b<0?c=l:b>0&&(i=r),w<0?p=h:w>0&&(a=o),z=oa),N.attr("cursor",pa[_]),B());break;default:return}na()},!0).on("mousemove.brush",P,!0).on("mouseup.brush",q,!0);fe(Ft.view)}ia(),Zn(y),s.call(y),I.start()}function P(){var t=ue(y);!A||g||m||(Math.abs(t[0]-D[0])>Math.abs(t[1]-D[1])?m=!0:g=!0),D=t,v=!0,na(),B()}function B(){var t;switch(d=D[0]-R[0],f=D[1]-R[1],z){case aa:case ra:b&&(d=Math.max(M-i,Math.min(k-c,d)),r=i+d,l=c+d),w&&(f=Math.max(T-a,Math.min(E-p,f)),o=a+f,h=p+f);break;case oa:b<0?(d=Math.max(M-i,Math.min(k-i,d)),r=i+d,l=c):b>0&&(d=Math.max(M-c,Math.min(k-c,d)),r=i,l=c+d),w<0?(f=Math.max(T-a,Math.min(E-a,f)),o=a+f,h=p):w>0&&(f=Math.max(T-p,Math.min(E-p,f)),o=a,h=p+f);break;case sa:b&&(r=Math.max(M,Math.min(k,i-d*b)),l=Math.max(M,Math.min(k,c+d*b))),w&&(o=Math.max(T,Math.min(E,a-f*w)),h=Math.max(T,Math.min(E,p+f*w)))}l<r&&(b*=-1,t=i,i=c,c=t,t=r,r=l,l=t,_ in ha&&N.attr("cursor",pa[_=ha[_]])),h<o&&(w*=-1,t=a,a=p,p=t,t=o,o=h,h=t,_ in da&&N.attr("cursor",pa[_=da[_]])),C.selection&&(x=C.selection),g&&(r=x[0][0],l=x[1][0]),m&&(o=x[0][1],h=x[1][1]),x[0][0]===r&&x[0][1]===o&&x[1][0]===l&&x[1][1]===h||(C.selection=[[r,o],[l,h]],s.call(y),I.brush())}function q(){if(ia(),Ft.touches){if(Ft.touches.length)return;e&&clearTimeout(e),e=setTimeout(function(){e=null},500),L.on("touchmove.brush touchend.brush touchcancel.brush",null)}else ve(Ft.view,v),O.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);L.attr("pointer-events","all"),N.attr("cursor",pa.overlay),C.selection&&(x=C.selection),za(x)&&(C.selection=null,s.call(y)),I.end()}}function p(){var e=this.__brush||{selection:null};return e.extent=i.apply(this,arguments),e.dim=t,e}return o.move=function(e,i){e.selection?e.on("start.brush",function(){u(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){u(this,arguments).end()}).tween("brush",function(){var e=this,n=e.__brush,r=u(e,arguments),a=n.selection,o=t.input("function"==typeof i?i.apply(this,arguments):i,n.extent),c=Yi(a,o);function l(t){n.selection=1===t&&za(o)?null:c(t),s.call(e),r.brush()}return a&&o?l:l(1)}):e.each(function(){var e=arguments,n=this.__brush,r=t.input("function"==typeof i?i.apply(this,e):i,n.extent),a=u(this,e).beforestart();Zn(this),n.selection=null==r||za(r)?null:r,s.call(this),a.start().brush().end()})},c.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(e){Xt(new ea(o,e,t.output(this.state.selection)),r.apply,r,[e,this.that,this.args])}},o.extent=function(t){return arguments.length?(i="function"==typeof t?t:ta([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),o):i},o.filter=function(t){return arguments.length?(n="function"==typeof t?t:ta(!!t),o):n},o.handleSize=function(t){return arguments.length?(a=+t,o):a},o.on=function(){var t=r.on.apply(r,arguments);return t===r?o:t},o}var Ma=Math.cos,Ta=Math.sin,ka=Math.PI,Ea=ka/2,Aa=2*ka,Ra=Math.max;var Da=function(){var t=0,e=null,i=null,n=null;function r(r){var a,o,s,u,c,l,p=r.length,h=[],d=w(p),f=[],v=[],g=v.groups=new Array(p),m=new Array(p*p);for(a=0,c=-1;++c<p;){for(o=0,l=-1;++l<p;)o+=r[c][l];h.push(o),f.push(w(p)),a+=o}for(e&&d.sort(function(t,i){return e(h[t],h[i])}),i&&f.forEach(function(t,e){t.sort(function(t,n){return i(r[e][t],r[e][n])})}),u=(a=Ra(0,Aa-t*p)/a)?t:Aa/p,o=0,c=-1;++c<p;){for(s=o,l=-1;++l<p;){var y=d[c],_=f[y][l],z=r[y][_],b=o,C=o+=z*a;m[_*p+y]={index:y,subindex:_,startAngle:b,endAngle:C,value:z}}g[y]={index:y,startAngle:s,endAngle:o,value:h[y]},o+=u}for(c=-1;++c<p;)for(l=c-1;++l<p;){var S=m[l*p+c],x=m[c*p+l];(S.value||x.value)&&v.push(S.value<x.value?{source:x,target:S}:{source:S,target:x})}return n?v.sort(n):v}return r.padAngle=function(e){return arguments.length?(t=Ra(0,e),r):t},r.sortGroups=function(t){return arguments.length?(e=t,r):e},r.sortSubgroups=function(t){return arguments.length?(i=t,r):i},r.sortChords=function(t){return arguments.length?(null==t?n=null:(e=t,n=function(t,i){return e(t.source.value+t.target.value,i.source.value+i.target.value)})._=t,r):n&&n._;var e},r},Ia=Array.prototype.slice,La=function(t){return function(){return t}},Na=Math.PI,Oa=2*Na,Pa=Oa-1e-6;function Ba(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function qa(){return new Ba}Ba.prototype=qa.prototype={constructor:Ba,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,i,n){this._+="Q"+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+n)},bezierCurveTo:function(t,e,i,n,r,a){this._+="C"+ +t+","+ +e+","+ +i+","+ +n+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(t,e,i,n,r){t=+t,e=+e,i=+i,n=+n,r=+r;var a=this._x1,o=this._y1,s=i-t,u=n-e,c=a-t,l=o-e,p=c*c+l*l;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(p>1e-6)if(Math.abs(l*s-u*c)>1e-6&&r){var h=i-a,d=n-o,f=s*s+u*u,v=h*h+d*d,g=Math.sqrt(f),m=Math.sqrt(p),y=r*Math.tan((Na-Math.acos((f+p-v)/(2*g*m)))/2),_=y/m,z=y/g;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*c)+","+(e+_*l)),this._+="A"+r+","+r+",0,0,"+ +(l*h>c*d)+","+(this._x1=t+z*s)+","+(this._y1=e+z*u)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,i,n,r,a){t=+t,e=+e;var o=(i=+i)*Math.cos(n),s=i*Math.sin(n),u=t+o,c=e+s,l=1^a,p=a?n-r:r-n;if(i<0)throw new Error("negative radius: "+i);null===this._x1?this._+="M"+u+","+c:(Math.abs(this._x1-u)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+u+","+c),i&&(p<0&&(p=p%Oa+Oa),p>Pa?this._+="A"+i+","+i+",0,1,"+l+","+(t-o)+","+(e-s)+"A"+i+","+i+",0,1,"+l+","+(this._x1=u)+","+(this._y1=c):p>1e-6&&(this._+="A"+i+","+i+",0,"+ +(p>=Na)+","+l+","+(this._x1=t+i*Math.cos(r))+","+(this._y1=e+i*Math.sin(r))))},rect:function(t,e,i,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +i+"v"+ +n+"h"+-i+"Z"},toString:function(){return this._}};var Ga=qa;function Va(t){return t.source}function Wa(t){return t.target}function Ua(t){return t.radius}function Fa(t){return t.startAngle}function ja(t){return t.endAngle}var Ha=function(){var t=Va,e=Wa,i=Ua,n=Fa,r=ja,a=null;function o(){var o,s=Ia.call(arguments),u=t.apply(this,s),c=e.apply(this,s),l=+i.apply(this,(s[0]=u,s)),p=n.apply(this,s)-Ea,h=r.apply(this,s)-Ea,d=l*Ma(p),f=l*Ta(p),v=+i.apply(this,(s[0]=c,s)),g=n.apply(this,s)-Ea,m=r.apply(this,s)-Ea;if(a||(a=o=Ga()),a.moveTo(d,f),a.arc(0,0,l,p,h),p===g&&h===m||(a.quadraticCurveTo(0,0,v*Ma(g),v*Ta(g)),a.arc(0,0,v,g,m)),a.quadraticCurveTo(0,0,d,f),a.closePath(),o)return a=null,o+""||null}return o.radius=function(t){return arguments.length?(i="function"==typeof t?t:La(+t),o):i},o.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:La(+t),o):n},o.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:La(+t),o):r},o.source=function(e){return arguments.length?(t=e,o):t},o.target=function(t){return arguments.length?(e=t,o):e},o.context=function(t){return arguments.length?(a=null==t?null:t,o):a},o};function Ya(){}function $a(t,e){var i=new Ya;if(t instanceof Ya)t.each(function(t,e){i.set(e,t)});else if(Array.isArray(t)){var n,r=-1,a=t.length;if(null==e)for(;++r<a;)i.set(r,t[r]);else for(;++r<a;)i.set(e(n=t[r],r,t),n)}else if(t)for(var o in t)i.set(o,t[o]);return i}Ya.prototype=$a.prototype={constructor:Ya,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,e){return this["$"+t]=e,this},remove:function(t){var e="$"+t;return e in this&&delete this[e]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)"$"===e[0]&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)"$"===e[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var e in this)"$"===e[0]&&t(this[e],e.slice(1),this)}};var Xa=$a,Ka=function(){var t,e,i,n=[],r=[];function a(i,r,o,s){if(r>=n.length)return null!=t&&i.sort(t),null!=e?e(i):i;for(var u,c,l,p=-1,h=i.length,d=n[r++],f=Xa(),v=o();++p<h;)(l=f.get(u=d(c=i[p])+""))?l.push(c):f.set(u,[c]);return f.each(function(t,e){s(v,e,a(t,r,o,s))}),v}return i={object:function(t){return a(t,0,Ja,Qa)},map:function(t){return a(t,0,Za,to)},entries:function(t){return function t(i,a){if(++a>n.length)return i;var o,s=r[a-1];return null!=e&&a>=n.length?o=i.entries():(o=[],i.each(function(e,i){o.push({key:i,values:t(e,a)})})),null!=s?o.sort(function(t,e){return s(t.key,e.key)}):o}(a(t,0,Za,to),0)},key:function(t){return n.push(t),i},sortKeys:function(t){return r[n.length-1]=t,i},sortValues:function(e){return t=e,i},rollup:function(t){return e=t,i}}};function Ja(){return{}}function Qa(t,e,i){t[e]=i}function Za(){return Xa()}function to(t,e,i){t.set(e,i)}function eo(){}var io=Xa.prototype;function no(t,e){var i=new eo;if(t instanceof eo)t.each(function(t){i.add(t)});else if(t){var n=-1,r=t.length;if(null==e)for(;++n<r;)i.add(t[n]);else for(;++n<r;)i.add(e(t[n],n,t))}return i}eo.prototype=no.prototype={constructor:eo,has:io.has,add:function(t){return this["$"+(t+="")]=t,this},remove:io.remove,clear:io.clear,values:io.keys,size:io.size,empty:io.empty,each:io.each};var ro=no,ao=function(t){var e=[];for(var i in t)e.push(i);return e},oo=function(t){var e=[];for(var i in t)e.push(t[i]);return e},so=function(t){var e=[];for(var i in t)e.push({key:i,value:t[i]});return e},uo=Array.prototype.slice,co=function(t,e){return t-e},lo=function(t){for(var e=0,i=t.length,n=t[i-1][1]*t[0][0]-t[i-1][0]*t[0][1];++e<i;)n+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return n},po=function(t){return function(){return t}},ho=function(t,e){for(var i,n=-1,r=e.length;++n<r;)if(i=fo(t,e[n]))return i;return 0};function fo(t,e){for(var i=e[0],n=e[1],r=-1,a=0,o=t.length,s=o-1;a<o;s=a++){var u=t[a],c=u[0],l=u[1],p=t[s],h=p[0],d=p[1];if(vo(u,p,e))return 0;l>n!=d>n&&i<(h-c)*(n-l)/(d-l)+c&&(r=-r)}return r}function vo(t,e,i){var n,r,a,o;return function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])==(i[0]-t[0])*(e[1]-t[1])}(t,e,i)&&(r=t[n=+(t[0]===e[0])],a=i[n],o=e[n],r<=a&&a<=o||o<=a&&a<=r)}var go=function(){},mo=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],yo=function(){var t=1,e=1,i=E,n=s;function r(t){var e=i(t);if(Array.isArray(e))e=e.slice().sort(co);else{var n=g(t),r=n[0],o=n[1];e=k(r,o,e),e=w(Math.floor(r/e)*e,Math.floor(o/e)*e,e)}return e.map(function(e){return a(t,e)})}function a(i,r){var a=[],s=[];return function(i,n,r){var a,s,u,c,l,p,h=new Array,d=new Array;a=s=-1,c=i[0]>=n,mo[c<<1].forEach(f);for(;++a<t-1;)u=c,c=i[a+1]>=n,mo[u|c<<1].forEach(f);mo[c<<0].forEach(f);for(;++s<e-1;){for(a=-1,c=i[s*t+t]>=n,l=i[s*t]>=n,mo[c<<1|l<<2].forEach(f);++a<t-1;)u=c,c=i[s*t+t+a+1]>=n,p=l,l=i[s*t+a+1]>=n,mo[u|c<<1|l<<2|p<<3].forEach(f);mo[c|l<<3].forEach(f)}a=-1,l=i[s*t]>=n,mo[l<<2].forEach(f);for(;++a<t-1;)p=l,l=i[s*t+a+1]>=n,mo[l<<2|p<<3].forEach(f);function f(t){var e,i,n=[t[0][0]+a,t[0][1]+s],u=[t[1][0]+a,t[1][1]+s],c=o(n),l=o(u);(e=d[c])?(i=h[l])?(delete d[e.end],delete h[i.start],e===i?(e.ring.push(u),r(e.ring)):h[e.start]=d[i.end]={start:e.start,end:i.end,ring:e.ring.concat(i.ring)}):(delete d[e.end],e.ring.push(u),d[e.end=l]=e):(e=h[l])?(i=d[c])?(delete h[e.start],delete d[i.end],e===i?(e.ring.push(u),r(e.ring)):h[i.start]=d[e.end]={start:i.start,end:e.end,ring:i.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(n),h[e.start=c]=e):h[c]=d[l]={start:c,end:l,ring:[n,u]}}mo[l<<3].forEach(f)}(i,r,function(t){n(t,i,r),lo(t)>0?a.push([t]):s.push(t)}),s.forEach(function(t){for(var e,i=0,n=a.length;i<n;++i)if(-1!==ho((e=a[i])[0],t))return void e.push(t)}),{type:"MultiPolygon",value:r,coordinates:a}}function o(e){return 2*e[0]+e[1]*(t+1)*4}function s(i,n,r){i.forEach(function(i){var a,o=i[0],s=i[1],u=0|o,c=0|s,l=n[c*t+u];o>0&&o<t&&u===o&&(a=n[c*t+u-1],i[0]=o+(r-a)/(l-a)-.5),s>0&&s<e&&c===s&&(a=n[(c-1)*t+u],i[1]=s+(r-a)/(l-a)-.5)})}return r.contour=a,r.size=function(i){if(!arguments.length)return[t,e];var n=Math.ceil(i[0]),a=Math.ceil(i[1]);if(!(n>0&&a>0))throw new Error("invalid size");return t=n,e=a,r},r.thresholds=function(t){return arguments.length?(i="function"==typeof t?t:Array.isArray(t)?po(uo.call(t)):po(t),r):i},r.smooth=function(t){return arguments.length?(n=t?s:go,r):n===s},r};function _o(t,e,i){for(var n=t.width,r=t.height,a=1+(i<<1),o=0;o<r;++o)for(var s=0,u=0;s<n+i;++s)s<n&&(u+=t.data[s+o*n]),s>=i&&(s>=a&&(u-=t.data[s-a+o*n]),e.data[s-i+o*n]=u/Math.min(s+1,n-1+a-s,a))}function zo(t,e,i){for(var n=t.width,r=t.height,a=1+(i<<1),o=0;o<n;++o)for(var s=0,u=0;s<r+i;++s)s<r&&(u+=t.data[o+s*n]),s>=i&&(s>=a&&(u-=t.data[o+(s-a)*n]),e.data[o+(s-i)*n]=u/Math.min(s+1,r-1+a-s,a))}function bo(t){return t[0]}function wo(t){return t[1]}function Co(){return 1}var So=function(){var t=bo,e=wo,i=Co,n=960,r=500,a=20,o=2,s=3*a,u=n+2*s>>o,c=r+2*s>>o,l=po(20);function p(n){var r=new Float32Array(u*c),p=new Float32Array(u*c);n.forEach(function(n,a,l){var p=+t(n,a,l)+s>>o,h=+e(n,a,l)+s>>o,d=+i(n,a,l);p>=0&&p<u&&h>=0&&h<c&&(r[p+h*u]+=d)}),_o({width:u,height:c,data:r},{width:u,height:c,data:p},a>>o),zo({width:u,height:c,data:p},{width:u,height:c,data:r},a>>o),_o({width:u,height:c,data:r},{width:u,height:c,data:p},a>>o),zo({width:u,height:c,data:p},{width:u,height:c,data:r},a>>o),_o({width:u,height:c,data:r},{width:u,height:c,data:p},a>>o),zo({width:u,height:c,data:p},{width:u,height:c,data:r},a>>o);var d=l(r);if(!Array.isArray(d)){var f=L(r);d=k(0,f,d),(d=w(0,Math.floor(f/d)*d,d)).shift()}return yo().thresholds(d).size([u,c])(r).map(h)}function h(t){return t.value*=Math.pow(2,-2*o),t.coordinates.forEach(d),t}function d(t){t.forEach(f)}function f(t){t.forEach(v)}function v(t){t[0]=t[0]*Math.pow(2,o)-s,t[1]=t[1]*Math.pow(2,o)-s}function g(){return u=n+2*(s=3*a)>>o,c=r+2*s>>o,p}return p.x=function(e){return arguments.length?(t="function"==typeof e?e:po(+e),p):t},p.y=function(t){return arguments.length?(e="function"==typeof t?t:po(+t),p):e},p.weight=function(t){return arguments.length?(i="function"==typeof t?t:po(+t),p):i},p.size=function(t){if(!arguments.length)return[n,r];var e=Math.ceil(t[0]),i=Math.ceil(t[1]);if(!(e>=0||e>=0))throw new Error("invalid size");return n=e,r=i,g()},p.cellSize=function(t){if(!arguments.length)return 1<<o;if(!((t=+t)>=1))throw new Error("invalid cell size");return o=Math.floor(Math.log(t)/Math.LN2),g()},p.thresholds=function(t){return arguments.length?(l="function"==typeof t?t:Array.isArray(t)?po(uo.call(t)):po(t),p):l},p.bandwidth=function(t){if(!arguments.length)return Math.sqrt(a*(a+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return a=Math.round((Math.sqrt(4*t*t+1)-1)/2),g()},p},xo={},Mo={},To=34,ko=10,Eo=13;function Ao(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}var Ro=function(t){var e=new RegExp('["'+t+"\n\r]"),i=t.charCodeAt(0);function n(t,e){var n,r=[],a=t.length,o=0,s=0,u=a<=0,c=!1;function l(){if(u)return Mo;if(c)return c=!1,xo;var e,n,r=o;if(t.charCodeAt(r)===To){for(;o++<a&&t.charCodeAt(o)!==To||t.charCodeAt(++o)===To;);return(e=o)>=a?u=!0:(n=t.charCodeAt(o++))===ko?c=!0:n===Eo&&(c=!0,t.charCodeAt(o)===ko&&++o),t.slice(r+1,e-1).replace(/""/g,'"')}for(;o<a;){if((n=t.charCodeAt(e=o++))===ko)c=!0;else if(n===Eo)c=!0,t.charCodeAt(o)===ko&&++o;else if(n!==i)continue;return t.slice(r,e)}return u=!0,t.slice(r,a)}for(t.charCodeAt(a-1)===ko&&--a,t.charCodeAt(a-1)===Eo&&--a;(n=l())!==Mo;){for(var p=[];n!==xo&&n!==Mo;)p.push(n),n=l();e&&null==(p=e(p,s++))||r.push(p)}return r}function r(e){return e.map(a).join(t)}function a(t){return null==t?"":e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var i,r,a=n(t,function(t,n){if(i)return i(t,n-1);r=t,i=e?function(t,e){var i=Ao(t);return function(n,r){return e(i(n),r,t)}}(t,e):Ao(t)});return a.columns=r||[],a},parseRows:n,format:function(e,i){return null==i&&(i=function(t){var e=Object.create(null),i=[];return t.forEach(function(t){for(var n in t)n in e||i.push(e[n]=n)}),i}(e)),[i.map(a).join(t)].concat(e.map(function(e){return i.map(function(t){return a(e[t])}).join(t)})).join("\n")},formatRows:function(t){return t.map(r).join("\n")}}},Do=Ro(","),Io=Do.parse,Lo=Do.parseRows,No=Do.format,Oo=Do.formatRows,Po=Ro("\t"),Bo=Po.parse,qo=Po.parseRows,Go=Po.format,Vo=Po.formatRows;function Wo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.blob()}var Uo=function(t,e){return fetch(t,e).then(Wo)};function Fo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.arrayBuffer()}var jo=function(t,e){return fetch(t,e).then(Fo)};function Ho(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}var Yo=function(t,e){return fetch(t,e).then(Ho)};function $o(t){return function(e,i,n){return 2===arguments.length&&"function"==typeof i&&(n=i,i=void 0),Yo(e,i).then(function(e){return t(e,n)})}}function Xo(t,e,i,n){3===arguments.length&&"function"==typeof i&&(n=i,i=void 0);var r=Ro(t);return Yo(e,i).then(function(t){return r.parse(t,n)})}var Ko=$o(Io),Jo=$o(Bo),Qo=function(t,e){return new Promise(function(i,n){var r=new Image;for(var a in e)r[a]=e[a];r.onerror=n,r.onload=function(){i(r)},r.src=t})};function Zo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}var ts=function(t,e){return fetch(t,e).then(Zo)};function es(t){return function(e,i){return Yo(e,i).then(function(e){return(new DOMParser).parseFromString(e,t)})}}var is=es("application/xml"),ns=es("text/html"),rs=es("image/svg+xml"),as=function(t,e){var i;function n(){var n,r,a=i.length,o=0,s=0;for(n=0;n<a;++n)o+=(r=i[n]).x,s+=r.y;for(o=o/a-t,s=s/a-e,n=0;n<a;++n)(r=i[n]).x-=o,r.y-=s}return null==t&&(t=0),null==e&&(e=0),n.initialize=function(t){i=t},n.x=function(e){return arguments.length?(t=+e,n):t},n.y=function(t){return arguments.length?(e=+t,n):e},n},os=function(t){return function(){return t}},ss=function(){return 1e-6*(Math.random()-.5)};function us(t,e,i,n){if(isNaN(e)||isNaN(i))return t;var r,a,o,s,u,c,l,p,h,d=t._root,f={data:n},v=t._x0,g=t._y0,m=t._x1,y=t._y1;if(!d)return t._root=f,t;for(;d.length;)if((c=e>=(a=(v+m)/2))?v=a:m=a,(l=i>=(o=(g+y)/2))?g=o:y=o,r=d,!(d=d[p=l<<1|c]))return r[p]=f,t;if(s=+t._x.call(null,d.data),u=+t._y.call(null,d.data),e===s&&i===u)return f.next=d,r?r[p]=f:t._root=f,t;do{r=r?r[p]=new Array(4):t._root=new Array(4),(c=e>=(a=(v+m)/2))?v=a:m=a,(l=i>=(o=(g+y)/2))?g=o:y=o}while((p=l<<1|c)==(h=(u>=o)<<1|s>=a));return r[h]=d,r[p]=f,t}var cs=function(t,e,i,n,r){this.node=t,this.x0=e,this.y0=i,this.x1=n,this.y1=r};function ls(t){return t[0]}function ps(t){return t[1]}function hs(t,e,i){var n=new ds(null==e?ls:e,null==i?ps:i,NaN,NaN,NaN,NaN);return null==t?n:n.addAll(t)}function ds(t,e,i,n,r,a){this._x=t,this._y=e,this._x0=i,this._y0=n,this._x1=r,this._y1=a,this._root=void 0}function fs(t){for(var e={data:t.data},i=e;t=t.next;)i=i.next={data:t.data};return e}var vs=hs.prototype=ds.prototype;function gs(t){return t.x+t.vx}function ms(t){return t.y+t.vy}vs.copy=function(){var t,e,i=new ds(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root;if(!n)return i;if(!n.length)return i._root=fs(n),i;for(t=[{source:n,target:i._root=new Array(4)}];n=t.pop();)for(var r=0;r<4;++r)(e=n.source[r])&&(e.length?t.push({source:e,target:n.target[r]=new Array(4)}):n.target[r]=fs(e));return i},vs.add=function(t){var e=+this._x.call(null,t),i=+this._y.call(null,t);return us(this.cover(e,i),e,i,t)},vs.addAll=function(t){var e,i,n,r,a=t.length,o=new Array(a),s=new Array(a),u=1/0,c=1/0,l=-1/0,p=-1/0;for(i=0;i<a;++i)isNaN(n=+this._x.call(null,e=t[i]))||isNaN(r=+this._y.call(null,e))||(o[i]=n,s[i]=r,n<u&&(u=n),n>l&&(l=n),r<c&&(c=r),r>p&&(p=r));for(l<u&&(u=this._x0,l=this._x1),p<c&&(c=this._y0,p=this._y1),this.cover(u,c).cover(l,p),i=0;i<a;++i)us(this,o[i],s[i],t[i]);return this},vs.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,r=this._x1,a=this._y1;if(isNaN(i))r=(i=Math.floor(t))+1,a=(n=Math.floor(e))+1;else{if(!(i>t||t>r||n>e||e>a))return this;var o,s,u=r-i,c=this._root;switch(s=(e<(n+a)/2)<<1|t<(i+r)/2){case 0:do{(o=new Array(4))[s]=c,c=o}while(a=n+(u*=2),t>(r=i+u)||e>a);break;case 1:do{(o=new Array(4))[s]=c,c=o}while(a=n+(u*=2),(i=r-u)>t||e>a);break;case 2:do{(o=new Array(4))[s]=c,c=o}while(n=a-(u*=2),t>(r=i+u)||n>e);break;case 3:do{(o=new Array(4))[s]=c,c=o}while(n=a-(u*=2),(i=r-u)>t||n>e)}this._root&&this._root.length&&(this._root=c)}return this._x0=i,this._y0=n,this._x1=r,this._y1=a,this},vs.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},vs.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},vs.find=function(t,e,i){var n,r,a,o,s,u,c,l=this._x0,p=this._y0,h=this._x1,d=this._y1,f=[],v=this._root;for(v&&f.push(new cs(v,l,p,h,d)),null==i?i=1/0:(l=t-i,p=e-i,h=t+i,d=e+i,i*=i);u=f.pop();)if(!(!(v=u.node)||(r=u.x0)>h||(a=u.y0)>d||(o=u.x1)<l||(s=u.y1)<p))if(v.length){var g=(r+o)/2,m=(a+s)/2;f.push(new cs(v[3],g,m,o,s),new cs(v[2],r,m,g,s),new cs(v[1],g,a,o,m),new cs(v[0],r,a,g,m)),(c=(e>=m)<<1|t>=g)&&(u=f[f.length-1],f[f.length-1]=f[f.length-1-c],f[f.length-1-c]=u)}else{var y=t-+this._x.call(null,v.data),_=e-+this._y.call(null,v.data),z=y*y+_*_;if(z<i){var b=Math.sqrt(i=z);l=t-b,p=e-b,h=t+b,d=e+b,n=v.data}}return n},vs.remove=function(t){if(isNaN(a=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,i,n,r,a,o,s,u,c,l,p,h,d=this._root,f=this._x0,v=this._y0,g=this._x1,m=this._y1;if(!d)return this;if(d.length)for(;;){if((c=a>=(s=(f+g)/2))?f=s:g=s,(l=o>=(u=(v+m)/2))?v=u:m=u,e=d,!(d=d[p=l<<1|c]))return this;if(!d.length)break;(e[p+1&3]||e[p+2&3]||e[p+3&3])&&(i=e,h=p)}for(;d.data!==t;)if(n=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,n?(r?n.next=r:delete n.next,this):e?(r?e[p]=r:delete e[p],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(i?i[h]=d:this._root=d),this):(this._root=r,this)},vs.removeAll=function(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this},vs.root=function(){return this._root},vs.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},vs.visit=function(t){var e,i,n,r,a,o,s=[],u=this._root;for(u&&s.push(new cs(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,n=e.x0,r=e.y0,a=e.x1,o=e.y1)&&u.length){var c=(n+a)/2,l=(r+o)/2;(i=u[3])&&s.push(new cs(i,c,l,a,o)),(i=u[2])&&s.push(new cs(i,n,l,c,o)),(i=u[1])&&s.push(new cs(i,c,r,a,l)),(i=u[0])&&s.push(new cs(i,n,r,c,l))}return this},vs.visitAfter=function(t){var e,i=[],n=[];for(this._root&&i.push(new cs(this._root,this._x0,this._y0,this._x1,this._y1));e=i.pop();){var r=e.node;if(r.length){var a,o=e.x0,s=e.y0,u=e.x1,c=e.y1,l=(o+u)/2,p=(s+c)/2;(a=r[0])&&i.push(new cs(a,o,s,l,p)),(a=r[1])&&i.push(new cs(a,l,s,u,p)),(a=r[2])&&i.push(new cs(a,o,p,l,c)),(a=r[3])&&i.push(new cs(a,l,p,u,c))}n.push(e)}for(;e=n.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},vs.x=function(t){return arguments.length?(this._x=t,this):this._x},vs.y=function(t){return arguments.length?(this._y=t,this):this._y};var ys=function(t){var e,i,n=1,r=1;function a(){for(var t,a,s,u,c,l,p,h=e.length,d=0;d<r;++d)for(a=hs(e,gs,ms).visitAfter(o),t=0;t<h;++t)s=e[t],l=i[s.index],p=l*l,u=s.x+s.vx,c=s.y+s.vy,a.visit(f);function f(t,e,i,r,a){var o=t.data,h=t.r,d=l+h;if(!o)return e>u+d||r<u-d||i>c+d||a<c-d;if(o.index>s.index){var f=u-o.x-o.vx,v=c-o.y-o.vy,g=f*f+v*v;g<d*d&&(0===f&&(g+=(f=ss())*f),0===v&&(g+=(v=ss())*v),g=(d-(g=Math.sqrt(g)))/g*n,s.vx+=(f*=g)*(d=(h*=h)/(p+h)),s.vy+=(v*=g)*d,o.vx-=f*(d=1-d),o.vy-=v*d)}}}function o(t){if(t.data)return t.r=i[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function s(){if(e){var n,r,a=e.length;for(i=new Array(a),n=0;n<a;++n)r=e[n],i[r.index]=+t(r,n,e)}}return"function"!=typeof t&&(t=os(null==t?1:+t)),a.initialize=function(t){e=t,s()},a.iterations=function(t){return arguments.length?(r=+t,a):r},a.strength=function(t){return arguments.length?(n=+t,a):n},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:os(+e),s(),a):t},a};function _s(t){return t.index}function zs(t,e){var i=t.get(e);if(!i)throw new Error("missing: "+e);return i}var bs=function(t){var e,i,n,r,a,o=_s,s=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},u=os(30),c=1;function l(n){for(var r=0,o=t.length;r<c;++r)for(var s,u,l,p,h,d,f,v=0;v<o;++v)u=(s=t[v]).source,p=(l=s.target).x+l.vx-u.x-u.vx||ss(),h=l.y+l.vy-u.y-u.vy||ss(),p*=d=((d=Math.sqrt(p*p+h*h))-i[v])/d*n*e[v],h*=d,l.vx-=p*(f=a[v]),l.vy-=h*f,u.vx+=p*(f=1-f),u.vy+=h*f}function p(){if(n){var s,u,c=n.length,l=t.length,p=Xa(n,o);for(s=0,r=new Array(c);s<l;++s)(u=t[s]).index=s,"object"!=typeof u.source&&(u.source=zs(p,u.source)),"object"!=typeof u.target&&(u.target=zs(p,u.target)),r[u.source.index]=(r[u.source.index]||0)+1,r[u.target.index]=(r[u.target.index]||0)+1;for(s=0,a=new Array(l);s<l;++s)u=t[s],a[s]=r[u.source.index]/(r[u.source.index]+r[u.target.index]);e=new Array(l),h(),i=new Array(l),d()}}function h(){if(n)for(var i=0,r=t.length;i<r;++i)e[i]=+s(t[i],i,t)}function d(){if(n)for(var e=0,r=t.length;e<r;++e)i[e]=+u(t[e],e,t)}return null==t&&(t=[]),l.initialize=function(t){n=t,p()},l.links=function(e){return arguments.length?(t=e,p(),l):t},l.id=function(t){return arguments.length?(o=t,l):o},l.iterations=function(t){return arguments.length?(c=+t,l):c},l.strength=function(t){return arguments.length?(s="function"==typeof t?t:os(+t),h(),l):s},l.distance=function(t){return arguments.length?(u="function"==typeof t?t:os(+t),d(),l):u},l};function ws(t){return t.x}function Cs(t){return t.y}var Ss=10,xs=Math.PI*(3-Math.sqrt(5)),Ms=function(t){var e,i=1,n=.001,r=1-Math.pow(n,1/300),a=0,o=.6,s=Xa(),u=In(l),c=ht("tick","end");function l(){p(),c.call("tick",e),i<n&&(u.stop(),c.call("end",e))}function p(n){var u,c,l=t.length;void 0===n&&(n=1);for(var p=0;p<n;++p)for(i+=(a-i)*r,s.each(function(t){t(i)}),u=0;u<l;++u)null==(c=t[u]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return e}function h(){for(var e,i=0,n=t.length;i<n;++i){if((e=t[i]).index=i,isNaN(e.fx)||(e.x=e.fx),isNaN(e.fy)||(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=Ss*Math.sqrt(i),a=i*xs;e.x=r*Math.cos(a),e.y=r*Math.sin(a)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function d(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),h(),e={tick:p,restart:function(){return u.restart(l),e},stop:function(){return u.stop(),e},nodes:function(i){return arguments.length?(t=i,h(),s.each(d),e):t},alpha:function(t){return arguments.length?(i=+t,e):i},alphaMin:function(t){return arguments.length?(n=+t,e):n},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(a=+t,e):a},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},force:function(t,i){return arguments.length>1?(null==i?s.remove(t):s.set(t,d(i)),e):s.get(t)},find:function(e,i,n){var r,a,o,s,u,c=0,l=t.length;for(null==n?n=1/0:n*=n,c=0;c<l;++c)(o=(r=e-(s=t[c]).x)*r+(a=i-s.y)*a)<n&&(u=s,n=o);return u},on:function(t,i){return arguments.length>1?(c.on(t,i),e):c.on(t)}}},Ts=function(){var t,e,i,n,r=os(-30),a=1,o=1/0,s=.81;function u(n){var r,a=t.length,o=hs(t,ws,Cs).visitAfter(l);for(i=n,r=0;r<a;++r)e=t[r],o.visit(p)}function c(){if(t){var e,i,a=t.length;for(n=new Array(a),e=0;e<a;++e)i=t[e],n[i.index]=+r(i,e,t)}}function l(t){var e,i,r,a,o,s=0,u=0;if(t.length){for(r=a=o=0;o<4;++o)(e=t[o])&&(i=Math.abs(e.value))&&(s+=e.value,u+=i,r+=i*e.x,a+=i*e.y);t.x=r/u,t.y=a/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=n[e.data.index]}while(e=e.next)}t.value=s}function p(t,r,u,c){if(!t.value)return!0;var l=t.x-e.x,p=t.y-e.y,h=c-r,d=l*l+p*p;if(h*h/s<d)return d<o&&(0===l&&(d+=(l=ss())*l),0===p&&(d+=(p=ss())*p),d<a&&(d=Math.sqrt(a*d)),e.vx+=l*t.value*i/d,e.vy+=p*t.value*i/d),!0;if(!(t.length||d>=o)){(t.data!==e||t.next)&&(0===l&&(d+=(l=ss())*l),0===p&&(d+=(p=ss())*p),d<a&&(d=Math.sqrt(a*d)));do{t.data!==e&&(h=n[t.data.index]*i/d,e.vx+=l*h,e.vy+=p*h)}while(t=t.next)}}return u.initialize=function(e){t=e,c()},u.strength=function(t){return arguments.length?(r="function"==typeof t?t:os(+t),c(),u):r},u.distanceMin=function(t){return arguments.length?(a=t*t,u):Math.sqrt(a)},u.distanceMax=function(t){return arguments.length?(o=t*t,u):Math.sqrt(o)},u.theta=function(t){return arguments.length?(s=t*t,u):Math.sqrt(s)},u},ks=function(t,e,i){var n,r,a,o=os(.1);function s(t){for(var o=0,s=n.length;o<s;++o){var u=n[o],c=u.x-e||1e-6,l=u.y-i||1e-6,p=Math.sqrt(c*c+l*l),h=(a[o]-p)*r[o]*t/p;u.vx+=c*h,u.vy+=l*h}}function u(){if(n){var e,i=n.length;for(r=new Array(i),a=new Array(i),e=0;e<i;++e)a[e]=+t(n[e],e,n),r[e]=isNaN(a[e])?0:+o(n[e],e,n)}}return"function"!=typeof t&&(t=os(+t)),null==e&&(e=0),null==i&&(i=0),s.initialize=function(t){n=t,u()},s.strength=function(t){return arguments.length?(o="function"==typeof t?t:os(+t),u(),s):o},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:os(+e),u(),s):t},s.x=function(t){return arguments.length?(e=+t,s):e},s.y=function(t){return arguments.length?(i=+t,s):i},s},Es=function(t){var e,i,n,r=os(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)(r=e[a]).vx+=(n[a]-r.x)*i[a]*t}function o(){if(e){var a,o=e.length;for(i=new Array(o),n=new Array(o),a=0;a<o;++a)i[a]=isNaN(n[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=os(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:os(+t),o(),a):r},a.x=function(e){return arguments.length?(t="function"==typeof e?e:os(+e),o(),a):t},a},As=function(t){var e,i,n,r=os(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)(r=e[a]).vy+=(n[a]-r.y)*i[a]*t}function o(){if(e){var a,o=e.length;for(i=new Array(o),n=new Array(o),a=0;a<o;++a)i[a]=isNaN(n[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=os(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:os(+t),o(),a):r},a.y=function(e){return arguments.length?(t="function"==typeof e?e:os(+e),o(),a):t},a},Rs=function(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]},Ds=function(t){return(t=Rs(Math.abs(t)))?t[1]:NaN},Is=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ls(t){return new Ns(t)}function Ns(t){if(!(e=Is.exec(t)))throw new Error("invalid format: "+t);var e;this.fill=e[1]||" ",this.align=e[2]||">",this.sign=e[3]||"-",this.symbol=e[4]||"",this.zero=!!e[5],this.width=e[6]&&+e[6],this.comma=!!e[7],this.precision=e[8]&&+e[8].slice(1),this.trim=!!e[9],this.type=e[10]||""}Ls.prototype=Ns.prototype,Ns.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Os,Ps,Bs,qs,Gs=function(t){t:for(var e,i=t.length,n=1,r=-1;n<i;++n)switch(t[n]){case".":r=e=n;break;case"0":0===r&&(r=n),e=n;break;default:if(r>0){if(!+t[n])break t;r=0}}return r>0?t.slice(0,r)+t.slice(e+1):t},Vs=function(t,e){var i=Rs(t,e);if(!i)return t+"";var n=i[0],r=i[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")},Ws={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Vs(100*t,e)},r:Vs,s:function(t,e){var i=Rs(t,e);if(!i)return t+"";var n=i[0],r=i[1],a=r-(Os=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Rs(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},Us=function(t){return t},Fs=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"],js=function(t){var e,i,n=t.grouping&&t.thousands?(e=t.grouping,i=t.thousands,function(t,n){for(var r=t.length,a=[],o=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),a.push(t.substring(r-=s,r+s)),!((u+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(i)}):Us,r=t.currency,a=t.decimal,o=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(t.numerals):Us,s=t.percent||"%";function u(t){var e=(t=Ls(t)).fill,i=t.align,u=t.sign,c=t.symbol,l=t.zero,p=t.width,h=t.comma,d=t.precision,f=t.trim,v=t.type;"n"===v?(h=!0,v="g"):Ws[v]||(null==d&&(d=12),f=!0,v="g"),(l||"0"===e&&"="===i)&&(l=!0,e="0",i="=");var g="$"===c?r[0]:"#"===c&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",m="$"===c?r[1]:/[%p]/.test(v)?s:"",y=Ws[v],_=/[defgprs%]/.test(v);function z(t){var r,s,c,z=g,b=m;if("c"===v)b=y(t)+b,t="";else{var w=(t=+t)<0;if(t=y(Math.abs(t),d),f&&(t=Gs(t)),w&&0==+t&&(w=!1),z=(w?"("===u?u:"-":"-"===u||"("===u?"":u)+z,b=("s"===v?Fs[8+Os/3]:"")+b+(w&&"("===u?")":""),_)for(r=-1,s=t.length;++r<s;)if(48>(c=t.charCodeAt(r))||c>57){b=(46===c?a+t.slice(r+1):t.slice(r))+b,t=t.slice(0,r);break}}h&&!l&&(t=n(t,1/0));var C=z.length+t.length+b.length,S=C<p?new Array(p-C+1).join(e):"";switch(h&&l&&(t=n(S+t,S.length?p-b.length:1/0),S=""),i){case"<":t=z+t+b+S;break;case"=":t=z+S+t+b;break;case"^":t=S.slice(0,C=S.length>>1)+z+t+b+S.slice(C);break;default:t=S+z+t+b}return o(t)}return d=null==d?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),z.toString=function(){return t+""},z}return{format:u,formatPrefix:function(t,e){var i=u(((t=Ls(t)).type="f",t)),n=3*Math.max(-8,Math.min(8,Math.floor(Ds(e)/3))),r=Math.pow(10,-n),a=Fs[8+n/3];return function(t){return i(r*t)+a}}}};function Hs(t){return Ps=js(t),Bs=Ps.format,qs=Ps.formatPrefix,Ps}Hs({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var Ys=function(t){return Math.max(0,-Ds(Math.abs(t)))},$s=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ds(e)/3)))-Ds(Math.abs(t)))},Xs=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ds(e)-Ds(t))+1},Ks=function(){return new Js};function Js(){this.reset()}Js.prototype={constructor:Js,reset:function(){this.s=this.t=0},add:function(t){Zs(Qs,t,this.t),Zs(this,Qs.s,this.s),this.s?this.t+=Qs.t:this.s=Qs.t},valueOf:function(){return this.s}};var Qs=new Js;function Zs(t,e,i){var n=t.s=e+i,r=n-e,a=n-r;t.t=e-a+(i-r)}var tu=1e-6,eu=Math.PI,iu=eu/2,nu=eu/4,ru=2*eu,au=180/eu,ou=eu/180,su=Math.abs,uu=Math.atan,cu=Math.atan2,lu=Math.cos,pu=Math.ceil,hu=Math.exp,du=(Math.floor,Math.log),fu=Math.pow,vu=Math.sin,gu=Math.sign||function(t){return t>0?1:t<0?-1:0},mu=Math.sqrt,yu=Math.tan;function _u(t){return t>1?0:t<-1?eu:Math.acos(t)}function zu(t){return t>1?iu:t<-1?-iu:Math.asin(t)}function bu(t){return(t=vu(t/2))*t}function wu(){}function Cu(t,e){t&&xu.hasOwnProperty(t.type)&&xu[t.type](t,e)}var Su={Feature:function(t,e){Cu(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,r=i.length;++n<r;)Cu(i[n].geometry,e)}},xu={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){Mu(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)Mu(i[n],e,0)},Polygon:function(t,e){Tu(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)Tu(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,r=i.length;++n<r;)Cu(i[n],e)}};function Mu(t,e,i){var n,r=-1,a=t.length-i;for(e.lineStart();++r<a;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function Tu(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)Mu(t[i],e,1);e.polygonEnd()}var ku,Eu,Au,Ru,Du,Iu=function(t,e){t&&Su.hasOwnProperty(t.type)?Su[t.type](t,e):Cu(t,e)},Lu=Ks(),Nu=Ks(),Ou={point:wu,lineStart:wu,lineEnd:wu,polygonStart:function(){Lu.reset(),Ou.lineStart=Pu,Ou.lineEnd=Bu},polygonEnd:function(){var t=+Lu;Nu.add(t<0?ru+t:t),this.lineStart=this.lineEnd=this.point=wu},sphere:function(){Nu.add(ru)}};function Pu(){Ou.point=qu}function Bu(){Gu(ku,Eu)}function qu(t,e){Ou.point=Gu,ku=t,Eu=e,Au=t*=ou,Ru=lu(e=(e*=ou)/2+nu),Du=vu(e)}function Gu(t,e){var i=(t*=ou)-Au,n=i>=0?1:-1,r=n*i,a=lu(e=(e*=ou)/2+nu),o=vu(e),s=Du*o,u=Ru*a+s*lu(r),c=s*n*vu(r);Lu.add(cu(c,u)),Au=t,Ru=a,Du=o}var Vu=function(t){return Nu.reset(),Iu(t,Ou),2*Nu};function Wu(t){return[cu(t[1],t[0]),zu(t[2])]}function Uu(t){var e=t[0],i=t[1],n=lu(i);return[n*lu(e),n*vu(e),vu(i)]}function Fu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ju(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Hu(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Yu(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function $u(t){var e=mu(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Xu,Ku,Ju,Qu,Zu,tc,ec,ic,nc,rc,ac=Ks(),oc={point:sc,lineStart:cc,lineEnd:lc,polygonStart:function(){oc.point=pc,oc.lineStart=hc,oc.lineEnd=dc,ac.reset(),Ou.polygonStart()},polygonEnd:function(){Ou.polygonEnd(),oc.point=sc,oc.lineStart=cc,oc.lineEnd=lc,Lu<0?(Xu=-(Ju=180),Ku=-(Qu=90)):ac>tu?Qu=90:ac<-tu&&(Ku=-90),rc[0]=Xu,rc[1]=Ju}};function sc(t,e){nc.push(rc=[Xu=t,Ju=t]),e<Ku&&(Ku=e),e>Qu&&(Qu=e)}function uc(t,e){var i=Uu([t*ou,e*ou]);if(ic){var n=ju(ic,i),r=ju([n[1],-n[0],0],n);$u(r),r=Wu(r);var a,o=t-Zu,s=o>0?1:-1,u=r[0]*au*s,c=su(o)>180;c^(s*Zu<u&&u<s*t)?(a=r[1]*au)>Qu&&(Qu=a):c^(s*Zu<(u=(u+360)%360-180)&&u<s*t)?(a=-r[1]*au)<Ku&&(Ku=a):(e<Ku&&(Ku=e),e>Qu&&(Qu=e)),c?t<Zu?fc(Xu,t)>fc(Xu,Ju)&&(Ju=t):fc(t,Ju)>fc(Xu,Ju)&&(Xu=t):Ju>=Xu?(t<Xu&&(Xu=t),t>Ju&&(Ju=t)):t>Zu?fc(Xu,t)>fc(Xu,Ju)&&(Ju=t):fc(t,Ju)>fc(Xu,Ju)&&(Xu=t)}else nc.push(rc=[Xu=t,Ju=t]);e<Ku&&(Ku=e),e>Qu&&(Qu=e),ic=i,Zu=t}function cc(){oc.point=uc}function lc(){rc[0]=Xu,rc[1]=Ju,oc.point=sc,ic=null}function pc(t,e){if(ic){var i=t-Zu;ac.add(su(i)>180?i+(i>0?360:-360):i)}else tc=t,ec=e;Ou.point(t,e),uc(t,e)}function hc(){Ou.lineStart()}function dc(){pc(tc,ec),Ou.lineEnd(),su(ac)>tu&&(Xu=-(Ju=180)),rc[0]=Xu,rc[1]=Ju,ic=null}function fc(t,e){return(e-=t)<0?e+360:e}function vc(t,e){return t[0]-e[0]}function gc(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var mc,yc,_c,zc,bc,wc,Cc,Sc,xc,Mc,Tc,kc,Ec,Ac,Rc,Dc,Ic=function(t){var e,i,n,r,a,o,s;if(Qu=Ju=-(Xu=Ku=1/0),nc=[],Iu(t,oc),i=nc.length){for(nc.sort(vc),e=1,a=[n=nc[0]];e<i;++e)gc(n,(r=nc[e])[0])||gc(n,r[1])?(fc(n[0],r[1])>fc(n[0],n[1])&&(n[1]=r[1]),fc(r[0],n[1])>fc(n[0],n[1])&&(n[0]=r[0])):a.push(n=r);for(o=-1/0,e=0,n=a[i=a.length-1];e<=i;n=r,++e)r=a[e],(s=fc(n[1],r[0]))>o&&(o=s,Xu=r[0],Ju=n[1])}return nc=rc=null,Xu===1/0||Ku===1/0?[[NaN,NaN],[NaN,NaN]]:[[Xu,Ku],[Ju,Qu]]},Lc={sphere:wu,point:Nc,lineStart:Pc,lineEnd:Gc,polygonStart:function(){Lc.lineStart=Vc,Lc.lineEnd=Wc},polygonEnd:function(){Lc.lineStart=Pc,Lc.lineEnd=Gc}};function Nc(t,e){t*=ou;var i=lu(e*=ou);Oc(i*lu(t),i*vu(t),vu(e))}function Oc(t,e,i){_c+=(t-_c)/++mc,zc+=(e-zc)/mc,bc+=(i-bc)/mc}function Pc(){Lc.point=Bc}function Bc(t,e){t*=ou;var i=lu(e*=ou);Ac=i*lu(t),Rc=i*vu(t),Dc=vu(e),Lc.point=qc,Oc(Ac,Rc,Dc)}function qc(t,e){t*=ou;var i=lu(e*=ou),n=i*lu(t),r=i*vu(t),a=vu(e),o=cu(mu((o=Rc*a-Dc*r)*o+(o=Dc*n-Ac*a)*o+(o=Ac*r-Rc*n)*o),Ac*n+Rc*r+Dc*a);yc+=o,wc+=o*(Ac+(Ac=n)),Cc+=o*(Rc+(Rc=r)),Sc+=o*(Dc+(Dc=a)),Oc(Ac,Rc,Dc)}function Gc(){Lc.point=Nc}function Vc(){Lc.point=Uc}function Wc(){Fc(kc,Ec),Lc.point=Nc}function Uc(t,e){kc=t,Ec=e,t*=ou,e*=ou,Lc.point=Fc;var i=lu(e);Ac=i*lu(t),Rc=i*vu(t),Dc=vu(e),Oc(Ac,Rc,Dc)}function Fc(t,e){t*=ou;var i=lu(e*=ou),n=i*lu(t),r=i*vu(t),a=vu(e),o=Rc*a-Dc*r,s=Dc*n-Ac*a,u=Ac*r-Rc*n,c=mu(o*o+s*s+u*u),l=zu(c),p=c&&-l/c;xc+=p*o,Mc+=p*s,Tc+=p*u,yc+=l,wc+=l*(Ac+(Ac=n)),Cc+=l*(Rc+(Rc=r)),Sc+=l*(Dc+(Dc=a)),Oc(Ac,Rc,Dc)}var jc=function(t){mc=yc=_c=zc=bc=wc=Cc=Sc=xc=Mc=Tc=0,Iu(t,Lc);var e=xc,i=Mc,n=Tc,r=e*e+i*i+n*n;return r<1e-12&&(e=wc,i=Cc,n=Sc,yc<tu&&(e=_c,i=zc,n=bc),(r=e*e+i*i+n*n)<1e-12)?[NaN,NaN]:[cu(i,e)*au,zu(n/mu(r))*au]},Hc=function(t){return function(){return t}},Yc=function(t,e){function i(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(i.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),i};function $c(t,e){return[su(t)>eu?t+Math.round(-t/ru)*ru:t,e]}function Xc(t,e,i){return(t%=ru)?e||i?Yc(Jc(t),Qc(e,i)):Jc(t):e||i?Qc(e,i):$c}function Kc(t){return function(e,i){return[(e+=t)>eu?e-ru:e<-eu?e+ru:e,i]}}function Jc(t){var e=Kc(t);return e.invert=Kc(-t),e}function Qc(t,e){var i=lu(t),n=vu(t),r=lu(e),a=vu(e);function o(t,e){var o=lu(e),s=lu(t)*o,u=vu(t)*o,c=vu(e),l=c*i+s*n;return[cu(u*r-l*a,s*i-c*n),zu(l*r+u*a)]}return o.invert=function(t,e){var o=lu(e),s=lu(t)*o,u=vu(t)*o,c=vu(e),l=c*r-u*a;return[cu(u*r+c*a,s*i+l*n),zu(l*i-s*n)]},o}$c.invert=$c;var Zc=function(t){function e(e){return(e=t(e[0]*ou,e[1]*ou))[0]*=au,e[1]*=au,e}return t=Xc(t[0]*ou,t[1]*ou,t.length>2?t[2]*ou:0),e.invert=function(e){return(e=t.invert(e[0]*ou,e[1]*ou))[0]*=au,e[1]*=au,e},e};function tl(t,e,i,n,r,a){if(i){var o=lu(e),s=vu(e),u=n*i;null==r?(r=e+n*ru,a=e-u/2):(r=el(o,r),a=el(o,a),(n>0?r<a:r>a)&&(r+=n*ru));for(var c,l=r;n>0?l>a:l<a;l-=u)c=Wu([o,-s*lu(l),-s*vu(l)]),t.point(c[0],c[1])}}function el(t,e){(e=Uu(e))[0]-=t,$u(e);var i=_u(-e[1]);return((-e[2]<0?-i:i)+ru-tu)%ru}var il=function(){var t,e,i=Hc([0,0]),n=Hc(90),r=Hc(6),a={point:function(i,n){t.push(i=e(i,n)),i[0]*=au,i[1]*=au}};function o(){var o=i.apply(this,arguments),s=n.apply(this,arguments)*ou,u=r.apply(this,arguments)*ou;return t=[],e=Xc(-o[0]*ou,-o[1]*ou,0).invert,tl(a,s,u,1),o={type:"Polygon",coordinates:[t]},t=e=null,o}return o.center=function(t){return arguments.length?(i="function"==typeof t?t:Hc([+t[0],+t[1]]),o):i},o.radius=function(t){return arguments.length?(n="function"==typeof t?t:Hc(+t),o):n},o.precision=function(t){return arguments.length?(r="function"==typeof t?t:Hc(+t),o):r},o},nl=function(){var t,e=[];return{point:function(e,i){t.push([e,i])},lineStart:function(){e.push(t=[])},lineEnd:wu,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}},rl=function(t,e){return su(t[0]-e[0])<tu&&su(t[1]-e[1])<tu};function al(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}var ol=function(t,e,i,n,r){var a,o,s=[],u=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,i,n=t[0],o=t[e];if(rl(n,o)){for(r.lineStart(),a=0;a<e;++a)r.point((n=t[a])[0],n[1]);r.lineEnd()}else s.push(i=new al(n,t,null,!0)),u.push(i.o=new al(n,null,i,!1)),s.push(i=new al(o,t,null,!1)),u.push(i.o=new al(o,null,i,!0))}}),s.length){for(u.sort(e),sl(s),sl(u),a=0,o=u.length;a<o;++a)u[a].e=i=!i;for(var c,l,p=s[0];;){for(var h=p,d=!0;h.v;)if((h=h.n)===p)return;c=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,o=c.length;a<o;++a)r.point((l=c[a])[0],l[1]);else n(h.x,h.n.x,1,r);h=h.n}else{if(d)for(c=h.p.z,a=c.length-1;a>=0;--a)r.point((l=c[a])[0],l[1]);else n(h.x,h.p.x,-1,r);h=h.p}c=(h=h.o).z,d=!d}while(!h.v);r.lineEnd()}}};function sl(t){if(e=t.length){for(var e,i,n=0,r=t[0];++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}var ul=Ks(),cl=function(t,e){var i=e[0],n=e[1],r=vu(n),a=[vu(i),-lu(i),0],o=0,s=0;ul.reset(),1===r?n=iu+tu:-1===r&&(n=-iu-tu);for(var u=0,c=t.length;u<c;++u)if(p=(l=t[u]).length)for(var l,p,h=l[p-1],d=h[0],f=h[1]/2+nu,v=vu(f),g=lu(f),m=0;m<p;++m,d=_,v=b,g=w,h=y){var y=l[m],_=y[0],z=y[1]/2+nu,b=vu(z),w=lu(z),C=_-d,S=C>=0?1:-1,x=S*C,M=x>eu,T=v*b;if(ul.add(cu(T*S*vu(x),g*w+T*lu(x))),o+=M?C+S*ru:C,M^d>=i^_>=i){var k=ju(Uu(h),Uu(y));$u(k);var E=ju(a,k);$u(E);var A=(M^C>=0?-1:1)*zu(E[2]);(n>A||n===A&&(k[0]||k[1]))&&(s+=M^C>=0?1:-1)}}return(o<-tu||o<tu&&ul<-tu)^1&s},ll=function(t,e,i,n){return function(r){var a,o,s,u=e(r),c=nl(),l=e(c),p=!1,h={point:d,lineStart:v,lineEnd:g,polygonStart:function(){h.point=m,h.lineStart=y,h.lineEnd=_,o=[],a=[]},polygonEnd:function(){h.point=d,h.lineStart=v,h.lineEnd=g,o=P(o);var t=cl(a,n);o.length?(p||(r.polygonStart(),p=!0),ol(o,hl,t,i,r)):t&&(p||(r.polygonStart(),p=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),p&&(r.polygonEnd(),p=!1),o=a=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(e,i){t(e,i)&&r.point(e,i)}function f(t,e){u.point(t,e)}function v(){h.point=f,u.lineStart()}function g(){h.point=d,u.lineEnd()}function m(t,e){s.push([t,e]),l.point(t,e)}function y(){l.lineStart(),s=[]}function _(){m(s[0][0],s[0][1]),l.lineEnd();var t,e,i,n,u=l.clean(),h=c.result(),d=h.length;if(s.pop(),a.push(s),s=null,d)if(1&u){if((e=(i=h[0]).length-1)>0){for(p||(r.polygonStart(),p=!0),r.lineStart(),t=0;t<e;++t)r.point((n=i[t])[0],n[1]);r.lineEnd()}}else d>1&&2&u&&h.push(h.pop().concat(h.shift())),o.push(h.filter(pl))}return h}};function pl(t){return t.length>1}function hl(t,e){return((t=t.x)[0]<0?t[1]-iu-tu:iu-t[1])-((e=e.x)[0]<0?e[1]-iu-tu:iu-e[1])}var dl=ll(function(){return!0},function(t){var e,i=NaN,n=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?eu:-eu,u=su(a-i);su(u-eu)<tu?(t.point(i,n=(n+o)/2>0?iu:-iu),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(s,n),t.point(a,n),e=0):r!==s&&u>=eu&&(su(i-r)<tu&&(i-=r*tu),su(a-s)<tu&&(a-=s*tu),n=function(t,e,i,n){var r,a,o=vu(t-i);return su(o)>tu?uu((vu(e)*(a=lu(n))*vu(i)-vu(n)*(r=lu(e))*vu(t))/(r*a*o)):(e+n)/2}(i,n,a,o),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(s,n),e=0),t.point(i=a,n=o),r=s},lineEnd:function(){t.lineEnd(),i=n=NaN},clean:function(){return 2-e}}},function(t,e,i,n){var r;if(null==t)r=i*iu,n.point(-eu,r),n.point(0,r),n.point(eu,r),n.point(eu,0),n.point(eu,-r),n.point(0,-r),n.point(-eu,-r),n.point(-eu,0),n.point(-eu,r);else if(su(t[0]-e[0])>tu){var a=t[0]<e[0]?eu:-eu;r=i*a/2,n.point(-a,r),n.point(0,r),n.point(a,r)}else n.point(e[0],e[1])},[-eu,-iu]);var fl=function(t){var e=lu(t),i=6*ou,n=e>0,r=su(e)>tu;function a(t,i){return lu(t)*lu(i)>e}function o(t,i,n){var r=[1,0,0],a=ju(Uu(t),Uu(i)),o=Fu(a,a),s=a[0],u=o-s*s;if(!u)return!n&&t;var c=e*o/u,l=-e*s/u,p=ju(r,a),h=Yu(r,c);Hu(h,Yu(a,l));var d=p,f=Fu(h,d),v=Fu(d,d),g=f*f-v*(Fu(h,h)-1);if(!(g<0)){var m=mu(g),y=Yu(d,(-f-m)/v);if(Hu(y,h),y=Wu(y),!n)return y;var _,z=t[0],b=i[0],w=t[1],C=i[1];b<z&&(_=z,z=b,b=_);var S=b-z,x=su(S-eu)<tu;if(!x&&C<w&&(_=w,w=C,C=_),x||S<tu?x?w+C>0^y[1]<(su(y[0]-z)<tu?w:C):w<=y[1]&&y[1]<=C:S>eu^(z<=y[0]&&y[0]<=b)){var M=Yu(d,(-f+m)/v);return Hu(M,h),[y,Wu(M)]}}}function s(e,i){var r=n?t:eu-t,a=0;return e<-r?a|=1:e>r&&(a|=2),i<-r?a|=4:i>r&&(a|=8),a}return ll(a,function(t){var e,i,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(p,h){var d,f=[p,h],v=a(p,h),g=n?v?0:s(p,h):v?s(p+(p<0?eu:-eu),h):0;if(!e&&(c=u=v)&&t.lineStart(),v!==u&&(!(d=o(e,f))||rl(e,d)||rl(f,d))&&(f[0]+=tu,f[1]+=tu,v=a(f[0],f[1])),v!==u)l=0,v?(t.lineStart(),d=o(f,e),t.point(d[0],d[1])):(d=o(e,f),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(r&&e&&n^v){var m;g&i||!(m=o(f,e,!0))||(l=0,n?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!v||e&&rl(e,f)||t.point(f[0],f[1]),e=f,u=v,i=g},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return l|(c&&u)<<1}}},function(e,n,r,a){tl(a,t,i,r,e,n)},n?[0,-t]:[-eu,t-eu])},vl=function(t,e,i,n,r,a){var o,s=t[0],u=t[1],c=0,l=1,p=e[0]-s,h=e[1]-u;if(o=i-s,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<l&&(l=o)}else if(p>0){if(o>l)return;o>c&&(c=o)}if(o=r-s,p||!(o<0)){if(o/=p,p<0){if(o>l)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<l&&(l=o)}if(o=n-u,h||!(o>0)){if(o/=h,h<0){if(o<c)return;o<l&&(l=o)}else if(h>0){if(o>l)return;o>c&&(c=o)}if(o=a-u,h||!(o<0)){if(o/=h,h<0){if(o>l)return;o>c&&(c=o)}else if(h>0){if(o<c)return;o<l&&(l=o)}return c>0&&(t[0]=s+c*p,t[1]=u+c*h),l<1&&(e[0]=s+l*p,e[1]=u+l*h),!0}}}}},gl=1e9,ml=-gl;function yl(t,e,i,n){function r(r,a){return t<=r&&r<=i&&e<=a&&a<=n}function a(r,a,s,c){var l=0,p=0;if(null==r||(l=o(r,s))!==(p=o(a,s))||u(r,a)<0^s>0)do{c.point(0===l||3===l?t:i,l>1?n:e)}while((l=(l+s+4)%4)!==p);else c.point(a[0],a[1])}function o(n,r){return su(n[0]-t)<tu?r>0?0:3:su(n[0]-i)<tu?r>0?2:1:su(n[1]-e)<tu?r>0?1:0:r>0?3:2}function s(t,e){return u(t.x,e.x)}function u(t,e){var i=o(t,1),n=o(e,1);return i!==n?i-n:0===i?e[1]-t[1]:1===i?t[0]-e[0]:2===i?t[1]-e[1]:e[0]-t[0]}return function(o){var u,c,l,p,h,d,f,v,g,m,y,_=o,z=nl(),b={point:w,lineStart:function(){b.point=C,c&&c.push(l=[]);m=!0,g=!1,f=v=NaN},lineEnd:function(){u&&(C(p,h),d&&g&&z.rejoin(),u.push(z.result()));b.point=w,g&&_.lineEnd()},polygonStart:function(){_=z,u=[],c=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,i=0,r=c.length;i<r;++i)for(var a,o,s=c[i],u=1,l=s.length,p=s[0],h=p[0],d=p[1];u<l;++u)a=h,o=d,p=s[u],h=p[0],d=p[1],o<=n?d>n&&(h-a)*(n-o)>(d-o)*(t-a)&&++e:d<=n&&(h-a)*(n-o)<(d-o)*(t-a)&&--e;return e}(),i=y&&e,r=(u=P(u)).length;(i||r)&&(o.polygonStart(),i&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),r&&ol(u,s,e,a,o),o.polygonEnd());_=o,u=c=l=null}};function w(t,e){r(t,e)&&_.point(t,e)}function C(a,o){var s=r(a,o);if(c&&l.push([a,o]),m)p=a,h=o,d=s,m=!1,s&&(_.lineStart(),_.point(a,o));else if(s&&g)_.point(a,o);else{var u=[f=Math.max(ml,Math.min(gl,f)),v=Math.max(ml,Math.min(gl,v))],z=[a=Math.max(ml,Math.min(gl,a)),o=Math.max(ml,Math.min(gl,o))];vl(u,z,t,e,i,n)?(g||(_.lineStart(),_.point(u[0],u[1])),_.point(z[0],z[1]),s||_.lineEnd(),y=!1):s&&(_.lineStart(),_.point(a,o),y=!1)}f=a,v=o,g=s}return b}}var _l,zl,bl,wl=function(){var t,e,i,n=0,r=0,a=960,o=500;return i={stream:function(i){return t&&e===i?t:t=yl(n,r,a,o)(e=i)},extent:function(s){return arguments.length?(n=+s[0][0],r=+s[0][1],a=+s[1][0],o=+s[1][1],t=e=null,i):[[n,r],[a,o]]}}},Cl=Ks(),Sl={sphere:wu,point:wu,lineStart:function(){Sl.point=Ml,Sl.lineEnd=xl},lineEnd:wu,polygonStart:wu,polygonEnd:wu};function xl(){Sl.point=Sl.lineEnd=wu}function Ml(t,e){_l=t*=ou,zl=vu(e*=ou),bl=lu(e),Sl.point=Tl}function Tl(t,e){t*=ou;var i=vu(e*=ou),n=lu(e),r=su(t-_l),a=lu(r),o=n*vu(r),s=bl*i-zl*n*a,u=zl*i+bl*n*a;Cl.add(cu(mu(o*o+s*s),u)),_l=t,zl=i,bl=n}var kl=function(t){return Cl.reset(),Iu(t,Sl),+Cl},El=[null,null],Al={type:"LineString",coordinates:El},Rl=function(t,e){return El[0]=t,El[1]=e,kl(Al)},Dl={Feature:function(t,e){return Ll(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,r=i.length;++n<r;)if(Ll(i[n].geometry,e))return!0;return!1}},Il={Sphere:function(){return!0},Point:function(t,e){return Nl(t.coordinates,e)},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)if(Nl(i[n],e))return!0;return!1},LineString:function(t,e){return Ol(t.coordinates,e)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)if(Ol(i[n],e))return!0;return!1},Polygon:function(t,e){return Pl(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)if(Pl(i[n],e))return!0;return!1},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,r=i.length;++n<r;)if(Ll(i[n],e))return!0;return!1}};function Ll(t,e){return!(!t||!Il.hasOwnProperty(t.type))&&Il[t.type](t,e)}function Nl(t,e){return 0===Rl(t,e)}function Ol(t,e){var i=Rl(t[0],t[1]);return Rl(t[0],e)+Rl(e,t[1])<=i+tu}function Pl(t,e){return!!cl(t.map(Bl),ql(e))}function Bl(t){return(t=t.map(ql)).pop(),t}function ql(t){return[t[0]*ou,t[1]*ou]}var Gl=function(t,e){return(t&&Dl.hasOwnProperty(t.type)?Dl[t.type]:Ll)(t,e)};function Vl(t,e,i){var n=w(t,e-tu,i).concat(e);return function(t){return n.map(function(e){return[t,e]})}}function Wl(t,e,i){var n=w(t,e-tu,i).concat(e);return function(t){return n.map(function(e){return[e,t]})}}function Ul(){var t,e,i,n,r,a,o,s,u,c,l,p,h=10,d=h,f=90,v=360,g=2.5;function m(){return{type:"MultiLineString",coordinates:y()}}function y(){return w(pu(n/f)*f,i,f).map(l).concat(w(pu(s/v)*v,o,v).map(p)).concat(w(pu(e/h)*h,t,h).filter(function(t){return su(t%f)>tu}).map(u)).concat(w(pu(a/d)*d,r,d).filter(function(t){return su(t%v)>tu}).map(c))}return m.lines=function(){return y().map(function(t){return{type:"LineString",coordinates:t}})},m.outline=function(){return{type:"Polygon",coordinates:[l(n).concat(p(o).slice(1),l(i).reverse().slice(1),p(s).reverse().slice(1))]}},m.extent=function(t){return arguments.length?m.extentMajor(t).extentMinor(t):m.extentMinor()},m.extentMajor=function(t){return arguments.length?(n=+t[0][0],i=+t[1][0],s=+t[0][1],o=+t[1][1],n>i&&(t=n,n=i,i=t),s>o&&(t=s,s=o,o=t),m.precision(g)):[[n,s],[i,o]]},m.extentMinor=function(i){return arguments.length?(e=+i[0][0],t=+i[1][0],a=+i[0][1],r=+i[1][1],e>t&&(i=e,e=t,t=i),a>r&&(i=a,a=r,r=i),m.precision(g)):[[e,a],[t,r]]},m.step=function(t){return arguments.length?m.stepMajor(t).stepMinor(t):m.stepMinor()},m.stepMajor=function(t){return arguments.length?(f=+t[0],v=+t[1],m):[f,v]},m.stepMinor=function(t){return arguments.length?(h=+t[0],d=+t[1],m):[h,d]},m.precision=function(h){return arguments.length?(g=+h,u=Vl(a,r,90),c=Wl(e,t,g),l=Vl(s,o,90),p=Wl(n,i,g),m):g},m.extentMajor([[-180,-90+tu],[180,90-tu]]).extentMinor([[-180,-80-tu],[180,80+tu]])}function Fl(){return Ul()()}var jl,Hl,Yl,$l,Xl=function(t,e){var i=t[0]*ou,n=t[1]*ou,r=e[0]*ou,a=e[1]*ou,o=lu(n),s=vu(n),u=lu(a),c=vu(a),l=o*lu(i),p=o*vu(i),h=u*lu(r),d=u*vu(r),f=2*zu(mu(bu(a-n)+o*u*bu(r-i))),v=vu(f),g=f?function(t){var e=vu(t*=f)/v,i=vu(f-t)/v,n=i*l+e*h,r=i*p+e*d,a=i*s+e*c;return[cu(r,n)*au,cu(a,mu(n*n+r*r))*au]}:function(){return[i*au,n*au]};return g.distance=f,g},Kl=function(t){return t},Jl=Ks(),Ql=Ks(),Zl={point:wu,lineStart:wu,lineEnd:wu,polygonStart:function(){Zl.lineStart=tp,Zl.lineEnd=np},polygonEnd:function(){Zl.lineStart=Zl.lineEnd=Zl.point=wu,Jl.add(su(Ql)),Ql.reset()},result:function(){var t=Jl/2;return Jl.reset(),t}};function tp(){Zl.point=ep}function ep(t,e){Zl.point=ip,jl=Yl=t,Hl=$l=e}function ip(t,e){Ql.add($l*t-Yl*e),Yl=t,$l=e}function np(){ip(jl,Hl)}var rp=Zl,ap=1/0,op=ap,sp=-ap,up=sp;var cp,lp,pp,hp,dp={point:function(t,e){t<ap&&(ap=t);t>sp&&(sp=t);e<op&&(op=e);e>up&&(up=e)},lineStart:wu,lineEnd:wu,polygonStart:wu,polygonEnd:wu,result:function(){var t=[[ap,op],[sp,up]];return sp=up=-(op=ap=1/0),t}},fp=0,vp=0,gp=0,mp=0,yp=0,_p=0,zp=0,bp=0,wp=0,Cp={point:Sp,lineStart:xp,lineEnd:kp,polygonStart:function(){Cp.lineStart=Ep,Cp.lineEnd=Ap},polygonEnd:function(){Cp.point=Sp,Cp.lineStart=xp,Cp.lineEnd=kp},result:function(){var t=wp?[zp/wp,bp/wp]:_p?[mp/_p,yp/_p]:gp?[fp/gp,vp/gp]:[NaN,NaN];return fp=vp=gp=mp=yp=_p=zp=bp=wp=0,t}};function Sp(t,e){fp+=t,vp+=e,++gp}function xp(){Cp.point=Mp}function Mp(t,e){Cp.point=Tp,Sp(pp=t,hp=e)}function Tp(t,e){var i=t-pp,n=e-hp,r=mu(i*i+n*n);mp+=r*(pp+t)/2,yp+=r*(hp+e)/2,_p+=r,Sp(pp=t,hp=e)}function kp(){Cp.point=Sp}function Ep(){Cp.point=Rp}function Ap(){Dp(cp,lp)}function Rp(t,e){Cp.point=Dp,Sp(cp=pp=t,lp=hp=e)}function Dp(t,e){var i=t-pp,n=e-hp,r=mu(i*i+n*n);mp+=r*(pp+t)/2,yp+=r*(hp+e)/2,_p+=r,zp+=(r=hp*t-pp*e)*(pp+t),bp+=r*(hp+e),wp+=3*r,Sp(pp=t,hp=e)}var Ip=Cp;function Lp(t){this._context=t}Lp.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,ru)}},result:wu};var Np,Op,Pp,Bp,qp,Gp=Ks(),Vp={point:wu,lineStart:function(){Vp.point=Wp},lineEnd:function(){Np&&Up(Op,Pp),Vp.point=wu},polygonStart:function(){Np=!0},polygonEnd:function(){Np=null},result:function(){var t=+Gp;return Gp.reset(),t}};function Wp(t,e){Vp.point=Up,Op=Bp=t,Pp=qp=e}function Up(t,e){Bp-=t,qp-=e,Gp.add(mu(Bp*Bp+qp*qp)),Bp=t,qp=e}var Fp=Vp;function jp(){this._string=[]}function Hp(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}jp.prototype={_radius:4.5,_circle:Hp(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Hp(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var Yp=function(t,e){var i,n,r=4.5;function a(t){return t&&("function"==typeof r&&n.pointRadius(+r.apply(this,arguments)),Iu(t,i(n))),n.result()}return a.area=function(t){return Iu(t,i(rp)),rp.result()},a.measure=function(t){return Iu(t,i(Fp)),Fp.result()},a.bounds=function(t){return Iu(t,i(dp)),dp.result()},a.centroid=function(t){return Iu(t,i(Ip)),Ip.result()},a.projection=function(e){return arguments.length?(i=null==e?(t=null,Kl):(t=e).stream,a):t},a.context=function(t){return arguments.length?(n=null==t?(e=null,new jp):new Lp(e=t),"function"!=typeof r&&n.pointRadius(r),a):e},a.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(n.pointRadius(+t),+t),a):r},a.projection(t).context(e)},$p=function(t){return{stream:Xp(t)}};function Xp(t){return function(e){var i=new Kp;for(var n in t)i[n]=t[n];return i.stream=e,i}}function Kp(){}function Jp(t,e,i){var n=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=n&&t.clipExtent(null),Iu(i,t.stream(dp)),e(dp.result()),null!=n&&t.clipExtent(n),t}function Qp(t,e,i){return Jp(t,function(i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=Math.min(n/(i[1][0]-i[0][0]),r/(i[1][1]-i[0][1])),o=+e[0][0]+(n-a*(i[1][0]+i[0][0]))/2,s=+e[0][1]+(r-a*(i[1][1]+i[0][1]))/2;t.scale(150*a).translate([o,s])},i)}function Zp(t,e,i){return Qp(t,[[0,0],e],i)}function th(t,e,i){return Jp(t,function(i){var n=+e,r=n/(i[1][0]-i[0][0]),a=(n-r*(i[1][0]+i[0][0]))/2,o=-r*i[0][1];t.scale(150*r).translate([a,o])},i)}function eh(t,e,i){return Jp(t,function(i){var n=+e,r=n/(i[1][1]-i[0][1]),a=-r*i[0][0],o=(n-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([a,o])},i)}Kp.prototype={constructor:Kp,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ih=16,nh=lu(30*ou),rh=function(t,e){return+e?function(t,e){function i(n,r,a,o,s,u,c,l,p,h,d,f,v,g){var m=c-n,y=l-r,_=m*m+y*y;if(_>4*e&&v--){var z=o+h,b=s+d,w=u+f,C=mu(z*z+b*b+w*w),S=zu(w/=C),x=su(su(w)-1)<tu||su(a-p)<tu?(a+p)/2:cu(b,z),M=t(x,S),T=M[0],k=M[1],E=T-n,A=k-r,R=y*E-m*A;(R*R/_>e||su((m*E+y*A)/_-.5)>.3||o*h+s*d+u*f<nh)&&(i(n,r,a,o,s,u,T,k,x,z/=C,b/=C,w,v,g),g.point(T,k),i(T,k,x,z,b,w,c,l,p,h,d,f,v,g))}}return function(e){var n,r,a,o,s,u,c,l,p,h,d,f,v={point:g,lineStart:m,lineEnd:_,polygonStart:function(){e.polygonStart(),v.lineStart=z},polygonEnd:function(){e.polygonEnd(),v.lineStart=m}};function g(i,n){i=t(i,n),e.point(i[0],i[1])}function m(){l=NaN,v.point=y,e.lineStart()}function y(n,r){var a=Uu([n,r]),o=t(n,r);i(l,p,c,h,d,f,l=o[0],p=o[1],c=n,h=a[0],d=a[1],f=a[2],ih,e),e.point(l,p)}function _(){v.point=g,e.lineEnd()}function z(){m(),v.point=b,v.lineEnd=w}function b(t,e){y(n=t,e),r=l,a=p,o=h,s=d,u=f,v.point=y}function w(){i(l,p,c,h,d,f,r,a,n,o,s,u,ih,e),v.lineEnd=_,_()}return v}}(t,e):function(t){return Xp({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}(t)};var ah=Xp({point:function(t,e){this.stream.point(t*ou,e*ou)}});function oh(t,e,i,n){var r=lu(n),a=vu(n),o=r*t,s=a*t,u=r/t,c=a/t,l=(a*i-r*e)/t,p=(a*e+r*i)/t;function h(t,n){return[o*t-s*n+e,i-s*t-o*n]}return h.invert=function(t,e){return[u*t-c*e+l,p-c*t-u*e]},h}function sh(t){return uh(function(){return t})()}function uh(t){var e,i,n,r,a,o,s,u,c,l,p=150,h=480,d=250,f=0,v=0,g=0,m=0,y=0,_=0,z=null,b=dl,w=null,C=Kl,S=.5;function x(t){return u(t[0]*ou,t[1]*ou)}function M(t){return(t=u.invert(t[0],t[1]))&&[t[0]*au,t[1]*au]}function T(){var t=oh(p,0,0,_).apply(null,e(f,v)),n=(_?oh:function(t,e,i){function n(n,r){return[e+t*n,i-t*r]}return n.invert=function(n,r){return[(n-e)/t,(i-r)/t]},n})(p,h-t[0],d-t[1],_);return i=Xc(g,m,y),s=Yc(e,n),u=Yc(i,s),o=rh(s,S),k()}function k(){return c=l=null,x}return x.stream=function(t){return c&&l===t?c:c=ah(function(t){return Xp({point:function(e,i){var n=t(e,i);return this.stream.point(n[0],n[1])}})}(i)(b(o(C(l=t)))))},x.preclip=function(t){return arguments.length?(b=t,z=void 0,k()):b},x.postclip=function(t){return arguments.length?(C=t,w=n=r=a=null,k()):C},x.clipAngle=function(t){return arguments.length?(b=+t?fl(z=t*ou):(z=null,dl),k()):z*au},x.clipExtent=function(t){return arguments.length?(C=null==t?(w=n=r=a=null,Kl):yl(w=+t[0][0],n=+t[0][1],r=+t[1][0],a=+t[1][1]),k()):null==w?null:[[w,n],[r,a]]},x.scale=function(t){return arguments.length?(p=+t,T()):p},x.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],T()):[h,d]},x.center=function(t){return arguments.length?(f=t[0]%360*ou,v=t[1]%360*ou,T()):[f*au,v*au]},x.rotate=function(t){return arguments.length?(g=t[0]%360*ou,m=t[1]%360*ou,y=t.length>2?t[2]%360*ou:0,T()):[g*au,m*au,y*au]},x.angle=function(t){return arguments.length?(_=t%360*ou,T()):_*au},x.precision=function(t){return arguments.length?(o=rh(s,S=t*t),k()):mu(S)},x.fitExtent=function(t,e){return Qp(x,t,e)},x.fitSize=function(t,e){return Zp(x,t,e)},x.fitWidth=function(t,e){return th(x,t,e)},x.fitHeight=function(t,e){return eh(x,t,e)},function(){return e=t.apply(this,arguments),x.invert=e.invert&&M,T()}}function ch(t){var e=0,i=eu/3,n=uh(t),r=n(e,i);return r.parallels=function(t){return arguments.length?n(e=t[0]*ou,i=t[1]*ou):[e*au,i*au]},r}function lh(t,e){var i=vu(t),n=(i+vu(e))/2;if(su(n)<tu)return function(t){var e=lu(t);function i(t,i){return[t*e,vu(i)/e]}return i.invert=function(t,i){return[t/e,zu(i*e)]},i}(t);var r=1+i*(2*n-i),a=mu(r)/n;function o(t,e){var i=mu(r-2*n*vu(e))/n;return[i*vu(t*=n),a-i*lu(t)]}return o.invert=function(t,e){var i=a-e;return[cu(t,su(i))/n*gu(i),zu((r-(t*t+i*i)*n*n)/(2*n))]},o}var ph=function(){return ch(lh).scale(155.424).center([0,33.6442])},hh=function(){return ph().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};var dh=function(){var t,e,i,n,r,a,o=hh(),s=ph().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=ph().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(t,e){a=[t,e]}};function l(t){var e=t[0],o=t[1];return a=null,i.point(e,o),a||(n.point(e,o),a)||(r.point(e,o),a)}function p(){return t=e=null,l}return l.invert=function(t){var e=o.scale(),i=o.translate(),n=(t[0]-i[0])/e,r=(t[1]-i[1])/e;return(r>=.12&&r<.234&&n>=-.425&&n<-.214?s:r>=.166&&r<.234&&n>=-.214&&n<-.115?u:o).invert(t)},l.stream=function(i){return t&&e===i?t:(n=[o.stream(e=i),s.stream(i),u.stream(i)],r=n.length,t={point:function(t,e){for(var i=-1;++i<r;)n[i].point(t,e)},sphere:function(){for(var t=-1;++t<r;)n[t].sphere()},lineStart:function(){for(var t=-1;++t<r;)n[t].lineStart()},lineEnd:function(){for(var t=-1;++t<r;)n[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<r;)n[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<r;)n[t].polygonEnd()}});var n,r},l.precision=function(t){return arguments.length?(o.precision(t),s.precision(t),u.precision(t),p()):o.precision()},l.scale=function(t){return arguments.length?(o.scale(t),s.scale(.35*t),u.scale(t),l.translate(o.translate())):o.scale()},l.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),a=+t[0],l=+t[1];return i=o.translate(t).clipExtent([[a-.455*e,l-.238*e],[a+.455*e,l+.238*e]]).stream(c),n=s.translate([a-.307*e,l+.201*e]).clipExtent([[a-.425*e+tu,l+.12*e+tu],[a-.214*e-tu,l+.234*e-tu]]).stream(c),r=u.translate([a-.205*e,l+.212*e]).clipExtent([[a-.214*e+tu,l+.166*e+tu],[a-.115*e-tu,l+.234*e-tu]]).stream(c),p()},l.fitExtent=function(t,e){return Qp(l,t,e)},l.fitSize=function(t,e){return Zp(l,t,e)},l.fitWidth=function(t,e){return th(l,t,e)},l.fitHeight=function(t,e){return eh(l,t,e)},l.scale(1070)};function fh(t){return function(e,i){var n=lu(e),r=lu(i),a=t(n*r);return[a*r*vu(e),a*vu(i)]}}function vh(t){return function(e,i){var n=mu(e*e+i*i),r=t(n),a=vu(r),o=lu(r);return[cu(e*a,n*o),zu(n&&i*a/n)]}}var gh=fh(function(t){return mu(2/(1+t))});gh.invert=vh(function(t){return 2*zu(t/2)});var mh=function(){return sh(gh).scale(124.75).clipAngle(179.999)},yh=fh(function(t){return(t=_u(t))&&t/vu(t)});yh.invert=vh(function(t){return t});var _h=function(){return sh(yh).scale(79.4188).clipAngle(179.999)};function zh(t,e){return[t,du(yu((iu+e)/2))]}zh.invert=function(t,e){return[t,2*uu(hu(e))-iu]};var bh=function(){return wh(zh).scale(961/ru)};function wh(t){var e,i,n,r=sh(t),a=r.center,o=r.scale,s=r.translate,u=r.clipExtent,c=null;function l(){var a=eu*o(),s=r(Zc(r.rotate()).invert([0,0]));return u(null==c?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:t===zh?[[Math.max(s[0]-a,c),e],[Math.min(s[0]+a,i),n]]:[[c,Math.max(s[1]-a,e)],[i,Math.min(s[1]+a,n)]])}return r.scale=function(t){return arguments.length?(o(t),l()):o()},r.translate=function(t){return arguments.length?(s(t),l()):s()},r.center=function(t){return arguments.length?(a(t),l()):a()},r.clipExtent=function(t){return arguments.length?(null==t?c=e=i=n=null:(c=+t[0][0],e=+t[0][1],i=+t[1][0],n=+t[1][1]),l()):null==c?null:[[c,e],[i,n]]},l()}function Ch(t){return yu((iu+t)/2)}function Sh(t,e){var i=lu(t),n=t===e?vu(t):du(i/lu(e))/du(Ch(e)/Ch(t)),r=i*fu(Ch(t),n)/n;if(!n)return zh;function a(t,e){r>0?e<-iu+tu&&(e=-iu+tu):e>iu-tu&&(e=iu-tu);var i=r/fu(Ch(e),n);return[i*vu(n*t),r-i*lu(n*t)]}return a.invert=function(t,e){var i=r-e,a=gu(n)*mu(t*t+i*i);return[cu(t,su(i))/n*gu(i),2*uu(fu(r/a,1/n))-iu]},a}var xh=function(){return ch(Sh).scale(109.5).parallels([30,30])};function Mh(t,e){return[t,e]}Mh.invert=Mh;var Th=function(){return sh(Mh).scale(152.63)};function kh(t,e){var i=lu(t),n=t===e?vu(t):(i-lu(e))/(e-t),r=i/n+t;if(su(n)<tu)return Mh;function a(t,e){var i=r-e,a=n*t;return[i*vu(a),r-i*lu(a)]}return a.invert=function(t,e){var i=r-e;return[cu(t,su(i))/n*gu(i),r-gu(n)*mu(t*t+i*i)]},a}var Eh=function(){return ch(kh).scale(131.154).center([0,13.9389])},Ah=1.340264,Rh=-.081106,Dh=893e-6,Ih=.003796,Lh=mu(3)/2;function Nh(t,e){var i=zu(Lh*vu(e)),n=i*i,r=n*n*n;return[t*lu(i)/(Lh*(Ah+3*Rh*n+r*(7*Dh+9*Ih*n))),i*(Ah+Rh*n+r*(Dh+Ih*n))]}Nh.invert=function(t,e){for(var i,n=e,r=n*n,a=r*r*r,o=0;o<12&&(a=(r=(n-=i=(n*(Ah+Rh*r+a*(Dh+Ih*r))-e)/(Ah+3*Rh*r+a*(7*Dh+9*Ih*r)))*n)*r*r,!(su(i)<1e-12));++o);return[Lh*t*(Ah+3*Rh*r+a*(7*Dh+9*Ih*r))/lu(n),zu(vu(n)/Lh)]};var Oh=function(){return sh(Nh).scale(177.158)};function Ph(t,e){var i=lu(e),n=lu(t)*i;return[i*vu(t)/n,vu(e)/n]}Ph.invert=vh(uu);var Bh=function(){return sh(Ph).scale(144.049).clipAngle(60)};function qh(t,e,i,n){return 1===t&&1===e&&0===i&&0===n?Kl:Xp({point:function(r,a){this.stream.point(r*t+i,a*e+n)}})}var Gh=function(){var t,e,i,n,r,a,o=1,s=0,u=0,c=1,l=1,p=Kl,h=null,d=Kl;function f(){return n=r=null,a}return a={stream:function(t){return n&&r===t?n:n=p(d(r=t))},postclip:function(n){return arguments.length?(d=n,h=t=e=i=null,f()):d},clipExtent:function(n){return arguments.length?(d=null==n?(h=t=e=i=null,Kl):yl(h=+n[0][0],t=+n[0][1],e=+n[1][0],i=+n[1][1]),f()):null==h?null:[[h,t],[e,i]]},scale:function(t){return arguments.length?(p=qh((o=+t)*c,o*l,s,u),f()):o},translate:function(t){return arguments.length?(p=qh(o*c,o*l,s=+t[0],u=+t[1]),f()):[s,u]},reflectX:function(t){return arguments.length?(p=qh(o*(c=t?-1:1),o*l,s,u),f()):c<0},reflectY:function(t){return arguments.length?(p=qh(o*c,o*(l=t?-1:1),s,u),f()):l<0},fitExtent:function(t,e){return Qp(a,t,e)},fitSize:function(t,e){return Zp(a,t,e)},fitWidth:function(t,e){return th(a,t,e)},fitHeight:function(t,e){return eh(a,t,e)}}};function Vh(t,e){var i=e*e,n=i*i;return[t*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791)),e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))]}Vh.invert=function(t,e){var i,n=e,r=25;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-e)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(su(i)>tu&&--r>0);return[t/(.8707+(a=n*n)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),n]};var Wh=function(){return sh(Vh).scale(175.295)};function Uh(t,e){return[lu(e)*vu(t),vu(e)]}Uh.invert=vh(zu);var Fh=function(){return sh(Uh).scale(249.5).clipAngle(90+tu)};function jh(t,e){var i=lu(e),n=1+lu(t)*i;return[i*vu(t)/n,vu(e)/n]}jh.invert=vh(function(t){return 2*uu(t)});var Hh=function(){return sh(jh).scale(250).clipAngle(142)};function Yh(t,e){return[du(yu((iu+e)/2)),-t]}Yh.invert=function(t,e){return[-e,2*uu(hu(t))-iu]};var $h=function(){var t=wh(Yh),e=t.center,i=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?i([t[0],t[1],t.length>2?t[2]+90:90]):[(t=i())[0],t[1],t[2]-90]},i([0,0,90]).scale(159.155)};function Xh(t,e){return t.parent===e.parent?1:2}function Kh(t,e){return t+e.x}function Jh(t,e){return Math.max(t,e.y)}var Qh=function(){var t=Xh,e=1,i=1,n=!1;function r(r){var a,o=0;r.eachAfter(function(e){var i=e.children;i?(e.x=function(t){return t.reduce(Kh,0)/t.length}(i),e.y=function(t){return 1+t.reduce(Jh,0)}(i)):(e.x=a?o+=t(e,a):0,e.y=0,a=e)});var s=function(t){for(var e;e=t.children;)t=e[0];return t}(r),u=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(r),c=s.x-t(s,u)/2,l=u.x+t(u,s)/2;return r.eachAfter(n?function(t){t.x=(t.x-r.x)*e,t.y=(r.y-t.y)*i}:function(t){t.x=(t.x-c)/(l-c)*e,t.y=(1-(r.y?t.y/r.y:1))*i})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(n=!1,e=+t[0],i=+t[1],r):n?null:[e,i]},r.nodeSize=function(t){return arguments.length?(n=!0,e=+t[0],i=+t[1],r):n?[e,i]:null},r};function Zh(t){var e=0,i=t.children,n=i&&i.length;if(n)for(;--n>=0;)e+=i[n].value;else e=1;t.value=e}function td(t,e){var i,n,r,a,o,s=new rd(t),u=+t.value&&(s.value=t.value),c=[s];for(null==e&&(e=ed);i=c.pop();)if(u&&(i.value=+i.data.value),(r=e(i.data))&&(o=r.length))for(i.children=new Array(o),a=o-1;a>=0;--a)c.push(n=i.children[a]=new rd(r[a])),n.parent=i,n.depth=i.depth+1;return s.eachBefore(nd)}function ed(t){return t.children}function id(t){t.data=t.data.data}function nd(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function rd(t){this.data=t,this.depth=this.height=0,this.parent=null}rd.prototype=td.prototype={constructor:rd,count:function(){return this.eachAfter(Zh)},each:function(t){var e,i,n,r,a=this,o=[a];do{for(e=o.reverse(),o=[];a=e.pop();)if(t(a),i=a.children)for(n=0,r=i.length;n<r;++n)o.push(i[n])}while(o.length);return this},eachAfter:function(t){for(var e,i,n,r=this,a=[r],o=[];r=a.pop();)if(o.push(r),e=r.children)for(i=0,n=e.length;i<n;++i)a.push(e[i]);for(;r=o.pop();)t(r);return this},eachBefore:function(t){for(var e,i,n=this,r=[n];n=r.pop();)if(t(n),e=n.children)for(i=e.length-1;i>=0;--i)r.push(e[i]);return this},sum:function(t){return this.eachAfter(function(e){for(var i=+t(e.data)||0,n=e.children,r=n&&n.length;--r>=0;)i+=n[r].value;e.value=i})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,i=function(t,e){if(t===e)return t;var i=t.ancestors(),n=e.ancestors(),r=null;for(t=i.pop(),e=n.pop();t===e;)r=t,t=i.pop(),e=n.pop();return r}(e,t),n=[e];e!==i;)e=e.parent,n.push(e);for(var r=n.length;t!==i;)n.splice(r,0,t),t=t.parent;return n},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each(function(e){t.push(e)}),t},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(i){i!==t&&e.push({source:i.parent,target:i})}),e},copy:function(){return td(this).eachBefore(id)}};var ad=Array.prototype.slice;var od=function(t){for(var e,i,n=0,r=(t=function(t){for(var e,i,n=t.length;n;)i=Math.random()*n--|0,e=t[n],t[n]=t[i],t[i]=e;return t}(ad.call(t))).length,a=[];n<r;)e=t[n],i&&cd(i,e)?++n:(i=pd(a=sd(a,e)),n=0);return i};function sd(t,e){var i,n;if(ld(e,t))return[e];for(i=0;i<t.length;++i)if(ud(e,t[i])&&ld(hd(t[i],e),t))return[t[i],e];for(i=0;i<t.length-1;++i)for(n=i+1;n<t.length;++n)if(ud(hd(t[i],t[n]),e)&&ud(hd(t[i],e),t[n])&&ud(hd(t[n],e),t[i])&&ld(dd(t[i],t[n],e),t))return[t[i],t[n],e];throw new Error}function ud(t,e){var i=t.r-e.r,n=e.x-t.x,r=e.y-t.y;return i<0||i*i<n*n+r*r}function cd(t,e){var i=t.r-e.r+1e-6,n=e.x-t.x,r=e.y-t.y;return i>0&&i*i>n*n+r*r}function ld(t,e){for(var i=0;i<e.length;++i)if(!cd(t,e[i]))return!1;return!0}function pd(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return hd(t[0],t[1]);case 3:return dd(t[0],t[1],t[2])}var e}function hd(t,e){var i=t.x,n=t.y,r=t.r,a=e.x,o=e.y,s=e.r,u=a-i,c=o-n,l=s-r,p=Math.sqrt(u*u+c*c);return{x:(i+a+u/p*l)/2,y:(n+o+c/p*l)/2,r:(p+r+s)/2}}function dd(t,e,i){var n=t.x,r=t.y,a=t.r,o=e.x,s=e.y,u=e.r,c=i.x,l=i.y,p=i.r,h=n-o,d=n-c,f=r-s,v=r-l,g=u-a,m=p-a,y=n*n+r*r-a*a,_=y-o*o-s*s+u*u,z=y-c*c-l*l+p*p,b=d*f-h*v,w=(f*z-v*_)/(2*b)-n,C=(v*g-f*m)/b,S=(d*_-h*z)/(2*b)-r,x=(h*m-d*g)/b,M=C*C+x*x-1,T=2*(a+w*C+S*x),k=w*w+S*S-a*a,E=-(M?(T+Math.sqrt(T*T-4*M*k))/(2*M):k/T);return{x:n+w+C*E,y:r+S+x*E,r:E}}function fd(t,e,i){var n,r,a,o,s=t.x-e.x,u=t.y-e.y,c=s*s+u*u;c?(r=e.r+i.r,r*=r,o=t.r+i.r,r>(o*=o)?(n=(c+o-r)/(2*c),a=Math.sqrt(Math.max(0,o/c-n*n)),i.x=t.x-n*s-a*u,i.y=t.y-n*u+a*s):(n=(c+r-o)/(2*c),a=Math.sqrt(Math.max(0,r/c-n*n)),i.x=e.x+n*s-a*u,i.y=e.y+n*u+a*s)):(i.x=e.x+i.r,i.y=e.y)}function vd(t,e){var i=t.r+e.r-1e-6,n=e.x-t.x,r=e.y-t.y;return i>0&&i*i>n*n+r*r}function gd(t){var e=t._,i=t.next._,n=e.r+i.r,r=(e.x*i.r+i.x*e.r)/n,a=(e.y*i.r+i.y*e.r)/n;return r*r+a*a}function md(t){this._=t,this.next=null,this.previous=null}function yd(t){if(!(r=t.length))return 0;var e,i,n,r,a,o,s,u,c,l,p;if((e=t[0]).x=0,e.y=0,!(r>1))return e.r;if(i=t[1],e.x=-i.r,i.x=e.r,i.y=0,!(r>2))return e.r+i.r;fd(i,e,n=t[2]),e=new md(e),i=new md(i),n=new md(n),e.next=n.previous=i,i.next=e.previous=n,n.next=i.previous=e;t:for(s=3;s<r;++s){fd(e._,i._,n=t[s]),n=new md(n),u=i.next,c=e.previous,l=i._.r,p=e._.r;do{if(l<=p){if(vd(u._,n._)){i=u,e.next=i,i.previous=e,--s;continue t}l+=u._.r,u=u.next}else{if(vd(c._,n._)){(e=c).next=i,i.previous=e,--s;continue t}p+=c._.r,c=c.previous}}while(u!==c.next);for(n.previous=e,n.next=i,e.next=i.previous=i=n,a=gd(e);(n=n.next)!==i;)(o=gd(n))<a&&(e=n,a=o);i=e.next}for(e=[i._],n=i;(n=n.next)!==i;)e.push(n._);for(n=od(e),s=0;s<r;++s)(e=t[s]).x-=n.x,e.y-=n.y;return n.r}var _d=function(t){return yd(t),t};function zd(t){if("function"!=typeof t)throw new Error;return t}function bd(){return 0}var wd=function(t){return function(){return t}};function Cd(t){return Math.sqrt(t.value)}var Sd=function(){var t=null,e=1,i=1,n=bd;function r(r){return r.x=e/2,r.y=i/2,t?r.eachBefore(xd(t)).eachAfter(Md(n,.5)).eachBefore(Td(1)):r.eachBefore(xd(Cd)).eachAfter(Md(bd,1)).eachAfter(Md(n,r.r/Math.min(e,i))).eachBefore(Td(Math.min(e,i)/(2*r.r))),r}return r.radius=function(e){return arguments.length?(t=null==(i=e)?null:zd(i),r):t;var i},r.size=function(t){return arguments.length?(e=+t[0],i=+t[1],r):[e,i]},r.padding=function(t){return arguments.length?(n="function"==typeof t?t:wd(+t),r):n},r};function xd(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function Md(t,e){return function(i){if(n=i.children){var n,r,a,o=n.length,s=t(i)*e||0;if(s)for(r=0;r<o;++r)n[r].r+=s;if(a=yd(n),s)for(r=0;r<o;++r)n[r].r-=s;i.r=a+s}}}function Td(t){return function(e){var i=e.parent;e.r*=t,i&&(e.x=i.x+t*e.x,e.y=i.y+t*e.y)}}var kd=function(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)},Ed=function(t,e,i,n,r){for(var a,o=t.children,s=-1,u=o.length,c=t.value&&(n-e)/t.value;++s<u;)(a=o[s]).y0=i,a.y1=r,a.x0=e,a.x1=e+=a.value*c},Ad=function(){var t=1,e=1,i=0,n=!1;function r(r){var a=r.height+1;return r.x0=r.y0=i,r.x1=t,r.y1=e/a,r.eachBefore(function(t,e){return function(n){n.children&&Ed(n,n.x0,t*(n.depth+1)/e,n.x1,t*(n.depth+2)/e);var r=n.x0,a=n.y0,o=n.x1-i,s=n.y1-i;o<r&&(r=o=(r+o)/2),s<a&&(a=s=(a+s)/2),n.x0=r,n.y0=a,n.x1=o,n.y1=s}}(e,a)),n&&r.eachBefore(kd),r}return r.round=function(t){return arguments.length?(n=!!t,r):n},r.size=function(i){return arguments.length?(t=+i[0],e=+i[1],r):[t,e]},r.padding=function(t){return arguments.length?(i=+t,r):i},r},Rd="$",Dd={depth:-1},Id={};function Ld(t){return t.id}function Nd(t){return t.parentId}var Od=function(){var t=Ld,e=Nd;function i(i){var n,r,a,o,s,u,c,l=i.length,p=new Array(l),h={};for(r=0;r<l;++r)n=i[r],s=p[r]=new rd(n),null!=(u=t(n,r,i))&&(u+="")&&(h[c=Rd+(s.id=u)]=c in h?Id:s);for(r=0;r<l;++r)if(s=p[r],null!=(u=e(i[r],r,i))&&(u+="")){if(!(o=h[Rd+u]))throw new Error("missing: "+u);if(o===Id)throw new Error("ambiguous: "+u);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=Dd,a.eachBefore(function(t){t.depth=t.parent.depth+1,--l}).eachBefore(nd),a.parent=null,l>0)throw new Error("cycle");return a}return i.id=function(e){return arguments.length?(t=zd(e),i):t},i.parentId=function(t){return arguments.length?(e=zd(t),i):e},i};function Pd(t,e){return t.parent===e.parent?1:2}function Bd(t){var e=t.children;return e?e[0]:t.t}function qd(t){var e=t.children;return e?e[e.length-1]:t.t}function Gd(t,e,i){var n=i/(e.i-t.i);e.c-=n,e.s+=i,t.c+=n,e.z+=i,e.m+=i}function Vd(t,e,i){return t.a.parent===e.parent?t.a:i}function Wd(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}Wd.prototype=Object.create(rd.prototype);var Ud=function(){var t=Pd,e=1,i=1,n=null;function r(r){var u=function(t){for(var e,i,n,r,a,o=new Wd(t,0),s=[o];e=s.pop();)if(n=e._.children)for(e.children=new Array(a=n.length),r=a-1;r>=0;--r)s.push(i=e.children[r]=new Wd(n[r],r)),i.parent=e;return(o.parent=new Wd(null,0)).children=[o],o}(r);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(o),n)r.eachBefore(s);else{var c=r,l=r,p=r;r.eachBefore(function(t){t.x<c.x&&(c=t),t.x>l.x&&(l=t),t.depth>p.depth&&(p=t)});var h=c===l?1:t(c,l)/2,d=h-c.x,f=e/(l.x+h+d),v=i/(p.depth||1);r.eachBefore(function(t){t.x=(t.x+d)*f,t.y=t.depth*v})}return r}function a(e){var i=e.children,n=e.parent.children,r=e.i?n[e.i-1]:null;if(i){!function(t){for(var e,i=0,n=0,r=t.children,a=r.length;--a>=0;)(e=r[a]).z+=i,e.m+=i,i+=e.s+(n+=e.c)}(e);var a=(i[0].z+i[i.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-a):e.z=a}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,i,n){if(i){for(var r,a=e,o=e,s=i,u=a.parent.children[0],c=a.m,l=o.m,p=s.m,h=u.m;s=qd(s),a=Bd(a),s&&a;)u=Bd(u),(o=qd(o)).a=e,(r=s.z+p-a.z-c+t(s._,a._))>0&&(Gd(Vd(s,e,n),e,r),c+=r,l+=r),p+=s.m,c+=a.m,h+=u.m,l+=o.m;s&&!qd(o)&&(o.t=s,o.m+=p-l),a&&!Bd(u)&&(u.t=a,u.m+=c-h,n=e)}return n}(e,r,e.parent.A||n[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*i}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(n=!1,e=+t[0],i=+t[1],r):n?null:[e,i]},r.nodeSize=function(t){return arguments.length?(n=!0,e=+t[0],i=+t[1],r):n?[e,i]:null},r},Fd=function(t,e,i,n,r){for(var a,o=t.children,s=-1,u=o.length,c=t.value&&(r-i)/t.value;++s<u;)(a=o[s]).x0=e,a.x1=n,a.y0=i,a.y1=i+=a.value*c},jd=(1+Math.sqrt(5))/2;function Hd(t,e,i,n,r,a){for(var o,s,u,c,l,p,h,d,f,v,g,m=[],y=e.children,_=0,z=0,b=y.length,w=e.value;_<b;){u=r-i,c=a-n;do{l=y[z++].value}while(!l&&z<b);for(p=h=l,g=l*l*(v=Math.max(c/u,u/c)/(w*t)),f=Math.max(h/g,g/p);z<b;++z){if(l+=s=y[z].value,s<p&&(p=s),s>h&&(h=s),g=l*l*v,(d=Math.max(h/g,g/p))>f){l-=s;break}f=d}m.push(o={value:l,dice:u<c,children:y.slice(_,z)}),o.dice?Ed(o,i,n,r,w?n+=c*l/w:a):Fd(o,i,n,w?i+=u*l/w:r,a),w-=l,_=z}return m}var Yd=function t(e){function i(t,i,n,r,a){Hd(e,t,i,n,r,a)}return i.ratio=function(e){return t((e=+e)>1?e:1)},i}(jd),$d=function(){var t=Yd,e=!1,i=1,n=1,r=[0],a=bd,o=bd,s=bd,u=bd,c=bd;function l(t){return t.x0=t.y0=0,t.x1=i,t.y1=n,t.eachBefore(p),r=[0],e&&t.eachBefore(kd),t}function p(e){var i=r[e.depth],n=e.x0+i,l=e.y0+i,p=e.x1-i,h=e.y1-i;p<n&&(n=p=(n+p)/2),h<l&&(l=h=(l+h)/2),e.x0=n,e.y0=l,e.x1=p,e.y1=h,e.children&&(i=r[e.depth+1]=a(e)/2,n+=c(e)-i,l+=o(e)-i,(p-=s(e)-i)<n&&(n=p=(n+p)/2),(h-=u(e)-i)<l&&(l=h=(l+h)/2),t(e,n,l,p,h))}return l.round=function(t){return arguments.length?(e=!!t,l):e},l.size=function(t){return arguments.length?(i=+t[0],n=+t[1],l):[i,n]},l.tile=function(e){return arguments.length?(t=zd(e),l):t},l.padding=function(t){return arguments.length?l.paddingInner(t).paddingOuter(t):l.paddingInner()},l.paddingInner=function(t){return arguments.length?(a="function"==typeof t?t:wd(+t),l):a},l.paddingOuter=function(t){return arguments.length?l.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):l.paddingTop()},l.paddingTop=function(t){return arguments.length?(o="function"==typeof t?t:wd(+t),l):o},l.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:wd(+t),l):s},l.paddingBottom=function(t){return arguments.length?(u="function"==typeof t?t:wd(+t),l):u},l.paddingLeft=function(t){return arguments.length?(c="function"==typeof t?t:wd(+t),l):c},l},Xd=function(t,e,i,n,r){var a,o,s=t.children,u=s.length,c=new Array(u+1);for(c[0]=o=a=0;a<u;++a)c[a+1]=o+=s[a].value;!function t(e,i,n,r,a,o,u){if(e>=i-1){var l=s[e];return l.x0=r,l.y0=a,l.x1=o,void(l.y1=u)}var p=c[e],h=n/2+p,d=e+1,f=i-1;for(;d<f;){var v=d+f>>>1;c[v]<h?d=v+1:f=v}h-c[d-1]<c[d]-h&&e+1<d&&--d;var g=c[d]-p,m=n-g;if(o-r>u-a){var y=(r*m+o*g)/n;t(e,d,g,r,a,y,u),t(d,i,m,y,a,o,u)}else{var _=(a*m+u*g)/n;t(e,d,g,r,a,o,_),t(d,i,m,r,_,o,u)}}(0,u,t.value,e,i,n,r)},Kd=function(t,e,i,n,r){(1&t.depth?Fd:Ed)(t,e,i,n,r)},Jd=function t(e){function i(t,i,n,r,a){if((o=t._squarify)&&o.ratio===e)for(var o,s,u,c,l,p=-1,h=o.length,d=t.value;++p<h;){for(u=(s=o[p]).children,c=s.value=0,l=u.length;c<l;++c)s.value+=u[c].value;s.dice?Ed(s,i,n,r,n+=(a-n)*s.value/d):Fd(s,i,n,i+=(r-i)*s.value/d,a),d-=s.value}else t._squarify=o=Hd(e,t,i,n,r,a),o.ratio=e}return i.ratio=function(e){return t((e=+e)>1?e:1)},i}(jd),Qd=function(t){for(var e,i=-1,n=t.length,r=t[n-1],a=0;++i<n;)e=r,r=t[i],a+=e[1]*r[0]-e[0]*r[1];return a/2},Zd=function(t){for(var e,i,n=-1,r=t.length,a=0,o=0,s=t[r-1],u=0;++n<r;)e=s,s=t[n],u+=i=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*i,o+=(e[1]+s[1])*i;return[a/(u*=3),o/u]},tf=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0])};function ef(t,e){return t[0]-e[0]||t[1]-e[1]}function nf(t){for(var e=t.length,i=[0,1],n=2,r=2;r<e;++r){for(;n>1&&tf(t[i[n-2]],t[i[n-1]],t[r])<=0;)--n;i[n++]=r}return i.slice(0,n)}var rf=function(t){if((i=t.length)<3)return null;var e,i,n=new Array(i),r=new Array(i);for(e=0;e<i;++e)n[e]=[+t[e][0],+t[e][1],e];for(n.sort(ef),e=0;e<i;++e)r[e]=[n[e][0],-n[e][1]];var a=nf(n),o=nf(r),s=o[0]===a[0],u=o[o.length-1]===a[a.length-1],c=[];for(e=a.length-1;e>=0;--e)c.push(t[n[a[e]][2]]);for(e=+s;e<o.length-u;++e)c.push(t[n[o[e]][2]]);return c},af=function(t,e){for(var i,n,r=t.length,a=t[r-1],o=e[0],s=e[1],u=a[0],c=a[1],l=!1,p=0;p<r;++p)i=(a=t[p])[0],(n=a[1])>s!=c>s&&o<(u-i)*(s-n)/(c-n)+i&&(l=!l),u=i,c=n;return l},of=function(t){for(var e,i,n=-1,r=t.length,a=t[r-1],o=a[0],s=a[1],u=0;++n<r;)e=o,i=s,e-=o=(a=t[n])[0],i-=s=a[1],u+=Math.sqrt(e*e+i*i);return u},sf=function(){return Math.random()},uf=function t(e){function i(t,i){return t=null==t?0:+t,i=null==i?1:+i,1===arguments.length?(i=t,t=0):i-=t,function(){return e()*i+t}}return i.source=t,i}(sf),cf=function t(e){function i(t,i){var n,r;return t=null==t?0:+t,i=null==i?1:+i,function(){var a;if(null!=n)a=n,n=null;else do{n=2*e()-1,a=2*e()-1,r=n*n+a*a}while(!r||r>1);return t+i*a*Math.sqrt(-2*Math.log(r)/r)}}return i.source=t,i}(sf),lf=function t(e){function i(){var t=cf.source(e).apply(this,arguments);return function(){return Math.exp(t())}}return i.source=t,i}(sf),pf=function t(e){function i(t){return function(){for(var i=0,n=0;n<t;++n)i+=e();return i}}return i.source=t,i}(sf),hf=function t(e){function i(t){var i=pf.source(e)(t);return function(){return i()/t}}return i.source=t,i}(sf),df=function t(e){function i(t){return function(){return-Math.log(1-e())/t}}return i.source=t,i}(sf);function ff(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function vf(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var gf=Array.prototype,mf=gf.map,yf=gf.slice,_f={name:"implicit"};function zf(){var t=Xa(),e=[],i=[],n=_f;function r(r){var a=r+"",o=t.get(a);if(!o){if(n!==_f)return n;t.set(a,o=e.push(r))}return i[(o-1)%i.length]}return r.domain=function(i){if(!arguments.length)return e.slice();e=[],t=Xa();for(var n,a,o=-1,s=i.length;++o<s;)t.has(a=(n=i[o])+"")||t.set(a,e.push(n));return r},r.range=function(t){return arguments.length?(i=yf.call(t),r):i.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return zf(e,i).unknown(n)},ff.apply(r,arguments),r}function bf(){var t,e,i=zf().unknown(void 0),n=i.domain,r=i.range,a=[0,1],o=!1,s=0,u=0,c=.5;function l(){var i=n().length,l=a[1]<a[0],p=a[l-0],h=a[1-l];t=(h-p)/Math.max(1,i-s+2*u),o&&(t=Math.floor(t)),p+=(h-p-t*(i-s))*c,e=t*(1-s),o&&(p=Math.round(p),e=Math.round(e));var d=w(i).map(function(e){return p+t*e});return r(l?d.reverse():d)}return delete i.unknown,i.domain=function(t){return arguments.length?(n(t),l()):n()},i.range=function(t){return arguments.length?(a=[+t[0],+t[1]],l()):a.slice()},i.rangeRound=function(t){return a=[+t[0],+t[1]],o=!0,l()},i.bandwidth=function(){return e},i.step=function(){return t},i.round=function(t){return arguments.length?(o=!!t,l()):o},i.padding=function(t){return arguments.length?(s=Math.min(1,u=+t),l()):s},i.paddingInner=function(t){return arguments.length?(s=Math.min(1,t),l()):s},i.paddingOuter=function(t){return arguments.length?(u=+t,l()):u},i.align=function(t){return arguments.length?(c=Math.max(0,Math.min(1,t)),l()):c},i.copy=function(){return bf(n(),a).round(o).paddingInner(s).paddingOuter(u).align(c)},ff.apply(l(),arguments)}function wf(){return function t(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return t(i())},e}(bf.apply(null,arguments).paddingInner(1))}var Cf=function(t){return function(){return t}},Sf=function(t){return+t},xf=[0,1];function Mf(t){return t}function Tf(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:Cf(isNaN(e)?NaN:.5)}function kf(t){var e,i=t[0],n=t[t.length-1];return i>n&&(e=i,i=n,n=e),function(t){return Math.max(i,Math.min(n,t))}}function Ef(t,e,i){var n=t[0],r=t[1],a=e[0],o=e[1];return r<n?(n=Tf(r,n),a=i(o,a)):(n=Tf(n,r),a=i(a,o)),function(t){return a(n(t))}}function Af(t,e,i){var n=Math.min(t.length,e.length)-1,r=new Array(n),a=new Array(n),o=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<n;)r[o]=Tf(t[o],t[o+1]),a[o]=i(e[o],e[o+1]);return function(e){var i=u(t,e,1,n)-1;return a[i](r[i](e))}}function Rf(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Df(){var t,e,i,n,r,a,o=xf,s=xf,u=Yi,c=Mf;function l(){return n=Math.min(o.length,s.length)>2?Af:Ef,r=a=null,p}function p(e){return isNaN(e=+e)?i:(r||(r=n(o.map(t),s,u)))(t(c(e)))}return p.invert=function(i){return c(e((a||(a=n(s,o.map(t),Bi)))(i)))},p.domain=function(t){return arguments.length?(o=mf.call(t,Sf),c===Mf||(c=kf(o)),l()):o.slice()},p.range=function(t){return arguments.length?(s=yf.call(t),l()):s.slice()},p.rangeRound=function(t){return s=yf.call(t),u=Ki,l()},p.clamp=function(t){return arguments.length?(c=t?kf(o):Mf,p):c!==Mf},p.interpolate=function(t){return arguments.length?(u=t,l()):u},p.unknown=function(t){return arguments.length?(i=t,p):i},function(i,n){return t=i,e=n,l()}}function If(t,e){return Df()(t,e)}var Lf=function(t,e,i,n){var r,a=k(t,e,i);switch((n=Ls(null==n?",f":n)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=n.precision||isNaN(r=$s(a,o))||(n.precision=r),qs(n,o);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(r=Xs(a,Math.max(Math.abs(t),Math.abs(e))))||(n.precision=r-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(r=Ys(a))||(n.precision=r-2*("%"===n.type))}return Bs(n)};function Nf(t){var e=t.domain;return t.ticks=function(t){var i=e();return M(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var n=e();return Lf(n[0],n[n.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var n,r=e(),a=0,o=r.length-1,s=r[a],u=r[o];return u<s&&(n=s,s=u,u=n,n=a,a=o,o=n),(n=T(s,u,i))>0?n=T(s=Math.floor(s/n)*n,u=Math.ceil(u/n)*n,i):n<0&&(n=T(s=Math.ceil(s*n)/n,u=Math.floor(u*n)/n,i)),n>0?(r[a]=Math.floor(s/n)*n,r[o]=Math.ceil(u/n)*n,e(r)):n<0&&(r[a]=Math.ceil(s*n)/n,r[o]=Math.floor(u*n)/n,e(r)),t},t}function Of(){var t=If(Mf,Mf);return t.copy=function(){return Rf(t,Of())},ff.apply(t,arguments),Nf(t)}function Pf(t){var e;function i(t){return isNaN(t=+t)?e:t}return i.invert=i,i.domain=i.range=function(e){return arguments.length?(t=mf.call(e,Sf),i):t.slice()},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return Pf(t).unknown(e)},t=arguments.length?mf.call(t,Sf):[0,1],Nf(i)}var Bf=function(t,e){var i,n=0,r=(t=t.slice()).length-1,a=t[n],o=t[r];return o<a&&(i=n,n=r,r=i,i=a,a=o,o=i),t[n]=e.floor(a),t[r]=e.ceil(o),t};function qf(t){return Math.log(t)}function Gf(t){return Math.exp(t)}function Vf(t){return-Math.log(-t)}function Wf(t){return-Math.exp(-t)}function Uf(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Ff(t){return function(e){return-t(-e)}}function jf(t){var e,i,n=t(qf,Gf),r=n.domain,a=10;function o(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(a),i=function(t){return 10===t?Uf:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(a),r()[0]<0?(e=Ff(e),i=Ff(i),t(Vf,Wf)):t(qf,Gf),n}return n.base=function(t){return arguments.length?(a=+t,o()):a},n.domain=function(t){return arguments.length?(r(t),o()):r()},n.ticks=function(t){var n,o=r(),s=o[0],u=o[o.length-1];(n=u<s)&&(h=s,s=u,u=h);var c,l,p,h=e(s),d=e(u),f=null==t?10:+t,v=[];if(!(a%1)&&d-h<f){if(h=Math.round(h)-1,d=Math.round(d)+1,s>0){for(;h<d;++h)for(l=1,c=i(h);l<a;++l)if(!((p=c*l)<s)){if(p>u)break;v.push(p)}}else for(;h<d;++h)for(l=a-1,c=i(h);l>=1;--l)if(!((p=c*l)<s)){if(p>u)break;v.push(p)}}else v=M(h,d,Math.min(d-h,f)).map(i);return n?v.reverse():v},n.tickFormat=function(t,r){if(null==r&&(r=10===a?".0e":","),"function"!=typeof r&&(r=Bs(r)),t===1/0)return r;null==t&&(t=10);var o=Math.max(1,a*t/n.ticks().length);return function(t){var n=t/i(Math.round(e(t)));return n*a<a-.5&&(n*=a),n<=o?r(t):""}},n.nice=function(){return r(Bf(r(),{floor:function(t){return i(Math.floor(e(t)))},ceil:function(t){return i(Math.ceil(e(t)))}}))},n}function Hf(){var t=jf(Df()).domain([1,10]);return t.copy=function(){return Rf(t,Hf()).base(t.base())},ff.apply(t,arguments),t}function Yf(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function $f(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Xf(t){var e=1,i=t(Yf(e),$f(e));return i.constant=function(i){return arguments.length?t(Yf(e=+i),$f(e)):e},Nf(i)}function Kf(){var t=Xf(Df());return t.copy=function(){return Rf(t,Kf()).constant(t.constant())},ff.apply(t,arguments)}function Jf(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Qf(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Zf(t){return t<0?-t*t:t*t}function tv(t){var e=t(Mf,Mf),i=1;return e.exponent=function(e){return arguments.length?1===(i=+e)?t(Mf,Mf):.5===i?t(Qf,Zf):t(Jf(i),Jf(1/i)):i},Nf(e)}function ev(){var t=tv(Df());return t.copy=function(){return Rf(t,ev()).exponent(t.exponent())},ff.apply(t,arguments),t}function iv(){return ev.apply(null,arguments).exponent(.5)}function nv(){var t,e=[],i=[],r=[];function a(){var t=0,n=Math.max(1,i.length);for(r=new Array(n-1);++t<n;)r[t-1]=R(e,t/n);return o}function o(e){return isNaN(e=+e)?t:i[u(r,e)]}return o.invertExtent=function(t){var n=i.indexOf(t);return n<0?[NaN,NaN]:[n>0?r[n-1]:e[0],n<r.length?r[n]:e[e.length-1]]},o.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var i,r=0,o=t.length;r<o;++r)null==(i=t[r])||isNaN(i=+i)||e.push(i);return e.sort(n),a()},o.range=function(t){return arguments.length?(i=yf.call(t),a()):i.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return r.slice()},o.copy=function(){return nv().domain(e).range(i).unknown(t)},ff.apply(o,arguments)}function rv(){var t,e=0,i=1,n=1,r=[.5],a=[0,1];function o(e){return e<=e?a[u(r,e,0,n)]:t}function s(){var t=-1;for(r=new Array(n);++t<n;)r[t]=((t+1)*i-(t-n)*e)/(n+1);return o}return o.domain=function(t){return arguments.length?(e=+t[0],i=+t[1],s()):[e,i]},o.range=function(t){return arguments.length?(n=(a=yf.call(t)).length-1,s()):a.slice()},o.invertExtent=function(t){var o=a.indexOf(t);return o<0?[NaN,NaN]:o<1?[e,r[0]]:o>=n?[r[n-1],i]:[r[o-1],r[o]]},o.unknown=function(e){return arguments.length?(t=e,o):o},o.thresholds=function(){return r.slice()},o.copy=function(){return rv().domain([e,i]).range(a).unknown(t)},ff.apply(Nf(o),arguments)}function av(){var t,e=[.5],i=[0,1],n=1;function r(r){return r<=r?i[u(e,r,0,n)]:t}return r.domain=function(t){return arguments.length?(e=yf.call(t),n=Math.min(e.length,i.length-1),r):e.slice()},r.range=function(t){return arguments.length?(i=yf.call(t),n=Math.min(e.length,i.length-1),r):i.slice()},r.invertExtent=function(t){var n=i.indexOf(t);return[e[n-1],e[n]]},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return av().domain(e).range(i).unknown(t)},ff.apply(r,arguments)}var ov=new Date,sv=new Date;function uv(t,e,i,n){function r(e){return t(e=new Date(+e)),e}return r.floor=r,r.ceil=function(i){return t(i=new Date(i-1)),e(i,1),t(i),i},r.round=function(t){var e=r(t),i=r.ceil(t);return t-e<i-t?e:i},r.offset=function(t,i){return e(t=new Date(+t),null==i?1:Math.floor(i)),t},r.range=function(i,n,a){var o,s=[];if(i=r.ceil(i),a=null==a?1:Math.floor(a),!(i<n&&a>0))return s;do{s.push(o=new Date(+i)),e(i,a),t(i)}while(o<i&&i<n);return s},r.filter=function(i){return uv(function(e){if(e>=e)for(;t(e),!i(e);)e.setTime(e-1)},function(t,n){if(t>=t)if(n<0)for(;++n<=0;)for(;e(t,-1),!i(t););else for(;--n>=0;)for(;e(t,1),!i(t););})},i&&(r.count=function(e,n){return ov.setTime(+e),sv.setTime(+n),t(ov),t(sv),Math.floor(i(ov,sv))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(n?function(e){return n(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var cv=uv(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});cv.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?uv(function(e){e.setTime(Math.floor(e/t)*t)},function(e,i){e.setTime(+e+i*t)},function(e,i){return(i-e)/t}):cv:null};var lv=cv,pv=cv.range,hv=6e4,dv=6048e5,fv=uv(function(t){t.setTime(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(+t+1e3*e)},function(t,e){return(e-t)/1e3},function(t){return t.getUTCSeconds()}),vv=fv,gv=fv.range,mv=uv(function(t){t.setTime(Math.floor(t/hv)*hv)},function(t,e){t.setTime(+t+e*hv)},function(t,e){return(e-t)/hv},function(t){return t.getMinutes()}),yv=mv,_v=mv.range,zv=uv(function(t){var e=t.getTimezoneOffset()*hv%36e5;e<0&&(e+=36e5),t.setTime(36e5*Math.floor((+t-e)/36e5)+e)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getHours()}),bv=zv,wv=zv.range,Cv=uv(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*hv)/864e5},function(t){return t.getDate()-1}),Sv=Cv,xv=Cv.range;function Mv(t){return uv(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*hv)/dv})}var Tv=Mv(0),kv=Mv(1),Ev=Mv(2),Av=Mv(3),Rv=Mv(4),Dv=Mv(5),Iv=Mv(6),Lv=Tv.range,Nv=kv.range,Ov=Ev.range,Pv=Av.range,Bv=Rv.range,qv=Dv.range,Gv=Iv.range,Vv=uv(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),Wv=Vv,Uv=Vv.range,Fv=uv(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Fv.every=function(t){return isFinite(t=Math.floor(t))&&t>0?uv(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i*t)}):null};var jv=Fv,Hv=Fv.range,Yv=uv(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*hv)},function(t,e){return(e-t)/hv},function(t){return t.getUTCMinutes()}),$v=Yv,Xv=Yv.range,Kv=uv(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getUTCHours()}),Jv=Kv,Qv=Kv.range,Zv=uv(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/864e5},function(t){return t.getUTCDate()-1}),tg=Zv,eg=Zv.range;function ig(t){return uv(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/dv})}var ng=ig(0),rg=ig(1),ag=ig(2),og=ig(3),sg=ig(4),ug=ig(5),cg=ig(6),lg=ng.range,pg=rg.range,hg=ag.range,dg=og.range,fg=sg.range,vg=ug.range,gg=cg.range,mg=uv(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),yg=mg,_g=mg.range,zg=uv(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});zg.every=function(t){return isFinite(t=Math.floor(t))&&t>0?uv(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i*t)}):null};var bg=zg,wg=zg.range;function Cg(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Sg(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function xg(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function Mg(t){var e=t.dateTime,i=t.date,n=t.time,r=t.periods,a=t.days,o=t.shortDays,s=t.months,u=t.shortMonths,c=Bg(r),l=qg(r),p=Bg(a),h=qg(a),d=Bg(o),f=qg(o),v=Bg(s),g=qg(s),m=Bg(u),y=qg(u),_={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:am,e:am,f:lm,H:om,I:sm,j:um,L:cm,m:pm,M:hm,p:function(t){return r[+(t.getHours()>=12)]},Q:Gm,s:Vm,S:dm,u:fm,U:vm,V:gm,w:mm,W:ym,x:null,X:null,y:_m,Y:zm,Z:bm,"%":qm},z={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:wm,e:wm,f:Tm,H:Cm,I:Sm,j:xm,L:Mm,m:km,M:Em,p:function(t){return r[+(t.getUTCHours()>=12)]},Q:Gm,s:Vm,S:Am,u:Rm,U:Dm,V:Im,w:Lm,W:Nm,x:null,X:null,y:Om,Y:Pm,Z:Bm,"%":qm},b={a:function(t,e,i){var n=d.exec(e.slice(i));return n?(t.w=f[n[0].toLowerCase()],i+n[0].length):-1},A:function(t,e,i){var n=p.exec(e.slice(i));return n?(t.w=h[n[0].toLowerCase()],i+n[0].length):-1},b:function(t,e,i){var n=m.exec(e.slice(i));return n?(t.m=y[n[0].toLowerCase()],i+n[0].length):-1},B:function(t,e,i){var n=v.exec(e.slice(i));return n?(t.m=g[n[0].toLowerCase()],i+n[0].length):-1},c:function(t,i,n){return S(t,e,i,n)},d:Xg,e:Xg,f:em,H:Jg,I:Jg,j:Kg,L:tm,m:$g,M:Qg,p:function(t,e,i){var n=c.exec(e.slice(i));return n?(t.p=l[n[0].toLowerCase()],i+n[0].length):-1},Q:nm,s:rm,S:Zg,u:Vg,U:Wg,V:Ug,w:Gg,W:Fg,x:function(t,e,n){return S(t,i,e,n)},X:function(t,e,i){return S(t,n,e,i)},y:Hg,Y:jg,Z:Yg,"%":im};function w(t,e){return function(i){var n,r,a,o=[],s=-1,u=0,c=t.length;for(i instanceof Date||(i=new Date(+i));++s<c;)37===t.charCodeAt(s)&&(o.push(t.slice(u,s)),null!=(r=Dg[n=t.charAt(++s)])?n=t.charAt(++s):r="e"===n?" ":"0",(a=e[n])&&(n=a(i,r)),o.push(n),u=s+1);return o.push(t.slice(u,s)),o.join("")}}function C(t,e){return function(i){var n,r,a=xg(1900);if(S(a,t,i+="",0)!=i.length)return null;if("Q"in a)return new Date(a.Q);if("p"in a&&(a.H=a.H%12+12*a.p),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(r=(n=Sg(xg(a.y))).getUTCDay(),n=r>4||0===r?rg.ceil(n):rg(n),n=tg.offset(n,7*(a.V-1)),a.y=n.getUTCFullYear(),a.m=n.getUTCMonth(),a.d=n.getUTCDate()+(a.w+6)%7):(r=(n=e(xg(a.y))).getDay(),n=r>4||0===r?kv.ceil(n):kv(n),n=Sv.offset(n,7*(a.V-1)),a.y=n.getFullYear(),a.m=n.getMonth(),a.d=n.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),r="Z"in a?Sg(xg(a.y)).getUTCDay():e(xg(a.y)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(r+5)%7:a.w+7*a.U-(r+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,Sg(a)):e(a)}}function S(t,e,i,n){for(var r,a,o=0,s=e.length,u=i.length;o<s;){if(n>=u)return-1;if(37===(r=e.charCodeAt(o++))){if(r=e.charAt(o++),!(a=b[r in Dg?e.charAt(o++):r])||(n=a(t,i,n))<0)return-1}else if(r!=i.charCodeAt(n++))return-1}return n}return _.x=w(i,_),_.X=w(n,_),_.c=w(e,_),z.x=w(i,z),z.X=w(n,z),z.c=w(e,z),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=C(t+="",Cg);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",z);return e.toString=function(){return t},e},utcParse:function(t){var e=C(t,Sg);return e.toString=function(){return t},e}}}var Tg,kg,Eg,Ag,Rg,Dg={"-":"",_:" ",0:"0"},Ig=/^\s*\d+/,Lg=/^%/,Ng=/[\\^$*+?|[\]().{}]/g;function Og(t,e,i){var n=t<0?"-":"",r=(n?-t:t)+"",a=r.length;return n+(a<i?new Array(i-a+1).join(e)+r:r)}function Pg(t){return t.replace(Ng,"\\$&")}function Bg(t){return new RegExp("^(?:"+t.map(Pg).join("|")+")","i")}function qg(t){for(var e={},i=-1,n=t.length;++i<n;)e[t[i].toLowerCase()]=i;return e}function Gg(t,e,i){var n=Ig.exec(e.slice(i,i+1));return n?(t.w=+n[0],i+n[0].length):-1}function Vg(t,e,i){var n=Ig.exec(e.slice(i,i+1));return n?(t.u=+n[0],i+n[0].length):-1}function Wg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.U=+n[0],i+n[0].length):-1}function Ug(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.V=+n[0],i+n[0].length):-1}function Fg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.W=+n[0],i+n[0].length):-1}function jg(t,e,i){var n=Ig.exec(e.slice(i,i+4));return n?(t.y=+n[0],i+n[0].length):-1}function Hg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function Yg(t,e,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(i,i+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function $g(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.m=n[0]-1,i+n[0].length):-1}function Xg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.d=+n[0],i+n[0].length):-1}function Kg(t,e,i){var n=Ig.exec(e.slice(i,i+3));return n?(t.m=0,t.d=+n[0],i+n[0].length):-1}function Jg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.H=+n[0],i+n[0].length):-1}function Qg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.M=+n[0],i+n[0].length):-1}function Zg(t,e,i){var n=Ig.exec(e.slice(i,i+2));return n?(t.S=+n[0],i+n[0].length):-1}function tm(t,e,i){var n=Ig.exec(e.slice(i,i+3));return n?(t.L=+n[0],i+n[0].length):-1}function em(t,e,i){var n=Ig.exec(e.slice(i,i+6));return n?(t.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function im(t,e,i){var n=Lg.exec(e.slice(i,i+1));return n?i+n[0].length:-1}function nm(t,e,i){var n=Ig.exec(e.slice(i));return n?(t.Q=+n[0],i+n[0].length):-1}function rm(t,e,i){var n=Ig.exec(e.slice(i));return n?(t.Q=1e3*+n[0],i+n[0].length):-1}function am(t,e){return Og(t.getDate(),e,2)}function om(t,e){return Og(t.getHours(),e,2)}function sm(t,e){return Og(t.getHours()%12||12,e,2)}function um(t,e){return Og(1+Sv.count(jv(t),t),e,3)}function cm(t,e){return Og(t.getMilliseconds(),e,3)}function lm(t,e){return cm(t,e)+"000"}function pm(t,e){return Og(t.getMonth()+1,e,2)}function hm(t,e){return Og(t.getMinutes(),e,2)}function dm(t,e){return Og(t.getSeconds(),e,2)}function fm(t){var e=t.getDay();return 0===e?7:e}function vm(t,e){return Og(Tv.count(jv(t),t),e,2)}function gm(t,e){var i=t.getDay();return t=i>=4||0===i?Rv(t):Rv.ceil(t),Og(Rv.count(jv(t),t)+(4===jv(t).getDay()),e,2)}function mm(t){return t.getDay()}function ym(t,e){return Og(kv.count(jv(t),t),e,2)}function _m(t,e){return Og(t.getFullYear()%100,e,2)}function zm(t,e){return Og(t.getFullYear()%1e4,e,4)}function bm(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Og(e/60|0,"0",2)+Og(e%60,"0",2)}function wm(t,e){return Og(t.getUTCDate(),e,2)}function Cm(t,e){return Og(t.getUTCHours(),e,2)}function Sm(t,e){return Og(t.getUTCHours()%12||12,e,2)}function xm(t,e){return Og(1+tg.count(bg(t),t),e,3)}function Mm(t,e){return Og(t.getUTCMilliseconds(),e,3)}function Tm(t,e){return Mm(t,e)+"000"}function km(t,e){return Og(t.getUTCMonth()+1,e,2)}function Em(t,e){return Og(t.getUTCMinutes(),e,2)}function Am(t,e){return Og(t.getUTCSeconds(),e,2)}function Rm(t){var e=t.getUTCDay();return 0===e?7:e}function Dm(t,e){return Og(ng.count(bg(t),t),e,2)}function Im(t,e){var i=t.getUTCDay();return t=i>=4||0===i?sg(t):sg.ceil(t),Og(sg.count(bg(t),t)+(4===bg(t).getUTCDay()),e,2)}function Lm(t){return t.getUTCDay()}function Nm(t,e){return Og(rg.count(bg(t),t),e,2)}function Om(t,e){return Og(t.getUTCFullYear()%100,e,2)}function Pm(t,e){return Og(t.getUTCFullYear()%1e4,e,4)}function Bm(){return"+0000"}function qm(){return"%"}function Gm(t){return+t}function Vm(t){return Math.floor(+t/1e3)}function Wm(t){return Tg=Mg(t),kg=Tg.format,Eg=Tg.parse,Ag=Tg.utcFormat,Rg=Tg.utcParse,Tg}Wm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Um=Date.prototype.toISOString?function(t){return t.toISOString()}:Ag("%Y-%m-%dT%H:%M:%S.%LZ");var Fm=+new Date("2000-01-01T00:00:00.000Z")?function(t){var e=new Date(t);return isNaN(e)?null:e}:Rg("%Y-%m-%dT%H:%M:%S.%LZ"),jm=1e3,Hm=60*jm,Ym=60*Hm,$m=24*Ym,Xm=7*$m,Km=30*$m,Jm=365*$m;function Qm(t){return new Date(t)}function Zm(t){return t instanceof Date?+t:+new Date(+t)}function ty(t,e,i,n,a,o,s,u,c){var l=If(Mf,Mf),p=l.invert,h=l.domain,d=c(".%L"),f=c(":%S"),v=c("%I:%M"),g=c("%I %p"),m=c("%a %d"),y=c("%b %d"),_=c("%B"),z=c("%Y"),b=[[s,1,jm],[s,5,5*jm],[s,15,15*jm],[s,30,30*jm],[o,1,Hm],[o,5,5*Hm],[o,15,15*Hm],[o,30,30*Hm],[a,1,Ym],[a,3,3*Ym],[a,6,6*Ym],[a,12,12*Ym],[n,1,$m],[n,2,2*$m],[i,1,Xm],[e,1,Km],[e,3,3*Km],[t,1,Jm]];function w(r){return(s(r)<r?d:o(r)<r?f:a(r)<r?v:n(r)<r?g:e(r)<r?i(r)<r?m:y:t(r)<r?_:z)(r)}function C(e,i,n,a){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(n-i)/e,s=r(function(t){return t[2]}).right(b,o);s===b.length?(a=k(i/Jm,n/Jm,e),e=t):s?(a=(s=b[o/b[s-1][2]<b[s][2]/o?s-1:s])[1],e=s[0]):(a=Math.max(k(i,n,e),1),e=u)}return null==a?e:e.every(a)}return l.invert=function(t){return new Date(p(t))},l.domain=function(t){return arguments.length?h(mf.call(t,Zm)):h().map(Qm)},l.ticks=function(t,e){var i,n=h(),r=n[0],a=n[n.length-1],o=a<r;return o&&(i=r,r=a,a=i),i=(i=C(t,r,a,e))?i.range(r,a+1):[],o?i.reverse():i},l.tickFormat=function(t,e){return null==e?w:c(e)},l.nice=function(t,e){var i=h();return(t=C(t,i[0],i[i.length-1],e))?h(Bf(i,t)):l},l.copy=function(){return Rf(l,ty(t,e,i,n,a,o,s,u,c))},l}var ey=function(){return ff.apply(ty(jv,Wv,Tv,Sv,bv,yv,vv,lv,kg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},iy=function(){return ff.apply(ty(bg,yg,ng,tg,Jv,$v,vv,lv,Ag).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)};function ny(){var t,e,i,n,r,a=0,o=1,s=Mf,u=!1;function c(e){return isNaN(e=+e)?r:s(0===i?.5:(e=(n(e)-t)*i,u?Math.max(0,Math.min(1,e)):e))}return c.domain=function(r){return arguments.length?(t=n(a=+r[0]),e=n(o=+r[1]),i=t===e?0:1/(e-t),c):[a,o]},c.clamp=function(t){return arguments.length?(u=!!t,c):u},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.unknown=function(t){return arguments.length?(r=t,c):r},function(r){return n=r,t=r(a),e=r(o),i=t===e?0:1/(e-t),c}}function ry(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function ay(){var t=Nf(ny()(Mf));return t.copy=function(){return ry(t,ay())},vf.apply(t,arguments)}function oy(){var t=jf(ny()).domain([1,10]);return t.copy=function(){return ry(t,oy()).base(t.base())},vf.apply(t,arguments)}function sy(){var t=Xf(ny());return t.copy=function(){return ry(t,sy()).constant(t.constant())},vf.apply(t,arguments)}function uy(){var t=tv(ny());return t.copy=function(){return ry(t,uy()).exponent(t.exponent())},vf.apply(t,arguments)}function cy(){return uy.apply(null,arguments).exponent(.5)}function ly(){var t=[],e=Mf;function i(i){if(!isNaN(i=+i))return e((u(t,i)-1)/(t.length-1))}return i.domain=function(e){if(!arguments.length)return t.slice();t=[];for(var r,a=0,o=e.length;a<o;++a)null==(r=e[a])||isNaN(r=+r)||t.push(r);return t.sort(n),i},i.interpolator=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return ly(e).domain(t)},vf.apply(i,arguments)}function py(){var t,e,i,n,r,a,o,s=0,u=.5,c=1,l=Mf,p=!1;function h(t){return isNaN(t=+t)?o:(t=.5+((t=+a(t))-e)*(t<e?n:r),l(p?Math.max(0,Math.min(1,t)):t))}return h.domain=function(o){return arguments.length?(t=a(s=+o[0]),e=a(u=+o[1]),i=a(c=+o[2]),n=t===e?0:.5/(e-t),r=e===i?0:.5/(i-e),h):[s,u,c]},h.clamp=function(t){return arguments.length?(p=!!t,h):p},h.interpolator=function(t){return arguments.length?(l=t,h):l},h.unknown=function(t){return arguments.length?(o=t,h):o},function(o){return a=o,t=o(s),e=o(u),i=o(c),n=t===e?0:.5/(e-t),r=e===i?0:.5/(i-e),h}}function hy(){var t=Nf(py()(Mf));return t.copy=function(){return ry(t,hy())},vf.apply(t,arguments)}function dy(){var t=jf(py()).domain([.1,1,10]);return t.copy=function(){return ry(t,dy()).base(t.base())},vf.apply(t,arguments)}function fy(){var t=Xf(py());return t.copy=function(){return ry(t,fy()).constant(t.constant())},vf.apply(t,arguments)}function vy(){var t=tv(py());return t.copy=function(){return ry(t,vy()).exponent(t.exponent())},vf.apply(t,arguments)}function gy(){return vy.apply(null,arguments).exponent(.5)}var my=function(t){for(var e=t.length/6|0,i=new Array(e),n=0;n<e;)i[n]="#"+t.slice(6*n,6*++n);return i},yy=my("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),_y=my("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),zy=my("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),by=my("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),wy=my("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Cy=my("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Sy=my("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),xy=my("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),My=my("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Ty=function(t){return Li(t[t.length-1])},ky=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(my),Ey=Ty(ky),Ay=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(my),Ry=Ty(Ay),Dy=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(my),Iy=Ty(Dy),Ly=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(my),Ny=Ty(Ly),Oy=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(my),Py=Ty(Oy),By=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(my),qy=Ty(By),Gy=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(my),Vy=Ty(Gy),Wy=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(my),Uy=Ty(Wy),Fy=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(my),jy=Ty(Fy),Hy=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(my),Yy=Ty(Hy),$y=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(my),Xy=Ty($y),Ky=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(my),Jy=Ty(Ky),Qy=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(my),Zy=Ty(Qy),t_=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(my),e_=Ty(t_),i_=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(my),n_=Ty(i_),r_=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(my),a_=Ty(r_),o_=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(my),s_=Ty(o_),u_=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(my),c_=Ty(u_),l_=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(my),p_=Ty(l_),h_=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(my),d_=Ty(h_),f_=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(my),v_=Ty(f_),g_=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(my),m_=Ty(g_),y_=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(my),__=Ty(y_),z_=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(my),b_=Ty(z_),w_=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(my),C_=Ty(w_),S_=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(my),x_=Ty(S_),M_=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(my),T_=Ty(M_),k_=gn(wi(300,.5,0),wi(-240,.5,1)),E_=gn(wi(-100,.75,.35),wi(80,1.5,.8)),A_=gn(wi(260,.75,.35),wi(80,1.5,.8)),R_=wi(),D_=function(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return R_.h=360*t-100,R_.s=1.5-1.5*e,R_.l=.8-.9*e,R_+""},I_=We(),L_=Math.PI/3,N_=2*Math.PI/3,O_=function(t){var e;return t=(.5-t)*Math.PI,I_.r=255*(e=Math.sin(t))*e,I_.g=255*(e=Math.sin(t+L_))*e,I_.b=255*(e=Math.sin(t+N_))*e,I_+""};function P_(t){var e=t.length;return function(i){return t[Math.max(0,Math.min(e-1,Math.floor(i*e)))]}}var B_=P_(my("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),q_=P_(my("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),G_=P_(my("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),V_=P_(my("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),W_=function(t){return function(){return t}},U_=Math.abs,F_=Math.atan2,j_=Math.cos,H_=Math.max,Y_=Math.min,$_=Math.sin,X_=Math.sqrt,K_=1e-12,J_=Math.PI,Q_=J_/2,Z_=2*J_;function tz(t){return t>=1?Q_:t<=-1?-Q_:Math.asin(t)}function ez(t){return t.innerRadius}function iz(t){return t.outerRadius}function nz(t){return t.startAngle}function rz(t){return t.endAngle}function az(t){return t&&t.padAngle}function oz(t,e,i,n,r,a,o){var s=t-i,u=e-n,c=(o?a:-a)/X_(s*s+u*u),l=c*u,p=-c*s,h=t+l,d=e+p,f=i+l,v=n+p,g=(h+f)/2,m=(d+v)/2,y=f-h,_=v-d,z=y*y+_*_,b=r-a,w=h*v-f*d,C=(_<0?-1:1)*X_(H_(0,b*b*z-w*w)),S=(w*_-y*C)/z,x=(-w*y-_*C)/z,M=(w*_+y*C)/z,T=(-w*y+_*C)/z,k=S-g,E=x-m,A=M-g,R=T-m;return k*k+E*E>A*A+R*R&&(S=M,x=T),{cx:S,cy:x,x01:-l,y01:-p,x11:S*(r/b-1),y11:x*(r/b-1)}}var sz=function(){var t=ez,e=iz,i=W_(0),n=null,r=nz,a=rz,o=az,s=null;function u(){var u,c,l,p=+t.apply(this,arguments),h=+e.apply(this,arguments),d=r.apply(this,arguments)-Q_,f=a.apply(this,arguments)-Q_,v=U_(f-d),g=f>d;if(s||(s=u=Ga()),h<p&&(c=h,h=p,p=c),h>K_)if(v>Z_-K_)s.moveTo(h*j_(d),h*$_(d)),s.arc(0,0,h,d,f,!g),p>K_&&(s.moveTo(p*j_(f),p*$_(f)),s.arc(0,0,p,f,d,g));else{var m,y,_=d,z=f,b=d,w=f,C=v,S=v,x=o.apply(this,arguments)/2,M=x>K_&&(n?+n.apply(this,arguments):X_(p*p+h*h)),T=Y_(U_(h-p)/2,+i.apply(this,arguments)),k=T,E=T;if(M>K_){var A=tz(M/p*$_(x)),R=tz(M/h*$_(x));(C-=2*A)>K_?(b+=A*=g?1:-1,w-=A):(C=0,b=w=(d+f)/2),(S-=2*R)>K_?(_+=R*=g?1:-1,z-=R):(S=0,_=z=(d+f)/2)}var D=h*j_(_),I=h*$_(_),L=p*j_(w),N=p*$_(w);if(T>K_){var O,P=h*j_(z),B=h*$_(z),q=p*j_(b),G=p*$_(b);if(v<=Z_-K_&&(O=function(t,e,i,n,r,a,o,s){var u=i-t,c=n-e,l=o-r,p=s-a,h=p*u-l*c;if(!(h*h<K_))return[t+(h=(l*(e-a)-p*(t-r))/h)*u,e+h*c]}(D,I,q,G,P,B,L,N))){var V=D-O[0],W=I-O[1],U=P-O[0],F=B-O[1],j=1/$_(((l=(V*U+W*F)/(X_(V*V+W*W)*X_(U*U+F*F)))>1?0:l<-1?J_:Math.acos(l))/2),H=X_(O[0]*O[0]+O[1]*O[1]);k=Y_(T,(p-H)/(j-1)),E=Y_(T,(h-H)/(j+1))}}S>K_?E>K_?(m=oz(q,G,D,I,h,E,g),y=oz(P,B,L,N,h,E,g),s.moveTo(m.cx+m.x01,m.cy+m.y01),E<T?s.arc(m.cx,m.cy,E,F_(m.y01,m.x01),F_(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,E,F_(m.y01,m.x01),F_(m.y11,m.x11),!g),s.arc(0,0,h,F_(m.cy+m.y11,m.cx+m.x11),F_(y.cy+y.y11,y.cx+y.x11),!g),s.arc(y.cx,y.cy,E,F_(y.y11,y.x11),F_(y.y01,y.x01),!g))):(s.moveTo(D,I),s.arc(0,0,h,_,z,!g)):s.moveTo(D,I),p>K_&&C>K_?k>K_?(m=oz(L,N,P,B,p,-k,g),y=oz(D,I,q,G,p,-k,g),s.lineTo(m.cx+m.x01,m.cy+m.y01),k<T?s.arc(m.cx,m.cy,k,F_(m.y01,m.x01),F_(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,k,F_(m.y01,m.x01),F_(m.y11,m.x11),!g),s.arc(0,0,p,F_(m.cy+m.y11,m.cx+m.x11),F_(y.cy+y.y11,y.cx+y.x11),g),s.arc(y.cx,y.cy,k,F_(y.y11,y.x11),F_(y.y01,y.x01),!g))):s.arc(0,0,p,w,b,g):s.lineTo(L,N)}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var i=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,n=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-J_/2;return[j_(n)*i,$_(n)*i]},u.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:W_(+e),u):t},u.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:W_(+t),u):e},u.cornerRadius=function(t){return arguments.length?(i="function"==typeof t?t:W_(+t),u):i},u.padRadius=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:W_(+t),u):n},u.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:W_(+t),u):r},u.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:W_(+t),u):a},u.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:W_(+t),u):o},u.context=function(t){return arguments.length?(s=null==t?null:t,u):s},u};function uz(t){this._context=t}uz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var cz=function(t){return new uz(t)};function lz(t){return t[0]}function pz(t){return t[1]}var hz=function(){var t=lz,e=pz,i=W_(!0),n=null,r=cz,a=null;function o(o){var s,u,c,l=o.length,p=!1;for(null==n&&(a=r(c=Ga())),s=0;s<=l;++s)!(s<l&&i(u=o[s],s,o))===p&&((p=!p)?a.lineStart():a.lineEnd()),p&&a.point(+t(u,s,o),+e(u,s,o));if(c)return a=null,c+""||null}return o.x=function(e){return arguments.length?(t="function"==typeof e?e:W_(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:W_(+t),o):e},o.defined=function(t){return arguments.length?(i="function"==typeof t?t:W_(!!t),o):i},o.curve=function(t){return arguments.length?(r=t,null!=n&&(a=r(n)),o):r},o.context=function(t){return arguments.length?(null==t?n=a=null:a=r(n=t),o):n},o},dz=function(){var t=lz,e=null,i=W_(0),n=pz,r=W_(!0),a=null,o=cz,s=null;function u(u){var c,l,p,h,d,f=u.length,v=!1,g=new Array(f),m=new Array(f);for(null==a&&(s=o(d=Ga())),c=0;c<=f;++c){if(!(c<f&&r(h=u[c],c,u))===v)if(v=!v)l=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),p=c-1;p>=l;--p)s.point(g[p],m[p]);s.lineEnd(),s.areaEnd()}v&&(g[c]=+t(h,c,u),m[c]=+i(h,c,u),s.point(e?+e(h,c,u):g[c],n?+n(h,c,u):m[c]))}if(d)return s=null,d+""||null}function c(){return hz().defined(r).curve(o).context(a)}return u.x=function(i){return arguments.length?(t="function"==typeof i?i:W_(+i),e=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:W_(+e),u):t},u.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:W_(+t),u):e},u.y=function(t){return arguments.length?(i="function"==typeof t?t:W_(+t),n=null,u):i},u.y0=function(t){return arguments.length?(i="function"==typeof t?t:W_(+t),u):i},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:W_(+t),u):n},u.lineX0=u.lineY0=function(){return c().x(t).y(i)},u.lineY1=function(){return c().x(t).y(n)},u.lineX1=function(){return c().x(e).y(i)},u.defined=function(t){return arguments.length?(r="function"==typeof t?t:W_(!!t),u):r},u.curve=function(t){return arguments.length?(o=t,null!=a&&(s=o(a)),u):o},u.context=function(t){return arguments.length?(null==t?a=s=null:s=o(a=t),u):a},u},fz=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},vz=function(t){return t},gz=function(){var t=vz,e=fz,i=null,n=W_(0),r=W_(Z_),a=W_(0);function o(o){var s,u,c,l,p,h=o.length,d=0,f=new Array(h),v=new Array(h),g=+n.apply(this,arguments),m=Math.min(Z_,Math.max(-Z_,r.apply(this,arguments)-g)),y=Math.min(Math.abs(m)/h,a.apply(this,arguments)),_=y*(m<0?-1:1);for(s=0;s<h;++s)(p=v[f[s]=s]=+t(o[s],s,o))>0&&(d+=p);for(null!=e?f.sort(function(t,i){return e(v[t],v[i])}):null!=i&&f.sort(function(t,e){return i(o[t],o[e])}),s=0,c=d?(m-h*_)/d:0;s<h;++s,g=l)u=f[s],l=g+((p=v[u])>0?p*c:0)+_,v[u]={data:o[u],index:s,value:p,startAngle:g,endAngle:l,padAngle:y};return v}return o.value=function(e){return arguments.length?(t="function"==typeof e?e:W_(+e),o):t},o.sortValues=function(t){return arguments.length?(e=t,i=null,o):e},o.sort=function(t){return arguments.length?(i=t,e=null,o):i},o.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:W_(+t),o):n},o.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:W_(+t),o):r},o.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:W_(+t),o):a},o},mz=_z(cz);function yz(t){this._curve=t}function _z(t){function e(e){return new yz(t(e))}return e._curve=t,e}function zz(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?e(_z(t)):e()._curve},t}yz.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};var bz=function(){return zz(hz().curve(mz))},wz=function(){var t=dz().curve(mz),e=t.curve,i=t.lineX0,n=t.lineX1,r=t.lineY0,a=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return zz(i())},delete t.lineX0,t.lineEndAngle=function(){return zz(n())},delete t.lineX1,t.lineInnerRadius=function(){return zz(r())},delete t.lineY0,t.lineOuterRadius=function(){return zz(a())},delete t.lineY1,t.curve=function(t){return arguments.length?e(_z(t)):e()._curve},t},Cz=function(t,e){return[(e=+e)*Math.cos(t-=Math.PI/2),e*Math.sin(t)]},Sz=Array.prototype.slice;function xz(t){return t.source}function Mz(t){return t.target}function Tz(t){var e=xz,i=Mz,n=lz,r=pz,a=null;function o(){var o,s=Sz.call(arguments),u=e.apply(this,s),c=i.apply(this,s);if(a||(a=o=Ga()),t(a,+n.apply(this,(s[0]=u,s)),+r.apply(this,s),+n.apply(this,(s[0]=c,s)),+r.apply(this,s)),o)return a=null,o+""||null}return o.source=function(t){return arguments.length?(e=t,o):e},o.target=function(t){return arguments.length?(i=t,o):i},o.x=function(t){return arguments.length?(n="function"==typeof t?t:W_(+t),o):n},o.y=function(t){return arguments.length?(r="function"==typeof t?t:W_(+t),o):r},o.context=function(t){return arguments.length?(a=null==t?null:t,o):a},o}function kz(t,e,i,n,r){t.moveTo(e,i),t.bezierCurveTo(e=(e+n)/2,i,e,r,n,r)}function Ez(t,e,i,n,r){t.moveTo(e,i),t.bezierCurveTo(e,i=(i+r)/2,n,i,n,r)}function Az(t,e,i,n,r){var a=Cz(e,i),o=Cz(e,i=(i+r)/2),s=Cz(n,i),u=Cz(n,r);t.moveTo(a[0],a[1]),t.bezierCurveTo(o[0],o[1],s[0],s[1],u[0],u[1])}function Rz(){return Tz(kz)}function Dz(){return Tz(Ez)}function Iz(){var t=Tz(Az);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t}var Lz={draw:function(t,e){var i=Math.sqrt(e/J_);t.moveTo(i,0),t.arc(0,0,i,0,Z_)}},Nz={draw:function(t,e){var i=Math.sqrt(e/5)/2;t.moveTo(-3*i,-i),t.lineTo(-i,-i),t.lineTo(-i,-3*i),t.lineTo(i,-3*i),t.lineTo(i,-i),t.lineTo(3*i,-i),t.lineTo(3*i,i),t.lineTo(i,i),t.lineTo(i,3*i),t.lineTo(-i,3*i),t.lineTo(-i,i),t.lineTo(-3*i,i),t.closePath()}},Oz=Math.sqrt(1/3),Pz=2*Oz,Bz={draw:function(t,e){var i=Math.sqrt(e/Pz),n=i*Oz;t.moveTo(0,-i),t.lineTo(n,0),t.lineTo(0,i),t.lineTo(-n,0),t.closePath()}},qz=Math.sin(J_/10)/Math.sin(7*J_/10),Gz=Math.sin(Z_/10)*qz,Vz=-Math.cos(Z_/10)*qz,Wz={draw:function(t,e){var i=Math.sqrt(.8908130915292852*e),n=Gz*i,r=Vz*i;t.moveTo(0,-i),t.lineTo(n,r);for(var a=1;a<5;++a){var o=Z_*a/5,s=Math.cos(o),u=Math.sin(o);t.lineTo(u*i,-s*i),t.lineTo(s*n-u*r,u*n+s*r)}t.closePath()}},Uz={draw:function(t,e){var i=Math.sqrt(e),n=-i/2;t.rect(n,n,i,i)}},Fz=Math.sqrt(3),jz={draw:function(t,e){var i=-Math.sqrt(e/(3*Fz));t.moveTo(0,2*i),t.lineTo(-Fz*i,-i),t.lineTo(Fz*i,-i),t.closePath()}},Hz=Math.sqrt(3)/2,Yz=1/Math.sqrt(12),$z=3*(Yz/2+1),Xz={draw:function(t,e){var i=Math.sqrt(e/$z),n=i/2,r=i*Yz,a=n,o=i*Yz+i,s=-a,u=o;t.moveTo(n,r),t.lineTo(a,o),t.lineTo(s,u),t.lineTo(-.5*n-Hz*r,Hz*n+-.5*r),t.lineTo(-.5*a-Hz*o,Hz*a+-.5*o),t.lineTo(-.5*s-Hz*u,Hz*s+-.5*u),t.lineTo(-.5*n+Hz*r,-.5*r-Hz*n),t.lineTo(-.5*a+Hz*o,-.5*o-Hz*a),t.lineTo(-.5*s+Hz*u,-.5*u-Hz*s),t.closePath()}},Kz=[Lz,Nz,Bz,Uz,Wz,jz,Xz],Jz=function(){var t=W_(Lz),e=W_(64),i=null;function n(){var n;if(i||(i=n=Ga()),t.apply(this,arguments).draw(i,+e.apply(this,arguments)),n)return i=null,n+""||null}return n.type=function(e){return arguments.length?(t="function"==typeof e?e:W_(e),n):t},n.size=function(t){return arguments.length?(e="function"==typeof t?t:W_(+t),n):e},n.context=function(t){return arguments.length?(i=null==t?null:t,n):i},n},Qz=function(){};function Zz(t,e,i){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6)}function tb(t){this._context=t}tb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Zz(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Zz(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var eb=function(t){return new tb(t)};function ib(t){this._context=t}ib.prototype={areaStart:Qz,areaEnd:Qz,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Zz(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var nb=function(t){return new ib(t)};function rb(t){this._context=t}rb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var i=(this._x0+4*this._x1+t)/6,n=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 3:this._point=4;default:Zz(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var ab=function(t){return new rb(t)};function ob(t,e){this._basis=new tb(t),this._beta=e}ob.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,i=t.length-1;if(i>0)for(var n,r=t[0],a=e[0],o=t[i]-r,s=e[i]-a,u=-1;++u<=i;)n=u/i,this._basis.point(this._beta*t[u]+(1-this._beta)*(r+n*o),this._beta*e[u]+(1-this._beta)*(a+n*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var sb=function t(e){function i(t){return 1===e?new tb(t):new ob(t,e)}return i.beta=function(e){return t(+e)},i}(.85);function ub(t,e,i){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-i),t._x2,t._y2)}function cb(t,e){this._context=t,this._k=(1-e)/6}cb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ub(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:ub(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var lb=function t(e){function i(t){return new cb(t,e)}return i.tension=function(e){return t(+e)},i}(0);function pb(t,e){this._context=t,this._k=(1-e)/6}pb.prototype={areaStart:Qz,areaEnd:Qz,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:ub(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var hb=function t(e){function i(t){return new pb(t,e)}return i.tension=function(e){return t(+e)},i}(0);function db(t,e){this._context=t,this._k=(1-e)/6}db.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ub(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var fb=function t(e){function i(t){return new db(t,e)}return i.tension=function(e){return t(+e)},i}(0);function vb(t,e,i){var n=t._x1,r=t._y1,a=t._x2,o=t._y2;if(t._l01_a>K_){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);n=(n*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>K_){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*c+t._x1*t._l23_2a-e*t._l12_2a)/l,o=(o*c+t._y1*t._l23_2a-i*t._l12_2a)/l}t._context.bezierCurveTo(n,r,a,o,t._x2,t._y2)}function gb(t,e){this._context=t,this._alpha=e}gb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:vb(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var mb=function t(e){function i(t){return e?new gb(t,e):new cb(t,0)}return i.alpha=function(e){return t(+e)},i}(.5);function yb(t,e){this._context=t,this._alpha=e}yb.prototype={areaStart:Qz,areaEnd:Qz,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:vb(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var _b=function t(e){function i(t){return e?new yb(t,e):new pb(t,0)}return i.alpha=function(e){return t(+e)},i}(.5);function zb(t,e){this._context=t,this._alpha=e}zb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var i=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:vb(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var bb=function t(e){function i(t){return e?new zb(t,e):new db(t,0)}return i.alpha=function(e){return t(+e)},i}(.5);function wb(t){this._context=t}wb.prototype={areaStart:Qz,areaEnd:Qz,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};var Cb=function(t){return new wb(t)};function Sb(t){return t<0?-1:1}function xb(t,e,i){var n=t._x1-t._x0,r=e-t._x1,a=(t._y1-t._y0)/(n||r<0&&-0),o=(i-t._y1)/(r||n<0&&-0),s=(a*r+o*n)/(n+r);return(Sb(a)+Sb(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Mb(t,e){var i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function Tb(t,e,i){var n=t._x0,r=t._y0,a=t._x1,o=t._y1,s=(a-n)/3;t._context.bezierCurveTo(n+s,r+s*e,a-s,o-s*i,a,o)}function kb(t){this._context=t}function Eb(t){this._context=new Ab(t)}function Ab(t){this._context=t}function Rb(t){return new kb(t)}function Db(t){return new Eb(t)}function Ib(t){this._context=t}function Lb(t){var e,i,n=t.length-1,r=new Array(n),a=new Array(n),o=new Array(n);for(r[0]=0,a[0]=2,o[0]=t[0]+2*t[1],e=1;e<n-1;++e)r[e]=1,a[e]=4,o[e]=4*t[e]+2*t[e+1];for(r[n-1]=2,a[n-1]=7,o[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)i=r[e]/a[e-1],a[e]-=i,o[e]-=i*o[e-1];for(r[n-1]=o[n-1]/a[n-1],e=n-2;e>=0;--e)r[e]=(o[e]-r[e+1])/a[e];for(a[n-1]=(t[n]+r[n-1])/2,e=0;e<n-1;++e)a[e]=2*t[e+1]-r[e+1];return[r,a]}kb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Tb(this,this._t0,Mb(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var i=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Tb(this,Mb(this,i=xb(this,t,e)),i);break;default:Tb(this,this._t0,i=xb(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=i}}},(Eb.prototype=Object.create(kb.prototype)).point=function(t,e){kb.prototype.point.call(this,e,t)},Ab.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,i,n,r,a){this._context.bezierCurveTo(e,t,n,i,a,r)}},Ib.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,i=t.length;if(i)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===i)this._context.lineTo(t[1],e[1]);else for(var n=Lb(t),r=Lb(e),a=0,o=1;o<i;++a,++o)this._context.bezierCurveTo(n[0][a],r[0][a],n[1][a],r[1][a],t[o],e[o]);(this._line||0!==this._line&&1===i)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var Nb=function(t){return new Ib(t)};function Ob(t,e){this._context=t,this._t=e}Ob.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var i=this._x*(1-this._t)+t*this._t;this._context.lineTo(i,this._y),this._context.lineTo(i,e)}}this._x=t,this._y=e}};var Pb=function(t){return new Ob(t,.5)};function Bb(t){return new Ob(t,0)}function qb(t){return new Ob(t,1)}var Gb=function(t,e){if((r=t.length)>1)for(var i,n,r,a=1,o=t[e[0]],s=o.length;a<r;++a)for(n=o,o=t[e[a]],i=0;i<s;++i)o[i][1]+=o[i][0]=isNaN(n[i][1])?n[i][0]:n[i][1]},Vb=function(t){for(var e=t.length,i=new Array(e);--e>=0;)i[e]=e;return i};function Wb(t,e){return t[e]}var Ub=function(){var t=W_([]),e=Vb,i=Gb,n=Wb;function r(r){var a,o,s=t.apply(this,arguments),u=r.length,c=s.length,l=new Array(c);for(a=0;a<c;++a){for(var p,h=s[a],d=l[a]=new Array(u),f=0;f<u;++f)d[f]=p=[0,+n(r[f],h,f,r)],p.data=r[f];d.key=h}for(a=0,o=e(l);a<c;++a)l[o[a]].index=a;return i(l,o),l}return r.keys=function(e){return arguments.length?(t="function"==typeof e?e:W_(Sz.call(e)),r):t},r.value=function(t){return arguments.length?(n="function"==typeof t?t:W_(+t),r):n},r.order=function(t){return arguments.length?(e=null==t?Vb:"function"==typeof t?t:W_(Sz.call(t)),r):e},r.offset=function(t){return arguments.length?(i=null==t?Gb:t,r):i},r},Fb=function(t,e){if((n=t.length)>0){for(var i,n,r,a=0,o=t[0].length;a<o;++a){for(r=i=0;i<n;++i)r+=t[i][a][1]||0;if(r)for(i=0;i<n;++i)t[i][a][1]/=r}Gb(t,e)}},jb=function(t,e){if((s=t.length)>1)for(var i,n,r,a,o,s,u=0,c=t[e[0]].length;u<c;++u)for(a=o=0,i=0;i<s;++i)(r=(n=t[e[i]][u])[1]-n[0])>=0?(n[0]=a,n[1]=a+=r):r<0?(n[1]=o,n[0]=o+=r):n[0]=a},Hb=function(t,e){if((i=t.length)>0){for(var i,n=0,r=t[e[0]],a=r.length;n<a;++n){for(var o=0,s=0;o<i;++o)s+=t[o][n][1]||0;r[n][1]+=r[n][0]=-s/2}Gb(t,e)}},Yb=function(t,e){if((r=t.length)>0&&(n=(i=t[e[0]]).length)>0){for(var i,n,r,a=0,o=1;o<n;++o){for(var s=0,u=0,c=0;s<r;++s){for(var l=t[e[s]],p=l[o][1]||0,h=(p-(l[o-1][1]||0))/2,d=0;d<s;++d){var f=t[e[d]];h+=(f[o][1]||0)-(f[o-1][1]||0)}u+=p,c+=h*p}i[o-1][1]+=i[o-1][0]=a,u&&(a-=c/u)}i[o-1][1]+=i[o-1][0]=a,Gb(t,e)}},$b=function(t){var e=t.map(Xb);return Vb(t).sort(function(t,i){return e[t]-e[i]})};function Xb(t){for(var e,i=-1,n=0,r=t.length,a=-1/0;++i<r;)(e=+t[i][1])>a&&(a=e,n=i);return n}var Kb=function(t){var e=t.map(Jb);return Vb(t).sort(function(t,i){return e[t]-e[i]})};function Jb(t){for(var e,i=0,n=-1,r=t.length;++n<r;)(e=+t[n][1])&&(i+=e);return i}var Qb=function(t){return Kb(t).reverse()},Zb=function(t){var e,i,n=t.length,r=t.map(Jb),a=$b(t),o=0,s=0,u=[],c=[];for(e=0;e<n;++e)i=a[e],o<s?(o+=r[i],u.push(i)):(s+=r[i],c.push(i));return c.reverse().concat(u)},tw=function(t){return Vb(t).reverse()},ew=function(t){return function(){return t}};function iw(t){return t[0]}function nw(t){return t[1]}function rw(){this._=null}function aw(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ow(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function sw(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function uw(t){for(;t.L;)t=t.L;return t}rw.prototype={constructor:rw,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=uw(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)i===(n=i.U).L?(r=n.R)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(ow(this,i),i=(t=i).U),i.C=!1,n.C=!0,sw(this,n)):(r=n.L)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(sw(this,i),i=(t=i).U),i.C=!1,n.C=!0,ow(this,n)),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,i,n,r=t.U,a=t.L,o=t.R;if(i=a?o?uw(o):a:o,r?r.L===t?r.L=i:r.R=i:this._=i,a&&o?(n=i.C,i.C=t.C,i.L=a,a.U=i,i!==o?(r=i.U,i.U=t.U,t=i.R,r.L=t,i.R=o,o.U=i):(i.U=r,r=i,t=i.R)):(n=t.C,t=i),t&&(t.U=r),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===r.L){if((e=r.R).C&&(e.C=!1,r.C=!0,ow(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,sw(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,ow(this,r),t=this._;break}}else if((e=r.L).C&&(e.C=!1,r.C=!0,sw(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ow(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,sw(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}};var cw=rw;function lw(t,e,i,n){var r=[null,null],a=Lw.push(r)-1;return r.left=t,r.right=e,i&&hw(r,t,e,i),n&&hw(r,e,t,n),Dw[t.index].halfedges.push(a),Dw[e.index].halfedges.push(a),r}function pw(t,e,i){var n=[e,i];return n.left=t,n}function hw(t,e,i,n){t[0]||t[1]?t.left===i?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=i)}function dw(t,e,i,n,r){var a,o=t[0],s=t[1],u=o[0],c=o[1],l=0,p=1,h=s[0]-u,d=s[1]-c;if(a=e-u,h||!(a>0)){if(a/=h,h<0){if(a<l)return;a<p&&(p=a)}else if(h>0){if(a>p)return;a>l&&(l=a)}if(a=n-u,h||!(a<0)){if(a/=h,h<0){if(a>p)return;a>l&&(l=a)}else if(h>0){if(a<l)return;a<p&&(p=a)}if(a=i-c,d||!(a>0)){if(a/=d,d<0){if(a<l)return;a<p&&(p=a)}else if(d>0){if(a>p)return;a>l&&(l=a)}if(a=r-c,d||!(a<0)){if(a/=d,d<0){if(a>p)return;a>l&&(l=a)}else if(d>0){if(a<l)return;a<p&&(p=a)}return!(l>0||p<1)||(l>0&&(t[0]=[u+l*h,c+l*d]),p<1&&(t[1]=[u+p*h,c+p*d]),!0)}}}}}function fw(t,e,i,n,r){var a=t[1];if(a)return!0;var o,s,u=t[0],c=t.left,l=t.right,p=c[0],h=c[1],d=l[0],f=l[1],v=(p+d)/2,g=(h+f)/2;if(f===h){if(v<e||v>=n)return;if(p>d){if(u){if(u[1]>=r)return}else u=[v,i];a=[v,r]}else{if(u){if(u[1]<i)return}else u=[v,r];a=[v,i]}}else if(s=g-(o=(p-d)/(f-h))*v,o<-1||o>1)if(p>d){if(u){if(u[1]>=r)return}else u=[(i-s)/o,i];a=[(r-s)/o,r]}else{if(u){if(u[1]<i)return}else u=[(r-s)/o,r];a=[(i-s)/o,i]}else if(h<f){if(u){if(u[0]>=n)return}else u=[e,o*e+s];a=[n,o*n+s]}else{if(u){if(u[0]<e)return}else u=[n,o*n+s];a=[e,o*e+s]}return t[0]=u,t[1]=a,!0}function vw(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function gw(t,e){return e[+(e.left!==t.site)]}function mw(t,e){return e[+(e.left===t.site)]}var yw,_w=[];function zw(){aw(this),this.x=this.y=this.arc=this.site=this.cy=null}function bw(t){var e=t.P,i=t.N;if(e&&i){var n=e.site,r=t.site,a=i.site;if(n!==a){var o=r[0],s=r[1],u=n[0]-o,c=n[1]-s,l=a[0]-o,p=a[1]-s,h=2*(u*p-c*l);if(!(h>=-Ow)){var d=u*u+c*c,f=l*l+p*p,v=(p*d-c*f)/h,g=(u*f-l*d)/h,m=_w.pop()||new zw;m.arc=t,m.site=r,m.x=v+o,m.y=(m.cy=g+s)+Math.sqrt(v*v+g*g),t.circle=m;for(var y=null,_=Iw._;_;)if(m.y<_.y||m.y===_.y&&m.x<=_.x){if(!_.L){y=_.P;break}_=_.L}else{if(!_.R){y=_;break}_=_.R}Iw.insert(y,m),y||(yw=m)}}}}function ww(t){var e=t.circle;e&&(e.P||(yw=e.N),Iw.remove(e),_w.push(e),aw(e),t.circle=null)}var Cw=[];function Sw(){aw(this),this.edge=this.site=this.circle=null}function xw(t){var e=Cw.pop()||new Sw;return e.site=t,e}function Mw(t){ww(t),Rw.remove(t),Cw.push(t),aw(t)}function Tw(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,o=t.N,s=[t];Mw(t);for(var u=a;u.circle&&Math.abs(i-u.circle.x)<Nw&&Math.abs(n-u.circle.cy)<Nw;)a=u.P,s.unshift(u),Mw(u),u=a;s.unshift(u),ww(u);for(var c=o;c.circle&&Math.abs(i-c.circle.x)<Nw&&Math.abs(n-c.circle.cy)<Nw;)o=c.N,s.push(c),Mw(c),c=o;s.push(c),ww(c);var l,p=s.length;for(l=1;l<p;++l)c=s[l],u=s[l-1],hw(c.edge,u.site,c.site,r);u=s[0],(c=s[p-1]).edge=lw(u.site,c.site,null,r),bw(u),bw(c)}function kw(t){for(var e,i,n,r,a=t[0],o=t[1],s=Rw._;s;)if((n=Ew(s,o)-a)>Nw)s=s.L;else{if(!((r=a-Aw(s,o))>Nw)){n>-Nw?(e=s.P,i=s):r>-Nw?(e=s,i=s.N):e=i=s;break}if(!s.R){e=s;break}s=s.R}!function(t){Dw[t.index]={site:t,halfedges:[]}}(t);var u=xw(t);if(Rw.insert(e,u),e||i){if(e===i)return ww(e),i=xw(e.site),Rw.insert(u,i),u.edge=i.edge=lw(e.site,u.site),bw(e),void bw(i);if(i){ww(e),ww(i);var c=e.site,l=c[0],p=c[1],h=t[0]-l,d=t[1]-p,f=i.site,v=f[0]-l,g=f[1]-p,m=2*(h*g-d*v),y=h*h+d*d,_=v*v+g*g,z=[(g*y-d*_)/m+l,(h*_-v*y)/m+p];hw(i.edge,c,f,z),u.edge=lw(c,t,null,z),i.edge=lw(t,f,null,z),bw(e),bw(i)}else u.edge=lw(e.site,u.site)}}function Ew(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var o=t.P;if(!o)return-1/0;var s=(i=o.site)[0],u=i[1],c=u-e;if(!c)return s;var l=s-n,p=1/a-1/c,h=l/c;return p?(-h+Math.sqrt(h*h-2*p*(l*l/(-2*c)-u+c/2+r-a/2)))/p+n:(n+s)/2}function Aw(t,e){var i=t.N;if(i)return Ew(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var Rw,Dw,Iw,Lw,Nw=1e-6,Ow=1e-12;function Pw(t,e){return e[1]-t[1]||e[0]-t[0]}function Bw(t,e){var i,n,r,a=t.sort(Pw).pop();for(Lw=[],Dw=new Array(t.length),Rw=new cw,Iw=new cw;;)if(r=yw,a&&(!r||a[1]<r.y||a[1]===r.y&&a[0]<r.x))a[0]===i&&a[1]===n||(kw(a),i=a[0],n=a[1]),a=t.pop();else{if(!r)break;Tw(r.arc)}if(function(){for(var t,e,i,n,r=0,a=Dw.length;r<a;++r)if((t=Dw[r])&&(n=(e=t.halfedges).length)){var o=new Array(n),s=new Array(n);for(i=0;i<n;++i)o[i]=i,s[i]=vw(t,Lw[e[i]]);for(o.sort(function(t,e){return s[e]-s[t]}),i=0;i<n;++i)s[i]=e[o[i]];for(i=0;i<n;++i)e[i]=s[i]}}(),e){var o=+e[0][0],s=+e[0][1],u=+e[1][0],c=+e[1][1];!function(t,e,i,n){for(var r,a=Lw.length;a--;)fw(r=Lw[a],t,e,i,n)&&dw(r,t,e,i,n)&&(Math.abs(r[0][0]-r[1][0])>Nw||Math.abs(r[0][1]-r[1][1])>Nw)||delete Lw[a]}(o,s,u,c),function(t,e,i,n){var r,a,o,s,u,c,l,p,h,d,f,v,g=Dw.length,m=!0;for(r=0;r<g;++r)if(a=Dw[r]){for(o=a.site,s=(u=a.halfedges).length;s--;)Lw[u[s]]||u.splice(s,1);for(s=0,c=u.length;s<c;)f=(d=mw(a,Lw[u[s]]))[0],v=d[1],p=(l=gw(a,Lw[u[++s%c]]))[0],h=l[1],(Math.abs(f-p)>Nw||Math.abs(v-h)>Nw)&&(u.splice(s,0,Lw.push(pw(o,d,Math.abs(f-t)<Nw&&n-v>Nw?[t,Math.abs(p-t)<Nw?h:n]:Math.abs(v-n)<Nw&&i-f>Nw?[Math.abs(h-n)<Nw?p:i,n]:Math.abs(f-i)<Nw&&v-e>Nw?[i,Math.abs(p-i)<Nw?h:e]:Math.abs(v-e)<Nw&&f-t>Nw?[Math.abs(h-e)<Nw?p:t,e]:null))-1),++c);c&&(m=!1)}if(m){var y,_,z,b=1/0;for(r=0,m=null;r<g;++r)(a=Dw[r])&&(z=(y=(o=a.site)[0]-t)*y+(_=o[1]-e)*_)<b&&(b=z,m=a);if(m){var w=[t,e],C=[t,n],S=[i,n],x=[i,e];m.halfedges.push(Lw.push(pw(o=m.site,w,C))-1,Lw.push(pw(o,C,S))-1,Lw.push(pw(o,S,x))-1,Lw.push(pw(o,x,w))-1)}}for(r=0;r<g;++r)(a=Dw[r])&&(a.halfedges.length||delete Dw[r])}(o,s,u,c)}this.edges=Lw,this.cells=Dw,Rw=Iw=Lw=Dw=null}Bw.prototype={constructor:Bw,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(i){return gw(e,t[i])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(a=(r=i.halfedges).length)for(var r,a,o,s,u,c,l=i.site,p=-1,h=e[r[a-1]],d=h.left===l?h.right:h.left;++p<a;)o=d,d=(h=e[r[p]]).left===l?h.right:h.left,o&&d&&n<o.index&&n<d.index&&(u=o,c=d,((s=l)[0]-c[0])*(u[1]-s[1])-(s[0]-u[0])*(c[1]-s[1])<0)&&t.push([l.data,o.data,d.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n,r,a=this,o=a._found||0,s=a.cells.length;!(r=a.cells[o]);)if(++o>=s)return null;var u=t-r.site[0],c=e-r.site[1],l=u*u+c*c;do{r=a.cells[n=o],o=null,r.halfedges.forEach(function(i){var n=a.edges[i],s=n.left;if(s!==r.site&&s||(s=n.right)){var u=t-s[0],c=e-s[1],p=u*u+c*c;p<l&&(l=p,o=s.index)}})}while(null!==o);return a._found=n,null==i||l<=i*i?r.site:null}};var qw=function(){var t=iw,e=nw,i=null;function n(n){return new Bw(n.map(function(i,r){var a=[Math.round(t(i,r,n)/Nw)*Nw,Math.round(e(i,r,n)/Nw)*Nw];return a.index=r,a.data=i,a}),i)}return n.polygons=function(t){return n(t).polygons()},n.links=function(t){return n(t).links()},n.triangles=function(t){return n(t).triangles()},n.x=function(e){return arguments.length?(t="function"==typeof e?e:ew(+e),n):t},n.y=function(t){return arguments.length?(e="function"==typeof t?t:ew(+t),n):e},n.extent=function(t){return arguments.length?(i=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],n):i&&[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},n.size=function(t){return arguments.length?(i=null==t?null:[[0,0],[+t[0],+t[1]]],n):i&&[i[1][0]-i[0][0],i[1][1]-i[0][1]]},n},Gw=function(t){return function(){return t}};function Vw(t,e,i){this.target=t,this.type=e,this.transform=i}function Ww(t,e,i){this.k=t,this.x=e,this.y=i}Ww.prototype={constructor:Ww,scale:function(t){return 1===t?this:new Ww(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Ww(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Uw=new Ww(1,0,0);function Fw(t){return t.__zoom||Uw}function jw(){Ft.stopImmediatePropagation()}Fw.prototype=Ww.prototype;var Hw=function(){Ft.preventDefault(),Ft.stopImmediatePropagation()};function Yw(){return!Ft.button}function $w(){var t,e,i=this;return i instanceof SVGElement?(t=(i=i.ownerSVGElement||i).width.baseVal.value,e=i.height.baseVal.value):(t=i.clientWidth,e=i.clientHeight),[[0,0],[t,e]]}function Xw(){return this.__zoom||Uw}function Kw(){return-Ft.deltaY*(Ft.deltaMode?120:1)/500}function Jw(){return"ontouchstart"in this}function Qw(t,e,i){var n=t.invertX(e[0][0])-i[0][0],r=t.invertX(e[1][0])-i[1][0],a=t.invertY(e[0][1])-i[0][1],o=t.invertY(e[1][1])-i[1][1];return t.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}var Zw=function(){var t,e,i=Yw,n=$w,r=Qw,a=Kw,o=Jw,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],c=250,l=on,p=[],h=ht("start","zoom","end"),d=500,f=150,v=0;function g(t){t.property("__zoom",Xw).on("wheel.zoom",C).on("mousedown.zoom",S).on("dblclick.zoom",x).filter(o).on("touchstart.zoom",M).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(t,e){return(e=Math.max(s[0],Math.min(s[1],e)))===t.k?t:new Ww(e,t.x,t.y)}function y(t,e,i){var n=e[0]-i[0]*t.k,r=e[1]-i[1]*t.k;return n===t.x&&r===t.y?t:new Ww(t.k,n,r)}function _(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function z(t,e,i){t.on("start.zoom",function(){b(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).end()}).tween("zoom",function(){var t=arguments,r=b(this,t),a=n.apply(this,t),o=i||_(a),s=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=this.__zoom,c="function"==typeof e?e.apply(this,t):e,p=l(u.invert(o).concat(s/u.k),c.invert(o).concat(s/c.k));return function(t){if(1===t)t=c;else{var e=p(t),i=s/e[2];t=new Ww(i,o[0]-e[0]*i,o[1]-e[1]*i)}r.zoom(null,t)}})}function b(t,e){for(var i,n=0,r=p.length;n<r;++n)if((i=p[n]).that===t)return i;return new w(t,e)}function w(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=n.apply(t,e)}function C(){if(i.apply(this,arguments)){var t=b(this,arguments),e=this.__zoom,n=Math.max(s[0],Math.min(s[1],e.k*Math.pow(2,a.apply(this,arguments)))),o=ue(this);if(t.wheel)t.mouse[0][0]===o[0]&&t.mouse[0][1]===o[1]||(t.mouse[1]=e.invert(t.mouse[0]=o)),clearTimeout(t.wheel);else{if(e.k===n)return;t.mouse=[o,e.invert(o)],Zn(this),t.start()}Hw(),t.wheel=setTimeout(function(){t.wheel=null,t.end()},f),t.zoom("mouse",r(y(m(e,n),t.mouse[0],t.mouse[1]),t.extent,u))}}function S(){if(!e&&i.apply(this,arguments)){var t=b(this,arguments),n=ee(Ft.view).on("mousemove.zoom",function(){if(Hw(),!t.moved){var e=Ft.clientX-o,i=Ft.clientY-s;t.moved=e*e+i*i>v}t.zoom("mouse",r(y(t.that.__zoom,t.mouse[0]=ue(t.that),t.mouse[1]),t.extent,u))},!0).on("mouseup.zoom",function(){n.on("mousemove.zoom mouseup.zoom",null),ve(Ft.view,t.moved),Hw(),t.end()},!0),a=ue(this),o=Ft.clientX,s=Ft.clientY;fe(Ft.view),jw(),t.mouse=[a,this.__zoom.invert(a)],Zn(this),t.start()}}function x(){if(i.apply(this,arguments)){var t=this.__zoom,e=ue(this),a=t.invert(e),o=t.k*(Ft.shiftKey?.5:2),s=r(y(m(t,o),e,a),n.apply(this,arguments),u);Hw(),c>0?ee(this).transition().duration(c).call(z,s,e):ee(this).call(g.transform,s)}}function M(){if(i.apply(this,arguments)){var e,n,r,a,o=b(this,arguments),s=Ft.changedTouches,u=s.length;for(jw(),n=0;n<u;++n)r=s[n],a=[a=le(this,s,r.identifier),this.__zoom.invert(a),r.identifier],o.touch0?o.touch1||(o.touch1=a):(o.touch0=a,e=!0);if(t&&(t=clearTimeout(t),!o.touch1))return o.end(),void((a=ee(this).on("dblclick.zoom"))&&a.apply(this,arguments));e&&(t=setTimeout(function(){t=null},d),Zn(this),o.start())}}function T(){var e,i,n,a,o=b(this,arguments),s=Ft.changedTouches,c=s.length;for(Hw(),t&&(t=clearTimeout(t)),e=0;e<c;++e)i=s[e],n=le(this,s,i.identifier),o.touch0&&o.touch0[2]===i.identifier?o.touch0[0]=n:o.touch1&&o.touch1[2]===i.identifier&&(o.touch1[0]=n);if(i=o.that.__zoom,o.touch1){var l=o.touch0[0],p=o.touch0[1],h=o.touch1[0],d=o.touch1[1],f=(f=h[0]-l[0])*f+(f=h[1]-l[1])*f,v=(v=d[0]-p[0])*v+(v=d[1]-p[1])*v;i=m(i,Math.sqrt(f/v)),n=[(l[0]+h[0])/2,(l[1]+h[1])/2],a=[(p[0]+d[0])/2,(p[1]+d[1])/2]}else{if(!o.touch0)return;n=o.touch0[0],a=o.touch0[1]}o.zoom("touch",r(y(i,n,a),o.extent,u))}function k(){var t,i,n=b(this,arguments),r=Ft.changedTouches,a=r.length;for(jw(),e&&clearTimeout(e),e=setTimeout(function(){e=null},d),t=0;t<a;++t)i=r[t],n.touch0&&n.touch0[2]===i.identifier?delete n.touch0:n.touch1&&n.touch1[2]===i.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0?n.touch0[1]=this.__zoom.invert(n.touch0[0]):n.end()}return g.transform=function(t,e){var i=t.selection?t.selection():t;i.property("__zoom",Xw),t!==i?z(t,e):i.interrupt().each(function(){b(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},g.scaleBy=function(t,e){g.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)})},g.scaleTo=function(t,e){g.transform(t,function(){var t=n.apply(this,arguments),i=this.__zoom,a=_(t),o=i.invert(a),s="function"==typeof e?e.apply(this,arguments):e;return r(y(m(i,s),a,o),t,u)})},g.translateBy=function(t,e,i){g.transform(t,function(){return r(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof i?i.apply(this,arguments):i),n.apply(this,arguments),u)})},g.translateTo=function(t,e,i){g.transform(t,function(){var t=n.apply(this,arguments),a=this.__zoom,o=_(t);return r(Uw.translate(o[0],o[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof i?-i.apply(this,arguments):-i),t,u)})},w.prototype={start:function(){return 1==++this.active&&(this.index=p.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(p.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){Xt(new Vw(g,t,this.that.__zoom),h.apply,h,[t,this.that,this.args])}},g.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Gw(+t),g):a},g.filter=function(t){return arguments.length?(i="function"==typeof t?t:Gw(!!t),g):i},g.touchable=function(t){return arguments.length?(o="function"==typeof t?t:Gw(!!t),g):o},g.extent=function(t){return arguments.length?(n="function"==typeof t?t:Gw([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),g):n},g.scaleExtent=function(t){return arguments.length?(s[0]=+t[0],s[1]=+t[1],g):[s[0],s[1]]},g.translateExtent=function(t){return arguments.length?(u[0][0]=+t[0][0],u[1][0]=+t[1][0],u[0][1]=+t[0][1],u[1][1]=+t[1][1],g):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},g.constrain=function(t){return arguments.length?(r=t,g):r},g.duration=function(t){return arguments.length?(c=+t,g):c},g.interpolate=function(t){return arguments.length?(l=t,g):l},g.on=function(){var t=h.on.apply(h,arguments);return t===h?g:t},g.clickDistance=function(t){return arguments.length?(v=(t=+t)*t,g):Math.sqrt(v)},g};i.d(e,"version",function(){return"5.8.0"}),i.d(e,"bisect",function(){return u}),i.d(e,"bisectRight",function(){return o}),i.d(e,"bisectLeft",function(){return s}),i.d(e,"ascending",function(){return n}),i.d(e,"bisector",function(){return r}),i.d(e,"cross",function(){return p}),i.d(e,"descending",function(){return h}),i.d(e,"deviation",function(){return v}),i.d(e,"extent",function(){return g}),i.d(e,"histogram",function(){return A}),i.d(e,"thresholdFreedmanDiaconis",function(){return D}),i.d(e,"thresholdScott",function(){return I}),i.d(e,"thresholdSturges",function(){return E}),i.d(e,"max",function(){return L}),i.d(e,"mean",function(){return N}),i.d(e,"median",function(){return O}),i.d(e,"merge",function(){return P}),i.d(e,"min",function(){return B}),i.d(e,"pairs",function(){return c}),i.d(e,"permute",function(){return q}),i.d(e,"quantile",function(){return R}),i.d(e,"range",function(){return w}),i.d(e,"scan",function(){return G}),i.d(e,"shuffle",function(){return V}),i.d(e,"sum",function(){return W}),i.d(e,"ticks",function(){return M}),i.d(e,"tickIncrement",function(){return T}),i.d(e,"tickStep",function(){return k}),i.d(e,"transpose",function(){return U}),i.d(e,"variance",function(){return f}),i.d(e,"zip",function(){return j}),i.d(e,"axisTop",function(){return nt}),i.d(e,"axisRight",function(){return rt}),i.d(e,"axisBottom",function(){return at}),i.d(e,"axisLeft",function(){return ot}),i.d(e,"brush",function(){return Sa}),i.d(e,"brushX",function(){return wa}),i.d(e,"brushY",function(){return Ca}),i.d(e,"brushSelection",function(){return ba}),i.d(e,"chord",function(){return Da}),i.d(e,"ribbon",function(){return Ha}),i.d(e,"nest",function(){return Ka}),i.d(e,"set",function(){return ro}),i.d(e,"map",function(){return Xa}),i.d(e,"keys",function(){return ao}),i.d(e,"values",function(){return oo}),i.d(e,"entries",function(){return so}),i.d(e,"color",function(){return Be}),i.d(e,"rgb",function(){return We}),i.d(e,"hsl",function(){return He}),i.d(e,"lab",function(){return oi}),i.d(e,"hcl",function(){return fi}),i.d(e,"lch",function(){return di}),i.d(e,"gray",function(){return ai}),i.d(e,"cubehelix",function(){return wi}),i.d(e,"contours",function(){return yo}),i.d(e,"contourDensity",function(){return So}),i.d(e,"dispatch",function(){return ht}),i.d(e,"drag",function(){return we}),i.d(e,"dragDisable",function(){return fe}),i.d(e,"dragEnable",function(){return ve}),i.d(e,"dsvFormat",function(){return Ro}),i.d(e,"csvParse",function(){return Io}),i.d(e,"csvParseRows",function(){return Lo}),i.d(e,"csvFormat",function(){return No}),i.d(e,"csvFormatRows",function(){return Oo}),i.d(e,"tsvParse",function(){return Bo}),i.d(e,"tsvParseRows",function(){return qo}),i.d(e,"tsvFormat",function(){return Go}),i.d(e,"tsvFormatRows",function(){return Vo}),i.d(e,"easeLinear",function(){return cr}),i.d(e,"easeQuad",function(){return hr}),i.d(e,"easeQuadIn",function(){return lr}),i.d(e,"easeQuadOut",function(){return pr}),i.d(e,"easeQuadInOut",function(){return hr}),i.d(e,"easeCubic",function(){return vr}),i.d(e,"easeCubicIn",function(){return dr}),i.d(e,"easeCubicOut",function(){return fr}),i.d(e,"easeCubicInOut",function(){return vr}),i.d(e,"easePoly",function(){return yr}),i.d(e,"easePolyIn",function(){return gr}),i.d(e,"easePolyOut",function(){return mr}),i.d(e,"easePolyInOut",function(){return yr}),i.d(e,"easeSin",function(){return Cr}),i.d(e,"easeSinIn",function(){return br}),i.d(e,"easeSinOut",function(){return wr}),i.d(e,"easeSinInOut",function(){return Cr}),i.d(e,"easeExp",function(){return Mr}),i.d(e,"easeExpIn",function(){return Sr}),i.d(e,"easeExpOut",function(){return xr}),i.d(e,"easeExpInOut",function(){return Mr}),i.d(e,"easeCircle",function(){return Er}),i.d(e,"easeCircleIn",function(){return Tr}),i.d(e,"easeCircleOut",function(){return kr}),i.d(e,"easeCircleInOut",function(){return Er}),i.d(e,"easeBounce",function(){return Vr}),i.d(e,"easeBounceIn",function(){return Gr}),i.d(e,"easeBounceOut",function(){return Vr}),i.d(e,"easeBounceInOut",function(){return Wr}),i.d(e,"easeBack",function(){return jr}),i.d(e,"easeBackIn",function(){return Ur}),i.d(e,"easeBackOut",function(){return Fr}),i.d(e,"easeBackInOut",function(){return jr}),i.d(e,"easeElastic",function(){return $r}),i.d(e,"easeElasticIn",function(){return Yr}),i.d(e,"easeElasticOut",function(){return $r}),i.d(e,"easeElasticInOut",function(){return Xr}),i.d(e,"blob",function(){return Uo}),i.d(e,"buffer",function(){return jo}),i.d(e,"dsv",function(){return Xo}),i.d(e,"csv",function(){return Ko}),i.d(e,"tsv",function(){return Jo}),i.d(e,"image",function(){return Qo}),i.d(e,"json",function(){return ts}),i.d(e,"text",function(){return Yo}),i.d(e,"xml",function(){return is}),i.d(e,"html",function(){return ns}),i.d(e,"svg",function(){return rs}),i.d(e,"forceCenter",function(){return as}),i.d(e,"forceCollide",function(){return ys}),i.d(e,"forceLink",function(){return bs}),i.d(e,"forceManyBody",function(){return Ts}),i.d(e,"forceRadial",function(){return ks}),i.d(e,"forceSimulation",function(){return Ms}),i.d(e,"forceX",function(){return Es}),i.d(e,"forceY",function(){return As}),i.d(e,"formatDefaultLocale",function(){return Hs}),i.d(e,"format",function(){return Bs}),i.d(e,"formatPrefix",function(){return qs}),i.d(e,"formatLocale",function(){return js}),i.d(e,"formatSpecifier",function(){return Ls}),i.d(e,"precisionFixed",function(){return Ys}),i.d(e,"precisionPrefix",function(){return $s}),i.d(e,"precisionRound",function(){return Xs}),i.d(e,"geoArea",function(){return Vu}),i.d(e,"geoBounds",function(){return Ic}),i.d(e,"geoCentroid",function(){return jc}),i.d(e,"geoCircle",function(){return il}),i.d(e,"geoClipAntimeridian",function(){return dl}),i.d(e,"geoClipCircle",function(){return fl}),i.d(e,"geoClipExtent",function(){return wl}),i.d(e,"geoClipRectangle",function(){return yl}),i.d(e,"geoContains",function(){return Gl}),i.d(e,"geoDistance",function(){return Rl}),i.d(e,"geoGraticule",function(){return Ul}),i.d(e,"geoGraticule10",function(){return Fl}),i.d(e,"geoInterpolate",function(){return Xl}),i.d(e,"geoLength",function(){return kl}),i.d(e,"geoPath",function(){return Yp}),i.d(e,"geoAlbers",function(){return hh}),i.d(e,"geoAlbersUsa",function(){return dh}),i.d(e,"geoAzimuthalEqualArea",function(){return mh}),i.d(e,"geoAzimuthalEqualAreaRaw",function(){return gh}),i.d(e,"geoAzimuthalEquidistant",function(){return _h}),i.d(e,"geoAzimuthalEquidistantRaw",function(){return yh}),i.d(e,"geoConicConformal",function(){return xh}),i.d(e,"geoConicConformalRaw",function(){return Sh}),i.d(e,"geoConicEqualArea",function(){return ph}),i.d(e,"geoConicEqualAreaRaw",function(){return lh}),i.d(e,"geoConicEquidistant",function(){return Eh}),i.d(e,"geoConicEquidistantRaw",function(){return kh}),i.d(e,"geoEqualEarth",function(){return Oh}),i.d(e,"geoEqualEarthRaw",function(){return Nh}),i.d(e,"geoEquirectangular",function(){return Th}),i.d(e,"geoEquirectangularRaw",function(){return Mh}),i.d(e,"geoGnomonic",function(){return Bh}),i.d(e,"geoGnomonicRaw",function(){return Ph}),i.d(e,"geoIdentity",function(){return Gh}),i.d(e,"geoProjection",function(){return sh}),i.d(e,"geoProjectionMutator",function(){return uh}),i.d(e,"geoMercator",function(){return bh}),i.d(e,"geoMercatorRaw",function(){return zh}),i.d(e,"geoNaturalEarth1",function(){return Wh}),i.d(e,"geoNaturalEarth1Raw",function(){return Vh}),i.d(e,"geoOrthographic",function(){return Fh}),i.d(e,"geoOrthographicRaw",function(){return Uh}),i.d(e,"geoStereographic",function(){return Hh}),i.d(e,"geoStereographicRaw",function(){return jh}),i.d(e,"geoTransverseMercator",function(){return $h}),i.d(e,"geoTransverseMercatorRaw",function(){return Yh}),i.d(e,"geoRotation",function(){return Zc}),i.d(e,"geoStream",function(){return Iu}),i.d(e,"geoTransform",function(){return $p}),i.d(e,"cluster",function(){return Qh}),i.d(e,"hierarchy",function(){return td}),i.d(e,"pack",function(){return Sd}),i.d(e,"packSiblings",function(){return _d}),i.d(e,"packEnclose",function(){return od}),i.d(e,"partition",function(){return Ad}),i.d(e,"stratify",function(){return Od}),i.d(e,"tree",function(){return Ud}),i.d(e,"treemap",function(){return $d}),i.d(e,"treemapBinary",function(){return Xd}),i.d(e,"treemapDice",function(){return Ed}),i.d(e,"treemapSlice",function(){return Fd}),i.d(e,"treemapSliceDice",function(){return Kd}),i.d(e,"treemapSquarify",function(){return Yd}),i.d(e,"treemapResquarify",function(){return Jd}),i.d(e,"interpolate",function(){return Yi}),i.d(e,"interpolateArray",function(){return Oi}),i.d(e,"interpolateBasis",function(){return xi}),i.d(e,"interpolateBasisClosed",function(){return Mi}),i.d(e,"interpolateDate",function(){return Pi}),i.d(e,"interpolateDiscrete",function(){return $i}),i.d(e,"interpolateHue",function(){return Xi}),i.d(e,"interpolateNumber",function(){return Bi}),i.d(e,"interpolateObject",function(){return qi}),i.d(e,"interpolateRound",function(){return Ki}),i.d(e,"interpolateString",function(){return Hi}),i.d(e,"interpolateTransformCss",function(){return en}),i.d(e,"interpolateTransformSvg",function(){return nn}),i.d(e,"interpolateZoom",function(){return on}),i.d(e,"interpolateRgb",function(){return Di}),i.d(e,"interpolateRgbBasis",function(){return Li}),i.d(e,"interpolateRgbBasisClosed",function(){return Ni}),i.d(e,"interpolateHsl",function(){return un}),i.d(e,"interpolateHslLong",function(){return cn}),i.d(e,"interpolateLab",function(){return ln}),i.d(e,"interpolateHcl",function(){return hn}),i.d(e,"interpolateHclLong",function(){return dn}),i.d(e,"interpolateCubehelix",function(){return vn}),i.d(e,"interpolateCubehelixLong",function(){return gn}),i.d(e,"piecewise",function(){return mn}),i.d(e,"quantize",function(){return zn}),i.d(e,"path",function(){return Ga}),i.d(e,"polygonArea",function(){return Qd}),i.d(e,"polygonCentroid",function(){return Zd}),i.d(e,"polygonHull",function(){return rf}),i.d(e,"polygonContains",function(){return af}),i.d(e,"polygonLength",function(){return of}),i.d(e,"quadtree",function(){return hs}),i.d(e,"randomUniform",function(){return uf}),i.d(e,"randomNormal",function(){return cf}),i.d(e,"randomLogNormal",function(){return lf}),i.d(e,"randomBates",function(){return hf}),i.d(e,"randomIrwinHall",function(){return pf}),i.d(e,"randomExponential",function(){return df}),i.d(e,"scaleBand",function(){return bf}),i.d(e,"scalePoint",function(){return wf}),i.d(e,"scaleIdentity",function(){return Pf}),i.d(e,"scaleLinear",function(){return Of}),i.d(e,"scaleLog",function(){return Hf}),i.d(e,"scaleSymlog",function(){return Kf}),i.d(e,"scaleOrdinal",function(){return zf}),i.d(e,"scaleImplicit",function(){return _f}),i.d(e,"scalePow",function(){return ev}),i.d(e,"scaleSqrt",function(){return iv}),i.d(e,"scaleQuantile",function(){return nv}),i.d(e,"scaleQuantize",function(){return rv}),i.d(e,"scaleThreshold",function(){return av}),i.d(e,"scaleTime",function(){return ey}),i.d(e,"scaleUtc",function(){return iy}),i.d(e,"scaleSequential",function(){return ay}),i.d(e,"scaleSequentialLog",function(){return oy}),i.d(e,"scaleSequentialPow",function(){return uy}),i.d(e,"scaleSequentialSqrt",function(){return cy}),i.d(e,"scaleSequentialSymlog",function(){return sy}),i.d(e,"scaleSequentialQuantile",function(){return ly}),i.d(e,"scaleDiverging",function(){return hy}),i.d(e,"scaleDivergingLog",function(){return dy}),i.d(e,"scaleDivergingPow",function(){return vy}),i.d(e,"scaleDivergingSqrt",function(){return gy}),i.d(e,"scaleDivergingSymlog",function(){return fy}),i.d(e,"tickFormat",function(){return Lf}),i.d(e,"schemeCategory10",function(){return yy}),i.d(e,"schemeAccent",function(){return _y}),i.d(e,"schemeDark2",function(){return zy}),i.d(e,"schemePaired",function(){return by}),i.d(e,"schemePastel1",function(){return wy}),i.d(e,"schemePastel2",function(){return Cy}),i.d(e,"schemeSet1",function(){return Sy}),i.d(e,"schemeSet2",function(){return xy}),i.d(e,"schemeSet3",function(){return My}),i.d(e,"interpolateBrBG",function(){return Ey}),i.d(e,"schemeBrBG",function(){return ky}),i.d(e,"interpolatePRGn",function(){return Ry}),i.d(e,"schemePRGn",function(){return Ay}),i.d(e,"interpolatePiYG",function(){return Iy}),i.d(e,"schemePiYG",function(){return Dy}),i.d(e,"interpolatePuOr",function(){return Ny}),i.d(e,"schemePuOr",function(){return Ly}),i.d(e,"interpolateRdBu",function(){return Py}),i.d(e,"schemeRdBu",function(){return Oy}),i.d(e,"interpolateRdGy",function(){return qy}),i.d(e,"schemeRdGy",function(){return By}),i.d(e,"interpolateRdYlBu",function(){return Vy}),i.d(e,"schemeRdYlBu",function(){return Gy}),i.d(e,"interpolateRdYlGn",function(){return Uy}),i.d(e,"schemeRdYlGn",function(){return Wy}),i.d(e,"interpolateSpectral",function(){return jy}),i.d(e,"schemeSpectral",function(){return Fy}),i.d(e,"interpolateBuGn",function(){return Yy}),i.d(e,"schemeBuGn",function(){return Hy}),i.d(e,"interpolateBuPu",function(){return Xy}),i.d(e,"schemeBuPu",function(){return $y}),i.d(e,"interpolateGnBu",function(){return Jy}),i.d(e,"schemeGnBu",function(){return Ky}),i.d(e,"interpolateOrRd",function(){return Zy}),i.d(e,"schemeOrRd",function(){return Qy}),i.d(e,"interpolatePuBuGn",function(){return e_}),i.d(e,"schemePuBuGn",function(){return t_}),i.d(e,"interpolatePuBu",function(){return n_}),i.d(e,"schemePuBu",function(){return i_}),i.d(e,"interpolatePuRd",function(){return a_}),i.d(e,"schemePuRd",function(){return r_}),i.d(e,"interpolateRdPu",function(){return s_}),i.d(e,"schemeRdPu",function(){return o_}),i.d(e,"interpolateYlGnBu",function(){return c_}),i.d(e,"schemeYlGnBu",function(){return u_}),i.d(e,"interpolateYlGn",function(){return p_}),i.d(e,"schemeYlGn",function(){return l_}),i.d(e,"interpolateYlOrBr",function(){return d_}),i.d(e,"schemeYlOrBr",function(){return h_}),i.d(e,"interpolateYlOrRd",function(){return v_}),i.d(e,"schemeYlOrRd",function(){return f_}),i.d(e,"interpolateBlues",function(){return m_}),i.d(e,"schemeBlues",function(){return g_}),i.d(e,"interpolateGreens",function(){return __}),i.d(e,"schemeGreens",function(){return y_}),i.d(e,"interpolateGreys",function(){return b_}),i.d(e,"schemeGreys",function(){return z_}),i.d(e,"interpolatePurples",function(){return C_}),i.d(e,"schemePurples",function(){return w_}),i.d(e,"interpolateReds",function(){return x_}),i.d(e,"schemeReds",function(){return S_}),i.d(e,"interpolateOranges",function(){return T_}),i.d(e,"schemeOranges",function(){return M_}),i.d(e,"interpolateCubehelixDefault",function(){return k_}),i.d(e,"interpolateRainbow",function(){return D_}),i.d(e,"interpolateWarm",function(){return E_}),i.d(e,"interpolateCool",function(){return A_}),i.d(e,"interpolateSinebow",function(){return O_}),i.d(e,"interpolateViridis",function(){return B_}),i.d(e,"interpolateMagma",function(){return q_}),i.d(e,"interpolateInferno",function(){return G_}),i.d(e,"interpolatePlasma",function(){return V_}),i.d(e,"create",function(){return ie}),i.d(e,"creator",function(){return gt}),i.d(e,"local",function(){return re}),i.d(e,"matcher",function(){return bt}),i.d(e,"mouse",function(){return ue}),i.d(e,"namespace",function(){return vt}),i.d(e,"namespaces",function(){return ft}),i.d(e,"clientPoint",function(){return se}),i.d(e,"select",function(){return ee}),i.d(e,"selectAll",function(){return ce}),i.d(e,"selection",function(){return te}),i.d(e,"selector",function(){return yt}),i.d(e,"selectorAll",function(){return zt}),i.d(e,"style",function(){return Et}),i.d(e,"touch",function(){return le}),i.d(e,"touches",function(){return pe}),i.d(e,"window",function(){return kt}),i.d(e,"event",function(){return Ft}),i.d(e,"customEvent",function(){return Xt}),i.d(e,"arc",function(){return sz}),i.d(e,"area",function(){return dz}),i.d(e,"line",function(){return hz}),i.d(e,"pie",function(){return gz}),i.d(e,"areaRadial",function(){return wz}),i.d(e,"radialArea",function(){return wz}),i.d(e,"lineRadial",function(){return bz}),i.d(e,"radialLine",function(){return bz}),i.d(e,"pointRadial",function(){return Cz}),i.d(e,"linkHorizontal",function(){return Rz}),i.d(e,"linkVertical",function(){return Dz}),i.d(e,"linkRadial",function(){return Iz}),i.d(e,"symbol",function(){return Jz}),i.d(e,"symbols",function(){return Kz}),i.d(e,"symbolCircle",function(){return Lz}),i.d(e,"symbolCross",function(){return Nz}),i.d(e,"symbolDiamond",function(){return Bz}),i.d(e,"symbolSquare",function(){return Uz}),i.d(e,"symbolStar",function(){return Wz}),i.d(e,"symbolTriangle",function(){return jz}),i.d(e,"symbolWye",function(){return Xz}),i.d(e,"curveBasisClosed",function(){return nb}),i.d(e,"curveBasisOpen",function(){return ab}),i.d(e,"curveBasis",function(){return eb}),i.d(e,"curveBundle",function(){return sb}),i.d(e,"curveCardinalClosed",function(){return hb}),i.d(e,"curveCardinalOpen",function(){return fb}),i.d(e,"curveCardinal",function(){return lb}),i.d(e,"curveCatmullRomClosed",function(){return _b}),i.d(e,"curveCatmullRomOpen",function(){return bb}),i.d(e,"curveCatmullRom",function(){return mb}),i.d(e,"curveLinearClosed",function(){return Cb}),i.d(e,"curveLinear",function(){return cz}),i.d(e,"curveMonotoneX",function(){return Rb}),i.d(e,"curveMonotoneY",function(){return Db}),i.d(e,"curveNatural",function(){return Nb}),i.d(e,"curveStep",function(){return Pb}),i.d(e,"curveStepAfter",function(){return qb}),i.d(e,"curveStepBefore",function(){return Bb}),i.d(e,"stack",function(){return Ub}),i.d(e,"stackOffsetExpand",function(){return Fb}),i.d(e,"stackOffsetDiverging",function(){return jb}),i.d(e,"stackOffsetNone",function(){return Gb}),i.d(e,"stackOffsetSilhouette",function(){return Hb}),i.d(e,"stackOffsetWiggle",function(){return Yb}),i.d(e,"stackOrderAppearance",function(){return $b}),i.d(e,"stackOrderAscending",function(){return Kb}),i.d(e,"stackOrderDescending",function(){return Qb}),i.d(e,"stackOrderInsideOut",function(){return Zb}),i.d(e,"stackOrderNone",function(){return Vb}),i.d(e,"stackOrderReverse",function(){return tw}),i.d(e,"timeInterval",function(){return uv}),i.d(e,"timeMillisecond",function(){return lv}),i.d(e,"timeMilliseconds",function(){return pv}),i.d(e,"utcMillisecond",function(){return lv}),i.d(e,"utcMilliseconds",function(){return pv}),i.d(e,"timeSecond",function(){return vv}),i.d(e,"timeSeconds",function(){return gv}),i.d(e,"utcSecond",function(){return vv}),i.d(e,"utcSeconds",function(){return gv}),i.d(e,"timeMinute",function(){return yv}),i.d(e,"timeMinutes",function(){return _v}),i.d(e,"timeHour",function(){return bv}),i.d(e,"timeHours",function(){return wv}),i.d(e,"timeDay",function(){return Sv}),i.d(e,"timeDays",function(){return xv}),i.d(e,"timeWeek",function(){return Tv}),i.d(e,"timeWeeks",function(){return Lv}),i.d(e,"timeSunday",function(){return Tv}),i.d(e,"timeSundays",function(){return Lv}),i.d(e,"timeMonday",function(){return kv}),i.d(e,"timeMondays",function(){return Nv}),i.d(e,"timeTuesday",function(){return Ev}),i.d(e,"timeTuesdays",function(){return Ov}),i.d(e,"timeWednesday",function(){return Av}),i.d(e,"timeWednesdays",function(){return Pv}),i.d(e,"timeThursday",function(){return Rv}),i.d(e,"timeThursdays",function(){return Bv}),i.d(e,"timeFriday",function(){return Dv}),i.d(e,"timeFridays",function(){return qv}),i.d(e,"timeSaturday",function(){return Iv}),i.d(e,"timeSaturdays",function(){return Gv}),i.d(e,"timeMonth",function(){return Wv}),i.d(e,"timeMonths",function(){return Uv}),i.d(e,"timeYear",function(){return jv}),i.d(e,"timeYears",function(){return Hv}),i.d(e,"utcMinute",function(){return $v}),i.d(e,"utcMinutes",function(){return Xv}),i.d(e,"utcHour",function(){return Jv}),i.d(e,"utcHours",function(){return Qv}),i.d(e,"utcDay",function(){return tg}),i.d(e,"utcDays",function(){return eg}),i.d(e,"utcWeek",function(){return ng}),i.d(e,"utcWeeks",function(){return lg}),i.d(e,"utcSunday",function(){return ng}),i.d(e,"utcSundays",function(){return lg}),i.d(e,"utcMonday",function(){return rg}),i.d(e,"utcMondays",function(){return pg}),i.d(e,"utcTuesday",function(){return ag}),i.d(e,"utcTuesdays",function(){return hg}),i.d(e,"utcWednesday",function(){return og}),i.d(e,"utcWednesdays",function(){return dg}),i.d(e,"utcThursday",function(){return sg}),i.d(e,"utcThursdays",function(){return fg}),i.d(e,"utcFriday",function(){return ug}),i.d(e,"utcFridays",function(){return vg}),i.d(e,"utcSaturday",function(){return cg}),i.d(e,"utcSaturdays",function(){return gg}),i.d(e,"utcMonth",function(){return yg}),i.d(e,"utcMonths",function(){return _g}),i.d(e,"utcYear",function(){return bg}),i.d(e,"utcYears",function(){return wg}),i.d(e,"timeFormatDefaultLocale",function(){return Wm}),i.d(e,"timeFormat",function(){return kg}),i.d(e,"timeParse",function(){return Eg}),i.d(e,"utcFormat",function(){return Ag}),i.d(e,"utcParse",function(){return Rg}),i.d(e,"timeFormatLocale",function(){return Mg}),i.d(e,"isoFormat",function(){return Um}),i.d(e,"isoParse",function(){return Fm}),i.d(e,"now",function(){return An}),i.d(e,"timer",function(){return In}),i.d(e,"timerFlush",function(){return Ln}),i.d(e,"timeout",function(){return Bn}),i.d(e,"interval",function(){return qn}),i.d(e,"transition",function(){return or}),i.d(e,"active",function(){return Zr}),i.d(e,"interrupt",function(){return Zn}),i.d(e,"voronoi",function(){return qw}),i.d(e,"zoom",function(){return Zw}),i.d(e,"zoomTransform",function(){return Fw}),i.d(e,"zoomIdentity",function(){return Uw})}]));